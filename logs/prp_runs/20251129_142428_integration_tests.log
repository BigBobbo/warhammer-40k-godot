Godot Engine v4.5.1.stable.official.f62fdbde1 - https://godotengine.org

DEBUG: System args: ["-s", "addons/gut/gut_cmdln.gd", "-gdir", "res://tests/integration/", "-gprefix", "test_", "-gsuffix", ".gd", "-gexit"]
DEBUG: User args: []
DEBUG: Combined args: ["-s", "addons/gut/gut_cmdln.gd", "-gdir", "res://tests/integration/", "-gprefix", "test_", "-gsuffix", ".gd", "-gexit"]
DEBUG: Processing arg[0]: '-s'
DEBUG: Processing arg[1]: 'addons/gut/gut_cmdln.gd'
DEBUG: Processing arg[2]: '-gdir'
DEBUG: Processing arg[3]: 'res://tests/integration/'
DEBUG: Processing arg[4]: '-gprefix'
DEBUG: Processing arg[5]: 'test_'
DEBUG: Processing arg[6]: '-gsuffix'
DEBUG: Processing arg[7]: '.gd'
DEBUG: Processing arg[8]: '-gexit'
=== GUT Test Runner ===
DEBUG: specific_test_file = ''
DEBUG: specific_test_method = ''
DEBUG: Found 3 test files
Running tests in: res://tests/integration//test_multiplayer_deployment.gd

========================================
Starting Multiplayer Integration Test
========================================

  Running: test_basic_multiplayer_connection

[TEST] test_basic_multiplayer_connection
[Test] Launching host and client instances...
[GameInstance] Launching Host instance on port 8000
[GameInstance] Using project path: /Users/robertocallaghan/Documents/claude/godotv2/40k/
Godot Engine v4.5.1.stable.official.f62fdbde1 - https://godotengine.org
OpenGL API 4.1 INTEL-18.8.6 - Compatibility - Using Device: Intel Inc. - Intel(R) Iris(TM) Graphics 6100

TestModeHandler: Args -> ["--test-mode", "--position=100,100", "--resolution=600x480", "--auto-host", "--port=8000", "--instance-name=Host"]
[LogMonitor] Started monitoring: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251129_143440.log
[GameInstance] Monitoring log file: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251129_143440.log
[GameInstance] Successfully launched Host (PID: 86973)
[Test] Host instance launched successfully on port 8000
========================================
   RUNNING IN TEST MODE
   Config: { "window_position": (100, 100), "window_size": (600, 480), "is_host": true, "port": 8000, "instance_name": "Host" }
========================================
TestModeHandler: Command directories ready
  Commands: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_commands/commands
  Results: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_commands/results
[2025-11-29 14:35:19] [INFO.0000000] DebugLogger initialized - Session: 20251129_143519
[2025-11-29 14:35:19] [INFO.0000000] Log file: user://logs/debug_20251129_143519.log
[2025-11-29 14:35:19] [INFO.0000000] Real path: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251129_143519.log
[MeasuringTapeManager] Save persistence: false
Found armies in res://: ["orks", "adeptus_custodes", "space_marines", "A_C_test", "ORK_test"]
ArmyListManager initialized with 5 armies: ["orks", "adeptus_custodes", "space_marines", "A_C_test", "ORK_test"]
[2025-11-29 14:35:19] [INFO.0000000] DebugManager initialized
GameState: Loading default armies...
GameState: ArmyListManager not available, falling back to placeholder armies
GameState: Initializing placeholder armies for both players
GameState: Initializing placeholder army for player 1
GameState: Initializing placeholder army for player 2
ActionLogger: Started session 20251129_143519
StateSerializer: Pretty print enabled: true
SaveLoadManager: Current res:// directory: res://
SaveLoadManager: Project directory path: /Users/robertocallaghan/Documents/claude/godotv2/40k/
SaveLoadManager: Initialized save directories in project folder
SaveLoadManager: Save files will be stored at: /Users/robertocallaghan/Documents/claude/godotv2/40k/saves/
[PhaseManager] Ready - awaiting explicit phase initialization
[TerrainManager] Initializing terrain system
[TerrainManager] Added walls to terrain pieces
[TerrainManager] Loaded 12 terrain pieces
[EnhancedLineOfSight] Initialized
MissionManager: Initializing mission system
MissionManager: Set up 5 objectives for Strike Force deployment
  - obj_center at position (880.0, 1200.0)
  - obj_tl at position (400.0, 560.0)
  - obj_tr at position (1360.0, 560.0)
  - obj_bl at position (400.0, 1840.0)
  - obj_br at position (1360.0, 1840.0)
MissionManager: Initialized Take and Hold mission
[MeasuringTapeManager] Initialized with save_persistence: false
[LineOfSightManager] Initialized - Hold 'V' to check what can see the cursor position
TransportManager initialized
NetworkManager: Initialized
MainMenu: Initializing main menu
MainMenu: Loaded 5 armies: ["A C Test", "Adeptus Custodes", "ORK Test", "Orks", "Space Marines"]
MainMenu: Dropdowns populated with 5 armies
MainMenu: Multiplayer button visible: true
MainMenu: Signals connected
MainMenu: Save/Load dialog setup complete
MainMenu: Default armies set - Player 1: A C Test, Player 2: ORK Test
MainMenu: Ready with default selections
TestModeHandler: Set window position to (100, 100)
TestModeHandler: Set window size to (600, 480)
TestModeHandler: Scheduling auto-host...
SaveLoadDialog: Checking node references...
  - save_button path: VBoxContainer/SaveSection/SaveInputContainer/SaveButton
  - save_name_input path: VBoxContainer/SaveSection/SaveInputContainer/SaveNameInput
  - saves_list path: VBoxContainer/LoadSection/SavesScrollContainer/SavesList
  - load_button path: VBoxContainer/LoadSection/LoadButtonContainer/LoadButton
SaveLoadDialog: Connected save button
SaveLoadDialog: Connected save input
SaveLoadDialog: Connected saves list
SaveLoadDialog: Connected load button
SaveLoadDialog: Connected delete button
SaveLoadDialog: Connected cancel button
SaveLoadDialog UI signals connected
SaveLoadDialog: Found 29 save files
SaveLoadDialog: Populated list with 29 save files
SaveLoadDialog initialized successfully
[GameInstance] Launching Client instance on port 7778
[GameInstance] Using project path: /Users/robertocallaghan/Documents/claude/godotv2/40k/
TestModeHandler: Current scene: MainMenu
TestModeHandler: Triggering multiplayer mode...
MainMenu: Multiplayer button pressed
MultiplayerLobby: Army selection initialized with 5 armies
MultiplayerLobby: Ready
Godot Engine v4.5.1.stable.official.f62fdbde1 - https://godotengine.org
OpenGL API 4.1 INTEL-18.8.6 - Compatibility - Using Device: Intel Inc. - Intel(R) Iris(TM) Graphics 6100

TestModeHandler: Lobby scene: MultiplayerLobby
TestModeHandler: Creating host on port 8000
MultiplayerLobby: Host button pressed
========================================
   YOU ARE: PLAYER 1 (HOST)
   Hosting on port: 7777
========================================
MultiplayerLobby: Successfully hosting on port 7777
TestModeHandler: Waiting for client to connect...
TestModeHandler: Listening for peer connection...
TestModeHandler: Args -> ["--test-mode", "--position=800,100", "--resolution=600x480", "--auto-join", "--host-ip=127.0.0.1", "--host-port=8000", "--instance-name=Client"]
[LogMonitor] Started monitoring: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251129_143519.log
[GameInstance] Monitoring log file: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251129_143519.log
[GameInstance] Successfully launched Client (PID: 86978)
[Test] Client instance launched successfully
[Test] Waiting for client to connect to host...
[Test] Host performing action: get_game_state with params: {  }
[Test] Writing command file: host_86973_cmd_001.json
[Test] Waiting for result file...
[Test] Polling for result file: host_86973_cmd_001_result.json
TestModeHandler: Processing command file host_86973_cmd_001.json
TestModeHandler: Executing command from file: host_86973_cmd_001.json
TestModeHandler: Executing action: get_game_state
TestModeHandler: Handling get_game_state action
TestModeHandler: get_game_state - Phase: Deployment, Turn: 0, Player: 0
TestModeHandler: Result written to: host_86973_cmd_001_result.json
TestModeHandler: Command executed and result written
[Test] Result file found!
[Test] Action completed: success=true, message=Game state retrieved
[Test] Connection verified - action simulation working!
[TEST] PASSED: Basic connection established

========================================
Cleaning up Multiplayer Test
========================================

[Test] Host performing action: get_game_state with params: {  }
[Test] Writing command file: host_86973_cmd_002.json
[Test] Waiting for result file...
[Test] Polling for result file: host_86973_cmd_002_result.json
TestModeHandler: Processing command file host_86973_cmd_002.json
TestModeHandler: Executing command from file: host_86973_cmd_002.json
TestModeHandler: Executing action: get_game_state
TestModeHandler: Handling get_game_state action
TestModeHandler: get_game_state - Phase: Deployment, Turn: 0, Player: 0
TestModeHandler: Result written to: host_86973_cmd_002_result.json
TestModeHandler: Command executed and result written
[Test] Result file found!
[Test] Action completed: success=true, message=Game state retrieved
[Test Artifacts] Report saved: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_artifacts/reports/unknown_test_2025-11-29T14-35-24.json
[GameInstance] Terminating instance: Host
[LogMonitor] Stopped monitoring: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251129_143440.log
[GameInstance] Terminating instance: Client
[LogMonitor] Stopped monitoring: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251129_143519.log

========================================
Starting Multiplayer Integration Test
========================================

  Running: test_deployment_save_load

[TEST] test_deployment_save_load
[Test] Launching host and client instances...
[GameInstance] Launching Host instance on port 8000
[GameInstance] Using project path: /Users/robertocallaghan/Documents/claude/godotv2/40k/
Godot Engine v4.5.1.stable.official.f62fdbde1 - https://godotengine.org
OpenGL API 4.1 INTEL-18.8.6 - Compatibility - Using Device: Intel Inc. - Intel(R) Iris(TM) Graphics 6100

TestModeHandler: Args -> ["--test-mode", "--position=100,100", "--resolution=600x480", "--auto-host", "--port=8000", "--instance-name=Host"]
[LogMonitor] Started monitoring: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251129_143519.log
[GameInstance] Monitoring log file: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251129_143519.log
[GameInstance] Successfully launched Host (PID: 86983)
[Test] Host instance launched successfully on port 8000
========================================
   RUNNING IN TEST MODE
   Config: { "window_position": (100, 100), "window_size": (600, 480), "is_host": true, "port": 8000, "instance_name": "Host" }
========================================
TestModeHandler: Command directories ready
  Commands: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_commands/commands
  Results: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_commands/results
[2025-11-29 14:35:29] [INFO.0000000] DebugLogger initialized - Session: 20251129_143529
[2025-11-29 14:35:29] [INFO.0000000] Log file: user://logs/debug_20251129_143529.log
[2025-11-29 14:35:29] [INFO.0000000] Real path: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251129_143529.log
[MeasuringTapeManager] Save persistence: false
Found armies in res://: ["orks", "adeptus_custodes", "space_marines", "A_C_test", "ORK_test"]
ArmyListManager initialized with 5 armies: ["orks", "adeptus_custodes", "space_marines", "A_C_test", "ORK_test"]
[2025-11-29 14:35:29] [INFO.0000000] DebugManager initialized
GameState: Loading default armies...
GameState: ArmyListManager not available, falling back to placeholder armies
GameState: Initializing placeholder armies for both players
GameState: Initializing placeholder army for player 1
GameState: Initializing placeholder army for player 2
ActionLogger: Started session 20251129_143529
StateSerializer: Pretty print enabled: true
SaveLoadManager: Current res:// directory: res://
SaveLoadManager: Project directory path: /Users/robertocallaghan/Documents/claude/godotv2/40k/
SaveLoadManager: Initialized save directories in project folder
SaveLoadManager: Save files will be stored at: /Users/robertocallaghan/Documents/claude/godotv2/40k/saves/
[PhaseManager] Ready - awaiting explicit phase initialization
[TerrainManager] Initializing terrain system
[TerrainManager] Added walls to terrain pieces
[TerrainManager] Loaded 12 terrain pieces
[EnhancedLineOfSight] Initialized
MissionManager: Initializing mission system
MissionManager: Set up 5 objectives for Strike Force deployment
  - obj_center at position (880.0, 1200.0)
  - obj_tl at position (400.0, 560.0)
  - obj_tr at position (1360.0, 560.0)
  - obj_bl at position (400.0, 1840.0)
  - obj_br at position (1360.0, 1840.0)
MissionManager: Initialized Take and Hold mission
[MeasuringTapeManager] Initialized with save_persistence: false
[LineOfSightManager] Initialized - Hold 'V' to check what can see the cursor position
TransportManager initialized
NetworkManager: Initialized
MainMenu: Initializing main menu
MainMenu: Loaded 5 armies: ["A C Test", "Adeptus Custodes", "ORK Test", "Orks", "Space Marines"]
MainMenu: Dropdowns populated with 5 armies
MainMenu: Multiplayer button visible: true
MainMenu: Signals connected
MainMenu: Save/Load dialog setup complete
MainMenu: Default armies set - Player 1: A C Test, Player 2: ORK Test
MainMenu: Ready with default selections
TestModeHandler: Set window position to (100, 100)
TestModeHandler: Set window size to (600, 480)
TestModeHandler: Scheduling auto-host...
SaveLoadDialog: Checking node references...
  - save_button path: VBoxContainer/SaveSection/SaveInputContainer/SaveButton
  - save_name_input path: VBoxContainer/SaveSection/SaveInputContainer/SaveNameInput
  - saves_list path: VBoxContainer/LoadSection/SavesScrollContainer/SavesList
  - load_button path: VBoxContainer/LoadSection/LoadButtonContainer/LoadButton
SaveLoadDialog: Connected save button
SaveLoadDialog: Connected save input
SaveLoadDialog: Connected saves list
SaveLoadDialog: Connected load button
SaveLoadDialog: Connected delete button
SaveLoadDialog: Connected cancel button
SaveLoadDialog UI signals connected
SaveLoadDialog: Found 29 save files
SaveLoadDialog: Populated list with 29 save files
SaveLoadDialog initialized successfully
[GameInstance] Launching Client instance on port 7778
[GameInstance] Using project path: /Users/robertocallaghan/Documents/claude/godotv2/40k/
TestModeHandler: Current scene: MainMenu
TestModeHandler: Triggering multiplayer mode...
MainMenu: Multiplayer button pressed
MultiplayerLobby: Army selection initialized with 5 armies
MultiplayerLobby: Ready
Godot Engine v4.5.1.stable.official.f62fdbde1 - https://godotengine.org
OpenGL API 4.1 INTEL-18.8.6 - Compatibility - Using Device: Intel Inc. - Intel(R) Iris(TM) Graphics 6100

TestModeHandler: Args -> ["--test-mode", "--position=800,100", "--resolution=600x480", "--auto-join", "--host-ip=127.0.0.1", "--host-port=8000", "--instance-name=Client"]
TestModeHandler: Lobby scene: MultiplayerLobby
TestModeHandler: Creating host on port 8000
MultiplayerLobby: Host button pressed
========================================
   YOU ARE: PLAYER 1 (HOST)
   Hosting on port: 7777
========================================
MultiplayerLobby: Successfully hosting on port 7777
TestModeHandler: Waiting for client to connect...
TestModeHandler: Listening for peer connection...
[LogMonitor] Started monitoring: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251129_143529.log
[GameInstance] Monitoring log file: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251129_143529.log
[GameInstance] Successfully launched Client (PID: 86994)
[Test] Client instance launched successfully
[Test] Waiting for client to connect to host...
[Test] Host performing action: get_game_state with params: {  }
[Test] Writing command file: host_86983_cmd_001.json
[Test] Waiting for result file...
[Test] Polling for result file: host_86983_cmd_001_result.json
TestModeHandler: Processing command file host_86983_cmd_001.json
TestModeHandler: Executing command from file: host_86983_cmd_001.json
TestModeHandler: Executing action: get_game_state
TestModeHandler: Handling get_game_state action
TestModeHandler: get_game_state - Phase: Deployment, Turn: 0, Player: 0
TestModeHandler: Result written to: host_86983_cmd_001_result.json
TestModeHandler: Command executed and result written
[Test] Result file found!
[Test] Action completed: success=true, message=Game state retrieved
[Test] Connection verified - action simulation working!
========================================
   RUNNING IN TEST MODE
   Config: { "window_position": (800, 100), "window_size": (600, 480), "is_host": false, "host_ip": "127.0.0.1", "host_port": 8000, "instance_name": "Client" }
========================================
TestModeHandler: Command directories ready
  Commands: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_commands/commands
  Results: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_commands/results
[2025-11-29 14:35:35] [INFO.0000000] DebugLogger initialized - Session: 20251129_143535
[2025-11-29 14:35:35] [INFO.0000000] Log file: user://logs/debug_20251129_143535.log
[2025-11-29 14:35:35] [INFO.0000000] Real path: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251129_143535.log
[MeasuringTapeManager] Save persistence: false
Found armies in res://: ["orks", "adeptus_custodes", "space_marines", "A_C_test", "ORK_test"]
ArmyListManager initialized with 5 armies: ["orks", "adeptus_custodes", "space_marines", "A_C_test", "ORK_test"]
[2025-11-29 14:35:35] [INFO.0000000] DebugManager initialized
GameState: Loading default armies...
GameState: ArmyListManager not available, falling back to placeholder armies
GameState: Initializing placeholder armies for both players
GameState: Initializing placeholder army for player 1
GameState: Initializing placeholder army for player 2
ActionLogger: Started session 20251129_143535
StateSerializer: Pretty print enabled: true
SaveLoadManager: Current res:// directory: res://
SaveLoadManager: Project directory path: /Users/robertocallaghan/Documents/claude/godotv2/40k/
SaveLoadManager: Initialized save directories in project folder
SaveLoadManager: Save files will be stored at: /Users/robertocallaghan/Documents/claude/godotv2/40k/saves/
[PhaseManager] Ready - awaiting explicit phase initialization
[TerrainManager] Initializing terrain system
[TerrainManager] Added walls to terrain pieces
[TerrainManager] Loaded 12 terrain pieces
[EnhancedLineOfSight] Initialized
MissionManager: Initializing mission system
MissionManager: Set up 5 objectives for Strike Force deployment
  - obj_center at position (880.0, 1200.0)
  - obj_tl at position (400.0, 560.0)
  - obj_tr at position (1360.0, 560.0)
  - obj_bl at position (400.0, 1840.0)
  - obj_br at position (1360.0, 1840.0)
MissionManager: Initialized Take and Hold mission
[MeasuringTapeManager] Initialized with save_persistence: false
[LineOfSightManager] Initialized - Hold 'V' to check what can see the cursor position
TransportManager initialized
NetworkManager: Initialized
MainMenu: Initializing main menu
MainMenu: Loaded 5 armies: ["A C Test", "Adeptus Custodes", "ORK Test", "Orks", "Space Marines"]
MainMenu: Dropdowns populated with 5 armies
MainMenu: Multiplayer button visible: true
MainMenu: Signals connected
MainMenu: Save/Load dialog setup complete
MainMenu: Default armies set - Player 1: A C Test, Player 2: ORK Test
MainMenu: Ready with default selections
TestModeHandler: Set window position to (800, 100)
TestModeHandler: Set window size to (600, 480)
TestModeHandler: Scheduling auto-join...
SaveLoadDialog: Checking node references...
  - save_button path: VBoxContainer/SaveSection/SaveInputContainer/SaveButton
  - save_name_input path: VBoxContainer/SaveSection/SaveInputContainer/SaveNameInput
  - saves_list path: VBoxContainer/LoadSection/SavesScrollContainer/SavesList
  - load_button path: VBoxContainer/LoadSection/LoadButtonContainer/LoadButton
SaveLoadDialog: Connected save button
SaveLoadDialog: Connected save input
SaveLoadDialog: Connected saves list
SaveLoadDialog: Connected load button
SaveLoadDialog: Connected delete button
SaveLoadDialog: Connected cancel button
SaveLoadDialog UI signals connected
SaveLoadDialog: Found 29 save files
SaveLoadDialog: Populated list with 29 save files
SaveLoadDialog initialized successfully
[Test] Host performing action: get_game_state with params: {  }
[Test] Writing command file: host_86983_cmd_002.json
[Test] Waiting for result file...
[Test] Polling for result file: host_86983_cmd_002_result.json
TestModeHandler: Processing command file host_86983_cmd_002.json
TestModeHandler: Executing command from file: host_86983_cmd_002.json
TestModeHandler: Executing action: get_game_state
TestModeHandler: Handling get_game_state action
TestModeHandler: get_game_state - Phase: Deployment, Turn: 0, Player: 0
TestModeHandler: Result written to: host_86983_cmd_002_result.json
TestModeHandler: Command executed and result written
[Test] Result file found!
[Test] Action completed: success=true, message=Game state retrieved
[Test] Client performing action: get_game_state with params: {  }
[Test] Writing command file: client_86994_cmd_001.json
[Test] Waiting for result file...
[Test] Polling for result file: client_86994_cmd_001_result.json
TestModeHandler: Processing command file client_86994_cmd_001.json
TestModeHandler: Executing command from file: client_86994_cmd_001.json
TestModeHandler: Executing action: get_game_state
TestModeHandler: Handling get_game_state action
TestModeHandler: get_game_state - Phase: Deployment, Turn: 0, Player: 0
TestModeHandler: Result written to: client_86994_cmd_001_result.json
TestModeHandler: Command executed and result written
[Test] Result file found!
[Test] Action completed: success=true, message=Game state retrieved
[TEST] PASSED: Deployment save loaded and synced

========================================
Cleaning up Multiplayer Test
========================================

[Test] Host performing action: get_game_state with params: {  }
[Test] Writing command file: host_86983_cmd_003.json
[Test] Waiting for result file...
[Test] Polling for result file: host_86983_cmd_003_result.json
TestModeHandler: Processing command file host_86983_cmd_003.json
TestModeHandler: Executing command from file: host_86983_cmd_003.json
TestModeHandler: Executing action: get_game_state
TestModeHandler: Handling get_game_state action
TestModeHandler: get_game_state - Phase: Deployment, Turn: 0, Player: 0
TestModeHandler: Result written to: host_86983_cmd_003_result.json
TestModeHandler: Command executed and result written
[Test] Result file found!
[Test] Action completed: success=true, message=Game state retrieved
[Test Artifacts] Report saved: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_artifacts/reports/unknown_test_2025-11-29T14-35-36.json
[GameInstance] Terminating instance: Host
[LogMonitor] Stopped monitoring: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251129_143519.log
[GameInstance] Terminating instance: Client
[LogMonitor] Stopped monitoring: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251129_143529.log

========================================
Starting Multiplayer Integration Test
========================================

  Running: test_deployment_single_unit

[TEST] test_deployment_single_unit
[Test] Launching host and client instances...
[GameInstance] Launching Host instance on port 8000
[GameInstance] Using project path: /Users/robertocallaghan/Documents/claude/godotv2/40k/
Godot Engine v4.5.1.stable.official.f62fdbde1 - https://godotengine.org
OpenGL API 4.1 INTEL-18.8.6 - Compatibility - Using Device: Intel Inc. - Intel(R) Iris(TM) Graphics 6100

TestModeHandler: Args -> ["--test-mode", "--position=100,100", "--resolution=600x480", "--auto-host", "--port=8000", "--instance-name=Host"]
[LogMonitor] Started monitoring: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251129_143535.log
[GameInstance] Monitoring log file: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251129_143535.log
[GameInstance] Successfully launched Host (PID: 86998)
[Test] Host instance launched successfully on port 8000
========================================
   RUNNING IN TEST MODE
   Config: { "window_position": (100, 100), "window_size": (600, 480), "is_host": true, "port": 8000, "instance_name": "Host" }
========================================
TestModeHandler: Command directories ready
  Commands: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_commands/commands
  Results: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_commands/results
[2025-11-29 14:35:40] [INFO.0000000] DebugLogger initialized - Session: 20251129_143540
[2025-11-29 14:35:40] [INFO.0000000] Log file: user://logs/debug_20251129_143540.log
[2025-11-29 14:35:40] [INFO.0000000] Real path: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251129_143540.log
[MeasuringTapeManager] Save persistence: false
Found armies in res://: ["orks", "adeptus_custodes", "space_marines", "A_C_test", "ORK_test"]
ArmyListManager initialized with 5 armies: ["orks", "adeptus_custodes", "space_marines", "A_C_test", "ORK_test"]
[2025-11-29 14:35:40] [INFO.0000000] DebugManager initialized
GameState: Loading default armies...
GameState: ArmyListManager not available, falling back to placeholder armies
GameState: Initializing placeholder armies for both players
GameState: Initializing placeholder army for player 1
GameState: Initializing placeholder army for player 2
ActionLogger: Started session 20251129_143540
StateSerializer: Pretty print enabled: true
SaveLoadManager: Current res:// directory: res://
SaveLoadManager: Project directory path: /Users/robertocallaghan/Documents/claude/godotv2/40k/
SaveLoadManager: Initialized save directories in project folder
SaveLoadManager: Save files will be stored at: /Users/robertocallaghan/Documents/claude/godotv2/40k/saves/
[PhaseManager] Ready - awaiting explicit phase initialization
[TerrainManager] Initializing terrain system
[TerrainManager] Added walls to terrain pieces
[TerrainManager] Loaded 12 terrain pieces
[EnhancedLineOfSight] Initialized
MissionManager: Initializing mission system
MissionManager: Set up 5 objectives for Strike Force deployment
  - obj_center at position (880.0, 1200.0)
  - obj_tl at position (400.0, 560.0)
  - obj_tr at position (1360.0, 560.0)
  - obj_bl at position (400.0, 1840.0)
  - obj_br at position (1360.0, 1840.0)
MissionManager: Initialized Take and Hold mission
[MeasuringTapeManager] Initialized with save_persistence: false
[LineOfSightManager] Initialized - Hold 'V' to check what can see the cursor position
TransportManager initialized
NetworkManager: Initialized
MainMenu: Initializing main menu
MainMenu: Loaded 5 armies: ["A C Test", "Adeptus Custodes", "ORK Test", "Orks", "Space Marines"]
MainMenu: Dropdowns populated with 5 armies
MainMenu: Multiplayer button visible: true
MainMenu: Signals connected
MainMenu: Save/Load dialog setup complete
MainMenu: Default armies set - Player 1: A C Test, Player 2: ORK Test
MainMenu: Ready with default selections
TestModeHandler: Set window position to (100, 100)
TestModeHandler: Set window size to (600, 480)
TestModeHandler: Scheduling auto-host...
SaveLoadDialog: Checking node references...
  - save_button path: VBoxContainer/SaveSection/SaveInputContainer/SaveButton
  - save_name_input path: VBoxContainer/SaveSection/SaveInputContainer/SaveNameInput
  - saves_list path: VBoxContainer/LoadSection/SavesScrollContainer/SavesList
  - load_button path: VBoxContainer/LoadSection/LoadButtonContainer/LoadButton
SaveLoadDialog: Connected save button
SaveLoadDialog: Connected save input
SaveLoadDialog: Connected saves list
SaveLoadDialog: Connected load button
SaveLoadDialog: Connected delete button
SaveLoadDialog: Connected cancel button
SaveLoadDialog UI signals connected
SaveLoadDialog: Found 29 save files
SaveLoadDialog: Populated list with 29 save files
SaveLoadDialog initialized successfully
[GameInstance] Launching Client instance on port 7778
[GameInstance] Using project path: /Users/robertocallaghan/Documents/claude/godotv2/40k/
TestModeHandler: Current scene: MainMenu
TestModeHandler: Triggering multiplayer mode...
MainMenu: Multiplayer button pressed
MultiplayerLobby: Army selection initialized with 5 armies
MultiplayerLobby: Ready
TestModeHandler: Lobby scene: MultiplayerLobby
TestModeHandler: Creating host on port 8000
MultiplayerLobby: Host button pressed
========================================
   YOU ARE: PLAYER 1 (HOST)
   Hosting on port: 7777
========================================
MultiplayerLobby: Successfully hosting on port 7777
TestModeHandler: Waiting for client to connect...
TestModeHandler: Listening for peer connection...
Godot Engine v4.5.1.stable.official.f62fdbde1 - https://godotengine.org
OpenGL API 4.1 INTEL-18.8.6 - Compatibility - Using Device: Intel Inc. - Intel(R) Iris(TM) Graphics 6100

[LogMonitor] Started monitoring: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251129_143540.log
[GameInstance] Monitoring log file: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251129_143540.log
[GameInstance] Successfully launched Client (PID: 87009)
[Test] Client instance launched successfully
[Test] Waiting for client to connect to host...
TestModeHandler: Args -> ["--test-mode", "--position=800,100", "--resolution=600x480", "--auto-join", "--host-ip=127.0.0.1", "--host-port=8000", "--instance-name=Client"]
[Test] Host performing action: get_game_state with params: {  }
[Test] Writing command file: host_86998_cmd_001.json
[Test] Waiting for result file...
[Test] Polling for result file: host_86998_cmd_001_result.json
TestModeHandler: Processing command file host_86998_cmd_001.json
TestModeHandler: Executing command from file: host_86998_cmd_001.json
TestModeHandler: Executing action: get_game_state
TestModeHandler: Handling get_game_state action
TestModeHandler: get_game_state - Phase: Deployment, Turn: 0, Player: 0
TestModeHandler: Result written to: host_86998_cmd_001_result.json
TestModeHandler: Command executed and result written
[Test] Result file found!
[Test] Action completed: success=true, message=Game state retrieved
[Test] Connection verified - action simulation working!
========================================
   RUNNING IN TEST MODE
   Config: { "window_position": (800, 100), "window_size": (600, 480), "is_host": false, "host_ip": "127.0.0.1", "host_port": 8000, "instance_name": "Client" }
========================================
TestModeHandler: Command directories ready
  Commands: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_commands/commands
  Results: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_commands/results
[2025-11-29 14:35:47] [INFO.0000000] DebugLogger initialized - Session: 20251129_143547
[2025-11-29 14:35:47] [INFO.0000000] Log file: user://logs/debug_20251129_143547.log
[2025-11-29 14:35:47] [INFO.0000000] Real path: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251129_143547.log
[MeasuringTapeManager] Save persistence: false
Found armies in res://: ["orks", "adeptus_custodes", "space_marines", "A_C_test", "ORK_test"]
ArmyListManager initialized with 5 armies: ["orks", "adeptus_custodes", "space_marines", "A_C_test", "ORK_test"]
[2025-11-29 14:35:47] [INFO.0000000] DebugManager initialized
GameState: Loading default armies...
GameState: ArmyListManager not available, falling back to placeholder armies
GameState: Initializing placeholder armies for both players
GameState: Initializing placeholder army for player 1
GameState: Initializing placeholder army for player 2
ActionLogger: Started session 20251129_143547
StateSerializer: Pretty print enabled: true
SaveLoadManager: Current res:// directory: res://
SaveLoadManager: Project directory path: /Users/robertocallaghan/Documents/claude/godotv2/40k/
SaveLoadManager: Initialized save directories in project folder
SaveLoadManager: Save files will be stored at: /Users/robertocallaghan/Documents/claude/godotv2/40k/saves/
[PhaseManager] Ready - awaiting explicit phase initialization
[TerrainManager] Initializing terrain system
[TerrainManager] Added walls to terrain pieces
[TerrainManager] Loaded 12 terrain pieces
[EnhancedLineOfSight] Initialized
MissionManager: Initializing mission system
MissionManager: Set up 5 objectives for Strike Force deployment
  - obj_center at position (880.0, 1200.0)
  - obj_tl at position (400.0, 560.0)
  - obj_tr at position (1360.0, 560.0)
  - obj_bl at position (400.0, 1840.0)
  - obj_br at position (1360.0, 1840.0)
MissionManager: Initialized Take and Hold mission
[MeasuringTapeManager] Initialized with save_persistence: false
[LineOfSightManager] Initialized - Hold 'V' to check what can see the cursor position
TransportManager initialized
NetworkManager: Initialized
MainMenu: Initializing main menu
MainMenu: Loaded 5 armies: ["A C Test", "Adeptus Custodes", "ORK Test", "Orks", "Space Marines"]
MainMenu: Dropdowns populated with 5 armies
MainMenu: Multiplayer button visible: true
MainMenu: Signals connected
MainMenu: Save/Load dialog setup complete
MainMenu: Default armies set - Player 1: A C Test, Player 2: ORK Test
MainMenu: Ready with default selections
TestModeHandler: Set window position to (800, 100)
TestModeHandler: Set window size to (600, 480)
TestModeHandler: Scheduling auto-join...
SaveLoadDialog: Checking node references...
  - save_button path: VBoxContainer/SaveSection/SaveInputContainer/SaveButton
  - save_name_input path: VBoxContainer/SaveSection/SaveInputContainer/SaveNameInput
  - saves_list path: VBoxContainer/LoadSection/SavesScrollContainer/SavesList
  - load_button path: VBoxContainer/LoadSection/LoadButtonContainer/LoadButton
SaveLoadDialog: Connected save button
SaveLoadDialog: Connected save input
SaveLoadDialog: Connected saves list
SaveLoadDialog: Connected load button
SaveLoadDialog: Connected delete button
SaveLoadDialog: Connected cancel button
SaveLoadDialog UI signals connected
SaveLoadDialog: Found 29 save files
SaveLoadDialog: Populated list with 29 save files
SaveLoadDialog initialized successfully
[TEST] Using auto-loaded save: deployment_start
TestModeHandler: Current scene: MainMenu
TestModeHandler: Triggering multiplayer mode...
MainMenu: Multiplayer button pressed
MultiplayerLobby: Army selection initialized with 5 armies
MultiplayerLobby: Ready
TestModeHandler: Lobby scene: MultiplayerLobby
TestModeHandler: Joining host at 127.0.0.1
MultiplayerLobby: Join button pressed
NetworkManager: Connecting to 127.0.0.1:7777
MultiplayerLobby: Attempting to join 127.0.0.1:7777
NetworkManager: Peer connected - 1
NetworkManager: Successfully connected to host
NetworkManager: Client set peer_to_player_map[454024757] = 2
========================================
   YOU ARE: PLAYER 2 (CLIENT)
   Connected to host
========================================
MultiplayerLobby: Peer connected - 1
MultiplayerLobby: Game started signal received
NetworkManager: Peer connected - 454024757
[GameState] MeasuringTapeManager not available
MultiplayerLobby: Peer connected - 454024757
TestModeHandler: Client connected!
MultiplayerLobby: Game started signal received
NetworkManager: Receiving initial state from host
[GameState] No measuring_tape data in save
NetworkManager: State synchronized
MultiplayerLobby: Game started signal received
MultiplayerLobby: Syncing army selection - Player 1 -> A_C_test
MultiplayerLobby: Syncing army selection - Player 2 -> ORK_test
[Test] Host performing action: get_game_state with params: {  }
[Test] Writing command file: host_86998_cmd_002.json
[Test] Waiting for result file...
[Test] Polling for result file: host_86998_cmd_002_result.json
TestModeHandler: Processing command file host_86998_cmd_002.json
TestModeHandler: Executing command from file: host_86998_cmd_002.json
TestModeHandler: Executing action: get_game_state
TestModeHandler: Handling get_game_state action
TestModeHandler: get_game_state - Phase: Deployment, Turn: 0, Player: 0
TestModeHandler: Result written to: host_86998_cmd_002_result.json
TestModeHandler: Command executed and result written
[Test] Result file found!
[Test] Action completed: success=true, message=Game state retrieved
[Test] Host performing action: get_available_units with params: {  }
[Test] Writing command file: host_86998_cmd_003.json
[Test] Waiting for result file...
[Test] Polling for result file: host_86998_cmd_003_result.json
TestModeHandler: Processing command file host_86998_cmd_003.json
TestModeHandler: Executing command from file: host_86998_cmd_003.json
TestModeHandler: Executing action: get_available_units
TestModeHandler: Handling get_available_units action
TestModeHandler: Player 1 units: ["U_INTERCESSORS_A", "U_TACTICAL_A"] (undeployed: ["U_INTERCESSORS_A", "U_TACTICAL_A"])
TestModeHandler: Player 2 units: ["U_BOYZ_A", "U_GRETCHIN_A"] (undeployed: ["U_BOYZ_A", "U_GRETCHIN_A"])
TestModeHandler: Result written to: host_86998_cmd_003_result.json
TestModeHandler: Command executed and result written
[Test] Result file found!
[Test] Action completed: success=true, message=Available units retrieved
[TEST] Player 1 undeployed units: ["U_INTERCESSORS_A", "U_TACTICAL_A"]
[TEST] Using unit: U_INTERCESSORS_A
[Test] Host performing action: deploy_unit with params: { "unit_id": "U_INTERCESSORS_A", "position": { "x": 100.0, "y": 100.0 } }
[Test] Writing command file: host_86998_cmd_004.json
[Test] Waiting for result file...
[Test] Polling for result file: host_86998_cmd_004_result.json
TestModeHandler: Processing command file host_86998_cmd_004.json
TestModeHandler: Executing command from file: host_86998_cmd_004.json
TestModeHandler: Executing action: deploy_unit
TestModeHandler: Handling deploy_unit action
GameManager: deploy_unit() called - unit_id: U_INTERCESSORS_A, position: (100.0, 100.0)
GameManager: Total units in GameState: 4
GameManager: Unit IDs: ["U_INTERCESSORS_A", "U_TACTICAL_A", "U_BOYZ_A", "U_GRETCHIN_A"]
GameManager: Switching active player from 1 to 2
GameManager: Applying result with 12 changes/diffs
GameManager: Setting units.U_INTERCESSORS_A.models.0.position = { "x": 100.0, "y": 100.0 }
GameManager: Setting units.U_INTERCESSORS_A.models.0.rotation = 0.0
GameManager: Setting units.U_INTERCESSORS_A.models.1.position = { "x": 100.0, "y": 100.0 }
GameManager: Setting units.U_INTERCESSORS_A.models.1.rotation = 0.0
GameManager: Setting units.U_INTERCESSORS_A.models.2.position = { "x": 100.0, "y": 100.0 }
GameManager: Setting units.U_INTERCESSORS_A.models.2.rotation = 0.0
GameManager: Setting units.U_INTERCESSORS_A.models.3.position = { "x": 100.0, "y": 100.0 }
GameManager: Setting units.U_INTERCESSORS_A.models.3.rotation = 0.0
GameManager: Setting units.U_INTERCESSORS_A.models.4.position = { "x": 100.0, "y": 100.0 }
GameManager: Setting units.U_INTERCESSORS_A.models.4.rotation = 0.0
GameManager: Setting units.U_INTERCESSORS_A.status = 2
GameManager: Setting meta.active_player = 2
GameManager: deploy_unit() result: success=true
TestModeHandler: Result written to: host_86998_cmd_004_result.json
TestModeHandler: Command executed and result written
[Test] Result file found!
[Test] Action completed: success=true, message=Unit deployed successfully
TestModeHandler: Starting game...
MultiplayerLobby: Start game button pressed
MultiplayerLobby: Loading armies...
MultiplayerLobby: Loading A_C_test for Player 1
Loading army list: A_C_test for player 1
Processed unit: U_BLADE_CHAMPION_A for player 1
Processed unit: U_WITCHSEEKERS_C for player 1
Processed unit: U_CALADIUS_GRAV-TANK_E for player 1
Successfully loaded army: A_C_test with 3 units
MultiplayerLobby: Player 1 army loaded, has 3 units
Applying army to game state for player: 1
Removing 0 existing units for player 1
Added unit: U_BLADE_CHAMPION_A (Blade Champion)
Added unit: U_WITCHSEEKERS_C (Witchseekers)
Added unit: U_CALADIUS_GRAV-TANK_E (Caladius Grav-tank)
Set faction for player 1: Adeptus Custodes
Army applied successfully. Total units in game: 3
MultiplayerLobby: After applying P1 army, GameState has 3 units
MultiplayerLobby: Loading ORK_test for Player 2
Loading army list: ORK_test for player 2
Processed unit: U_WARBOSS_B for player 2
Processed unit: U_WARBOSS_IN_MEGA_ARMOUR_D for player 2
[2025-11-29 14:35:51] [DEBUG.0000000] Parsed transport capacity keywords | Context: {"description":"This model has a transport capacity of 22 ORKS INFANTRY models. Each MEGA ARMOUR model takes up the space of 2 models. This model cannot transport models that are JUMP PACK models.","keywords":["ORKS","INFANTRY"],"unit_id":"U_BATTLEWAGON_G"}
Processed unit: U_BATTLEWAGON_G for player 2
Successfully loaded army: ORK_test with 3 units
MultiplayerLobby: Player 2 army loaded, has 3 units
Applying army to game state for player: 2
Removing 0 existing units for player 2
Added unit: U_WARBOSS_B (Warboss)
Added unit: U_WARBOSS_IN_MEGA_ARMOUR_D (Warboss in Mega Armour)
Added unit: U_BATTLEWAGON_G (Battlewagon)
Set faction for player 2: Unknown
Army applied successfully. Total units in game: 6
MultiplayerLobby: After applying P2 army, GameState has 6 units
MultiplayerLobby: Armies loaded. Total units: 6
MultiplayerLobby: Syncing loaded armies to clients...
[GameState] MeasuringTapeManager not available
MultiplayerLobby: Snapshot has 6 units
MultiplayerLobby: Sent army snapshot to peer 454024757
NetworkManager: Receiving initial state from host
[GameState] No measuring_tape data in save
NetworkManager: State synchronized
MultiplayerLobby: Game started signal received
[Test] Host performing action: get_game_state with params: {  }
[Test] Writing command file: host_86998_cmd_005.json
[Test] Waiting for result file...
[Test] Polling for result file: host_86998_cmd_005_result.json
TestModeHandler: Processing command file host_86998_cmd_005.json
TestModeHandler: Executing command from file: host_86998_cmd_005.json
TestModeHandler: Executing action: get_game_state
TestModeHandler: Handling get_game_state action
TestModeHandler: get_game_state - Phase: Deployment, Turn: 0, Player: 0
TestModeHandler: Result written to: host_86998_cmd_005_result.json
TestModeHandler: Command executed and result written
NetworkManager: Starting multiplayer game - transitioning to Main scene
NetworkManager: Units in GameState BEFORE scene change: 6
NetworkManager: Unit IDs: ["U_BLADE_CHAMPION_A", "U_WITCHSEEKERS_C", "U_CALADIUS_GRAV-TANK_E", "U_WARBOSS_B", "U_WARBOSS_IN_MEGA_ARMOUR_D", "U_BATTLEWAGON_G"]
NetworkManager: Starting multiplayer game - transitioning to Main scene
NetworkManager: Units in GameState BEFORE scene change: 6
NetworkManager: Unit IDs: ["U_BLADE_CHAMPION_A", "U_WITCHSEEKERS_C", "U_CALADIUS_GRAV-TANK_E", "U_WARBOSS_B", "U_WARBOSS_IN_MEGA_ARMOUR_D", "U_BATTLEWAGON_G"]
[Test] Result file found!
[Test] Action completed: success=true, message=Game state retrieved
[Test] Client performing action: get_game_state with params: {  }
[Test] Writing command file: client_87009_cmd_001.json
[Test] Waiting for result file...
[Test] Polling for result file: client_87009_cmd_001_result.json
MultiplayerLobby: Game started signal received
MultiplayerLobby: Game start RPC sent to all peers
TestModeHandler: Processing command file client_87009_cmd_001.json
TestModeHandler: Executing command from file: client_87009_cmd_001.json
TestModeHandler: Executing action: get_game_state
TestModeHandler: Handling get_game_state action
TestModeHandler: get_game_state - Phase: Deployment, Turn: 0, Player: 0
TestModeHandler: Result written to: client_87009_cmd_001_result.json
TestModeHandler: Command executed and result written
MultiplayerLobby: Game started signal received
[Test] Result file found!
[Test] Action completed: success=true, message=Game state retrieved
[TEST] Host units count: 6
[TEST] Client units count: 6
[TEST] PASSED: Unit deployment successful

========================================
Cleaning up Multiplayer Test
========================================

[Test] Host performing action: get_game_state with params: {  }
[Test] Writing command file: host_86998_cmd_006.json
[Test] Waiting for result file...
[Test] Polling for result file: host_86998_cmd_006_result.json
UnitStatsPanel: _ready() called with 4-section layout
UnitStatsPanel: Toggle button connected
UnitStatsPanel: Player units list connected
UnitStatsPanel: Enemy units list connected
UnitStatsPanel: Setting collapsed to true
UnitStatsPanel: Main content visible = false
UnitStatsPanel: Toggle button text = ▼ Unit Stats
UnitStatsPanel: Target height = 40, Target offset = -40
Main: _ready() called
Main: DebugLogger log file path: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251129_143540.log
[2025-11-29 14:35:54] [INFO.0000000] Main._ready() called
Main: Current units count BEFORE check: 6
Main: Unit IDs in GameState: ["U_BLADE_CHAMPION_A", "U_WITCHSEEKERS_C", "U_CALADIUS_GRAV-TANK_E", "U_WARBOSS_B", "U_WARBOSS_IN_MEGA_ARMOUR_D", "U_BATTLEWAGON_G"]
Main: Meta flags: ["game_id", "turn_number", "battle_round", "active_player", "phase", "created_at", "version", "from_multiplayer_lobby", "game_config"]
Main: Game config: { "player1_army": "A_C_test", "player2_army": "ORK_test" }
Main: from_menu=false from_save=false from_multiplayer=true
Main: ✓ Loading from multiplayer lobby with armies already loaded
Main: Units count AFTER multiplayer check: 6
Main: Initializing deployment phase with 6 units
[PhaseManager] transition_to_phase called for: DEPLOYMENT
[PhaseManager] Creating new phase instance for: DEPLOYMENT
[PhaseManager] Phase script: <GDScript#-9223372002159491695>
[PhaseManager] Created instance class: Node
[PhaseManager] Instance script: <GDScript#-9223372002159491695>
[PhaseManager] Instance has validate_action: true
[PhaseManager] Connected to phase_completed signal
[PhaseManager] Connected to action_taken signal
[GameState] MeasuringTapeManager not available
[PhaseManager] Creating snapshot for phase 0
[PhaseManager] Snapshot has 6 units
[PhaseManager] Unit IDs: ["U_BLADE_CHAMPION_A", "U_WITCHSEEKERS_C", "U_CALADIUS_GRAV-TANK_E", "U_WARBOSS_B", "U_WARBOSS_IN_MEGA_ARMOUR_D", "U_BATTLEWAGON_G"]
[0][INFO] Entering Deployment Phase
[0][INFO] Deployment phase initialized
UnitStatsPanel: _ready() called with 4-section layout
UnitStatsPanel: Toggle button connected
UnitStatsPanel: Player units list connected
UnitStatsPanel: Enemy units list connected
UnitStatsPanel: Setting collapsed to true
UnitStatsPanel: Main content visible = false
UnitStatsPanel: Toggle button text = ▼ Unit Stats
UnitStatsPanel: Target height = 40, Target offset = -40
Main: _ready() called
Main: DebugLogger log file path: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251129_143547.log
[2025-11-29 14:35:54] [INFO.0000000] Main._ready() called
Main: Current units count BEFORE check: 6
Main: Unit IDs in GameState: ["U_BLADE_CHAMPION_A", "U_WITCHSEEKERS_C", "U_CALADIUS_GRAV-TANK_E", "U_WARBOSS_B", "U_WARBOSS_IN_MEGA_ARMOUR_D", "U_BATTLEWAGON_G"]
Main: Meta flags: ["game_id", "turn_number", "battle_round", "active_player", "phase", "created_at", "version", "from_multiplayer_lobby", "game_config"]
Main: Game config: { "player1_army": "A_C_test", "player2_army": "ORK_test" }
Main: from_menu=false from_save=false from_multiplayer=true
Main: ✓ Loading from multiplayer lobby with armies already loaded
Main: Units count AFTER multiplayer check: 6
Main: Initializing deployment phase with 6 units
[PhaseManager] transition_to_phase called for: DEPLOYMENT
[PhaseManager] Creating new phase instance for: DEPLOYMENT
[PhaseManager] Phase script: <GDScript#-9223372002159491695>
[PhaseManager] Created instance class: Node
[PhaseManager] Instance script: <GDScript#-9223372002159491695>
[PhaseManager] Instance has validate_action: true
[PhaseManager] Connected to phase_completed signal
[PhaseManager] Connected to action_taken signal
[GameState] MeasuringTapeManager not available
[PhaseManager] Creating snapshot for phase 0
[PhaseManager] Snapshot has 6 units
[PhaseManager] Unit IDs: ["U_BLADE_CHAMPION_A", "U_WITCHSEEKERS_C", "U_CALADIUS_GRAV-TANK_E", "U_WARBOSS_B", "U_WARBOSS_IN_MEGA_ARMOUR_D", "U_BATTLEWAGON_G"]
[0][INFO] Entering Deployment Phase
[0][INFO] Deployment phase initialized
[PhaseManager] get_current_phase_instance returning: Node
[PhaseManager] Instance script path: res://phases/DeploymentPhase.gd
[PhaseManager] Instance has validate_action: true
[PhaseManager] ⚠️ Script path: res://phases/DeploymentPhase.gd
[PhaseManager] ⚠️ This SHOULD be a DeploymentPhase!
Main: Phase instance created - class: Node
Main: Phase instance script: <GDScript#-9223372002159491695>
Main: Phase has validate_action: true
Setting up objectives on board...
Main: Creating visuals for 5 objectives
MissionManager: Checking control for 5 objectives with 6 units

Checking objective: obj_center at position (880.0, 1200.0)
  Skipping U_BLADE_CHAMPION_A - not deployed (status: 0)
  Skipping U_WITCHSEEKERS_C - not deployed (status: 0)
  Skipping U_CALADIUS_GRAV-TANK_E - not deployed (status: 0)
  Skipping U_WARBOSS_B - not deployed (status: 0)
  Skipping U_WARBOSS_IN_MEGA_ARMOUR_D - not deployed (status: 0)
  Skipping U_BATTLEWAGON_G - not deployed (status: 0)

Checking objective: obj_tl at position (400.0, 560.0)
  Skipping U_BLADE_CHAMPION_A - not deployed (status: 0)
  Skipping U_WITCHSEEKERS_C - not deployed (status: 0)
  Skipping U_CALADIUS_GRAV-TANK_E - not deployed (status: 0)
  Skipping U_WARBOSS_B - not deployed (status: 0)
  Skipping U_WARBOSS_IN_MEGA_ARMOUR_D - not deployed (status: 0)
  Skipping U_BATTLEWAGON_G - not deployed (status: 0)

Checking objective: obj_tr at position (1360.0, 560.0)
  Skipping U_BLADE_CHAMPION_A - not deployed (status: 0)
  Skipping U_WITCHSEEKERS_C - not deployed (status: 0)
  Skipping U_CALADIUS_GRAV-TANK_E - not deployed (status: 0)
  Skipping U_WARBOSS_B - not deployed (status: 0)
  Skipping U_WARBOSS_IN_MEGA_ARMOUR_D - not deployed (status: 0)
  Skipping U_BATTLEWAGON_G - not deployed (status: 0)

Checking objective: obj_bl at position (400.0, 1840.0)
  Skipping U_BLADE_CHAMPION_A - not deployed (status: 0)
  Skipping U_WITCHSEEKERS_C - not deployed (status: 0)
  Skipping U_CALADIUS_GRAV-TANK_E - not deployed (status: 0)
  Skipping U_WARBOSS_B - not deployed (status: 0)
  Skipping U_WARBOSS_IN_MEGA_ARMOUR_D - not deployed (status: 0)
  Skipping U_BATTLEWAGON_G - not deployed (status: 0)

Checking objective: obj_br at position (1360.0, 1840.0)
  Skipping U_BLADE_CHAMPION_A - not deployed (status: 0)
  Skipping U_WITCHSEEKERS_C - not deployed (status: 0)
  Skipping U_CALADIUS_GRAV-TANK_E - not deployed (status: 0)
  Skipping U_WARBOSS_B - not deployed (status: 0)
  Skipping U_WARBOSS_IN_MEGA_ARMOUR_D - not deployed (status: 0)
  Skipping U_BATTLEWAGON_G - not deployed (status: 0)
Main: Objectives setup complete
Moved HUD_Bottom to top of screen
Looking for UnitStatsPanel in scene...
Found UnitStatsPanel in scene structure
Connected to unit_selected signal from UnitStatsPanel
UnitStatsPanel: Populating unit lists for phase: DEPLOYMENT
UnitStatsPanel: Populated 3 units for player (player 1)
UnitStatsPanel: Populated 3 units for enemy (player 2)
Initialized UnitStatsPanel unit lists for phase: DEPLOYMENT
Fixed HUD layout: HUD_Left adjusted for new layout
Fixed HUD layout: HUD_Right adjusted for new layout
Adjusted unit list: fixed height to 150px
Setting up Mathhammer UI...
MathhhammerUI: Initializing...
[PhaseManager] get_current_phase_instance returning: Node
[PhaseManager] Instance script path: res://phases/DeploymentPhase.gd
[PhaseManager] Instance has validate_action: true
[PhaseManager] ⚠️ Script path: res://phases/DeploymentPhase.gd
[PhaseManager] ⚠️ This SHOULD be a DeploymentPhase!
Main: Phase instance created - class: Node
Main: Phase instance script: <GDScript#-9223372002159491695>
Main: Phase has validate_action: true
Setting up objectives on board...
Main: Creating visuals for 5 objectives
MissionManager: Checking control for 5 objectives with 6 units

Checking objective: obj_center at position (880.0, 1200.0)
  Skipping U_BLADE_CHAMPION_A - not deployed (status: 0)
  Skipping U_WITCHSEEKERS_C - not deployed (status: 0)
  Skipping U_CALADIUS_GRAV-TANK_E - not deployed (status: 0)
  Skipping U_WARBOSS_B - not deployed (status: 0)
  Skipping U_WARBOSS_IN_MEGA_ARMOUR_D - not deployed (status: 0)
  Skipping U_BATTLEWAGON_G - not deployed (status: 0)

Checking objective: obj_tl at position (400.0, 560.0)
  Skipping U_BLADE_CHAMPION_A - not deployed (status: 0)
  Skipping U_WITCHSEEKERS_C - not deployed (status: 0)
  Skipping U_CALADIUS_GRAV-TANK_E - not deployed (status: 0)
  Skipping U_WARBOSS_B - not deployed (status: 0)
  Skipping U_WARBOSS_IN_MEGA_ARMOUR_D - not deployed (status: 0)
  Skipping U_BATTLEWAGON_G - not deployed (status: 0)

Checking objective: obj_tr at position (1360.0, 560.0)
  Skipping U_BLADE_CHAMPION_A - not deployed (status: 0)
  Skipping U_WITCHSEEKERS_C - not deployed (status: 0)
  Skipping U_CALADIUS_GRAV-TANK_E - not deployed (status: 0)
  Skipping U_WARBOSS_B - not deployed (status: 0)
  Skipping U_WARBOSS_IN_MEGA_ARMOUR_D - not deployed (status: 0)
  Skipping U_BATTLEWAGON_G - not deployed (status: 0)

Checking objective: obj_bl at position (400.0, 1840.0)
  Skipping U_BLADE_CHAMPION_A - not deployed (status: 0)
  Skipping U_WITCHSEEKERS_C - not deployed (status: 0)
  Skipping U_CALADIUS_GRAV-TANK_E - not deployed (status: 0)
  Skipping U_WARBOSS_B - not deployed (status: 0)
  Skipping U_WARBOSS_IN_MEGA_ARMOUR_D - not deployed (status: 0)
  Skipping U_BATTLEWAGON_G - not deployed (status: 0)

Checking objective: obj_br at position (1360.0, 1840.0)
  Skipping U_BLADE_CHAMPION_A - not deployed (status: 0)
  Skipping U_WITCHSEEKERS_C - not deployed (status: 0)
  Skipping U_CALADIUS_GRAV-TANK_E - not deployed (status: 0)
  Skipping U_WARBOSS_B - not deployed (status: 0)
  Skipping U_WARBOSS_IN_MEGA_ARMOUR_D - not deployed (status: 0)
  Skipping U_BATTLEWAGON_G - not deployed (status: 0)
Main: Objectives setup complete
Moved HUD_Bottom to top of screen
Looking for UnitStatsPanel in scene...
Found UnitStatsPanel in scene structure
Connected to unit_selected signal from UnitStatsPanel
UnitStatsPanel: Populating unit lists for phase: DEPLOYMENT
UnitStatsPanel: Populated 3 units for player (player 1)
UnitStatsPanel: Populated 3 units for enemy (player 2)
Initialized UnitStatsPanel unit lists for phase: DEPLOYMENT
Fixed HUD layout: HUD_Left adjusted for new layout
Fixed HUD layout: HUD_Right adjusted for new layout
Adjusted unit list: fixed height to 150px
Setting up Mathhammer UI...
MathhhammerUI: Initializing...
Mathhammer UI added to left HUD
Mathhammer UI successfully integrated into left side of main UI
Setting up Save/Load Dialog...
Save/Load Dialog setup completed
Setting up terrain system...
[TerrainVisual] Added wall line from (640.0, 80.0) to (800.0, 80.0) type: solid
[TerrainVisual] Added wall line from (640.0, 80.0) to (640.0, 200.0) type: window
[TerrainVisual] Added wall line from (1120.0, 200.0) to (1600.0, 200.0) type: solid
[TerrainVisual] Added wall line from (1120.0, 440.0) to (1600.0, 440.0) type: solid
[TerrainVisual] Added wall line from (1120.0, 280.0) to (1120.0, 360.0) type: door
[TerrainVisual] Added wall line from (1600.0, 250.0) to (1600.0, 390.0) type: window
[TerrainVisual] Added wall line from (640.0, 320.0) to (640.0, 560.0) type: solid
[TerrainVisual] Added wall line from (280.0, 440.0) to (520.0, 440.0) type: window
[TerrainVisual] Added wall line from (160.0, 1960.0) to (640.0, 1960.0) type: solid
[TerrainVisual] Added wall line from (160.0, 1960.0) to (160.0, 2200.0) type: solid
[TerrainVisual] Added wall line from (625.4415, 844.8528) to (964.8528, 505.4416) type: solid
[TerrainVisual] Rendered 12 terrain pieces
[TerrainVisual] Initialized
Added TerrainVisual to BoardRoot
[LineOfSightVisual] Initialized - Will show models that can see cursor position
Added LineOfSightVisual to BoardRoot
Line of Sight: Hold 'V' to check what models can see the cursor position
Added terrain UI controls to HUD
Setting up measuring tape visual...
[MeasuringTapeVisual] Initialized with z_index 15
Added MeasuringTapeVisual to BoardRoot
Measuring Tape: Hold 't' and drag to measure, press 'y' to clear all measurements
Added measuring tape save toggle to HUD
Setting up transport panel...
Transport panel added to HUD_Right
Left panel toggle button added to top HUD
Left panel hidden by default
Main: setup_phase_controllers() STARTING (semaphore locked)
Mathhammer UI added to left HUD
Mathhammer UI successfully integrated into left side of main UI
Setting up Save/Load Dialog...
Save/Load Dialog setup completed
Setting up terrain system...
[TerrainVisual] Added wall line from (640.0, 80.0) to (800.0, 80.0) type: solid
[TerrainVisual] Added wall line from (640.0, 80.0) to (640.0, 200.0) type: window
[TerrainVisual] Added wall line from (1120.0, 200.0) to (1600.0, 200.0) type: solid
[TerrainVisual] Added wall line from (1120.0, 440.0) to (1600.0, 440.0) type: solid
[TerrainVisual] Added wall line from (1120.0, 280.0) to (1120.0, 360.0) type: door
[TerrainVisual] Added wall line from (1600.0, 250.0) to (1600.0, 390.0) type: window
[TerrainVisual] Added wall line from (640.0, 320.0) to (640.0, 560.0) type: solid
[TerrainVisual] Added wall line from (280.0, 440.0) to (520.0, 440.0) type: window
[TerrainVisual] Added wall line from (160.0, 1960.0) to (640.0, 1960.0) type: solid
[TerrainVisual] Added wall line from (160.0, 1960.0) to (160.0, 2200.0) type: solid
[TerrainVisual] Added wall line from (625.4415, 844.8528) to (964.8528, 505.4416) type: solid
[TerrainVisual] Rendered 12 terrain pieces
[TerrainVisual] Initialized
TestModeHandler: Processing command file host_86998_cmd_006.json
Added TerrainVisual to BoardRoot
[LineOfSightVisual] Initialized - Will show models that can see cursor position
Added LineOfSightVisual to BoardRoot
Line of Sight: Hold 'V' to check what models can see the cursor position
TestModeHandler: Executing command from file: host_86998_cmd_006.json
TestModeHandler: Executing action: get_game_state
TestModeHandler: Handling get_game_state action
TestModeHandler: get_game_state - Phase: Deployment, Turn: 0, Player: 0
Added terrain UI controls to HUD
Setting up measuring tape visual...
[MeasuringTapeVisual] Initialized with z_index 15
Added MeasuringTapeVisual to BoardRoot
Measuring Tape: Hold 't' and drag to measure, press 'y' to clear all measurements
Added measuring tape save toggle to HUD
Setting up transport panel...
TestModeHandler: Result written to: host_86998_cmd_006_result.json
TestModeHandler: Command executed and result written
Transport panel added to HUD_Right
Left panel toggle button added to top HUD
Left panel hidden by default
Main: setup_phase_controllers() STARTING (semaphore locked)
SaveLoadDialog: Checking node references...
  - save_button path: VBoxContainer/SaveSection/SaveInputContainer/SaveButton
  - save_name_input path: VBoxContainer/SaveSection/SaveInputContainer/SaveNameInput
  - saves_list path: VBoxContainer/LoadSection/SavesScrollContainer/SavesList
  - load_button path: VBoxContainer/LoadSection/LoadButtonContainer/LoadButton
SaveLoadDialog: Connected save button
SaveLoadDialog: Connected save input
SaveLoadDialog: Connected saves list
SaveLoadDialog: Connected load button
SaveLoadDialog: Connected delete button
SaveLoadDialog: Connected cancel button
SaveLoadDialog UI signals connected
SaveLoadDialog: Found 29 save files
SaveLoadDialog: Populated list with 29 save files
SaveLoadDialog initialized successfully
SaveLoadDialog: Checking node references...
  - save_button path: VBoxContainer/SaveSection/SaveInputContainer/SaveButton
  - save_name_input path: VBoxContainer/SaveSection/SaveInputContainer/SaveNameInput
  - saves_list path: VBoxContainer/LoadSection/SavesScrollContainer/SavesList
  - load_button path: VBoxContainer/LoadSection/LoadButtonContainer/LoadButton
SaveLoadDialog: Connected save button
SaveLoadDialog: Connected save input
SaveLoadDialog: Connected saves list
SaveLoadDialog: Connected load button
SaveLoadDialog: Connected delete button
SaveLoadDialog: Connected cancel button
SaveLoadDialog UI signals connected
[Test] Result file found!
Main: setup_phase_controllers() COMPLETE (semaphore unlocked)
ERROR: Signal 'unit_confirmed' is already connected to given callable 'CanvasLayer(Main.gd)::_on_unit_confirmed' in that object.
   at: connect (core/object/object.cpp:1538)
   GDScript backtrace (most recent call first):
       [0] connect_signals (res://scripts/Main.gd:1250)
       [1] _ready (res://scripts/Main.gd:137)
       [2] setup_phase_controllers (res://scripts/Main.gd:940)
ERROR: Signal 'models_placed_changed' is already connected to given callable 'CanvasLayer(Main.gd)::_on_models_placed_changed' in that object.
   at: connect (core/object/object.cpp:1538)
   GDScript backtrace (most recent call first):
       [0] connect_signals (res://scripts/Main.gd:1251)
       [1] _ready (res://scripts/Main.gd:137)
       [2] setup_phase_controllers (res://scripts/Main.gd:940)
Main: Connected to GameManager.result_applied signal
UnitStatsPanel: Populating unit lists for phase: DEPLOYMENT
[Test] Action completed: success=true, message=Game state retrieved
UnitStatsPanel: Populated 3 units for player (player 1)
UnitStatsPanel: Populated 3 units for enemy (player 2)
Refreshed bottom panel unit lists for phase: DEPLOYMENT
Refreshing right panel unit list for deployment - found 3 undeployed units
GameState: ⚠️ all_units_deployed check - Undeployed units: ["U_BLADE_CHAMPION_A (player 1)", "U_WITCHSEEKERS_C (player 1)", "U_CALADIUS_GRAV-TANK_E (player 1)", "U_WARBOSS_B (player 2)", "U_WARBOSS_IN_MEGA_ARMOUR_D (player 2)", "U_BATTLEWAGON_G (player 2)"]
Main: ⚠️ update_ui() - DEPLOYMENT phase - all_deployed: false
Main: ⚠️ Button state BEFORE change - disabled: true text: 'End Phase'
[2025-11-29 14:35:54] [INFO.0000000] update_ui deployment check | Context: {"all_deployed":false,"button_text":"End Phase","current_button_disabled":true}
Main: ⚠️ update_ui() - Setting button DISABLED (not all deployed)
Main: ⚠️ Button state AFTER disable - disabled: true
Main: ⚠️ Calling update_ui_for_phase() for initial phase setup
Main: ========== UPDATE UI FOR PHASE ==========
Main: Current phase: DEPLOYMENT
[2025-11-29 14:35:54] [INFO.0000000] update_ui_for_phase START | Context: {"button_exists":true,"button_path":"/root/Main/HUD_Bottom/HBoxContainer/PhaseActionButton","phase":"DEPLOYMENT"}
[2025-11-29 14:35:54] [INFO.0000000] Updating UI for phase | Context: {"phase":"DEPLOYMENT"}
GameState: ⚠️ all_units_deployed check - Undeployed units: ["U_BLADE_CHAMPION_A (player 1)", "U_WITCHSEEKERS_C (player 1)", "U_CALADIUS_GRAV-TANK_E (player 1)", "U_WARBOSS_B (player 2)", "U_WARBOSS_IN_MEGA_ARMOUR_D (player 2)", "U_BATTLEWAGON_G (player 2)"]
Main: Deployment phase - all_units_deployed: false button_disabled: true
[2025-11-29 14:35:54] [INFO.0000000] Deployment button state | Context: {"all_deployed":false,"button_disabled":true}
Main: Phase button configured - text: 'End Deployment' visible: true disabled: true
[2025-11-29 14:35:54] [INFO.0000000] Phase button configured | Context: {"disabled":true,"text":"End Deployment","visible":true}
Main: Connected phase action button to _on_phase_action_pressed
Main: ⚠️ VERIFICATION - Button connected: true
[Test Artifacts] Report saved: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_artifacts/reports/unknown_test_2025-11-29T14-35-54.json
[2025-11-29 14:35:54] [INFO.0000000] Phase button signal connected | Context: {"connection_verified":true,"is_now_connected":true,"was_previously_connected":false}
WARNING: MovementActions container not found!
GameState: ⚠️ all_units_deployed check - Undeployed units: ["U_BLADE_CHAMPION_A (player 1)", "U_WITCHSEEKERS_C (player 1)", "U_CALADIUS_GRAV-TANK_E (player 1)", "U_WARBOSS_B (player 2)", "U_WARBOSS_IN_MEGA_ARMOUR_D (player 2)", "U_BATTLEWAGON_G (player 2)"]
UnitStatsPanel: Populating unit lists for phase: DEPLOYMENT
[GameInstance] Terminating instance: Host
[LogMonitor] Stopped monitoring: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251129_143535.log
SaveLoadDialog: Found 29 save files
SaveLoadDialog: Populated list with 29 save files
SaveLoadDialog initialized successfully
Main: setup_phase_controllers() COMPLETE (semaphore unlocked)
ERROR: Signal 'unit_confirmed' is already connected to given callable 'CanvasLayer(Main.gd)::_on_unit_confirmed' in that object.
   at: connect (core/object/object.cpp:1538)
   GDScript backtrace (most recent call first):
       [0] connect_signals (res://scripts/Main.gd:1250)
       [1] _ready (res://scripts/Main.gd:137)
       [2] setup_phase_controllers (res://scripts/Main.gd:940)
ERROR: Signal 'models_placed_changed' is already connected to given callable 'CanvasLayer(Main.gd)::_on_models_placed_changed' in that object.
   at: connect (core/object/object.cpp:1538)
   GDScript backtrace (most recent call first):
       [0] connect_signals (res://scripts/Main.gd:1251)
       [1] _ready (res://scripts/Main.gd:137)
       [2] setup_phase_controllers (res://scripts/Main.gd:940)
Main: Connected to GameManager.result_applied signal
UnitStatsPanel: Populating unit lists for phase: DEPLOYMENT
UnitStatsPanel: Populated 3 units for player (player 1)
UnitStatsPanel: Populated 3 units for enemy (player 2)
Refreshed bottom panel unit lists for phase: DEPLOYMENT
Refreshing right panel unit list for deployment - found 3 undeployed units
GameState: ⚠️ all_units_deployed check - Undeployed units: ["U_BLADE_CHAMPION_A (player 1)", "U_WITCHSEEKERS_C (player 1)", "U_CALADIUS_GRAV-TANK_E (player 1)", "U_WARBOSS_B (player 2)", "U_WARBOSS_IN_MEGA_ARMOUR_D (player 2)", "U_BATTLEWAGON_G (player 2)"]
Main: ⚠️ update_ui() - DEPLOYMENT phase - all_deployed: false
Main: ⚠️ Button state BEFORE change - disabled: true text: 'End Phase'
[2025-11-29 14:35:54] [INFO.0000000] update_ui deployment check | Context: {"all_deployed":false,"button_text":"End Phase","current_button_disabled":true}
Main: ⚠️ update_ui() - Setting button DISABLED (not all deployed)
Main: ⚠️ Button state AFTER disable - disabled: true
Main: ⚠️ Calling update_ui_for_phase() for initial phase setup
Main: ========== UPDATE UI FOR PHASE ==========
Main: Current phase: DEPLOYMENT
[2025-11-29 14:35:54] [INFO.0000000] update_ui_for_phase START | Context: {"button_exists":true,"button_path":"/root/Main/HUD_Bottom/HBoxContainer/PhaseActionButton","phase":"DEPLOYMENT"}
[2025-11-29 14:35:54] [INFO.0000000] Updating UI for phase | Context: {"phase":"DEPLOYMENT"}
GameState: ⚠️ all_units_deployed check - Undeployed units: ["U_BLADE_CHAMPION_A (player 1)", "U_WITCHSEEKERS_C (player 1)", "U_CALADIUS_GRAV-TANK_E (player 1)", "U_WARBOSS_B (player 2)", "U_WARBOSS_IN_MEGA_ARMOUR_D (player 2)", "U_BATTLEWAGON_G (player 2)"]
Main: Deployment phase - all_units_deployed: false button_disabled: true
[2025-11-29 14:35:54] [INFO.0000000] Deployment button state | Context: {"all_deployed":false,"button_disabled":true}
Main: Phase button configured - text: 'End Deployment' visible: true disabled: true
[2025-11-29 14:35:54] [INFO.0000000] Phase button configured | Context: {"disabled":true,"text":"End Deployment","visible":true}
Main: Connected phase action button to _on_phase_action_pressed
Main: ⚠️ VERIFICATION - Button connected: true
[2025-11-29 14:35:54] [INFO.0000000] Phase button signal connected | Context: {"connection_verified":true,"is_now_connected":true,"was_previously_connected":false}
WARNING: MovementActions container not found!
GameState: ⚠️ all_units_deployed check - Undeployed units: ["U_BLADE_CHAMPION_A (player 1)", "U_WITCHSEEKERS_C (player 1)", "U_CALADIUS_GRAV-TANK_E (player 1)", "U_WARBOSS_B (player 2)", "U_WARBOSS_IN_MEGA_ARMOUR_D (player 2)", "U_BATTLEWAGON_G (player 2)"]
UnitStatsPanel: Populating unit lists for phase: DEPLOYMENT
UnitStatsPanel: Populated 3 units for player (player 1)
UnitStatsPanel: Populated 3 units for enemy (player 2)
Refreshed bottom panel unit lists for phase: DEPLOYMENT
Refreshing right panel unit list for deployment - found 3 undeployed units
GameState: ⚠️ all_units_deployed check - Undeployed units: ["U_BLADE_CHAMPION_A (player 1)", "U_WITCHSEEKERS_C (player 1)", "U_CALADIUS_GRAV-TANK_E (player 1)", "U_WARBOSS_B (player 2)", "U_WARBOSS_IN_MEGA_ARMOUR_D (player 2)", "U_BATTLEWAGON_G (player 2)"]
Main: ⚠️ update_ui() - DEPLOYMENT phase - all_deployed: false
Main: ⚠️ Button state BEFORE change - disabled: true text: 'End Deployment'
[2025-11-29 14:35:54] [INFO.0000000] update_ui deployment check | Context: {"all_deployed":false,"button_text":"End Deployment","current_button_disabled":true}
Main: ⚠️ update_ui() - Setting button DISABLED (not all deployed)
Main: ⚠️ Button state AFTER disable - disabled: true
Main: ⚠️ Initial phase UI setup complete
Quick Save/Load enabled: [ key to save, ] key (or F9) to load
[GameInstance] Terminating instance: Client
[LogMonitor] Stopped monitoring: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251129_143540.log

========================================
Starting Multiplayer Integration Test
========================================

  Running: test_deployment_outside_zone

[TEST] test_deployment_outside_zone
[Test] Launching host and client instances...
[GameInstance] Launching Host instance on port 8000
[GameInstance] Using project path: /Users/robertocallaghan/Documents/claude/godotv2/40k/
Godot Engine v4.5.1.stable.official.f62fdbde1 - https://godotengine.org
OpenGL API 4.1 INTEL-18.8.6 - Compatibility - Using Device: Intel Inc. - Intel(R) Iris(TM) Graphics 6100

TestModeHandler: Args -> ["--test-mode", "--position=100,100", "--resolution=600x480", "--auto-host", "--port=8000", "--instance-name=Host"]
[LogMonitor] Started monitoring: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251129_143547.log
[GameInstance] Monitoring log file: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251129_143547.log
[GameInstance] Successfully launched Host (PID: 87019)
[Test] Host instance launched successfully on port 8000
========================================
   RUNNING IN TEST MODE
   Config: { "window_position": (100, 100), "window_size": (600, 480), "is_host": true, "port": 8000, "instance_name": "Host" }
========================================
TestModeHandler: Command directories ready
  Commands: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_commands/commands
  Results: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_commands/results
[2025-11-29 14:35:59] [INFO.0000000] DebugLogger initialized - Session: 20251129_143559
[2025-11-29 14:35:59] [INFO.0000000] Log file: user://logs/debug_20251129_143559.log
[2025-11-29 14:35:59] [INFO.0000000] Real path: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251129_143559.log
[MeasuringTapeManager] Save persistence: false
Found armies in res://: ["orks", "adeptus_custodes", "space_marines", "A_C_test", "ORK_test"]
ArmyListManager initialized with 5 armies: ["orks", "adeptus_custodes", "space_marines", "A_C_test", "ORK_test"]
[2025-11-29 14:35:59] [INFO.0000000] DebugManager initialized
GameState: Loading default armies...
GameState: ArmyListManager not available, falling back to placeholder armies
GameState: Initializing placeholder armies for both players
GameState: Initializing placeholder army for player 1
GameState: Initializing placeholder army for player 2
ActionLogger: Started session 20251129_143559
StateSerializer: Pretty print enabled: true
SaveLoadManager: Current res:// directory: res://
SaveLoadManager: Project directory path: /Users/robertocallaghan/Documents/claude/godotv2/40k/
SaveLoadManager: Initialized save directories in project folder
SaveLoadManager: Save files will be stored at: /Users/robertocallaghan/Documents/claude/godotv2/40k/saves/
[PhaseManager] Ready - awaiting explicit phase initialization
[TerrainManager] Initializing terrain system
[TerrainManager] Added walls to terrain pieces
[TerrainManager] Loaded 12 terrain pieces
[EnhancedLineOfSight] Initialized
MissionManager: Initializing mission system
MissionManager: Set up 5 objectives for Strike Force deployment
  - obj_center at position (880.0, 1200.0)
  - obj_tl at position (400.0, 560.0)
  - obj_tr at position (1360.0, 560.0)
  - obj_bl at position (400.0, 1840.0)
  - obj_br at position (1360.0, 1840.0)
MissionManager: Initialized Take and Hold mission
[MeasuringTapeManager] Initialized with save_persistence: false
[LineOfSightManager] Initialized - Hold 'V' to check what can see the cursor position
TransportManager initialized
NetworkManager: Initialized
MainMenu: Initializing main menu
MainMenu: Loaded 5 armies: ["A C Test", "Adeptus Custodes", "ORK Test", "Orks", "Space Marines"]
MainMenu: Dropdowns populated with 5 armies
MainMenu: Multiplayer button visible: true
MainMenu: Signals connected
MainMenu: Save/Load dialog setup complete
MainMenu: Default armies set - Player 1: A C Test, Player 2: ORK Test
MainMenu: Ready with default selections
TestModeHandler: Set window position to (100, 100)
TestModeHandler: Set window size to (600, 480)
TestModeHandler: Scheduling auto-host...
SaveLoadDialog: Checking node references...
  - save_button path: VBoxContainer/SaveSection/SaveInputContainer/SaveButton
  - save_name_input path: VBoxContainer/SaveSection/SaveInputContainer/SaveNameInput
  - saves_list path: VBoxContainer/LoadSection/SavesScrollContainer/SavesList
  - load_button path: VBoxContainer/LoadSection/LoadButtonContainer/LoadButton
SaveLoadDialog: Connected save button
SaveLoadDialog: Connected save input
SaveLoadDialog: Connected saves list
SaveLoadDialog: Connected load button
SaveLoadDialog: Connected delete button
SaveLoadDialog: Connected cancel button
SaveLoadDialog UI signals connected
SaveLoadDialog: Found 29 save files
SaveLoadDialog: Populated list with 29 save files
SaveLoadDialog initialized successfully
[GameInstance] Launching Client instance on port 7778
[GameInstance] Using project path: /Users/robertocallaghan/Documents/claude/godotv2/40k/
TestModeHandler: Current scene: MainMenu
TestModeHandler: Triggering multiplayer mode...
MainMenu: Multiplayer button pressed
MultiplayerLobby: Army selection initialized with 5 armies
MultiplayerLobby: Ready
Godot Engine v4.5.1.stable.official.f62fdbde1 - https://godotengine.org
OpenGL API 4.1 INTEL-18.8.6 - Compatibility - Using Device: Intel Inc. - Intel(R) Iris(TM) Graphics 6100

TestModeHandler: Args -> ["--test-mode", "--position=800,100", "--resolution=600x480", "--auto-join", "--host-ip=127.0.0.1", "--host-port=8000", "--instance-name=Client"]
[LogMonitor] Started monitoring: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251129_143559.log
[GameInstance] Monitoring log file: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251129_143559.log
[GameInstance] Successfully launched Client (PID: 87032)
[Test] Client instance launched successfully
[Test] Waiting for client to connect to host...
TestModeHandler: Lobby scene: MultiplayerLobby
TestModeHandler: Creating host on port 8000
MultiplayerLobby: Host button pressed
========================================
   YOU ARE: PLAYER 1 (HOST)
   Hosting on port: 7777
========================================
MultiplayerLobby: Successfully hosting on port 7777
TestModeHandler: Waiting for client to connect...
TestModeHandler: Listening for peer connection...
[Test] Host performing action: get_game_state with params: {  }
[Test] Writing command file: host_87019_cmd_001.json
[Test] Waiting for result file...
[Test] Polling for result file: host_87019_cmd_001_result.json
TestModeHandler: Processing command file host_87019_cmd_001.json
TestModeHandler: Executing command from file: host_87019_cmd_001.json
TestModeHandler: Executing action: get_game_state
TestModeHandler: Handling get_game_state action
TestModeHandler: get_game_state - Phase: Deployment, Turn: 0, Player: 0
TestModeHandler: Result written to: host_87019_cmd_001_result.json
TestModeHandler: Command executed and result written
[Test] Result file found!
[Test] Action completed: success=true, message=Game state retrieved
[Test] Connection verified - action simulation working!
========================================
   RUNNING IN TEST MODE
   Config: { "window_position": (800, 100), "window_size": (600, 480), "is_host": false, "host_ip": "127.0.0.1", "host_port": 8000, "instance_name": "Client" }
========================================
TestModeHandler: Command directories ready
  Commands: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_commands/commands
  Results: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_commands/results
[2025-11-29 14:36:04] [INFO.0000000] DebugLogger initialized - Session: 20251129_143604
[2025-11-29 14:36:04] [INFO.0000000] Log file: user://logs/debug_20251129_143604.log
[2025-11-29 14:36:04] [INFO.0000000] Real path: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251129_143604.log
[MeasuringTapeManager] Save persistence: false
Found armies in res://: ["orks", "adeptus_custodes", "space_marines", "A_C_test", "ORK_test"]
ArmyListManager initialized with 5 armies: ["orks", "adeptus_custodes", "space_marines", "A_C_test", "ORK_test"]
[2025-11-29 14:36:04] [INFO.0000000] DebugManager initialized
GameState: Loading default armies...
GameState: ArmyListManager not available, falling back to placeholder armies
GameState: Initializing placeholder armies for both players
GameState: Initializing placeholder army for player 1
GameState: Initializing placeholder army for player 2
ActionLogger: Started session 20251129_143604
StateSerializer: Pretty print enabled: true
SaveLoadManager: Current res:// directory: res://
SaveLoadManager: Project directory path: /Users/robertocallaghan/Documents/claude/godotv2/40k/
SaveLoadManager: Initialized save directories in project folder
SaveLoadManager: Save files will be stored at: /Users/robertocallaghan/Documents/claude/godotv2/40k/saves/
[PhaseManager] Ready - awaiting explicit phase initialization
[TerrainManager] Initializing terrain system
[TerrainManager] Added walls to terrain pieces
[TerrainManager] Loaded 12 terrain pieces
[EnhancedLineOfSight] Initialized
MissionManager: Initializing mission system
MissionManager: Set up 5 objectives for Strike Force deployment
  - obj_center at position (880.0, 1200.0)
  - obj_tl at position (400.0, 560.0)
  - obj_tr at position (1360.0, 560.0)
  - obj_bl at position (400.0, 1840.0)
  - obj_br at position (1360.0, 1840.0)
MissionManager: Initialized Take and Hold mission
[MeasuringTapeManager] Initialized with save_persistence: false
[LineOfSightManager] Initialized - Hold 'V' to check what can see the cursor position
TransportManager initialized
NetworkManager: Initialized
MainMenu: Initializing main menu
MainMenu: Loaded 5 armies: ["A C Test", "Adeptus Custodes", "ORK Test", "Orks", "Space Marines"]
MainMenu: Dropdowns populated with 5 armies
MainMenu: Multiplayer button visible: true
MainMenu: Signals connected
MainMenu: Save/Load dialog setup complete
MainMenu: Default armies set - Player 1: A C Test, Player 2: ORK Test
MainMenu: Ready with default selections
TestModeHandler: Set window position to (800, 100)
TestModeHandler: Set window size to (600, 480)
TestModeHandler: Scheduling auto-join...
SaveLoadDialog: Checking node references...
  - save_button path: VBoxContainer/SaveSection/SaveInputContainer/SaveButton
  - save_name_input path: VBoxContainer/SaveSection/SaveInputContainer/SaveNameInput
  - saves_list path: VBoxContainer/LoadSection/SavesScrollContainer/SavesList
  - load_button path: VBoxContainer/LoadSection/LoadButtonContainer/LoadButton
SaveLoadDialog: Connected save button
SaveLoadDialog: Connected save input
SaveLoadDialog: Connected saves list
SaveLoadDialog: Connected load button
SaveLoadDialog: Connected delete button
SaveLoadDialog: Connected cancel button
SaveLoadDialog UI signals connected
SaveLoadDialog: Found 29 save files
SaveLoadDialog: Populated list with 29 save files
SaveLoadDialog initialized successfully
TestModeHandler: Current scene: MainMenu
TestModeHandler: Triggering multiplayer mode...
MainMenu: Multiplayer button pressed
MultiplayerLobby: Army selection initialized with 5 armies
MultiplayerLobby: Ready
[Test] Host performing action: get_available_units with params: {  }
[Test] Writing command file: host_87019_cmd_002.json
[Test] Waiting for result file...
[Test] Polling for result file: host_87019_cmd_002_result.json
TestModeHandler: Processing command file host_87019_cmd_002.json
TestModeHandler: Executing command from file: host_87019_cmd_002.json
TestModeHandler: Executing action: get_available_units
TestModeHandler: Handling get_available_units action
TestModeHandler: Player 1 units: ["U_INTERCESSORS_A", "U_TACTICAL_A"] (undeployed: ["U_INTERCESSORS_A", "U_TACTICAL_A"])
TestModeHandler: Player 2 units: ["U_BOYZ_A", "U_GRETCHIN_A"] (undeployed: ["U_BOYZ_A", "U_GRETCHIN_A"])
TestModeHandler: Result written to: host_87019_cmd_002_result.json
TestModeHandler: Command executed and result written
[Test] Result file found!
[Test] Action completed: success=true, message=Available units retrieved
[Test] Host performing action: deploy_unit with params: { "unit_id": "U_INTERCESSORS_A", "position": { "x": 22.0, "y": 30.0 } }
[Test] Writing command file: host_87019_cmd_003.json
[Test] Waiting for result file...
TestModeHandler: Processing command file host_87019_cmd_003.json
[Test] Polling for result file: host_87019_cmd_003_result.json
TestModeHandler: Executing command from file: host_87019_cmd_003.json
TestModeHandler: Executing action: deploy_unit
TestModeHandler: Handling deploy_unit action
GameManager: deploy_unit() called - unit_id: U_INTERCESSORS_A, position: (22.0, 30.0)
GameManager: Total units in GameState: 4
GameManager: Unit IDs: ["U_INTERCESSORS_A", "U_TACTICAL_A", "U_BOYZ_A", "U_GRETCHIN_A"]
GameManager: Switching active player from 1 to 2
GameManager: Applying result with 12 changes/diffs
GameManager: Setting units.U_INTERCESSORS_A.models.0.position = { "x": 22.0, "y": 30.0 }
GameManager: Setting units.U_INTERCESSORS_A.models.0.rotation = 0.0
GameManager: Setting units.U_INTERCESSORS_A.models.1.position = { "x": 22.0, "y": 30.0 }
GameManager: Setting units.U_INTERCESSORS_A.models.1.rotation = 0.0
GameManager: Setting units.U_INTERCESSORS_A.models.2.position = { "x": 22.0, "y": 30.0 }
GameManager: Setting units.U_INTERCESSORS_A.models.2.rotation = 0.0
GameManager: Setting units.U_INTERCESSORS_A.models.3.position = { "x": 22.0, "y": 30.0 }
GameManager: Setting units.U_INTERCESSORS_A.models.3.rotation = 0.0
GameManager: Setting units.U_INTERCESSORS_A.models.4.position = { "x": 22.0, "y": 30.0 }
GameManager: Setting units.U_INTERCESSORS_A.models.4.rotation = 0.0
GameManager: Setting units.U_INTERCESSORS_A.status = 2
GameManager: Setting meta.active_player = 2
GameManager: deploy_unit() result: success=true
TestModeHandler: Result written to: host_87019_cmd_003_result.json
TestModeHandler: Command executed and result written
[Test] Result file found!
[Test] Action completed: success=true, message=Unit deployed successfully
ASSERTION FAILED: test_deployment_outside_zone - Deployment outside zone should be rejected
[TEST] Deployment correctly rejected: Unit deployed successfully

========================================
Cleaning up Multiplayer Test
========================================

[Test] Host performing action: get_game_state with params: {  }
[Test] Writing command file: host_87019_cmd_004.json
[Test] Waiting for result file...
[Test] Polling for result file: host_87019_cmd_004_result.json
TestModeHandler: Processing command file host_87019_cmd_004.json
TestModeHandler: Executing command from file: host_87019_cmd_004.json
TestModeHandler: Executing action: get_game_state
TestModeHandler: Handling get_game_state action
TestModeHandler: get_game_state - Phase: Deployment, Turn: 0, Player: 0
TestModeHandler: Result written to: host_87019_cmd_004_result.json
TestModeHandler: Command executed and result written
[Test] Result file found!
[Test] Action completed: success=true, message=Game state retrieved
[Test Artifacts] Report saved: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_artifacts/reports/unknown_test_2025-11-29T14-36-07.json
[GameInstance] Terminating instance: Host
[LogMonitor] Stopped monitoring: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251129_143547.log
[GameInstance] Terminating instance: Client
[LogMonitor] Stopped monitoring: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251129_143559.log

========================================
Starting Multiplayer Integration Test
========================================

  Running: test_deployment_alternating_turns

[TEST] test_deployment_alternating_turns
[Test] Launching host and client instances...
[GameInstance] Launching Host instance on port 8000
[GameInstance] Using project path: /Users/robertocallaghan/Documents/claude/godotv2/40k/
Godot Engine v4.5.1.stable.official.f62fdbde1 - https://godotengine.org
OpenGL API 4.1 INTEL-18.8.6 - Compatibility - Using Device: Intel Inc. - Intel(R) Iris(TM) Graphics 6100

TestModeHandler: Args -> ["--test-mode", "--position=100,100", "--resolution=600x480", "--auto-host", "--port=8000", "--instance-name=Host"]
[LogMonitor] Started monitoring: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251129_143604.log
[GameInstance] Monitoring log file: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251129_143604.log
[GameInstance] Successfully launched Host (PID: 87042)
[Test] Host instance launched successfully on port 8000
========================================
   RUNNING IN TEST MODE
   Config: { "window_position": (100, 100), "window_size": (600, 480), "is_host": true, "port": 8000, "instance_name": "Host" }
========================================
TestModeHandler: Command directories ready
  Commands: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_commands/commands
  Results: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_commands/results
[2025-11-29 14:36:11] [INFO.0000000] DebugLogger initialized - Session: 20251129_143611
[2025-11-29 14:36:11] [INFO.0000000] Log file: user://logs/debug_20251129_143611.log
[2025-11-29 14:36:11] [INFO.0000000] Real path: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251129_143611.log
[MeasuringTapeManager] Save persistence: false
Found armies in res://: ["orks", "adeptus_custodes", "space_marines", "A_C_test", "ORK_test"]
ArmyListManager initialized with 5 armies: ["orks", "adeptus_custodes", "space_marines", "A_C_test", "ORK_test"]
[2025-11-29 14:36:11] [INFO.0000000] DebugManager initialized
GameState: Loading default armies...
GameState: ArmyListManager not available, falling back to placeholder armies
GameState: Initializing placeholder armies for both players
GameState: Initializing placeholder army for player 1
GameState: Initializing placeholder army for player 2
ActionLogger: Started session 20251129_143611
StateSerializer: Pretty print enabled: true
SaveLoadManager: Current res:// directory: res://
SaveLoadManager: Project directory path: /Users/robertocallaghan/Documents/claude/godotv2/40k/
SaveLoadManager: Initialized save directories in project folder
SaveLoadManager: Save files will be stored at: /Users/robertocallaghan/Documents/claude/godotv2/40k/saves/
[PhaseManager] Ready - awaiting explicit phase initialization
[TerrainManager] Initializing terrain system
[TerrainManager] Added walls to terrain pieces
[TerrainManager] Loaded 12 terrain pieces
[EnhancedLineOfSight] Initialized
MissionManager: Initializing mission system
MissionManager: Set up 5 objectives for Strike Force deployment
  - obj_center at position (880.0, 1200.0)
  - obj_tl at position (400.0, 560.0)
  - obj_tr at position (1360.0, 560.0)
  - obj_bl at position (400.0, 1840.0)
  - obj_br at position (1360.0, 1840.0)
MissionManager: Initialized Take and Hold mission
[MeasuringTapeManager] Initialized with save_persistence: false
[LineOfSightManager] Initialized - Hold 'V' to check what can see the cursor position
TransportManager initialized
NetworkManager: Initialized
MainMenu: Initializing main menu
MainMenu: Loaded 5 armies: ["A C Test", "Adeptus Custodes", "ORK Test", "Orks", "Space Marines"]
MainMenu: Dropdowns populated with 5 armies
MainMenu: Multiplayer button visible: true
MainMenu: Signals connected
MainMenu: Save/Load dialog setup complete
MainMenu: Default armies set - Player 1: A C Test, Player 2: ORK Test
MainMenu: Ready with default selections
TestModeHandler: Set window position to (100, 100)
TestModeHandler: Set window size to (600, 480)
TestModeHandler: Scheduling auto-host...
SaveLoadDialog: Checking node references...
  - save_button path: VBoxContainer/SaveSection/SaveInputContainer/SaveButton
  - save_name_input path: VBoxContainer/SaveSection/SaveInputContainer/SaveNameInput
  - saves_list path: VBoxContainer/LoadSection/SavesScrollContainer/SavesList
  - load_button path: VBoxContainer/LoadSection/LoadButtonContainer/LoadButton
SaveLoadDialog: Connected save button
SaveLoadDialog: Connected save input
SaveLoadDialog: Connected saves list
SaveLoadDialog: Connected load button
SaveLoadDialog: Connected delete button
SaveLoadDialog: Connected cancel button
SaveLoadDialog UI signals connected
SaveLoadDialog: Found 29 save files
SaveLoadDialog: Populated list with 29 save files
SaveLoadDialog initialized successfully
[GameInstance] Launching Client instance on port 7778
[GameInstance] Using project path: /Users/robertocallaghan/Documents/claude/godotv2/40k/
TestModeHandler: Current scene: MainMenu
TestModeHandler: Triggering multiplayer mode...
MainMenu: Multiplayer button pressed
MultiplayerLobby: Army selection initialized with 5 armies
MultiplayerLobby: Ready
Godot Engine v4.5.1.stable.official.f62fdbde1 - https://godotengine.org
OpenGL API 4.1 INTEL-18.8.6 - Compatibility - Using Device: Intel Inc. - Intel(R) Iris(TM) Graphics 6100

TestModeHandler: Lobby scene: MultiplayerLobby
TestModeHandler: Creating host on port 8000
MultiplayerLobby: Host button pressed
========================================
   YOU ARE: PLAYER 1 (HOST)
   Hosting on port: 7777
========================================
MultiplayerLobby: Successfully hosting on port 7777
TestModeHandler: Waiting for client to connect...
TestModeHandler: Listening for peer connection...
TestModeHandler: Args -> ["--test-mode", "--position=800,100", "--resolution=600x480", "--auto-join", "--host-ip=127.0.0.1", "--host-port=8000", "--instance-name=Client"]
[LogMonitor] Started monitoring: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251129_143611.log
[GameInstance] Monitoring log file: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251129_143611.log
[GameInstance] Successfully launched Client (PID: 87047)
[Test] Client instance launched successfully
[Test] Waiting for client to connect to host...
[Test] Host performing action: get_game_state with params: {  }
[Test] Writing command file: host_87042_cmd_001.json
[Test] Waiting for result file...
[Test] Polling for result file: host_87042_cmd_001_result.json
TestModeHandler: Processing command file host_87042_cmd_001.json
TestModeHandler: Executing command from file: host_87042_cmd_001.json
TestModeHandler: Executing action: get_game_state
TestModeHandler: Handling get_game_state action
TestModeHandler: get_game_state - Phase: Deployment, Turn: 0, Player: 0
TestModeHandler: Result written to: host_87042_cmd_001_result.json
TestModeHandler: Command executed and result written
[Test] Result file found!
[Test] Action completed: success=true, message=Game state retrieved
[Test] Connection verified - action simulation working!
========================================
   RUNNING IN TEST MODE
   Config: { "window_position": (800, 100), "window_size": (600, 480), "is_host": false, "host_ip": "127.0.0.1", "host_port": 8000, "instance_name": "Client" }
========================================
TestModeHandler: Command directories ready
  Commands: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_commands/commands
  Results: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_commands/results
[2025-11-29 14:36:16] [INFO.0000000] DebugLogger initialized - Session: 20251129_143616
[2025-11-29 14:36:16] [INFO.0000000] Log file: user://logs/debug_20251129_143616.log
[2025-11-29 14:36:16] [INFO.0000000] Real path: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251129_143616.log
[MeasuringTapeManager] Save persistence: false
Found armies in res://: ["orks", "adeptus_custodes", "space_marines", "A_C_test", "ORK_test"]
ArmyListManager initialized with 5 armies: ["orks", "adeptus_custodes", "space_marines", "A_C_test", "ORK_test"]
[2025-11-29 14:36:16] [INFO.0000000] DebugManager initialized
GameState: Loading default armies...
GameState: ArmyListManager not available, falling back to placeholder armies
GameState: Initializing placeholder armies for both players
GameState: Initializing placeholder army for player 1
GameState: Initializing placeholder army for player 2
ActionLogger: Started session 20251129_143616
StateSerializer: Pretty print enabled: true
SaveLoadManager: Current res:// directory: res://
SaveLoadManager: Project directory path: /Users/robertocallaghan/Documents/claude/godotv2/40k/
SaveLoadManager: Initialized save directories in project folder
SaveLoadManager: Save files will be stored at: /Users/robertocallaghan/Documents/claude/godotv2/40k/saves/
[PhaseManager] Ready - awaiting explicit phase initialization
[TerrainManager] Initializing terrain system
[TerrainManager] Added walls to terrain pieces
[TerrainManager] Loaded 12 terrain pieces
[EnhancedLineOfSight] Initialized
MissionManager: Initializing mission system
MissionManager: Set up 5 objectives for Strike Force deployment
  - obj_center at position (880.0, 1200.0)
  - obj_tl at position (400.0, 560.0)
  - obj_tr at position (1360.0, 560.0)
  - obj_bl at position (400.0, 1840.0)
  - obj_br at position (1360.0, 1840.0)
MissionManager: Initialized Take and Hold mission
[MeasuringTapeManager] Initialized with save_persistence: false
[LineOfSightManager] Initialized - Hold 'V' to check what can see the cursor position
TransportManager initialized
NetworkManager: Initialized
MainMenu: Initializing main menu
MainMenu: Loaded 5 armies: ["A C Test", "Adeptus Custodes", "ORK Test", "Orks", "Space Marines"]
MainMenu: Dropdowns populated with 5 armies
MainMenu: Multiplayer button visible: true
MainMenu: Signals connected
MainMenu: Save/Load dialog setup complete
MainMenu: Default armies set - Player 1: A C Test, Player 2: ORK Test
MainMenu: Ready with default selections
TestModeHandler: Set window position to (800, 100)
TestModeHandler: Set window size to (600, 480)
TestModeHandler: Scheduling auto-join...
SaveLoadDialog: Checking node references...
  - save_button path: VBoxContainer/SaveSection/SaveInputContainer/SaveButton
  - save_name_input path: VBoxContainer/SaveSection/SaveInputContainer/SaveNameInput
  - saves_list path: VBoxContainer/LoadSection/SavesScrollContainer/SavesList
  - load_button path: VBoxContainer/LoadSection/LoadButtonContainer/LoadButton
SaveLoadDialog: Connected save button
SaveLoadDialog: Connected save input
SaveLoadDialog: Connected saves list
SaveLoadDialog: Connected load button
SaveLoadDialog: Connected delete button
SaveLoadDialog: Connected cancel button
SaveLoadDialog UI signals connected
SaveLoadDialog: Found 29 save files
SaveLoadDialog: Populated list with 29 save files
SaveLoadDialog initialized successfully
TestModeHandler: Current scene: MainMenu
TestModeHandler: Triggering multiplayer mode...
MainMenu: Multiplayer button pressed
MultiplayerLobby: Army selection initialized with 5 armies
MultiplayerLobby: Ready
[Test] Host performing action: get_available_units with params: {  }
[Test] Writing command file: host_87042_cmd_002.json
[Test] Waiting for result file...
[Test] Polling for result file: host_87042_cmd_002_result.json
TestModeHandler: Processing command file host_87042_cmd_002.json
TestModeHandler: Executing command from file: host_87042_cmd_002.json
TestModeHandler: Executing action: get_available_units
TestModeHandler: Handling get_available_units action
TestModeHandler: Player 1 units: ["U_INTERCESSORS_A", "U_TACTICAL_A"] (undeployed: ["U_INTERCESSORS_A", "U_TACTICAL_A"])
TestModeHandler: Player 2 units: ["U_BOYZ_A", "U_GRETCHIN_A"] (undeployed: ["U_BOYZ_A", "U_GRETCHIN_A"])
TestModeHandler: Result written to: host_87042_cmd_002_result.json
TestModeHandler: Command executed and result written
[Test] Result file found!
[Test] Action completed: success=true, message=Available units retrieved
[TEST] Using unit: U_INTERCESSORS_A
[Test] Host performing action: get_game_state with params: {  }
[Test] Writing command file: host_87042_cmd_003.json
[Test] Waiting for result file...
[Test] Polling for result file: host_87042_cmd_003_result.json
TestModeHandler: Processing command file host_87042_cmd_003.json
TestModeHandler: Executing command from file: host_87042_cmd_003.json
TestModeHandler: Executing action: get_game_state
TestModeHandler: Handling get_game_state action
TestModeHandler: get_game_state - Phase: Deployment, Turn: 0, Player: 0
TestModeHandler: Result written to: host_87042_cmd_003_result.json
TestModeHandler: Command executed and result written
[Test] Result file found!
[Test] Action completed: success=true, message=Game state retrieved
[TEST] Initial turn: Player 0.0
[Test] Host performing action: deploy_unit with params: { "unit_id": "U_INTERCESSORS_A", "position": { "x": 100.0, "y": 100.0 } }
[Test] Writing command file: host_87042_cmd_004.json
[Test] Waiting for result file...
[Test] Polling for result file: host_87042_cmd_004_result.json
TestModeHandler: Processing command file host_87042_cmd_004.json
TestModeHandler: Executing command from file: host_87042_cmd_004.json
TestModeHandler: Executing action: deploy_unit
TestModeHandler: Handling deploy_unit action
GameManager: deploy_unit() called - unit_id: U_INTERCESSORS_A, position: (100.0, 100.0)
GameManager: Total units in GameState: 4
GameManager: Unit IDs: ["U_INTERCESSORS_A", "U_TACTICAL_A", "U_BOYZ_A", "U_GRETCHIN_A"]
GameManager: Switching active player from 1 to 2
GameManager: Applying result with 12 changes/diffs
GameManager: Setting units.U_INTERCESSORS_A.models.0.position = { "x": 100.0, "y": 100.0 }
GameManager: Setting units.U_INTERCESSORS_A.models.0.rotation = 0.0
GameManager: Setting units.U_INTERCESSORS_A.models.1.position = { "x": 100.0, "y": 100.0 }
GameManager: Setting units.U_INTERCESSORS_A.models.1.rotation = 0.0
GameManager: Setting units.U_INTERCESSORS_A.models.2.position = { "x": 100.0, "y": 100.0 }
GameManager: Setting units.U_INTERCESSORS_A.models.2.rotation = 0.0
GameManager: Setting units.U_INTERCESSORS_A.models.3.position = { "x": 100.0, "y": 100.0 }
GameManager: Setting units.U_INTERCESSORS_A.models.3.rotation = 0.0
GameManager: Setting units.U_INTERCESSORS_A.models.4.position = { "x": 100.0, "y": 100.0 }
GameManager: Setting units.U_INTERCESSORS_A.models.4.rotation = 0.0
GameManager: Setting units.U_INTERCESSORS_A.status = 2
GameManager: Setting meta.active_player = 2
GameManager: deploy_unit() result: success=true
TestModeHandler: Result written to: host_87042_cmd_004_result.json
TestModeHandler: Command executed and result written
[Test] Result file found!
[Test] Action completed: success=true, message=Unit deployed successfully
TestModeHandler: Lobby scene: MultiplayerLobby
TestModeHandler: Joining host at 127.0.0.1
MultiplayerLobby: Join button pressed
NetworkManager: Connecting to 127.0.0.1:7777
MultiplayerLobby: Attempting to join 127.0.0.1:7777
NetworkManager: Peer connected - 1
NetworkManager: Successfully connected to host
NetworkManager: Client set peer_to_player_map[1204690212] = 2
========================================
   YOU ARE: PLAYER 2 (CLIENT)
   Connected to host
========================================
MultiplayerLobby: Peer connected - 1
MultiplayerLobby: Game started signal received
NetworkManager: Peer connected - 1204690212
[GameState] MeasuringTapeManager not available
MultiplayerLobby: Peer connected - 1204690212
TestModeHandler: Client connected!
MultiplayerLobby: Game started signal received
NetworkManager: Receiving initial state from host
[GameState] No measuring_tape data in save
NetworkManager: State synchronized
MultiplayerLobby: Game started signal received
MultiplayerLobby: Syncing army selection - Player 1 -> A_C_test
MultiplayerLobby: Syncing army selection - Player 2 -> ORK_test
[Test] Host performing action: get_game_state with params: {  }
[Test] Writing command file: host_87042_cmd_005.json
[Test] Waiting for result file...
[Test] Polling for result file: host_87042_cmd_005_result.json
TestModeHandler: Processing command file host_87042_cmd_005.json
TestModeHandler: Executing command from file: host_87042_cmd_005.json
TestModeHandler: Executing action: get_game_state
TestModeHandler: Handling get_game_state action
TestModeHandler: get_game_state - Phase: Deployment, Turn: 0, Player: 0
TestModeHandler: Result written to: host_87042_cmd_005_result.json
TestModeHandler: Command executed and result written
[Test] Result file found!
[Test] Action completed: success=true, message=Game state retrieved
[TEST] Turn after deployment: Player 0.0
[TEST] Turn alternation test completed

========================================
Cleaning up Multiplayer Test
========================================

[Test] Host performing action: get_game_state with params: {  }
[Test] Writing command file: host_87042_cmd_006.json
[Test] Waiting for result file...
[Test] Polling for result file: host_87042_cmd_006_result.json
TestModeHandler: Processing command file host_87042_cmd_006.json
TestModeHandler: Executing command from file: host_87042_cmd_006.json
TestModeHandler: Executing action: get_game_state
TestModeHandler: Handling get_game_state action
TestModeHandler: get_game_state - Phase: Deployment, Turn: 0, Player: 0
TestModeHandler: Result written to: host_87042_cmd_006_result.json
TestModeHandler: Command executed and result written
[Test] Result file found!
[Test] Action completed: success=true, message=Game state retrieved
[Test Artifacts] Report saved: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_artifacts/reports/unknown_test_2025-11-29T14-36-21.json
[GameInstance] Terminating instance: Host
[LogMonitor] Stopped monitoring: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251129_143604.log
[GameInstance] Terminating instance: Client
[LogMonitor] Stopped monitoring: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251129_143611.log

========================================
Starting Multiplayer Integration Test
========================================

  Running: test_deployment_wrong_turn

[TEST] test_deployment_wrong_turn
[Test] Launching host and client instances...
[GameInstance] Launching Host instance on port 8000
[GameInstance] Using project path: /Users/robertocallaghan/Documents/claude/godotv2/40k/
Godot Engine v4.5.1.stable.official.f62fdbde1 - https://godotengine.org
OpenGL API 4.1 INTEL-18.8.6 - Compatibility - Using Device: Intel Inc. - Intel(R) Iris(TM) Graphics 6100

TestModeHandler: Args -> ["--test-mode", "--position=100,100", "--resolution=600x480", "--auto-host", "--port=8000", "--instance-name=Host"]
[LogMonitor] Started monitoring: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251129_143611.log
[GameInstance] Monitoring log file: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251129_143611.log
[GameInstance] Successfully launched Host (PID: 87053)
[Test] Host instance launched successfully on port 8000
========================================
   RUNNING IN TEST MODE
   Config: { "window_position": (100, 100), "window_size": (600, 480), "is_host": true, "port": 8000, "instance_name": "Host" }
========================================
TestModeHandler: Command directories ready
  Commands: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_commands/commands
  Results: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_commands/results
[2025-11-29 14:36:25] [INFO.0000000] DebugLogger initialized - Session: 20251129_143625
[2025-11-29 14:36:25] [INFO.0000000] Log file: user://logs/debug_20251129_143625.log
[2025-11-29 14:36:25] [INFO.0000000] Real path: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251129_143625.log
[MeasuringTapeManager] Save persistence: false
Found armies in res://: ["orks", "adeptus_custodes", "space_marines", "A_C_test", "ORK_test"]
ArmyListManager initialized with 5 armies: ["orks", "adeptus_custodes", "space_marines", "A_C_test", "ORK_test"]
[2025-11-29 14:36:25] [INFO.0000000] DebugManager initialized
GameState: Loading default armies...
GameState: ArmyListManager not available, falling back to placeholder armies
GameState: Initializing placeholder armies for both players
GameState: Initializing placeholder army for player 1
GameState: Initializing placeholder army for player 2
ActionLogger: Started session 20251129_143625
StateSerializer: Pretty print enabled: true
SaveLoadManager: Current res:// directory: res://
SaveLoadManager: Project directory path: /Users/robertocallaghan/Documents/claude/godotv2/40k/
SaveLoadManager: Initialized save directories in project folder
SaveLoadManager: Save files will be stored at: /Users/robertocallaghan/Documents/claude/godotv2/40k/saves/
[PhaseManager] Ready - awaiting explicit phase initialization
[TerrainManager] Initializing terrain system
[TerrainManager] Added walls to terrain pieces
[TerrainManager] Loaded 12 terrain pieces
[EnhancedLineOfSight] Initialized
MissionManager: Initializing mission system
MissionManager: Set up 5 objectives for Strike Force deployment
  - obj_center at position (880.0, 1200.0)
  - obj_tl at position (400.0, 560.0)
  - obj_tr at position (1360.0, 560.0)
  - obj_bl at position (400.0, 1840.0)
  - obj_br at position (1360.0, 1840.0)
MissionManager: Initialized Take and Hold mission
[MeasuringTapeManager] Initialized with save_persistence: false
[LineOfSightManager] Initialized - Hold 'V' to check what can see the cursor position
TransportManager initialized
NetworkManager: Initialized
MainMenu: Initializing main menu
MainMenu: Loaded 5 armies: ["A C Test", "Adeptus Custodes", "ORK Test", "Orks", "Space Marines"]
MainMenu: Dropdowns populated with 5 armies
MainMenu: Multiplayer button visible: true
MainMenu: Signals connected
MainMenu: Save/Load dialog setup complete
MainMenu: Default armies set - Player 1: A C Test, Player 2: ORK Test
MainMenu: Ready with default selections
TestModeHandler: Set window position to (100, 100)
TestModeHandler: Set window size to (600, 480)
TestModeHandler: Scheduling auto-host...
SaveLoadDialog: Checking node references...
  - save_button path: VBoxContainer/SaveSection/SaveInputContainer/SaveButton
  - save_name_input path: VBoxContainer/SaveSection/SaveInputContainer/SaveNameInput
  - saves_list path: VBoxContainer/LoadSection/SavesScrollContainer/SavesList
  - load_button path: VBoxContainer/LoadSection/LoadButtonContainer/LoadButton
SaveLoadDialog: Connected save button
SaveLoadDialog: Connected save input
SaveLoadDialog: Connected saves list
SaveLoadDialog: Connected load button
SaveLoadDialog: Connected delete button
SaveLoadDialog: Connected cancel button
SaveLoadDialog UI signals connected
SaveLoadDialog: Found 29 save files
SaveLoadDialog: Populated list with 29 save files
SaveLoadDialog initialized successfully
[GameInstance] Launching Client instance on port 7778
[GameInstance] Using project path: /Users/robertocallaghan/Documents/claude/godotv2/40k/
TestModeHandler: Current scene: MainMenu
TestModeHandler: Triggering multiplayer mode...
MainMenu: Multiplayer button pressed
MultiplayerLobby: Army selection initialized with 5 armies
MultiplayerLobby: Ready
Godot Engine v4.5.1.stable.official.f62fdbde1 - https://godotengine.org
OpenGL API 4.1 INTEL-18.8.6 - Compatibility - Using Device: Intel Inc. - Intel(R) Iris(TM) Graphics 6100

TestModeHandler: Args -> ["--test-mode", "--position=800,100", "--resolution=600x480", "--auto-join", "--host-ip=127.0.0.1", "--host-port=8000", "--instance-name=Client"]
TestModeHandler: Lobby scene: MultiplayerLobby
TestModeHandler: Creating host on port 8000
MultiplayerLobby: Host button pressed
========================================
   YOU ARE: PLAYER 1 (HOST)
   Hosting on port: 7777
========================================
MultiplayerLobby: Successfully hosting on port 7777
TestModeHandler: Waiting for client to connect...
TestModeHandler: Listening for peer connection...
[LogMonitor] Started monitoring: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251129_143625.log
[GameInstance] Monitoring log file: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251129_143625.log
[GameInstance] Successfully launched Client (PID: 87061)
[Test] Client instance launched successfully
[Test] Waiting for client to connect to host...
[Test] Host performing action: get_game_state with params: {  }
[Test] Writing command file: host_87053_cmd_001.json
[Test] Waiting for result file...
[Test] Polling for result file: host_87053_cmd_001_result.json
TestModeHandler: Processing command file host_87053_cmd_001.json
TestModeHandler: Executing command from file: host_87053_cmd_001.json
TestModeHandler: Executing action: get_game_state
TestModeHandler: Handling get_game_state action
TestModeHandler: get_game_state - Phase: Deployment, Turn: 0, Player: 0
TestModeHandler: Result written to: host_87053_cmd_001_result.json
TestModeHandler: Command executed and result written
[Test] Result file found!
[Test] Action completed: success=true, message=Game state retrieved
[Test] Connection verified - action simulation working!
========================================
   RUNNING IN TEST MODE
   Config: { "window_position": (800, 100), "window_size": (600, 480), "is_host": false, "host_ip": "127.0.0.1", "host_port": 8000, "instance_name": "Client" }
========================================
TestModeHandler: Command directories ready
  Commands: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_commands/commands
  Results: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_commands/results
[2025-11-29 14:36:30] [INFO.0000000] DebugLogger initialized - Session: 20251129_143630
[2025-11-29 14:36:30] [INFO.0000000] Log file: user://logs/debug_20251129_143630.log
[2025-11-29 14:36:30] [INFO.0000000] Real path: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251129_143630.log
[MeasuringTapeManager] Save persistence: false
Found armies in res://: ["orks", "adeptus_custodes", "space_marines", "A_C_test", "ORK_test"]
ArmyListManager initialized with 5 armies: ["orks", "adeptus_custodes", "space_marines", "A_C_test", "ORK_test"]
[2025-11-29 14:36:30] [INFO.0000000] DebugManager initialized
GameState: Loading default armies...
GameState: ArmyListManager not available, falling back to placeholder armies
GameState: Initializing placeholder armies for both players
GameState: Initializing placeholder army for player 1
GameState: Initializing placeholder army for player 2
ActionLogger: Started session 20251129_143630
StateSerializer: Pretty print enabled: true
SaveLoadManager: Current res:// directory: res://
SaveLoadManager: Project directory path: /Users/robertocallaghan/Documents/claude/godotv2/40k/
SaveLoadManager: Initialized save directories in project folder
SaveLoadManager: Save files will be stored at: /Users/robertocallaghan/Documents/claude/godotv2/40k/saves/
[PhaseManager] Ready - awaiting explicit phase initialization
[TerrainManager] Initializing terrain system
[TerrainManager] Added walls to terrain pieces
[TerrainManager] Loaded 12 terrain pieces
[EnhancedLineOfSight] Initialized
MissionManager: Initializing mission system
MissionManager: Set up 5 objectives for Strike Force deployment
  - obj_center at position (880.0, 1200.0)
  - obj_tl at position (400.0, 560.0)
  - obj_tr at position (1360.0, 560.0)
  - obj_bl at position (400.0, 1840.0)
  - obj_br at position (1360.0, 1840.0)
MissionManager: Initialized Take and Hold mission
[MeasuringTapeManager] Initialized with save_persistence: false
[LineOfSightManager] Initialized - Hold 'V' to check what can see the cursor position
TransportManager initialized
NetworkManager: Initialized
MainMenu: Initializing main menu
MainMenu: Loaded 5 armies: ["A C Test", "Adeptus Custodes", "ORK Test", "Orks", "Space Marines"]
MainMenu: Dropdowns populated with 5 armies
MainMenu: Multiplayer button visible: true
MainMenu: Signals connected
MainMenu: Save/Load dialog setup complete
MainMenu: Default armies set - Player 1: A C Test, Player 2: ORK Test
MainMenu: Ready with default selections
TestModeHandler: Set window position to (800, 100)
TestModeHandler: Set window size to (600, 480)
TestModeHandler: Scheduling auto-join...
SaveLoadDialog: Checking node references...
  - save_button path: VBoxContainer/SaveSection/SaveInputContainer/SaveButton
  - save_name_input path: VBoxContainer/SaveSection/SaveInputContainer/SaveNameInput
  - saves_list path: VBoxContainer/LoadSection/SavesScrollContainer/SavesList
  - load_button path: VBoxContainer/LoadSection/LoadButtonContainer/LoadButton
SaveLoadDialog: Connected save button
SaveLoadDialog: Connected save input
SaveLoadDialog: Connected saves list
SaveLoadDialog: Connected load button
SaveLoadDialog: Connected delete button
SaveLoadDialog: Connected cancel button
SaveLoadDialog UI signals connected
SaveLoadDialog: Found 29 save files
SaveLoadDialog: Populated list with 29 save files
SaveLoadDialog initialized successfully
TestModeHandler: Current scene: MainMenu
TestModeHandler: Triggering multiplayer mode...
MainMenu: Multiplayer button pressed
MultiplayerLobby: Army selection initialized with 5 armies
MultiplayerLobby: Ready
[Test] Host performing action: get_available_units with params: {  }
[Test] Writing command file: host_87053_cmd_002.json
[Test] Waiting for result file...
[Test] Polling for result file: host_87053_cmd_002_result.json
TestModeHandler: Processing command file host_87053_cmd_002.json
TestModeHandler: Executing command from file: host_87053_cmd_002.json
TestModeHandler: Executing action: get_available_units
TestModeHandler: Handling get_available_units action
TestModeHandler: Player 1 units: ["U_INTERCESSORS_A", "U_TACTICAL_A"] (undeployed: ["U_INTERCESSORS_A", "U_TACTICAL_A"])
TestModeHandler: Player 2 units: ["U_BOYZ_A", "U_GRETCHIN_A"] (undeployed: ["U_BOYZ_A", "U_GRETCHIN_A"])
TestModeHandler: Result written to: host_87053_cmd_002_result.json
TestModeHandler: Command executed and result written
[Test] Result file found!
[Test] Action completed: success=true, message=Available units retrieved
[TEST] Using Player 2 unit: U_BOYZ_A
[Test] Host performing action: get_game_state with params: {  }
[Test] Writing command file: host_87053_cmd_003.json
[Test] Waiting for result file...
[Test] Polling for result file: host_87053_cmd_003_result.json
TestModeHandler: Processing command file host_87053_cmd_003.json
TestModeHandler: Executing command from file: host_87053_cmd_003.json
TestModeHandler: Executing action: get_game_state
TestModeHandler: Handling get_game_state action
TestModeHandler: get_game_state - Phase: Deployment, Turn: 0, Player: 0
TestModeHandler: Result written to: host_87053_cmd_003_result.json
TestModeHandler: Command executed and result written
[Test] Result file found!
[Test] Action completed: success=true, message=Game state retrieved
[TEST] Current turn: Player 0.0
[Test] Client performing action: deploy_unit with params: { "unit_id": "U_BOYZ_A", "position": { "x": 100.0, "y": 2100.0 } }
[Test] Writing command file: client_87061_cmd_001.json
[Test] Waiting for result file...
[Test] Polling for result file: client_87061_cmd_001_result.json
TestModeHandler: Processing command file client_87061_cmd_001.json
TestModeHandler: Executing command from file: client_87061_cmd_001.json
TestModeHandler: Executing action: deploy_unit
TestModeHandler: Handling deploy_unit action
GameManager: deploy_unit() called - unit_id: U_BOYZ_A, position: (100.0, 2100.0)
GameManager: Total units in GameState: 4
GameManager: Unit IDs: ["U_INTERCESSORS_A", "U_TACTICAL_A", "U_BOYZ_A", "U_GRETCHIN_A"]
GameManager: Switching active player from 1 to 2
GameManager: Applying result with 22 changes/diffs
GameManager: Setting units.U_BOYZ_A.models.0.position = { "x": 100.0, "y": 2100.0 }
GameManager: Setting units.U_BOYZ_A.models.0.rotation = 0.0
GameManager: Setting units.U_BOYZ_A.models.1.position = { "x": 100.0, "y": 2100.0 }
GameManager: Setting units.U_BOYZ_A.models.1.rotation = 0.0
GameManager: Setting units.U_BOYZ_A.models.2.position = { "x": 100.0, "y": 2100.0 }
GameManager: Setting units.U_BOYZ_A.models.2.rotation = 0.0
GameManager: Setting units.U_BOYZ_A.models.3.position = { "x": 100.0, "y": 2100.0 }
GameManager: Setting units.U_BOYZ_A.models.3.rotation = 0.0
GameManager: Setting units.U_BOYZ_A.models.4.position = { "x": 100.0, "y": 2100.0 }
GameManager: Setting units.U_BOYZ_A.models.4.rotation = 0.0
GameManager: Setting units.U_BOYZ_A.models.5.position = { "x": 100.0, "y": 2100.0 }
GameManager: Setting units.U_BOYZ_A.models.5.rotation = 0.0
GameManager: Setting units.U_BOYZ_A.models.6.position = { "x": 100.0, "y": 2100.0 }
GameManager: Setting units.U_BOYZ_A.models.6.rotation = 0.0
GameManager: Setting units.U_BOYZ_A.models.7.position = { "x": 100.0, "y": 2100.0 }
GameManager: Setting units.U_BOYZ_A.models.7.rotation = 0.0
GameManager: Setting units.U_BOYZ_A.models.8.position = { "x": 100.0, "y": 2100.0 }
GameManager: Setting units.U_BOYZ_A.models.8.rotation = 0.0
GameManager: Setting units.U_BOYZ_A.models.9.position = { "x": 100.0, "y": 2100.0 }
GameManager: Setting units.U_BOYZ_A.models.9.rotation = 0.0
GameManager: Setting units.U_BOYZ_A.status = 2
GameManager: Setting meta.active_player = 2
GameManager: deploy_unit() result: success=true
TestModeHandler: Result written to: client_87061_cmd_001_result.json
TestModeHandler: Command executed and result written
[Test] Result file found!
[Test] Action completed: success=true, message=Unit deployed successfully
[TEST] Wrong turn deployment result: success=true message=Unit deployed successfully
ASSERTION FAILED: test_deployment_wrong_turn - Player 2 should not be able to deploy when it's not their turn
[TEST] PASSED: Wrong turn deployment correctly rejected

========================================
Cleaning up Multiplayer Test
========================================

[Test] Host performing action: get_game_state with params: {  }
[Test] Writing command file: host_87053_cmd_004.json
[Test] Waiting for result file...
[Test] Polling for result file: host_87053_cmd_004_result.json
TestModeHandler: Processing command file host_87053_cmd_004.json
TestModeHandler: Executing command from file: host_87053_cmd_004.json
TestModeHandler: Executing action: get_game_state
TestModeHandler: Handling get_game_state action
TestModeHandler: get_game_state - Phase: Deployment, Turn: 0, Player: 0
TestModeHandler: Result written to: host_87053_cmd_004_result.json
TestModeHandler: Command executed and result written
[Test] Result file found!
[Test] Action completed: success=true, message=Game state retrieved
[Test Artifacts] Report saved: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_artifacts/reports/unknown_test_2025-11-29T14-36-33.json
[GameInstance] Terminating instance: Host
[LogMonitor] Stopped monitoring: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251129_143611.log
[GameInstance] Terminating instance: Client
[LogMonitor] Stopped monitoring: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251129_143625.log

========================================
Starting Multiplayer Integration Test
========================================

  Running: test_deployment_blocked_by_terrain

[TEST] test_deployment_blocked_by_terrain
[Test] Launching host and client instances...
[GameInstance] Launching Host instance on port 8000
[GameInstance] Using project path: /Users/robertocallaghan/Documents/claude/godotv2/40k/
Godot Engine v4.5.1.stable.official.f62fdbde1 - https://godotengine.org
OpenGL API 4.1 INTEL-18.8.6 - Compatibility - Using Device: Intel Inc. - Intel(R) Iris(TM) Graphics 6100

TestModeHandler: Args -> ["--test-mode", "--position=100,100", "--resolution=600x480", "--auto-host", "--port=8000", "--instance-name=Host"]
[LogMonitor] Started monitoring: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251129_143630.log
[GameInstance] Monitoring log file: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251129_143630.log
[GameInstance] Successfully launched Host (PID: 87066)
[Test] Host instance launched successfully on port 8000
========================================
   RUNNING IN TEST MODE
   Config: { "window_position": (100, 100), "window_size": (600, 480), "is_host": true, "port": 8000, "instance_name": "Host" }
========================================
TestModeHandler: Command directories ready
  Commands: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_commands/commands
  Results: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_commands/results
[2025-11-29 14:36:37] [INFO.0000000] DebugLogger initialized - Session: 20251129_143637
[2025-11-29 14:36:37] [INFO.0000000] Log file: user://logs/debug_20251129_143637.log
[2025-11-29 14:36:37] [INFO.0000000] Real path: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251129_143637.log
[MeasuringTapeManager] Save persistence: false
Found armies in res://: ["orks", "adeptus_custodes", "space_marines", "A_C_test", "ORK_test"]
ArmyListManager initialized with 5 armies: ["orks", "adeptus_custodes", "space_marines", "A_C_test", "ORK_test"]
[2025-11-29 14:36:37] [INFO.0000000] DebugManager initialized
GameState: Loading default armies...
GameState: ArmyListManager not available, falling back to placeholder armies
GameState: Initializing placeholder armies for both players
GameState: Initializing placeholder army for player 1
GameState: Initializing placeholder army for player 2
ActionLogger: Started session 20251129_143637
StateSerializer: Pretty print enabled: true
SaveLoadManager: Current res:// directory: res://
SaveLoadManager: Project directory path: /Users/robertocallaghan/Documents/claude/godotv2/40k/
SaveLoadManager: Initialized save directories in project folder
SaveLoadManager: Save files will be stored at: /Users/robertocallaghan/Documents/claude/godotv2/40k/saves/
[PhaseManager] Ready - awaiting explicit phase initialization
[TerrainManager] Initializing terrain system
[TerrainManager] Added walls to terrain pieces
[TerrainManager] Loaded 12 terrain pieces
[EnhancedLineOfSight] Initialized
MissionManager: Initializing mission system
MissionManager: Set up 5 objectives for Strike Force deployment
  - obj_center at position (880.0, 1200.0)
  - obj_tl at position (400.0, 560.0)
  - obj_tr at position (1360.0, 560.0)
  - obj_bl at position (400.0, 1840.0)
  - obj_br at position (1360.0, 1840.0)
MissionManager: Initialized Take and Hold mission
[MeasuringTapeManager] Initialized with save_persistence: false
[LineOfSightManager] Initialized - Hold 'V' to check what can see the cursor position
TransportManager initialized
NetworkManager: Initialized
MainMenu: Initializing main menu
MainMenu: Loaded 5 armies: ["A C Test", "Adeptus Custodes", "ORK Test", "Orks", "Space Marines"]
MainMenu: Dropdowns populated with 5 armies
MainMenu: Multiplayer button visible: true
MainMenu: Signals connected
MainMenu: Save/Load dialog setup complete
MainMenu: Default armies set - Player 1: A C Test, Player 2: ORK Test
MainMenu: Ready with default selections
TestModeHandler: Set window position to (100, 100)
TestModeHandler: Set window size to (600, 480)
TestModeHandler: Scheduling auto-host...
SaveLoadDialog: Checking node references...
  - save_button path: VBoxContainer/SaveSection/SaveInputContainer/SaveButton
  - save_name_input path: VBoxContainer/SaveSection/SaveInputContainer/SaveNameInput
  - saves_list path: VBoxContainer/LoadSection/SavesScrollContainer/SavesList
  - load_button path: VBoxContainer/LoadSection/LoadButtonContainer/LoadButton
SaveLoadDialog: Connected save button
SaveLoadDialog: Connected save input
SaveLoadDialog: Connected saves list
SaveLoadDialog: Connected load button
SaveLoadDialog: Connected delete button
SaveLoadDialog: Connected cancel button
SaveLoadDialog UI signals connected
SaveLoadDialog: Found 29 save files
SaveLoadDialog: Populated list with 29 save files
SaveLoadDialog initialized successfully
[GameInstance] Launching Client instance on port 7778
[GameInstance] Using project path: /Users/robertocallaghan/Documents/claude/godotv2/40k/
TestModeHandler: Current scene: MainMenu
TestModeHandler: Triggering multiplayer mode...
MainMenu: Multiplayer button pressed
MultiplayerLobby: Army selection initialized with 5 armies
MultiplayerLobby: Ready
Godot Engine v4.5.1.stable.official.f62fdbde1 - https://godotengine.org
OpenGL API 4.1 INTEL-18.8.6 - Compatibility - Using Device: Intel Inc. - Intel(R) Iris(TM) Graphics 6100

TestModeHandler: Args -> ["--test-mode", "--position=800,100", "--resolution=600x480", "--auto-join", "--host-ip=127.0.0.1", "--host-port=8000", "--instance-name=Client"]
TestModeHandler: Lobby scene: MultiplayerLobby
TestModeHandler: Creating host on port 8000
MultiplayerLobby: Host button pressed
========================================
   YOU ARE: PLAYER 1 (HOST)
   Hosting on port: 7777
========================================
MultiplayerLobby: Successfully hosting on port 7777
TestModeHandler: Waiting for client to connect...
TestModeHandler: Listening for peer connection...
[LogMonitor] Started monitoring: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251129_143637.log
[GameInstance] Monitoring log file: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251129_143637.log
[GameInstance] Successfully launched Client (PID: 87078)
[Test] Client instance launched successfully
[Test] Waiting for client to connect to host...
[Test] Host performing action: get_game_state with params: {  }
[Test] Writing command file: host_87066_cmd_001.json
[Test] Waiting for result file...
[Test] Polling for result file: host_87066_cmd_001_result.json
TestModeHandler: Processing command file host_87066_cmd_001.json
TestModeHandler: Executing command from file: host_87066_cmd_001.json
TestModeHandler: Executing action: get_game_state
TestModeHandler: Handling get_game_state action
TestModeHandler: get_game_state - Phase: Deployment, Turn: 0, Player: 0
TestModeHandler: Result written to: host_87066_cmd_001_result.json
TestModeHandler: Command executed and result written
[Test] Result file found!
[Test] Action completed: success=true, message=Game state retrieved
[Test] Connection verified - action simulation working!
========================================
   RUNNING IN TEST MODE
   Config: { "window_position": (800, 100), "window_size": (600, 480), "is_host": false, "host_ip": "127.0.0.1", "host_port": 8000, "instance_name": "Client" }
========================================
TestModeHandler: Command directories ready
  Commands: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_commands/commands
  Results: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_commands/results
[2025-11-29 14:36:43] [INFO.0000000] DebugLogger initialized - Session: 20251129_143643
[2025-11-29 14:36:43] [INFO.0000000] Log file: user://logs/debug_20251129_143643.log
[2025-11-29 14:36:43] [INFO.0000000] Real path: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251129_143643.log
[MeasuringTapeManager] Save persistence: false
Found armies in res://: ["orks", "adeptus_custodes", "space_marines", "A_C_test", "ORK_test"]
ArmyListManager initialized with 5 armies: ["orks", "adeptus_custodes", "space_marines", "A_C_test", "ORK_test"]
[2025-11-29 14:36:43] [INFO.0000000] DebugManager initialized
GameState: Loading default armies...
GameState: ArmyListManager not available, falling back to placeholder armies
GameState: Initializing placeholder armies for both players
GameState: Initializing placeholder army for player 1
GameState: Initializing placeholder army for player 2
ActionLogger: Started session 20251129_143643
StateSerializer: Pretty print enabled: true
SaveLoadManager: Current res:// directory: res://
SaveLoadManager: Project directory path: /Users/robertocallaghan/Documents/claude/godotv2/40k/
SaveLoadManager: Initialized save directories in project folder
SaveLoadManager: Save files will be stored at: /Users/robertocallaghan/Documents/claude/godotv2/40k/saves/
[PhaseManager] Ready - awaiting explicit phase initialization
[TerrainManager] Initializing terrain system
[TerrainManager] Added walls to terrain pieces
[TerrainManager] Loaded 12 terrain pieces
[EnhancedLineOfSight] Initialized
MissionManager: Initializing mission system
MissionManager: Set up 5 objectives for Strike Force deployment
  - obj_center at position (880.0, 1200.0)
  - obj_tl at position (400.0, 560.0)
  - obj_tr at position (1360.0, 560.0)
  - obj_bl at position (400.0, 1840.0)
  - obj_br at position (1360.0, 1840.0)
MissionManager: Initialized Take and Hold mission
[MeasuringTapeManager] Initialized with save_persistence: false
[LineOfSightManager] Initialized - Hold 'V' to check what can see the cursor position
TransportManager initialized
NetworkManager: Initialized
MainMenu: Initializing main menu
MainMenu: Loaded 5 armies: ["A C Test", "Adeptus Custodes", "ORK Test", "Orks", "Space Marines"]
MainMenu: Dropdowns populated with 5 armies
MainMenu: Multiplayer button visible: true
MainMenu: Signals connected
MainMenu: Save/Load dialog setup complete
MainMenu: Default armies set - Player 1: A C Test, Player 2: ORK Test
MainMenu: Ready with default selections
TestModeHandler: Set window position to (800, 100)
TestModeHandler: Set window size to (600, 480)
TestModeHandler: Scheduling auto-join...
SaveLoadDialog: Checking node references...
  - save_button path: VBoxContainer/SaveSection/SaveInputContainer/SaveButton
  - save_name_input path: VBoxContainer/SaveSection/SaveInputContainer/SaveNameInput
  - saves_list path: VBoxContainer/LoadSection/SavesScrollContainer/SavesList
  - load_button path: VBoxContainer/LoadSection/LoadButtonContainer/LoadButton
SaveLoadDialog: Connected save button
SaveLoadDialog: Connected save input
SaveLoadDialog: Connected saves list
SaveLoadDialog: Connected load button
SaveLoadDialog: Connected delete button
SaveLoadDialog: Connected cancel button
SaveLoadDialog UI signals connected
SaveLoadDialog: Found 29 save files
SaveLoadDialog: Populated list with 29 save files
SaveLoadDialog initialized successfully
TestModeHandler: Current scene: MainMenu
TestModeHandler: Triggering multiplayer mode...
MainMenu: Multiplayer button pressed
MultiplayerLobby: Army selection initialized with 5 armies
MultiplayerLobby: Ready
[Test] Host performing action: get_available_units with params: {  }
[Test] Writing command file: host_87066_cmd_002.json
[Test] Waiting for result file...
[Test] Polling for result file: host_87066_cmd_002_result.json
TestModeHandler: Processing command file host_87066_cmd_002.json
TestModeHandler: Executing command from file: host_87066_cmd_002.json
TestModeHandler: Executing action: get_available_units
TestModeHandler: Handling get_available_units action
TestModeHandler: Player 1 units: ["U_INTERCESSORS_A", "U_TACTICAL_A"] (undeployed: ["U_INTERCESSORS_A", "U_TACTICAL_A"])
TestModeHandler: Player 2 units: ["U_BOYZ_A", "U_GRETCHIN_A"] (undeployed: ["U_BOYZ_A", "U_GRETCHIN_A"])
TestModeHandler: Result written to: host_87066_cmd_002_result.json
TestModeHandler: Command executed and result written
[Test] Result file found!
[Test] Action completed: success=true, message=Available units retrieved
[TEST] Using unit: U_INTERCESSORS_A
[Test] Host performing action: deploy_unit with params: { "unit_id": "U_INTERCESSORS_A", "position": { "x": 320.0, "y": 240.0 } }
[Test] Writing command file: host_87066_cmd_003.json
[Test] Waiting for result file...
[Test] Polling for result file: host_87066_cmd_003_result.json
TestModeHandler: Processing command file host_87066_cmd_003.json
TestModeHandler: Executing command from file: host_87066_cmd_003.json
TestModeHandler: Executing action: deploy_unit
TestModeHandler: Handling deploy_unit action
GameManager: deploy_unit() called - unit_id: U_INTERCESSORS_A, position: (320.0, 240.0)
GameManager: Total units in GameState: 4
GameManager: Unit IDs: ["U_INTERCESSORS_A", "U_TACTICAL_A", "U_BOYZ_A", "U_GRETCHIN_A"]
GameManager: Switching active player from 1 to 2
GameManager: Applying result with 12 changes/diffs
GameManager: Setting units.U_INTERCESSORS_A.models.0.position = { "x": 320.0, "y": 240.0 }
GameManager: Setting units.U_INTERCESSORS_A.models.0.rotation = 0.0
GameManager: Setting units.U_INTERCESSORS_A.models.1.position = { "x": 320.0, "y": 240.0 }
GameManager: Setting units.U_INTERCESSORS_A.models.1.rotation = 0.0
GameManager: Setting units.U_INTERCESSORS_A.models.2.position = { "x": 320.0, "y": 240.0 }
GameManager: Setting units.U_INTERCESSORS_A.models.2.rotation = 0.0
GameManager: Setting units.U_INTERCESSORS_A.models.3.position = { "x": 320.0, "y": 240.0 }
GameManager: Setting units.U_INTERCESSORS_A.models.3.rotation = 0.0
GameManager: Setting units.U_INTERCESSORS_A.models.4.position = { "x": 320.0, "y": 240.0 }
GameManager: Setting units.U_INTERCESSORS_A.models.4.rotation = 0.0
GameManager: Setting units.U_INTERCESSORS_A.status = 2
GameManager: Setting meta.active_player = 2
GameManager: deploy_unit() result: success=true
TestModeHandler: Result written to: host_87066_cmd_003_result.json
TestModeHandler: Command executed and result written
[Test] Result file found!
[Test] Action completed: success=true, message=Unit deployed successfully
[TEST] Terrain blocking result: success=true message=Unit deployed successfully
ASSERTION FAILED: test_deployment_blocked_by_terrain - Deployment should be blocked by terrain: Unit deployed successfully

========================================
Cleaning up Multiplayer Test
========================================

[Test] Host performing action: get_game_state with params: {  }
[Test] Writing command file: host_87066_cmd_004.json
[Test] Waiting for result file...
[Test] Polling for result file: host_87066_cmd_004_result.json
TestModeHandler: Processing command file host_87066_cmd_004.json
TestModeHandler: Executing command from file: host_87066_cmd_004.json
TestModeHandler: Executing action: get_game_state
TestModeHandler: Handling get_game_state action
TestModeHandler: get_game_state - Phase: Deployment, Turn: 0, Player: 0
TestModeHandler: Result written to: host_87066_cmd_004_result.json
TestModeHandler: Command executed and result written
[Test] Result file found!
[Test] Action completed: success=true, message=Game state retrieved
[Test Artifacts] Report saved: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_artifacts/reports/unknown_test_2025-11-29T14-36-46.json
[GameInstance] Terminating instance: Host
[LogMonitor] Stopped monitoring: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251129_143630.log
[GameInstance] Terminating instance: Client
[LogMonitor] Stopped monitoring: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251129_143637.log

========================================
Starting Multiplayer Integration Test
========================================

  Running: test_deployment_unit_coherency

[TEST] test_deployment_unit_coherency
[Test] Launching host and client instances...
[GameInstance] Launching Host instance on port 8000
[GameInstance] Using project path: /Users/robertocallaghan/Documents/claude/godotv2/40k/
Godot Engine v4.5.1.stable.official.f62fdbde1 - https://godotengine.org
OpenGL API 4.1 INTEL-18.8.6 - Compatibility - Using Device: Intel Inc. - Intel(R) Iris(TM) Graphics 6100

TestModeHandler: Args -> ["--test-mode", "--position=100,100", "--resolution=600x480", "--auto-host", "--port=8000", "--instance-name=Host"]
[LogMonitor] Started monitoring: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251129_143643.log
[GameInstance] Monitoring log file: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251129_143643.log
[GameInstance] Successfully launched Host (PID: 87080)
[Test] Host instance launched successfully on port 8000
========================================
   RUNNING IN TEST MODE
   Config: { "window_position": (100, 100), "window_size": (600, 480), "is_host": true, "port": 8000, "instance_name": "Host" }
========================================
TestModeHandler: Command directories ready
  Commands: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_commands/commands
  Results: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_commands/results
[2025-11-29 14:36:50] [INFO.0000000] DebugLogger initialized - Session: 20251129_143650
[2025-11-29 14:36:50] [INFO.0000000] Log file: user://logs/debug_20251129_143650.log
[2025-11-29 14:36:50] [INFO.0000000] Real path: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251129_143650.log
[MeasuringTapeManager] Save persistence: false
Found armies in res://: ["orks", "adeptus_custodes", "space_marines", "A_C_test", "ORK_test"]
ArmyListManager initialized with 5 armies: ["orks", "adeptus_custodes", "space_marines", "A_C_test", "ORK_test"]
[2025-11-29 14:36:50] [INFO.0000000] DebugManager initialized
GameState: Loading default armies...
GameState: ArmyListManager not available, falling back to placeholder armies
GameState: Initializing placeholder armies for both players
GameState: Initializing placeholder army for player 1
GameState: Initializing placeholder army for player 2
ActionLogger: Started session 20251129_143650
StateSerializer: Pretty print enabled: true
SaveLoadManager: Current res:// directory: res://
SaveLoadManager: Project directory path: /Users/robertocallaghan/Documents/claude/godotv2/40k/
SaveLoadManager: Initialized save directories in project folder
SaveLoadManager: Save files will be stored at: /Users/robertocallaghan/Documents/claude/godotv2/40k/saves/
[PhaseManager] Ready - awaiting explicit phase initialization
[TerrainManager] Initializing terrain system
[TerrainManager] Added walls to terrain pieces
[TerrainManager] Loaded 12 terrain pieces
[EnhancedLineOfSight] Initialized
MissionManager: Initializing mission system
MissionManager: Set up 5 objectives for Strike Force deployment
  - obj_center at position (880.0, 1200.0)
  - obj_tl at position (400.0, 560.0)
  - obj_tr at position (1360.0, 560.0)
  - obj_bl at position (400.0, 1840.0)
  - obj_br at position (1360.0, 1840.0)
MissionManager: Initialized Take and Hold mission
[MeasuringTapeManager] Initialized with save_persistence: false
[LineOfSightManager] Initialized - Hold 'V' to check what can see the cursor position
TransportManager initialized
NetworkManager: Initialized
MainMenu: Initializing main menu
MainMenu: Loaded 5 armies: ["A C Test", "Adeptus Custodes", "ORK Test", "Orks", "Space Marines"]
MainMenu: Dropdowns populated with 5 armies
MainMenu: Multiplayer button visible: true
MainMenu: Signals connected
MainMenu: Save/Load dialog setup complete
MainMenu: Default armies set - Player 1: A C Test, Player 2: ORK Test
MainMenu: Ready with default selections
TestModeHandler: Set window position to (100, 100)
TestModeHandler: Set window size to (600, 480)
TestModeHandler: Scheduling auto-host...
SaveLoadDialog: Checking node references...
  - save_button path: VBoxContainer/SaveSection/SaveInputContainer/SaveButton
  - save_name_input path: VBoxContainer/SaveSection/SaveInputContainer/SaveNameInput
  - saves_list path: VBoxContainer/LoadSection/SavesScrollContainer/SavesList
  - load_button path: VBoxContainer/LoadSection/LoadButtonContainer/LoadButton
SaveLoadDialog: Connected save button
SaveLoadDialog: Connected save input
SaveLoadDialog: Connected saves list
SaveLoadDialog: Connected load button
SaveLoadDialog: Connected delete button
SaveLoadDialog: Connected cancel button
SaveLoadDialog UI signals connected
SaveLoadDialog: Found 29 save files
SaveLoadDialog: Populated list with 29 save files
SaveLoadDialog initialized successfully
[GameInstance] Launching Client instance on port 7778
[GameInstance] Using project path: /Users/robertocallaghan/Documents/claude/godotv2/40k/
TestModeHandler: Current scene: MainMenu
TestModeHandler: Triggering multiplayer mode...
MainMenu: Multiplayer button pressed
MultiplayerLobby: Army selection initialized with 5 armies
MultiplayerLobby: Ready
Godot Engine v4.5.1.stable.official.f62fdbde1 - https://godotengine.org
OpenGL API 4.1 INTEL-18.8.6 - Compatibility - Using Device: Intel Inc. - Intel(R) Iris(TM) Graphics 6100

TestModeHandler: Lobby scene: MultiplayerLobby
TestModeHandler: Creating host on port 8000
MultiplayerLobby: Host button pressed
========================================
   YOU ARE: PLAYER 1 (HOST)
   Hosting on port: 7777
========================================
MultiplayerLobby: Successfully hosting on port 7777
TestModeHandler: Waiting for client to connect...
TestModeHandler: Listening for peer connection...
TestModeHandler: Args -> ["--test-mode", "--position=800,100", "--resolution=600x480", "--auto-join", "--host-ip=127.0.0.1", "--host-port=8000", "--instance-name=Client"]
[LogMonitor] Started monitoring: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251129_143650.log
[GameInstance] Monitoring log file: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251129_143650.log
[GameInstance] Successfully launched Client (PID: 87092)
[Test] Client instance launched successfully
[Test] Waiting for client to connect to host...
[Test] Host performing action: get_game_state with params: {  }
[Test] Writing command file: host_87080_cmd_001.json
[Test] Waiting for result file...
[Test] Polling for result file: host_87080_cmd_001_result.json
TestModeHandler: Processing command file host_87080_cmd_001.json
TestModeHandler: Executing command from file: host_87080_cmd_001.json
TestModeHandler: Executing action: get_game_state
TestModeHandler: Handling get_game_state action
TestModeHandler: get_game_state - Phase: Deployment, Turn: 0, Player: 0
TestModeHandler: Result written to: host_87080_cmd_001_result.json
TestModeHandler: Command executed and result written
========================================
   RUNNING IN TEST MODE
   Config: { "window_position": (800, 100), "window_size": (600, 480), "is_host": false, "host_ip": "127.0.0.1", "host_port": 8000, "instance_name": "Client" }
========================================
TestModeHandler: Command directories ready
  Commands: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_commands/commands
  Results: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_commands/results
[2025-11-29 14:36:55] [INFO.0000000] DebugLogger initialized - Session: 20251129_143655
[2025-11-29 14:36:55] [INFO.0000000] Log file: user://logs/debug_20251129_143655.log
[2025-11-29 14:36:55] [INFO.0000000] Real path: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251129_143655.log
[MeasuringTapeManager] Save persistence: false
Found armies in res://: ["orks", "adeptus_custodes", "space_marines", "A_C_test", "ORK_test"]
ArmyListManager initialized with 5 armies: ["orks", "adeptus_custodes", "space_marines", "A_C_test", "ORK_test"]
[2025-11-29 14:36:55] [INFO.0000000] DebugManager initialized
GameState: Loading default armies...
GameState: ArmyListManager not available, falling back to placeholder armies
GameState: Initializing placeholder armies for both players
GameState: Initializing placeholder army for player 1
GameState: Initializing placeholder army for player 2
ActionLogger: Started session 20251129_143655
StateSerializer: Pretty print enabled: true
SaveLoadManager: Current res:// directory: res://
SaveLoadManager: Project directory path: /Users/robertocallaghan/Documents/claude/godotv2/40k/
SaveLoadManager: Initialized save directories in project folder
SaveLoadManager: Save files will be stored at: /Users/robertocallaghan/Documents/claude/godotv2/40k/saves/
[PhaseManager] Ready - awaiting explicit phase initialization
[TerrainManager] Initializing terrain system
[TerrainManager] Added walls to terrain pieces
[TerrainManager] Loaded 12 terrain pieces
[EnhancedLineOfSight] Initialized
MissionManager: Initializing mission system
MissionManager: Set up 5 objectives for Strike Force deployment
  - obj_center at position (880.0, 1200.0)
  - obj_tl at position (400.0, 560.0)
  - obj_tr at position (1360.0, 560.0)
  - obj_bl at position (400.0, 1840.0)
  - obj_br at position (1360.0, 1840.0)
MissionManager: Initialized Take and Hold mission
[MeasuringTapeManager] Initialized with save_persistence: false
[LineOfSightManager] Initialized - Hold 'V' to check what can see the cursor position
TransportManager initialized
NetworkManager: Initialized
MainMenu: Initializing main menu
MainMenu: Loaded 5 armies: ["A C Test", "Adeptus Custodes", "ORK Test", "Orks", "Space Marines"]
MainMenu: Dropdowns populated with 5 armies
MainMenu: Multiplayer button visible: true
MainMenu: Signals connected
[Test] Result file found!
[Test] Action completed: success=true, message=Game state retrieved
[Test] Connection verified - action simulation working!
MainMenu: Save/Load dialog setup complete
MainMenu: Default armies set - Player 1: A C Test, Player 2: ORK Test
MainMenu: Ready with default selections
TestModeHandler: Set window position to (800, 100)
TestModeHandler: Set window size to (600, 480)
TestModeHandler: Scheduling auto-join...
SaveLoadDialog: Checking node references...
  - save_button path: VBoxContainer/SaveSection/SaveInputContainer/SaveButton
  - save_name_input path: VBoxContainer/SaveSection/SaveInputContainer/SaveNameInput
  - saves_list path: VBoxContainer/LoadSection/SavesScrollContainer/SavesList
  - load_button path: VBoxContainer/LoadSection/LoadButtonContainer/LoadButton
SaveLoadDialog: Connected save button
SaveLoadDialog: Connected save input
SaveLoadDialog: Connected saves list
SaveLoadDialog: Connected load button
SaveLoadDialog: Connected delete button
SaveLoadDialog: Connected cancel button
SaveLoadDialog UI signals connected
SaveLoadDialog: Found 29 save files
SaveLoadDialog: Populated list with 29 save files
SaveLoadDialog initialized successfully
TestModeHandler: Current scene: MainMenu
TestModeHandler: Triggering multiplayer mode...
MainMenu: Multiplayer button pressed
MultiplayerLobby: Army selection initialized with 5 armies
MultiplayerLobby: Ready
[Test] Host performing action: get_available_units with params: {  }
[Test] Writing command file: host_87080_cmd_002.json
[Test] Waiting for result file...
[Test] Polling for result file: host_87080_cmd_002_result.json
TestModeHandler: Processing command file host_87080_cmd_002.json
TestModeHandler: Executing command from file: host_87080_cmd_002.json
TestModeHandler: Executing action: get_available_units
TestModeHandler: Handling get_available_units action
TestModeHandler: Player 1 units: ["U_INTERCESSORS_A", "U_TACTICAL_A"] (undeployed: ["U_INTERCESSORS_A", "U_TACTICAL_A"])
TestModeHandler: Player 2 units: ["U_BOYZ_A", "U_GRETCHIN_A"] (undeployed: ["U_BOYZ_A", "U_GRETCHIN_A"])
TestModeHandler: Result written to: host_87080_cmd_002_result.json
TestModeHandler: Command executed and result written
[Test] Result file found!
[Test] Action completed: success=true, message=Available units retrieved
[TEST] Using unit: U_INTERCESSORS_A
[Test] Host performing action: deploy_unit with params: { "unit_id": "U_INTERCESSORS_A", "position": { "x": 200.0, "y": 200.0 } }
[Test] Writing command file: host_87080_cmd_003.json
[Test] Waiting for result file...
[Test] Polling for result file: host_87080_cmd_003_result.json
TestModeHandler: Processing command file host_87080_cmd_003.json
TestModeHandler: Executing command from file: host_87080_cmd_003.json
TestModeHandler: Executing action: deploy_unit
TestModeHandler: Handling deploy_unit action
GameManager: deploy_unit() called - unit_id: U_INTERCESSORS_A, position: (200.0, 200.0)
GameManager: Total units in GameState: 4
GameManager: Unit IDs: ["U_INTERCESSORS_A", "U_TACTICAL_A", "U_BOYZ_A", "U_GRETCHIN_A"]
GameManager: Switching active player from 1 to 2
GameManager: Applying result with 12 changes/diffs
GameManager: Setting units.U_INTERCESSORS_A.models.0.position = { "x": 200.0, "y": 200.0 }
GameManager: Setting units.U_INTERCESSORS_A.models.0.rotation = 0.0
GameManager: Setting units.U_INTERCESSORS_A.models.1.position = { "x": 200.0, "y": 200.0 }
GameManager: Setting units.U_INTERCESSORS_A.models.1.rotation = 0.0
GameManager: Setting units.U_INTERCESSORS_A.models.2.position = { "x": 200.0, "y": 200.0 }
GameManager: Setting units.U_INTERCESSORS_A.models.2.rotation = 0.0
GameManager: Setting units.U_INTERCESSORS_A.models.3.position = { "x": 200.0, "y": 200.0 }
GameManager: Setting units.U_INTERCESSORS_A.models.3.rotation = 0.0
GameManager: Setting units.U_INTERCESSORS_A.models.4.position = { "x": 200.0, "y": 200.0 }
GameManager: Setting units.U_INTERCESSORS_A.models.4.rotation = 0.0
GameManager: Setting units.U_INTERCESSORS_A.status = 2
GameManager: Setting meta.active_player = 2
GameManager: deploy_unit() result: success=true
TestModeHandler: Result written to: host_87080_cmd_003_result.json
TestModeHandler: Command executed and result written
[Test] Result file found!
[Test] Action completed: success=true, message=Unit deployed successfully
[TEST] Multi-model deployment result: success=true message=Unit deployed successfully
TestModeHandler: Lobby scene: MultiplayerLobby
TestModeHandler: Joining host at 127.0.0.1
MultiplayerLobby: Join button pressed
NetworkManager: Connecting to 127.0.0.1:7777
MultiplayerLobby: Attempting to join 127.0.0.1:7777
NetworkManager: Peer connected - 1
NetworkManager: Successfully connected to host
NetworkManager: Client set peer_to_player_map[450403943] = 2
========================================
   YOU ARE: PLAYER 2 (CLIENT)
   Connected to host
========================================
MultiplayerLobby: Peer connected - 1
MultiplayerLobby: Game started signal received
NetworkManager: Peer connected - 450403943
[GameState] MeasuringTapeManager not available
MultiplayerLobby: Peer connected - 450403943
TestModeHandler: Client connected!
MultiplayerLobby: Game started signal received
NetworkManager: Receiving initial state from host
[GameState] No measuring_tape data in save
NetworkManager: State synchronized
MultiplayerLobby: Game started signal received
MultiplayerLobby: Syncing army selection - Player 1 -> A_C_test
MultiplayerLobby: Syncing army selection - Player 2 -> ORK_test
[Test] Host performing action: get_game_state with params: {  }
[Test] Writing command file: host_87080_cmd_004.json
[Test] Waiting for result file...
[Test] Polling for result file: host_87080_cmd_004_result.json
TestModeHandler: Processing command file host_87080_cmd_004.json
TestModeHandler: Executing command from file: host_87080_cmd_004.json
TestModeHandler: Executing action: get_game_state
TestModeHandler: Handling get_game_state action
TestModeHandler: get_game_state - Phase: Deployment, Turn: 0, Player: 0
TestModeHandler: Result written to: host_87080_cmd_004_result.json
TestModeHandler: Command executed and result written
[Test] Result file found!
[Test] Action completed: success=true, message=Game state retrieved
[TEST] Unit U_INTERCESSORS_A has 5 models, all positioned correctly
[TEST] Unit coherency test completed with assertions

========================================
Cleaning up Multiplayer Test
========================================

[Test] Host performing action: get_game_state with params: {  }
[Test] Writing command file: host_87080_cmd_005.json
[Test] Waiting for result file...
[Test] Polling for result file: host_87080_cmd_005_result.json
TestModeHandler: Processing command file host_87080_cmd_005.json
TestModeHandler: Executing command from file: host_87080_cmd_005.json
TestModeHandler: Executing action: get_game_state
TestModeHandler: Handling get_game_state action
TestModeHandler: get_game_state - Phase: Deployment, Turn: 0, Player: 0
TestModeHandler: Result written to: host_87080_cmd_005_result.json
TestModeHandler: Command executed and result written
[Test] Result file found!
[Test] Action completed: success=true, message=Game state retrieved
[Test Artifacts] Report saved: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_artifacts/reports/unknown_test_2025-11-29T14-36-59.json
[GameInstance] Terminating instance: Host
[LogMonitor] Stopped monitoring: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251129_143643.log
[GameInstance] Terminating instance: Client
[LogMonitor] Stopped monitoring: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251129_143650.log

========================================
Starting Multiplayer Integration Test
========================================

  Running: test_deployment_completion_both_players

[TEST] test_deployment_completion_both_players
[Test] Launching host and client instances...
[GameInstance] Launching Host instance on port 8000
[GameInstance] Using project path: /Users/robertocallaghan/Documents/claude/godotv2/40k/
Godot Engine v4.5.1.stable.official.f62fdbde1 - https://godotengine.org
OpenGL API 4.1 INTEL-18.8.6 - Compatibility - Using Device: Intel Inc. - Intel(R) Iris(TM) Graphics 6100

TestModeHandler: Args -> ["--test-mode", "--position=100,100", "--resolution=600x480", "--auto-host", "--port=8000", "--instance-name=Host"]
[LogMonitor] Started monitoring: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251129_143650.log
[GameInstance] Monitoring log file: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251129_143650.log
[GameInstance] Successfully launched Host (PID: 87099)
[Test] Host instance launched successfully on port 8000
========================================
   RUNNING IN TEST MODE
   Config: { "window_position": (100, 100), "window_size": (600, 480), "is_host": true, "port": 8000, "instance_name": "Host" }
========================================
TestModeHandler: Command directories ready
  Commands: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_commands/commands
  Results: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_commands/results
[2025-11-29 14:37:03] [INFO.0000000] DebugLogger initialized - Session: 20251129_143703
[2025-11-29 14:37:03] [INFO.0000000] Log file: user://logs/debug_20251129_143703.log
[2025-11-29 14:37:03] [INFO.0000000] Real path: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251129_143703.log
[MeasuringTapeManager] Save persistence: false
Found armies in res://: ["orks", "adeptus_custodes", "space_marines", "A_C_test", "ORK_test"]
ArmyListManager initialized with 5 armies: ["orks", "adeptus_custodes", "space_marines", "A_C_test", "ORK_test"]
[2025-11-29 14:37:03] [INFO.0000000] DebugManager initialized
GameState: Loading default armies...
GameState: ArmyListManager not available, falling back to placeholder armies
GameState: Initializing placeholder armies for both players
GameState: Initializing placeholder army for player 1
GameState: Initializing placeholder army for player 2
ActionLogger: Started session 20251129_143703
StateSerializer: Pretty print enabled: true
SaveLoadManager: Current res:// directory: res://
SaveLoadManager: Project directory path: /Users/robertocallaghan/Documents/claude/godotv2/40k/
SaveLoadManager: Initialized save directories in project folder
SaveLoadManager: Save files will be stored at: /Users/robertocallaghan/Documents/claude/godotv2/40k/saves/
[PhaseManager] Ready - awaiting explicit phase initialization
[TerrainManager] Initializing terrain system
[TerrainManager] Added walls to terrain pieces
[TerrainManager] Loaded 12 terrain pieces
[EnhancedLineOfSight] Initialized
MissionManager: Initializing mission system
MissionManager: Set up 5 objectives for Strike Force deployment
  - obj_center at position (880.0, 1200.0)
  - obj_tl at position (400.0, 560.0)
  - obj_tr at position (1360.0, 560.0)
  - obj_bl at position (400.0, 1840.0)
  - obj_br at position (1360.0, 1840.0)
MissionManager: Initialized Take and Hold mission
[MeasuringTapeManager] Initialized with save_persistence: false
[LineOfSightManager] Initialized - Hold 'V' to check what can see the cursor position
TransportManager initialized
NetworkManager: Initialized
MainMenu: Initializing main menu
MainMenu: Loaded 5 armies: ["A C Test", "Adeptus Custodes", "ORK Test", "Orks", "Space Marines"]
MainMenu: Dropdowns populated with 5 armies
MainMenu: Multiplayer button visible: true
MainMenu: Signals connected
MainMenu: Save/Load dialog setup complete
MainMenu: Default armies set - Player 1: A C Test, Player 2: ORK Test
MainMenu: Ready with default selections
TestModeHandler: Set window position to (100, 100)
TestModeHandler: Set window size to (600, 480)
TestModeHandler: Scheduling auto-host...
SaveLoadDialog: Checking node references...
  - save_button path: VBoxContainer/SaveSection/SaveInputContainer/SaveButton
  - save_name_input path: VBoxContainer/SaveSection/SaveInputContainer/SaveNameInput
  - saves_list path: VBoxContainer/LoadSection/SavesScrollContainer/SavesList
  - load_button path: VBoxContainer/LoadSection/LoadButtonContainer/LoadButton
SaveLoadDialog: Connected save button
SaveLoadDialog: Connected save input
SaveLoadDialog: Connected saves list
SaveLoadDialog: Connected load button
SaveLoadDialog: Connected delete button
SaveLoadDialog: Connected cancel button
SaveLoadDialog UI signals connected
SaveLoadDialog: Found 29 save files
SaveLoadDialog: Populated list with 29 save files
SaveLoadDialog initialized successfully
[GameInstance] Launching Client instance on port 7778
[GameInstance] Using project path: /Users/robertocallaghan/Documents/claude/godotv2/40k/
TestModeHandler: Current scene: MainMenu
TestModeHandler: Triggering multiplayer mode...
MainMenu: Multiplayer button pressed
MultiplayerLobby: Army selection initialized with 5 armies
MultiplayerLobby: Ready
Godot Engine v4.5.1.stable.official.f62fdbde1 - https://godotengine.org
OpenGL API 4.1 INTEL-18.8.6 - Compatibility - Using Device: Intel Inc. - Intel(R) Iris(TM) Graphics 6100

TestModeHandler: Lobby scene: MultiplayerLobby
TestModeHandler: Creating host on port 8000
MultiplayerLobby: Host button pressed
========================================
   YOU ARE: PLAYER 1 (HOST)
   Hosting on port: 7777
========================================
MultiplayerLobby: Successfully hosting on port 7777
TestModeHandler: Waiting for client to connect...
TestModeHandler: Listening for peer connection...
TestModeHandler: Args -> ["--test-mode", "--position=800,100", "--resolution=600x480", "--auto-join", "--host-ip=127.0.0.1", "--host-port=8000", "--instance-name=Client"]
[LogMonitor] Started monitoring: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251129_143703.log
[GameInstance] Monitoring log file: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251129_143703.log
[GameInstance] Successfully launched Client (PID: 87107)
[Test] Client instance launched successfully
[Test] Waiting for client to connect to host...
[Test] Host performing action: get_game_state with params: {  }
[Test] Writing command file: host_87099_cmd_001.json
[Test] Waiting for result file...
[Test] Polling for result file: host_87099_cmd_001_result.json
TestModeHandler: Processing command file host_87099_cmd_001.json
TestModeHandler: Executing command from file: host_87099_cmd_001.json
TestModeHandler: Executing action: get_game_state
TestModeHandler: Handling get_game_state action
TestModeHandler: get_game_state - Phase: Deployment, Turn: 0, Player: 0
TestModeHandler: Result written to: host_87099_cmd_001_result.json
TestModeHandler: Command executed and result written
[Test] Result file found!
[Test] Action completed: success=true, message=Game state retrieved
[Test] Connection verified - action simulation working!
========================================
   RUNNING IN TEST MODE
   Config: { "window_position": (800, 100), "window_size": (600, 480), "is_host": false, "host_ip": "127.0.0.1", "host_port": 8000, "instance_name": "Client" }
========================================
TestModeHandler: Command directories ready
  Commands: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_commands/commands
  Results: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_commands/results
[2025-11-29 14:37:09] [INFO.0000000] DebugLogger initialized - Session: 20251129_143709
[2025-11-29 14:37:09] [INFO.0000000] Log file: user://logs/debug_20251129_143709.log
[2025-11-29 14:37:09] [INFO.0000000] Real path: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251129_143709.log
[MeasuringTapeManager] Save persistence: false
Found armies in res://: ["orks", "adeptus_custodes", "space_marines", "A_C_test", "ORK_test"]
ArmyListManager initialized with 5 armies: ["orks", "adeptus_custodes", "space_marines", "A_C_test", "ORK_test"]
[2025-11-29 14:37:09] [INFO.0000000] DebugManager initialized
GameState: Loading default armies...
GameState: ArmyListManager not available, falling back to placeholder armies
GameState: Initializing placeholder armies for both players
GameState: Initializing placeholder army for player 1
GameState: Initializing placeholder army for player 2
ActionLogger: Started session 20251129_143709
StateSerializer: Pretty print enabled: true
SaveLoadManager: Current res:// directory: res://
SaveLoadManager: Project directory path: /Users/robertocallaghan/Documents/claude/godotv2/40k/
SaveLoadManager: Initialized save directories in project folder
SaveLoadManager: Save files will be stored at: /Users/robertocallaghan/Documents/claude/godotv2/40k/saves/
[PhaseManager] Ready - awaiting explicit phase initialization
[TerrainManager] Initializing terrain system
[TerrainManager] Added walls to terrain pieces
[TerrainManager] Loaded 12 terrain pieces
[EnhancedLineOfSight] Initialized
MissionManager: Initializing mission system
MissionManager: Set up 5 objectives for Strike Force deployment
  - obj_center at position (880.0, 1200.0)
  - obj_tl at position (400.0, 560.0)
  - obj_tr at position (1360.0, 560.0)
  - obj_bl at position (400.0, 1840.0)
  - obj_br at position (1360.0, 1840.0)
MissionManager: Initialized Take and Hold mission
[MeasuringTapeManager] Initialized with save_persistence: false
[LineOfSightManager] Initialized - Hold 'V' to check what can see the cursor position
TransportManager initialized
NetworkManager: Initialized
MainMenu: Initializing main menu
MainMenu: Loaded 5 armies: ["A C Test", "Adeptus Custodes", "ORK Test", "Orks", "Space Marines"]
MainMenu: Dropdowns populated with 5 armies
MainMenu: Multiplayer button visible: true
MainMenu: Signals connected
MainMenu: Save/Load dialog setup complete
MainMenu: Default armies set - Player 1: A C Test, Player 2: ORK Test
MainMenu: Ready with default selections
TestModeHandler: Set window position to (800, 100)
TestModeHandler: Set window size to (600, 480)
TestModeHandler: Scheduling auto-join...
SaveLoadDialog: Checking node references...
  - save_button path: VBoxContainer/SaveSection/SaveInputContainer/SaveButton
  - save_name_input path: VBoxContainer/SaveSection/SaveInputContainer/SaveNameInput
  - saves_list path: VBoxContainer/LoadSection/SavesScrollContainer/SavesList
  - load_button path: VBoxContainer/LoadSection/LoadButtonContainer/LoadButton
SaveLoadDialog: Connected save button
SaveLoadDialog: Connected save input
SaveLoadDialog: Connected saves list
SaveLoadDialog: Connected load button
SaveLoadDialog: Connected delete button
SaveLoadDialog: Connected cancel button
SaveLoadDialog UI signals connected
SaveLoadDialog: Found 29 save files
SaveLoadDialog: Populated list with 29 save files
SaveLoadDialog initialized successfully
TestModeHandler: Current scene: MainMenu
TestModeHandler: Triggering multiplayer mode...
MainMenu: Multiplayer button pressed
MultiplayerLobby: Army selection initialized with 5 armies
MultiplayerLobby: Ready
[Test] Host performing action: complete_deployment with params: { "player_id": 1 }
[Test] Writing command file: host_87099_cmd_002.json
[Test] Waiting for result file...
[Test] Polling for result file: host_87099_cmd_002_result.json
TestModeHandler: Processing command file host_87099_cmd_002.json
TestModeHandler: Processing command file host_87099_cmd_002.json
TestModeHandler: Executing command from file: host_87099_cmd_002.json
TestModeHandler: Executing action: complete_deployment
TestModeHandler: Executing command from file: host_87099_cmd_002.json
TestModeHandler: Handling complete_deployment action
TestModeHandler: Executing action: complete_deployment
GameManager: complete_deployment() called for player 1
TestModeHandler: Handling complete_deployment action
GameManager: complete_deployment() called for player 1
GameManager: Processing END_DEPLOYMENT action
GameManager: Processing END_DEPLOYMENT action
[PhaseManager] get_current_phase_instance returning: null
[PhaseManager] get_current_phase_instance returning: null
WARNING: GameManager: Could not emit phase_completed - no phase instance
     at: push_warning (core/variant/variant_utility.cpp:1034)
WARNING: GameManager: Could not emit phase_completed - no phase instance
     at: push_warning (core/variant/variant_utility.cpp:1034)
     GDScript backtrace (most recent call first):
         [0] _trigger_phase_completion (res://autoloads/GameManager.gd:664)
         [1] process_end_deployment (res://autoloads/GameManager.gd:270)
         [2] process_action (res://autoloads/GameManager.gd:45)
         [3] apply_action (res://autoloads/GameManager.gd:10)
         [4] complete_deployment (res://autoloads/GameManager.gd:867)
         [5] _handle_complete_deployment (res://autoloads/TestModeHandler.gd:686)
         [6] _execute_command (res://autoloads/TestModeHandler.gd:440)
         [7] _execute_command_file (res://autoloads/TestModeHandler.gd:415)
         [8] _check_for_commands (res://autoloads/TestModeHandler.gd:386)
         [9] _process (res://autoloads/TestModeHandler.gd:372)
     GDScript backtrace (most recent call first):
         [0] _trigger_phase_completion (res://autoloads/GameManager.gd:664)
         [1] process_end_deployment (res://autoloads/GameManager.gd:270)
         [2] process_action (res://autoloads/GameManager.gd:45)
         [3] apply_action (res://autoloads/GameManager.gd:10)
         [4] complete_deployment (res://autoloads/GameManager.gd:867)
         [5] _handle_complete_deployment (res://autoloads/TestModeHandler.gd:686)
         [6] _execute_command (res://autoloads/TestModeHandler.gd:440)
         [7] _execute_command_file (res://autoloads/TestModeHandler.gd:415)
         [8] _check_for_commands (res://autoloads/TestModeHandler.gd:386)
         [9] _process (res://autoloads/TestModeHandler.gd:372)
GameManager: Applying result with 1 changes/diffs
GameManager: Applying result with 1 changes/diffs
GameManager: Setting meta.phase = 1
GameManager: complete_deployment() result: success=true
GameManager: Setting meta.phase = 1
GameManager: complete_deployment() result: success=true
TestModeHandler: Result written to: host_87099_cmd_002_result.json
TestModeHandler: Result written to: host_87099_cmd_002_result.json
TestModeHandler: Command executed and result written
TestModeHandler: Command executed and result written
[Test] Result file found!
[Test] Action completed: success=true, message=Player 1 deployment complete
[TEST] Player 1 complete: success=true
TestModeHandler: Lobby scene: MultiplayerLobby
TestModeHandler: Joining host at 127.0.0.1
MultiplayerLobby: Join button pressed
NetworkManager: Connecting to 127.0.0.1:7777
MultiplayerLobby: Attempting to join 127.0.0.1:7777
NetworkManager: Peer connected - 1
NetworkManager: Successfully connected to host
NetworkManager: Client set peer_to_player_map[2077342954] = 2
========================================
   YOU ARE: PLAYER 2 (CLIENT)
   Connected to host
========================================
MultiplayerLobby: Peer connected - 1
MultiplayerLobby: Game started signal received
NetworkManager: Peer connected - 2077342954
[GameState] MeasuringTapeManager not available
MultiplayerLobby: Peer connected - 2077342954
TestModeHandler: Client connected!
MultiplayerLobby: Game started signal received
NetworkManager: Receiving initial state from host
[GameState] No measuring_tape data in save
NetworkManager: State synchronized
MultiplayerLobby: Game started signal received
MultiplayerLobby: Syncing army selection - Player 1 -> A_C_test
MultiplayerLobby: Syncing army selection - Player 2 -> ORK_test
[Test] Host performing action: get_game_state with params: {  }
[Test] Writing command file: host_87099_cmd_003.json
[Test] Waiting for result file...
[Test] Polling for result file: host_87099_cmd_003_result.json
TestModeHandler: Processing command file host_87099_cmd_003.json
TestModeHandler: Executing command from file: host_87099_cmd_003.json
TestModeHandler: Executing action: get_game_state
TestModeHandler: Handling get_game_state action
TestModeHandler: get_game_state - Phase: Command, Turn: 0, Player: 0
TestModeHandler: Result written to: host_87099_cmd_003_result.json
TestModeHandler: Command executed and result written
[Test] Result file found!
[Test] Action completed: success=true, message=Game state retrieved
[TEST] Phase after P1 complete: Command
[Test] Client performing action: complete_deployment with params: { "player_id": 2 }
[Test] Writing command file: client_87107_cmd_001.json
[Test] Waiting for result file...
[Test] Polling for result file: client_87107_cmd_001_result.json
TestModeHandler: Processing command file client_87107_cmd_001.json
TestModeHandler: Executing command from file: client_87107_cmd_001.json
TestModeHandler: Executing action: complete_deployment
TestModeHandler: Handling complete_deployment action
GameManager: complete_deployment() called for player 2
GameManager: Processing END_DEPLOYMENT action
[PhaseManager] get_current_phase_instance returning: null
WARNING: GameManager: Could not emit phase_completed - no phase instance
     at: push_warning (core/variant/variant_utility.cpp:1034)
     GDScript backtrace (most recent call first):
         [0] _trigger_phase_completion (res://autoloads/GameManager.gd:664)
         [1] process_end_deployment (res://autoloads/GameManager.gd:270)
         [2] process_action (res://autoloads/GameManager.gd:45)
         [3] apply_action (res://autoloads/GameManager.gd:10)
         [4] complete_deployment (res://autoloads/GameManager.gd:867)
         [5] _handle_complete_deployment (res://autoloads/TestModeHandler.gd:686)
         [6] _execute_command (res://autoloads/TestModeHandler.gd:440)
         [7] _execute_command_file (res://autoloads/TestModeHandler.gd:415)
         [8] _check_for_commands (res://autoloads/TestModeHandler.gd:386)
         [9] _process (res://autoloads/TestModeHandler.gd:372)
GameManager: Applying result with 1 changes/diffs
GameManager: Setting meta.phase = 1
GameManager: complete_deployment() result: success=true
TestModeHandler: Result written to: client_87107_cmd_001_result.json
TestModeHandler: Command executed and result written
[Test] Result file found!
[Test] Action completed: success=true, message=Player 2 deployment complete
[TEST] Player 2 complete: success=true
TestModeHandler: Starting game...
MultiplayerLobby: Start game button pressed
MultiplayerLobby: Loading armies...
MultiplayerLobby: Loading A_C_test for Player 1
Loading army list: A_C_test for player 1
Processed unit: U_BLADE_CHAMPION_A for player 1
Processed unit: U_WITCHSEEKERS_C for player 1
Processed unit: U_CALADIUS_GRAV-TANK_E for player 1
Successfully loaded army: A_C_test with 3 units
MultiplayerLobby: Player 1 army loaded, has 3 units
Applying army to game state for player: 1
Removing 0 existing units for player 1
Added unit: U_BLADE_CHAMPION_A (Blade Champion)
Added unit: U_WITCHSEEKERS_C (Witchseekers)
Added unit: U_CALADIUS_GRAV-TANK_E (Caladius Grav-tank)
Set faction for player 1: Adeptus Custodes
Army applied successfully. Total units in game: 3
MultiplayerLobby: After applying P1 army, GameState has 3 units
MultiplayerLobby: Loading ORK_test for Player 2
Loading army list: ORK_test for player 2
Processed unit: U_WARBOSS_B for player 2
Processed unit: U_WARBOSS_IN_MEGA_ARMOUR_D for player 2
[2025-11-29 14:37:13] [DEBUG.0000000] Parsed transport capacity keywords | Context: {"description":"This model has a transport capacity of 22 ORKS INFANTRY models. Each MEGA ARMOUR model takes up the space of 2 models. This model cannot transport models that are JUMP PACK models.","keywords":["ORKS","INFANTRY"],"unit_id":"U_BATTLEWAGON_G"}
Processed unit: U_BATTLEWAGON_G for player 2
Successfully loaded army: ORK_test with 3 units
MultiplayerLobby: Player 2 army loaded, has 3 units
Applying army to game state for player: 2
Removing 0 existing units for player 2
Added unit: U_WARBOSS_B (Warboss)
Added unit: U_WARBOSS_IN_MEGA_ARMOUR_D (Warboss in Mega Armour)
Added unit: U_BATTLEWAGON_G (Battlewagon)
Set faction for player 2: Unknown
Army applied successfully. Total units in game: 6
MultiplayerLobby: After applying P2 army, GameState has 6 units
MultiplayerLobby: Armies loaded. Total units: 6
MultiplayerLobby: Syncing loaded armies to clients...
[GameState] MeasuringTapeManager not available
MultiplayerLobby: Snapshot has 6 units
MultiplayerLobby: Sent army snapshot to peer 2077342954
NetworkManager: Receiving initial state from host
[GameState] No measuring_tape data in save
NetworkManager: State synchronized
MultiplayerLobby: Game started signal received
NetworkManager: Starting multiplayer game - transitioning to Main scene
NetworkManager: Units in GameState BEFORE scene change: 6
NetworkManager: Unit IDs: ["U_BLADE_CHAMPION_A", "U_WITCHSEEKERS_C", "U_CALADIUS_GRAV-TANK_E", "U_WARBOSS_B", "U_WARBOSS_IN_MEGA_ARMOUR_D", "U_BATTLEWAGON_G"]
NetworkManager: Starting multiplayer game - transitioning to Main scene
NetworkManager: Units in GameState BEFORE scene change: 6
NetworkManager: Unit IDs: ["U_BLADE_CHAMPION_A", "U_WITCHSEEKERS_C", "U_CALADIUS_GRAV-TANK_E", "U_WARBOSS_B", "U_WARBOSS_IN_MEGA_ARMOUR_D", "U_BATTLEWAGON_G"]
[Test] Host performing action: get_game_state with params: {  }
[Test] Writing command file: host_87099_cmd_004.json
[Test] Waiting for result file...
[Test] Polling for result file: host_87099_cmd_004_result.json
MultiplayerLobby: Game started signal received
MultiplayerLobby: Game start RPC sent to all peers
TestModeHandler: Processing command file host_87099_cmd_004.json
TestModeHandler: Executing command from file: host_87099_cmd_004.json
TestModeHandler: Executing action: get_game_state
TestModeHandler: Handling get_game_state action
TestModeHandler: get_game_state - Phase: Command, Turn: 0, Player: 0
TestModeHandler: Result written to: host_87099_cmd_004_result.json
TestModeHandler: Command executed and result written
MultiplayerLobby: Game started signal received
[Test] Result file found!
[Test] Action completed: success=true, message=Game state retrieved
[TEST] Phase after both complete: Command
[TEST] Deployment completion test finished

========================================
Cleaning up Multiplayer Test
========================================

[Test] Host performing action: get_game_state with params: {  }
[Test] Writing command file: host_87099_cmd_005.json
[Test] Waiting for result file...
[Test] Polling for result file: host_87099_cmd_005_result.json
UnitStatsPanel: _ready() called with 4-section layout
UnitStatsPanel: Toggle button connected
UnitStatsPanel: Player units list connected
UnitStatsPanel: Enemy units list connected
UnitStatsPanel: Setting collapsed to true
UnitStatsPanel: Main content visible = false
UnitStatsPanel: Toggle button text = ▼ Unit Stats
UnitStatsPanel: Target height = 40, Target offset = -40
Main: _ready() called
Main: DebugLogger log file path: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251129_143703.log
[2025-11-29 14:37:16] [INFO.0000000] Main._ready() called
Main: Current units count BEFORE check: 6
Main: Unit IDs in GameState: ["U_BLADE_CHAMPION_A", "U_WITCHSEEKERS_C", "U_CALADIUS_GRAV-TANK_E", "U_WARBOSS_B", "U_WARBOSS_IN_MEGA_ARMOUR_D", "U_BATTLEWAGON_G"]
Main: Meta flags: ["game_id", "turn_number", "battle_round", "active_player", "phase", "created_at", "version", "from_multiplayer_lobby", "game_config"]
Main: Game config: { "player1_army": "A_C_test", "player2_army": "ORK_test" }
Main: from_menu=false from_save=false from_multiplayer=true
Main: ✓ Loading from multiplayer lobby with armies already loaded
Main: Units count AFTER multiplayer check: 6
Main: Initializing deployment phase with 6 units
[PhaseManager] transition_to_phase called for: DEPLOYMENT
[PhaseManager] Creating new phase instance for: DEPLOYMENT
[PhaseManager] Phase script: <GDScript#-9223372002159491695>
[PhaseManager] Created instance class: Node
[PhaseManager] Instance script: <GDScript#-9223372002159491695>
[PhaseManager] Instance has validate_action: true
UnitStatsPanel: _ready() called with 4-section layout
[PhaseManager] Connected to phase_completed signal
[PhaseManager] Connected to action_taken signal
UnitStatsPanel: Toggle button connected
UnitStatsPanel: Player units list connected
UnitStatsPanel: Enemy units list connected
UnitStatsPanel: Setting collapsed to true
UnitStatsPanel: Main content visible = false
UnitStatsPanel: Toggle button text = ▼ Unit Stats
UnitStatsPanel: Target height = 40, Target offset = -40
Main: _ready() called
[GameState] MeasuringTapeManager not available
[PhaseManager] Creating snapshot for phase 0
Main: DebugLogger log file path: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251129_143709.log
[PhaseManager] Snapshot has 6 units
[PhaseManager] Unit IDs: ["U_BLADE_CHAMPION_A", "U_WITCHSEEKERS_C", "U_CALADIUS_GRAV-TANK_E", "U_WARBOSS_B", "U_WARBOSS_IN_MEGA_ARMOUR_D", "U_BATTLEWAGON_G"]
[2025-11-29 14:37:16] [INFO.0000000] Main._ready() called
[0][INFO] Entering Deployment Phase
Main: Current units count BEFORE check: 6
Main: Unit IDs in GameState: ["U_BLADE_CHAMPION_A", "U_WITCHSEEKERS_C", "U_CALADIUS_GRAV-TANK_E", "U_WARBOSS_B", "U_WARBOSS_IN_MEGA_ARMOUR_D", "U_BATTLEWAGON_G"]
[0][INFO] Deployment phase initialized
Main: Meta flags: ["game_id", "turn_number", "battle_round", "active_player", "phase", "created_at", "version", "from_multiplayer_lobby", "game_config"]
Main: Game config: { "player1_army": "A_C_test", "player2_army": "ORK_test" }
Main: from_menu=false from_save=false from_multiplayer=true
Main: ✓ Loading from multiplayer lobby with armies already loaded
Main: Units count AFTER multiplayer check: 6
Main: Initializing deployment phase with 6 units
[PhaseManager] transition_to_phase called for: DEPLOYMENT
[PhaseManager] Creating new phase instance for: DEPLOYMENT
[PhaseManager] Phase script: <GDScript#-9223372002159491695>
[PhaseManager] Created instance class: Node
[PhaseManager] Instance script: <GDScript#-9223372002159491695>
[PhaseManager] Instance has validate_action: true
[PhaseManager] Connected to phase_completed signal
[PhaseManager] Connected to action_taken signal
[GameState] MeasuringTapeManager not available
[PhaseManager] Creating snapshot for phase 0
[PhaseManager] Snapshot has 6 units
[PhaseManager] Unit IDs: ["U_BLADE_CHAMPION_A", "U_WITCHSEEKERS_C", "U_CALADIUS_GRAV-TANK_E", "U_WARBOSS_B", "U_WARBOSS_IN_MEGA_ARMOUR_D", "U_BATTLEWAGON_G"]
[0][INFO] Entering Deployment Phase
[0][INFO] Deployment phase initialized
[PhaseManager] get_current_phase_instance returning: Node
[PhaseManager] Instance script path: res://phases/DeploymentPhase.gd
[PhaseManager] Instance has validate_action: true
[PhaseManager] ⚠️ Script path: res://phases/DeploymentPhase.gd
[PhaseManager] ⚠️ This SHOULD be a DeploymentPhase!
Main: Phase instance created - class: Node
Main: Phase instance script: <GDScript#-9223372002159491695>
Main: Phase has validate_action: true
Setting up objectives on board...
Main: Creating visuals for 5 objectives
MissionManager: Checking control for 5 objectives with 6 units

Checking objective: obj_center at position (880.0, 1200.0)
  Skipping U_BLADE_CHAMPION_A - not deployed (status: 0)
  Skipping U_WITCHSEEKERS_C - not deployed (status: 0)
  Skipping U_CALADIUS_GRAV-TANK_E - not deployed (status: 0)
  Skipping U_WARBOSS_B - not deployed (status: 0)
  Skipping U_WARBOSS_IN_MEGA_ARMOUR_D - not deployed (status: 0)
  Skipping U_BATTLEWAGON_G - not deployed (status: 0)

Checking objective: obj_tl at position (400.0, 560.0)
  Skipping U_BLADE_CHAMPION_A - not deployed (status: 0)
  Skipping U_WITCHSEEKERS_C - not deployed (status: 0)
  Skipping U_CALADIUS_GRAV-TANK_E - not deployed (status: 0)
  Skipping U_WARBOSS_B - not deployed (status: 0)
  Skipping U_WARBOSS_IN_MEGA_ARMOUR_D - not deployed (status: 0)
  Skipping U_BATTLEWAGON_G - not deployed (status: 0)

Checking objective: obj_tr at position (1360.0, 560.0)
  Skipping U_BLADE_CHAMPION_A - not deployed (status: 0)
  Skipping U_WITCHSEEKERS_C - not deployed (status: 0)
  Skipping U_CALADIUS_GRAV-TANK_E - not deployed (status: 0)
  Skipping U_WARBOSS_B - not deployed (status: 0)
  Skipping U_WARBOSS_IN_MEGA_ARMOUR_D - not deployed (status: 0)
  Skipping U_BATTLEWAGON_G - not deployed (status: 0)

Checking objective: obj_bl at position (400.0, 1840.0)
  Skipping U_BLADE_CHAMPION_A - not deployed (status: 0)
  Skipping U_WITCHSEEKERS_C - not deployed (status: 0)
  Skipping U_CALADIUS_GRAV-TANK_E - not deployed (status: 0)
  Skipping U_WARBOSS_B - not deployed (status: 0)
  Skipping U_WARBOSS_IN_MEGA_ARMOUR_D - not deployed (status: 0)
  Skipping U_BATTLEWAGON_G - not deployed (status: 0)

Checking objective: obj_br at position (1360.0, 1840.0)
  Skipping U_BLADE_CHAMPION_A - not deployed (status: 0)
  Skipping U_WITCHSEEKERS_C - not deployed (status: 0)
  Skipping U_CALADIUS_GRAV-TANK_E - not deployed (status: 0)
  Skipping U_WARBOSS_B - not deployed (status: 0)
  Skipping U_WARBOSS_IN_MEGA_ARMOUR_D - not deployed (status: 0)
  Skipping U_BATTLEWAGON_G - not deployed (status: 0)
Main: Objectives setup complete
Moved HUD_Bottom to top of screen
Looking for UnitStatsPanel in scene...
Found UnitStatsPanel in scene structure
Connected to unit_selected signal from UnitStatsPanel
UnitStatsPanel: Populating unit lists for phase: DEPLOYMENT
UnitStatsPanel: Populated 3 units for player (player 1)
UnitStatsPanel: Populated 3 units for enemy (player 2)
Initialized UnitStatsPanel unit lists for phase: DEPLOYMENT
Fixed HUD layout: HUD_Left adjusted for new layout
Fixed HUD layout: HUD_Right adjusted for new layout
Adjusted unit list: fixed height to 150px
Setting up Mathhammer UI...
MathhhammerUI: Initializing...
[PhaseManager] get_current_phase_instance returning: Node
[PhaseManager] Instance script path: res://phases/DeploymentPhase.gd
[PhaseManager] Instance has validate_action: true
[PhaseManager] ⚠️ Script path: res://phases/DeploymentPhase.gd
[PhaseManager] ⚠️ This SHOULD be a DeploymentPhase!
Main: Phase instance created - class: Node
Main: Phase instance script: <GDScript#-9223372002159491695>
Main: Phase has validate_action: true
Setting up objectives on board...
Main: Creating visuals for 5 objectives
MissionManager: Checking control for 5 objectives with 6 units

Checking objective: obj_center at position (880.0, 1200.0)
  Skipping U_BLADE_CHAMPION_A - not deployed (status: 0)
  Skipping U_WITCHSEEKERS_C - not deployed (status: 0)
  Skipping U_CALADIUS_GRAV-TANK_E - not deployed (status: 0)
  Skipping U_WARBOSS_B - not deployed (status: 0)
  Skipping U_WARBOSS_IN_MEGA_ARMOUR_D - not deployed (status: 0)
  Skipping U_BATTLEWAGON_G - not deployed (status: 0)

Checking objective: obj_tl at position (400.0, 560.0)
  Skipping U_BLADE_CHAMPION_A - not deployed (status: 0)
  Skipping U_WITCHSEEKERS_C - not deployed (status: 0)
  Skipping U_CALADIUS_GRAV-TANK_E - not deployed (status: 0)
  Skipping U_WARBOSS_B - not deployed (status: 0)
  Skipping U_WARBOSS_IN_MEGA_ARMOUR_D - not deployed (status: 0)
  Skipping U_BATTLEWAGON_G - not deployed (status: 0)

Checking objective: obj_tr at position (1360.0, 560.0)
  Skipping U_BLADE_CHAMPION_A - not deployed (status: 0)
  Skipping U_WITCHSEEKERS_C - not deployed (status: 0)
  Skipping U_CALADIUS_GRAV-TANK_E - not deployed (status: 0)
  Skipping U_WARBOSS_B - not deployed (status: 0)
  Skipping U_WARBOSS_IN_MEGA_ARMOUR_D - not deployed (status: 0)
  Skipping U_BATTLEWAGON_G - not deployed (status: 0)

Checking objective: obj_bl at position (400.0, 1840.0)
  Skipping U_BLADE_CHAMPION_A - not deployed (status: 0)
  Skipping U_WITCHSEEKERS_C - not deployed (status: 0)
  Skipping U_CALADIUS_GRAV-TANK_E - not deployed (status: 0)
  Skipping U_WARBOSS_B - not deployed (status: 0)
  Skipping U_WARBOSS_IN_MEGA_ARMOUR_D - not deployed (status: 0)
  Skipping U_BATTLEWAGON_G - not deployed (status: 0)

Checking objective: obj_br at position (1360.0, 1840.0)
  Skipping U_BLADE_CHAMPION_A - not deployed (status: 0)
  Skipping U_WITCHSEEKERS_C - not deployed (status: 0)
  Skipping U_CALADIUS_GRAV-TANK_E - not deployed (status: 0)
  Skipping U_WARBOSS_B - not deployed (status: 0)
  Skipping U_WARBOSS_IN_MEGA_ARMOUR_D - not deployed (status: 0)
  Skipping U_BATTLEWAGON_G - not deployed (status: 0)
Main: Objectives setup complete
Moved HUD_Bottom to top of screen
Looking for UnitStatsPanel in scene...
Found UnitStatsPanel in scene structure
Connected to unit_selected signal from UnitStatsPanel
UnitStatsPanel: Populating unit lists for phase: DEPLOYMENT
UnitStatsPanel: Populated 3 units for player (player 1)
UnitStatsPanel: Populated 3 units for enemy (player 2)
Initialized UnitStatsPanel unit lists for phase: DEPLOYMENT
Fixed HUD layout: HUD_Left adjusted for new layout
Fixed HUD layout: HUD_Right adjusted for new layout
Adjusted unit list: fixed height to 150px
Setting up Mathhammer UI...
MathhhammerUI: Initializing...
Mathhammer UI added to left HUD
Mathhammer UI successfully integrated into left side of main UI
Setting up Save/Load Dialog...
Mathhammer UI added to left HUD
Mathhammer UI successfully integrated into left side of main UI
Setting up Save/Load Dialog...
Save/Load Dialog setup completed
Setting up terrain system...
[TerrainVisual] Added wall line from (640.0, 80.0) to (800.0, 80.0) type: solid
[TerrainVisual] Added wall line from (640.0, 80.0) to (640.0, 200.0) type: window
Save/Load Dialog setup completed
Setting up terrain system...
[TerrainVisual] Added wall line from (640.0, 80.0) to (800.0, 80.0) type: solid
[TerrainVisual] Added wall line from (640.0, 80.0) to (640.0, 200.0) type: window
[TerrainVisual] Added wall line from (1120.0, 200.0) to (1600.0, 200.0) type: solid
[TerrainVisual] Added wall line from (1120.0, 440.0) to (1600.0, 440.0) type: solid
[TerrainVisual] Added wall line from (1120.0, 280.0) to (1120.0, 360.0) type: door
[TerrainVisual] Added wall line from (1600.0, 250.0) to (1600.0, 390.0) type: window
[TerrainVisual] Added wall line from (640.0, 320.0) to (640.0, 560.0) type: solid
[TerrainVisual] Added wall line from (280.0, 440.0) to (520.0, 440.0) type: window
[TerrainVisual] Added wall line from (1120.0, 200.0) to (1600.0, 200.0) type: solid
[TerrainVisual] Added wall line from (1120.0, 440.0) to (1600.0, 440.0) type: solid
[TerrainVisual] Added wall line from (1120.0, 280.0) to (1120.0, 360.0) type: door
[TerrainVisual] Added wall line from (1600.0, 250.0) to (1600.0, 390.0) type: window
[TerrainVisual] Added wall line from (160.0, 1960.0) to (640.0, 1960.0) type: solid
[TerrainVisual] Added wall line from (160.0, 1960.0) to (160.0, 2200.0) type: solid
[TerrainVisual] Added wall line from (625.4415, 844.8528) to (964.8528, 505.4416) type: solid
[TerrainVisual] Added wall line from (640.0, 320.0) to (640.0, 560.0) type: solid
[TerrainVisual] Added wall line from (280.0, 440.0) to (520.0, 440.0) type: window
[TerrainVisual] Rendered 12 terrain pieces
[TerrainVisual] Initialized
Added TerrainVisual to BoardRoot
[LineOfSightVisual] Initialized - Will show models that can see cursor position
Added LineOfSightVisual to BoardRoot
Line of Sight: Hold 'V' to check what models can see the cursor position
[TerrainVisual] Added wall line from (160.0, 1960.0) to (640.0, 1960.0) type: solid
[TerrainVisual] Added wall line from (160.0, 1960.0) to (160.0, 2200.0) type: solid
[TerrainVisual] Added wall line from (625.4415, 844.8528) to (964.8528, 505.4416) type: solid
[TerrainVisual] Rendered 12 terrain pieces
[TerrainVisual] Initialized
Added TerrainVisual to BoardRoot
[LineOfSightVisual] Initialized - Will show models that can see cursor position
Added LineOfSightVisual to BoardRoot
Line of Sight: Hold 'V' to check what models can see the cursor position
Added terrain UI controls to HUD
Setting up measuring tape visual...
[MeasuringTapeVisual] Initialized with z_index 15
Added MeasuringTapeVisual to BoardRoot
Measuring Tape: Hold 't' and drag to measure, press 'y' to clear all measurements
Added measuring tape save toggle to HUD
Setting up transport panel...
Added terrain UI controls to HUD
Setting up measuring tape visual...
[MeasuringTapeVisual] Initialized with z_index 15
Added MeasuringTapeVisual to BoardRoot
Measuring Tape: Hold 't' and drag to measure, press 'y' to clear all measurements
Added measuring tape save toggle to HUD
Setting up transport panel...
Transport panel added to HUD_Right
Left panel toggle button added to top HUD
Left panel hidden by default
Main: setup_phase_controllers() STARTING (semaphore locked)
Transport panel added to HUD_Right
Left panel toggle button added to top HUD
Left panel hidden by default
Main: setup_phase_controllers() STARTING (semaphore locked)
TestModeHandler: Processing command file host_87099_cmd_005.json
TestModeHandler: Processing command file host_87099_cmd_005.json
TestModeHandler: Executing command from file: host_87099_cmd_005.json
TestModeHandler: Executing action: get_game_state
TestModeHandler: Handling get_game_state action
TestModeHandler: Executing command from file: host_87099_cmd_005.json
TestModeHandler: get_game_state - Phase: Deployment, Turn: 0, Player: 0
TestModeHandler: Executing action: get_game_state
TestModeHandler: Handling get_game_state action
TestModeHandler: get_game_state - Phase: Deployment, Turn: 0, Player: 0
TestModeHandler: Result written to: host_87099_cmd_005_result.json
TestModeHandler: Command executed and result written
TestModeHandler: Result written to: host_87099_cmd_005_result.json
TestModeHandler: Command executed and result written
SaveLoadDialog: Checking node references...
  - save_button path: VBoxContainer/SaveSection/SaveInputContainer/SaveButton
  - save_name_input path: VBoxContainer/SaveSection/SaveInputContainer/SaveNameInput
  - saves_list path: VBoxContainer/LoadSection/SavesScrollContainer/SavesList
  - load_button path: VBoxContainer/LoadSection/LoadButtonContainer/LoadButton
SaveLoadDialog: Connected save button
SaveLoadDialog: Connected save input
SaveLoadDialog: Connected saves list
SaveLoadDialog: Connected load button
SaveLoadDialog: Connected delete button
SaveLoadDialog: Connected cancel button
SaveLoadDialog UI signals connected
SaveLoadDialog: Checking node references...
  - save_button path: VBoxContainer/SaveSection/SaveInputContainer/SaveButton
  - save_name_input path: VBoxContainer/SaveSection/SaveInputContainer/SaveNameInput
  - saves_list path: VBoxContainer/LoadSection/SavesScrollContainer/SavesList
  - load_button path: VBoxContainer/LoadSection/LoadButtonContainer/LoadButton
SaveLoadDialog: Connected save button
SaveLoadDialog: Connected save input
SaveLoadDialog: Connected saves list
SaveLoadDialog: Connected load button
SaveLoadDialog: Connected delete button
SaveLoadDialog: Connected cancel button
SaveLoadDialog UI signals connected
SaveLoadDialog: Found 29 save files
SaveLoadDialog: Populated list with 29 save files
SaveLoadDialog initialized successfully
SaveLoadDialog: Found 29 save files
SaveLoadDialog: Populated list with 29 save files
SaveLoadDialog initialized successfully
Main: setup_phase_controllers() COMPLETE (semaphore unlocked)
ERROR: Signal 'unit_confirmed' is already connected to given callable 'CanvasLayer(Main.gd)::_on_unit_confirmed' in that object.
   at: connect (core/object/object.cpp:1538)
   GDScript backtrace (most recent call first):
       [0] connect_signals (res://scripts/Main.gd:1250)
       [1] _ready (res://scripts/Main.gd:137)
       [2] setup_phase_controllers (res://scripts/Main.gd:940)
ERROR: Signal 'models_placed_changed' is already connected to given callable 'CanvasLayer(Main.gd)::_on_models_placed_changed' in that object.
   at: connect (core/object/object.cpp:1538)
   GDScript backtrace (most recent call first):
       [0] connect_signals (res://scripts/Main.gd:1251)
       [1] _ready (res://scripts/Main.gd:137)
       [2] setup_phase_controllers (res://scripts/Main.gd:940)
Main: Connected to GameManager.result_applied signal
UnitStatsPanel: Populating unit lists for phase: DEPLOYMENT
[Test] Result file found!
UnitStatsPanel: Populated 3 units for player (player 1)
UnitStatsPanel: Populated 3 units for enemy (player 2)
Refreshed bottom panel unit lists for phase: DEPLOYMENT
Refreshing right panel unit list for deployment - found 3 undeployed units
GameState: ⚠️ all_units_deployed check - Undeployed units: ["U_BLADE_CHAMPION_A (player 1)", "U_WITCHSEEKERS_C (player 1)", "U_CALADIUS_GRAV-TANK_E (player 1)", "U_WARBOSS_B (player 2)", "U_WARBOSS_IN_MEGA_ARMOUR_D (player 2)", "U_BATTLEWAGON_G (player 2)"]
Main: ⚠️ update_ui() - DEPLOYMENT phase - all_deployed: false
Main: ⚠️ Button state BEFORE change - disabled: true text: 'End Phase'
[2025-11-29 14:37:16] [INFO.0000000] update_ui deployment check | Context: {"all_deployed":false,"button_text":"End Phase","current_button_disabled":true}
Main: ⚠️ update_ui() - Setting button DISABLED (not all deployed)
Main: ⚠️ Button state AFTER disable - disabled: true
Main: ⚠️ Calling update_ui_for_phase() for initial phase setup
Main: ========== UPDATE UI FOR PHASE ==========
Main: Current phase: DEPLOYMENT
[2025-11-29 14:37:16] [INFO.0000000] update_ui_for_phase START | Context: {"button_exists":true,"button_path":"/root/Main/HUD_Bottom/HBoxContainer/PhaseActionButton","phase":"DEPLOYMENT"}
[2025-11-29 14:37:16] [INFO.0000000] Updating UI for phase | Context: {"phase":"DEPLOYMENT"}
GameState: ⚠️ all_units_deployed check - Undeployed units: ["U_BLADE_CHAMPION_A (player 1)", "U_WITCHSEEKERS_C (player 1)", "U_CALADIUS_GRAV-TANK_E (player 1)", "U_WARBOSS_B (player 2)", "U_WARBOSS_IN_MEGA_ARMOUR_D (player 2)", "U_BATTLEWAGON_G (player 2)"]
Main: Deployment phase - all_units_deployed: false button_disabled: true
[2025-11-29 14:37:16] [INFO.0000000] Deployment button state | Context: {"all_deployed":false,"button_disabled":true}
Main: Phase button configured - text: 'End Deployment' visible: true disabled: true
[2025-11-29 14:37:16] [INFO.0000000] Phase button configured | Context: {"disabled":true,"text":"End Deployment","visible":true}
Main: Connected phase action button to _on_phase_action_pressed
Main: ⚠️ VERIFICATION - Button connected: true
[2025-11-29 14:37:16] [INFO.0000000] Phase button signal connected | Context: {"connection_verified":true,"is_now_connected":true,"was_previously_connected":false}
WARNING: MovementActions container not found!
GameState: ⚠️ all_units_deployed check - Undeployed units: ["U_BLADE_CHAMPION_A (player 1)", "U_WITCHSEEKERS_C (player 1)", "U_CALADIUS_GRAV-TANK_E (player 1)", "U_WARBOSS_B (player 2)", "U_WARBOSS_IN_MEGA_ARMOUR_D (player 2)", "U_BATTLEWAGON_G (player 2)"]
UnitStatsPanel: Populating unit lists for phase: DEPLOYMENT
UnitStatsPanel: Populated 3 units for player (player 1)
Main: setup_phase_controllers() COMPLETE (semaphore unlocked)
UnitStatsPanel: Populated 3 units for enemy (player 2)
Refreshed bottom panel unit lists for phase: DEPLOYMENT
Refreshing right panel unit list for deployment - found 3 undeployed units
ERROR: Signal 'unit_confirmed' is already connected to given callable 'CanvasLayer(Main.gd)::_on_unit_confirmed' in that object.
   at: connect (core/object/object.cpp:1538)
   GDScript backtrace (most recent call first):
       [0] connect_signals (res://scripts/Main.gd:1250)
       [1] _ready (res://scripts/Main.gd:137)
       [2] setup_phase_controllers (res://scripts/Main.gd:940)
ERROR: Signal 'models_placed_changed' is already connected to given callable 'CanvasLayer(Main.gd)::_on_models_placed_changed' in that object.
   at: connect (core/object/object.cpp:1538)
   GDScript backtrace (most recent call first):
       [0] connect_signals (res://scripts/Main.gd:1251)
       [1] _ready (res://scripts/Main.gd:137)
       [2] setup_phase_controllers (res://scripts/Main.gd:940)
GameState: ⚠️ all_units_deployed check - Undeployed units: ["U_BLADE_CHAMPION_A (player 1)", "U_WITCHSEEKERS_C (player 1)", "U_CALADIUS_GRAV-TANK_E (player 1)", "U_WARBOSS_B (player 2)", "U_WARBOSS_IN_MEGA_ARMOUR_D (player 2)", "U_BATTLEWAGON_G (player 2)"]
Main: ⚠️ update_ui() - DEPLOYMENT phase - all_deployed: false
Main: ⚠️ Button state BEFORE change - disabled: true text: 'End Deployment'
Main: Connected to GameManager.result_applied signal
UnitStatsPanel: Populating unit lists for phase: DEPLOYMENT
[2025-11-29 14:37:16] [INFO.0000000] update_ui deployment check | Context: {"all_deployed":false,"button_text":"End Deployment","current_button_disabled":true}
Main: ⚠️ update_ui() - Setting button DISABLED (not all deployed)
Main: ⚠️ Button state AFTER disable - disabled: true
Main: ⚠️ Initial phase UI setup complete
Quick Save/Load enabled: [ key to save, ] key (or F9) to load
UnitStatsPanel: Populated 3 units for player (player 1)
UnitStatsPanel: Populated 3 units for enemy (player 2)
Refreshed bottom panel unit lists for phase: DEPLOYMENT
Refreshing right panel unit list for deployment - found 3 undeployed units
GameState: ⚠️ all_units_deployed check - Undeployed units: ["U_BLADE_CHAMPION_A (player 1)", "U_WITCHSEEKERS_C (player 1)", "U_CALADIUS_GRAV-TANK_E (player 1)", "U_WARBOSS_B (player 2)", "U_WARBOSS_IN_MEGA_ARMOUR_D (player 2)", "U_BATTLEWAGON_G (player 2)"]
Main: ⚠️ update_ui() - DEPLOYMENT phase - all_deployed: false
Main: ⚠️ Button state BEFORE change - disabled: true text: 'End Phase'
[2025-11-29 14:37:16] [INFO.0000000] update_ui deployment check | Context: {"all_deployed":false,"button_text":"End Phase","current_button_disabled":true}
Main: ⚠️ update_ui() - Setting button DISABLED (not all deployed)
Main: ⚠️ Button state AFTER disable - disabled: true
Main: ⚠️ Calling update_ui_for_phase() for initial phase setup
Main: ========== UPDATE UI FOR PHASE ==========
Main: Current phase: DEPLOYMENT
[2025-11-29 14:37:16] [INFO.0000000] update_ui_for_phase START | Context: {"button_exists":true,"button_path":"/root/Main/HUD_Bottom/HBoxContainer/PhaseActionButton","phase":"DEPLOYMENT"}
[2025-11-29 14:37:16] [INFO.0000000] Updating UI for phase | Context: {"phase":"DEPLOYMENT"}
GameState: ⚠️ all_units_deployed check - Undeployed units: ["U_BLADE_CHAMPION_A (player 1)", "U_WITCHSEEKERS_C (player 1)", "U_CALADIUS_GRAV-TANK_E (player 1)", "U_WARBOSS_B (player 2)", "U_WARBOSS_IN_MEGA_ARMOUR_D (player 2)", "U_BATTLEWAGON_G (player 2)"]
Main: Deployment phase - all_units_deployed: false button_disabled: true
[2025-11-29 14:37:16] [INFO.0000000] Deployment button state | Context: {"all_deployed":false,"button_disabled":true}
Main: Phase button configured - text: 'End Deployment' visible: true disabled: true
[2025-11-29 14:37:16] [INFO.0000000] Phase button configured | Context: {"disabled":true,"text":"End Deployment","visible":true}
Main: Connected phase action button to _on_phase_action_pressed
Main: ⚠️ VERIFICATION - Button connected: true
[2025-11-29 14:37:16] [INFO.0000000] Phase button signal connected | Context: {"connection_verified":true,"is_now_connected":true,"was_previously_connected":false}
WARNING: MovementActions container not found!
GameState: ⚠️ all_units_deployed check - Undeployed units: ["U_BLADE_CHAMPION_A (player 1)", "U_WITCHSEEKERS_C (player 1)", "U_CALADIUS_GRAV-TANK_E (player 1)", "U_WARBOSS_B (player 2)", "U_WARBOSS_IN_MEGA_ARMOUR_D (player 2)", "U_BATTLEWAGON_G (player 2)"]
UnitStatsPanel: Populating unit lists for phase: DEPLOYMENT
UnitStatsPanel: Populated 3 units for player (player 1)
UnitStatsPanel: Populated 3 units for enemy (player 2)
Refreshed bottom panel unit lists for phase: DEPLOYMENT
Refreshing right panel unit list for deployment - found 3 undeployed units
GameState: ⚠️ all_units_deployed check - Undeployed units: ["U_BLADE_CHAMPION_A (player 1)", "U_WITCHSEEKERS_C (player 1)", "U_CALADIUS_GRAV-TANK_E (player 1)", "U_WARBOSS_B (player 2)", "U_WARBOSS_IN_MEGA_ARMOUR_D (player 2)", "U_BATTLEWAGON_G (player 2)"]
Main: ⚠️ update_ui() - DEPLOYMENT phase - all_deployed: false
Main: ⚠️ Button state BEFORE change - disabled: true text: 'End Deployment'
[2025-11-29 14:37:16] [INFO.0000000] update_ui deployment check | Context: {"all_deployed":false,"button_text":"End Deployment","current_button_disabled":true}
Main: ⚠️ update_ui() - Setting button DISABLED (not all deployed)
Main: ⚠️ Button state AFTER disable - disabled: true
Main: ⚠️ Initial phase UI setup complete
Quick Save/Load enabled: [ key to save, ] key (or F9) to load
[Test] Action completed: success=true, message=Game state retrieved
[Test Artifacts] Report saved: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_artifacts/reports/unknown_test_2025-11-29T14-37-16.json
[GameInstance] Terminating instance: Host
[LogMonitor] Stopped monitoring: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251129_143650.log
[GameInstance] Terminating instance: Client
[LogMonitor] Stopped monitoring: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251129_143703.log

========================================
Starting Multiplayer Integration Test
========================================

  Running: test_deployment_undo_action

[TEST] test_deployment_undo_action
[Test] Launching host and client instances...
[GameInstance] Launching Host instance on port 8000
[GameInstance] Using project path: /Users/robertocallaghan/Documents/claude/godotv2/40k/
Godot Engine v4.5.1.stable.official.f62fdbde1 - https://godotengine.org
OpenGL API 4.1 INTEL-18.8.6 - Compatibility - Using Device: Intel Inc. - Intel(R) Iris(TM) Graphics 6100

TestModeHandler: Args -> ["--test-mode", "--position=100,100", "--resolution=600x480", "--auto-host", "--port=8000", "--instance-name=Host"]
[LogMonitor] Started monitoring: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251129_143709.log
[GameInstance] Monitoring log file: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251129_143709.log
[GameInstance] Successfully launched Host (PID: 87121)
[Test] Host instance launched successfully on port 8000
========================================
   RUNNING IN TEST MODE
   Config: { "window_position": (100, 100), "window_size": (600, 480), "is_host": true, "port": 8000, "instance_name": "Host" }
========================================
TestModeHandler: Command directories ready
  Commands: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_commands/commands
  Results: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_commands/results
[2025-11-29 14:37:20] [INFO.0000000] DebugLogger initialized - Session: 20251129_143720
[2025-11-29 14:37:20] [INFO.0000000] Log file: user://logs/debug_20251129_143720.log
[2025-11-29 14:37:20] [INFO.0000000] Real path: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251129_143720.log
[MeasuringTapeManager] Save persistence: false
Found armies in res://: ["orks", "adeptus_custodes", "space_marines", "A_C_test", "ORK_test"]
ArmyListManager initialized with 5 armies: ["orks", "adeptus_custodes", "space_marines", "A_C_test", "ORK_test"]
[2025-11-29 14:37:20] [INFO.0000000] DebugManager initialized
GameState: Loading default armies...
GameState: ArmyListManager not available, falling back to placeholder armies
GameState: Initializing placeholder armies for both players
GameState: Initializing placeholder army for player 1
GameState: Initializing placeholder army for player 2
ActionLogger: Started session 20251129_143720
StateSerializer: Pretty print enabled: true
SaveLoadManager: Current res:// directory: res://
SaveLoadManager: Project directory path: /Users/robertocallaghan/Documents/claude/godotv2/40k/
SaveLoadManager: Initialized save directories in project folder
SaveLoadManager: Save files will be stored at: /Users/robertocallaghan/Documents/claude/godotv2/40k/saves/
[PhaseManager] Ready - awaiting explicit phase initialization
[TerrainManager] Initializing terrain system
[TerrainManager] Added walls to terrain pieces
[TerrainManager] Loaded 12 terrain pieces
[EnhancedLineOfSight] Initialized
MissionManager: Initializing mission system
MissionManager: Set up 5 objectives for Strike Force deployment
  - obj_center at position (880.0, 1200.0)
  - obj_tl at position (400.0, 560.0)
  - obj_tr at position (1360.0, 560.0)
  - obj_bl at position (400.0, 1840.0)
  - obj_br at position (1360.0, 1840.0)
MissionManager: Initialized Take and Hold mission
[MeasuringTapeManager] Initialized with save_persistence: false
[LineOfSightManager] Initialized - Hold 'V' to check what can see the cursor position
TransportManager initialized
NetworkManager: Initialized
MainMenu: Initializing main menu
MainMenu: Loaded 5 armies: ["A C Test", "Adeptus Custodes", "ORK Test", "Orks", "Space Marines"]
MainMenu: Dropdowns populated with 5 armies
MainMenu: Multiplayer button visible: true
MainMenu: Signals connected
MainMenu: Save/Load dialog setup complete
MainMenu: Default armies set - Player 1: A C Test, Player 2: ORK Test
MainMenu: Ready with default selections
TestModeHandler: Set window position to (100, 100)
TestModeHandler: Set window size to (600, 480)
TestModeHandler: Scheduling auto-host...
SaveLoadDialog: Checking node references...
  - save_button path: VBoxContainer/SaveSection/SaveInputContainer/SaveButton
  - save_name_input path: VBoxContainer/SaveSection/SaveInputContainer/SaveNameInput
  - saves_list path: VBoxContainer/LoadSection/SavesScrollContainer/SavesList
  - load_button path: VBoxContainer/LoadSection/LoadButtonContainer/LoadButton
SaveLoadDialog: Connected save button
SaveLoadDialog: Connected save input
SaveLoadDialog: Connected saves list
SaveLoadDialog: Connected load button
SaveLoadDialog: Connected delete button
SaveLoadDialog: Connected cancel button
SaveLoadDialog UI signals connected
SaveLoadDialog: Found 29 save files
SaveLoadDialog: Populated list with 29 save files
SaveLoadDialog initialized successfully
[GameInstance] Launching Client instance on port 7778
[GameInstance] Using project path: /Users/robertocallaghan/Documents/claude/godotv2/40k/
TestModeHandler: Current scene: MainMenu
TestModeHandler: Triggering multiplayer mode...
MainMenu: Multiplayer button pressed
MultiplayerLobby: Army selection initialized with 5 armies
MultiplayerLobby: Ready
Godot Engine v4.5.1.stable.official.f62fdbde1 - https://godotengine.org
OpenGL API 4.1 INTEL-18.8.6 - Compatibility - Using Device: Intel Inc. - Intel(R) Iris(TM) Graphics 6100

TestModeHandler: Args -> ["--test-mode", "--position=800,100", "--resolution=600x480", "--auto-join", "--host-ip=127.0.0.1", "--host-port=8000", "--instance-name=Client"]
TestModeHandler: Lobby scene: MultiplayerLobby
TestModeHandler: Creating host on port 8000
MultiplayerLobby: Host button pressed
========================================
   YOU ARE: PLAYER 1 (HOST)
   Hosting on port: 7777
========================================
MultiplayerLobby: Successfully hosting on port 7777
TestModeHandler: Waiting for client to connect...
TestModeHandler: Listening for peer connection...
[LogMonitor] Started monitoring: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251129_143720.log
[GameInstance] Monitoring log file: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251129_143720.log
[GameInstance] Successfully launched Client (PID: 87134)
[Test] Client instance launched successfully
[Test] Waiting for client to connect to host...
[Test] Host performing action: get_game_state with params: {  }
[Test] Writing command file: host_87121_cmd_001.json
[Test] Waiting for result file...
[Test] Polling for result file: host_87121_cmd_001_result.json
TestModeHandler: Processing command file host_87121_cmd_001.json
TestModeHandler: Executing command from file: host_87121_cmd_001.json
TestModeHandler: Executing action: get_game_state
TestModeHandler: Handling get_game_state action
TestModeHandler: get_game_state - Phase: Deployment, Turn: 0, Player: 0
TestModeHandler: Result written to: host_87121_cmd_001_result.json
TestModeHandler: Command executed and result written
[Test] Result file found!
[Test] Action completed: success=true, message=Game state retrieved
[Test] Connection verified - action simulation working!
========================================
   RUNNING IN TEST MODE
   Config: { "window_position": (800, 100), "window_size": (600, 480), "is_host": false, "host_ip": "127.0.0.1", "host_port": 8000, "instance_name": "Client" }
========================================
TestModeHandler: Command directories ready
  Commands: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_commands/commands
  Results: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_commands/results
[2025-11-29 14:37:25] [INFO.0000000] DebugLogger initialized - Session: 20251129_143725
[2025-11-29 14:37:25] [INFO.0000000] Log file: user://logs/debug_20251129_143725.log
[2025-11-29 14:37:25] [INFO.0000000] Real path: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251129_143725.log
[MeasuringTapeManager] Save persistence: false
Found armies in res://: ["orks", "adeptus_custodes", "space_marines", "A_C_test", "ORK_test"]
ArmyListManager initialized with 5 armies: ["orks", "adeptus_custodes", "space_marines", "A_C_test", "ORK_test"]
[2025-11-29 14:37:25] [INFO.0000000] DebugManager initialized
GameState: Loading default armies...
GameState: ArmyListManager not available, falling back to placeholder armies
GameState: Initializing placeholder armies for both players
GameState: Initializing placeholder army for player 1
GameState: Initializing placeholder army for player 2
ActionLogger: Started session 20251129_143725
StateSerializer: Pretty print enabled: true
SaveLoadManager: Current res:// directory: res://
SaveLoadManager: Project directory path: /Users/robertocallaghan/Documents/claude/godotv2/40k/
SaveLoadManager: Initialized save directories in project folder
SaveLoadManager: Save files will be stored at: /Users/robertocallaghan/Documents/claude/godotv2/40k/saves/
[PhaseManager] Ready - awaiting explicit phase initialization
[TerrainManager] Initializing terrain system
[TerrainManager] Added walls to terrain pieces
[TerrainManager] Loaded 12 terrain pieces
[EnhancedLineOfSight] Initialized
MissionManager: Initializing mission system
MissionManager: Set up 5 objectives for Strike Force deployment
  - obj_center at position (880.0, 1200.0)
  - obj_tl at position (400.0, 560.0)
  - obj_tr at position (1360.0, 560.0)
  - obj_bl at position (400.0, 1840.0)
  - obj_br at position (1360.0, 1840.0)
MissionManager: Initialized Take and Hold mission
[MeasuringTapeManager] Initialized with save_persistence: false
[LineOfSightManager] Initialized - Hold 'V' to check what can see the cursor position
TransportManager initialized
NetworkManager: Initialized
MainMenu: Initializing main menu
MainMenu: Loaded 5 armies: ["A C Test", "Adeptus Custodes", "ORK Test", "Orks", "Space Marines"]
MainMenu: Dropdowns populated with 5 armies
MainMenu: Multiplayer button visible: true
MainMenu: Signals connected
MainMenu: Save/Load dialog setup complete
MainMenu: Default armies set - Player 1: A C Test, Player 2: ORK Test
MainMenu: Ready with default selections
TestModeHandler: Set window position to (800, 100)
TestModeHandler: Set window size to (600, 480)
TestModeHandler: Scheduling auto-join...
SaveLoadDialog: Checking node references...
  - save_button path: VBoxContainer/SaveSection/SaveInputContainer/SaveButton
  - save_name_input path: VBoxContainer/SaveSection/SaveInputContainer/SaveNameInput
  - saves_list path: VBoxContainer/LoadSection/SavesScrollContainer/SavesList
  - load_button path: VBoxContainer/LoadSection/LoadButtonContainer/LoadButton
SaveLoadDialog: Connected save button
SaveLoadDialog: Connected save input
SaveLoadDialog: Connected saves list
SaveLoadDialog: Connected load button
SaveLoadDialog: Connected delete button
SaveLoadDialog: Connected cancel button
SaveLoadDialog UI signals connected
SaveLoadDialog: Found 29 save files
SaveLoadDialog: Populated list with 29 save files
SaveLoadDialog initialized successfully
TestModeHandler: Current scene: MainMenu
TestModeHandler: Triggering multiplayer mode...
MainMenu: Multiplayer button pressed
MultiplayerLobby: Army selection initialized with 5 armies
MultiplayerLobby: Ready
[Test] Host performing action: get_available_units with params: {  }
[Test] Writing command file: host_87121_cmd_002.json
[Test] Waiting for result file...
[Test] Polling for result file: host_87121_cmd_002_result.json
TestModeHandler: Processing command file host_87121_cmd_002.json
TestModeHandler: Executing command from file: host_87121_cmd_002.json
TestModeHandler: Executing action: get_available_units
TestModeHandler: Handling get_available_units action
TestModeHandler: Player 1 units: ["U_INTERCESSORS_A", "U_TACTICAL_A"] (undeployed: ["U_INTERCESSORS_A", "U_TACTICAL_A"])
TestModeHandler: Player 2 units: ["U_BOYZ_A", "U_GRETCHIN_A"] (undeployed: ["U_BOYZ_A", "U_GRETCHIN_A"])
TestModeHandler: Result written to: host_87121_cmd_002_result.json
TestModeHandler: Command executed and result written
[Test] Result file found!
[Test] Action completed: success=true, message=Available units retrieved
[Test] Host performing action: deploy_unit with params: { "unit_id": "U_INTERCESSORS_A", "position": { "x": 100.0, "y": 100.0 } }
[Test] Writing command file: host_87121_cmd_003.json
[Test] Waiting for result file...
[Test] Polling for result file: host_87121_cmd_003_result.json
TestModeHandler: Processing command file host_87121_cmd_003.json
TestModeHandler: Executing command from file: host_87121_cmd_003.json
TestModeHandler: Executing action: deploy_unit
TestModeHandler: Handling deploy_unit action
GameManager: deploy_unit() called - unit_id: U_INTERCESSORS_A, position: (100.0, 100.0)
GameManager: Total units in GameState: 4
GameManager: Unit IDs: ["U_INTERCESSORS_A", "U_TACTICAL_A", "U_BOYZ_A", "U_GRETCHIN_A"]
GameManager: Switching active player from 1 to 2
GameManager: Applying result with 12 changes/diffs
GameManager: Setting units.U_INTERCESSORS_A.models.0.position = { "x": 100.0, "y": 100.0 }
GameManager: Setting units.U_INTERCESSORS_A.models.0.rotation = 0.0
GameManager: Setting units.U_INTERCESSORS_A.models.1.position = { "x": 100.0, "y": 100.0 }
GameManager: Setting units.U_INTERCESSORS_A.models.1.rotation = 0.0
GameManager: Setting units.U_INTERCESSORS_A.models.2.position = { "x": 100.0, "y": 100.0 }
GameManager: Setting units.U_INTERCESSORS_A.models.2.rotation = 0.0
GameManager: Setting units.U_INTERCESSORS_A.models.3.position = { "x": 100.0, "y": 100.0 }
GameManager: Setting units.U_INTERCESSORS_A.models.3.rotation = 0.0
GameManager: Setting units.U_INTERCESSORS_A.models.4.position = { "x": 100.0, "y": 100.0 }
GameManager: Setting units.U_INTERCESSORS_A.models.4.rotation = 0.0
GameManager: Setting units.U_INTERCESSORS_A.status = 2
GameManager: Setting meta.active_player = 2
GameManager: deploy_unit() result: success=true
TestModeHandler: Result written to: host_87121_cmd_003_result.json
TestModeHandler: Command executed and result written
[Test] Result file found!
[Test] Action completed: success=true, message=Unit deployed successfully
TestModeHandler: Lobby scene: MultiplayerLobby
TestModeHandler: Joining host at 127.0.0.1
MultiplayerLobby: Join button pressed
NetworkManager: Connecting to 127.0.0.1:7777
MultiplayerLobby: Attempting to join 127.0.0.1:7777
NetworkManager: Peer connected - 1
NetworkManager: Successfully connected to host
NetworkManager: Client set peer_to_player_map[452218089] = 2
========================================
   YOU ARE: PLAYER 2 (CLIENT)
   Connected to host
========================================
MultiplayerLobby: Peer connected - 1
MultiplayerLobby: Game started signal received
NetworkManager: Peer connected - 452218089
[GameState] MeasuringTapeManager not available
MultiplayerLobby: Peer connected - 452218089
TestModeHandler: Client connected!
MultiplayerLobby: Game started signal received
NetworkManager: Receiving initial state from host
[GameState] No measuring_tape data in save
NetworkManager: State synchronized
MultiplayerLobby: Game started signal received
MultiplayerLobby: Syncing army selection - Player 1 -> A_C_test
MultiplayerLobby: Syncing army selection - Player 2 -> ORK_test
[Test] Host performing action: undo_deployment with params: {  }
[Test] Writing command file: host_87121_cmd_004.json
[Test] Waiting for result file...
[Test] Polling for result file: host_87121_cmd_004_result.json
TestModeHandler: Processing command file host_87121_cmd_004.json
TestModeHandler: Executing command from file: host_87121_cmd_004.json
TestModeHandler: Executing action: undo_deployment
TestModeHandler: Handling undo_deployment action
GameManager: undo_last_action() called
WARNING: GameManager: No actions to undo
     at: push_warning (core/variant/variant_utility.cpp:1034)
     GDScript backtrace (most recent call first):
         [0] undo_last_action (res://autoloads/GameManager.gd:753)
         [1] _handle_undo_deployment (res://autoloads/TestModeHandler.gd:656)
         [2] _execute_command (res://autoloads/TestModeHandler.gd:438)
         [3] _execute_command_file (res://autoloads/TestModeHandler.gd:415)
         [4] _check_for_commands (res://autoloads/TestModeHandler.gd:386)
         [5] _process (res://autoloads/TestModeHandler.gd:372)
TestModeHandler: Result written to: host_87121_cmd_004_result.json
TestModeHandler: Command executed and result written
[Test] Result file found!
[Test] Action completed: success=false, message=No action to undo
[TEST] Undo result: success=false message=No action to undo
TestModeHandler: Starting game...
MultiplayerLobby: Start game button pressed
MultiplayerLobby: Loading armies...
MultiplayerLobby: Loading A_C_test for Player 1
Loading army list: A_C_test for player 1
Processed unit: U_BLADE_CHAMPION_A for player 1
Processed unit: U_WITCHSEEKERS_C for player 1
Processed unit: U_CALADIUS_GRAV-TANK_E for player 1
Successfully loaded army: A_C_test with 3 units
MultiplayerLobby: Player 1 army loaded, has 3 units
Applying army to game state for player: 1
Removing 0 existing units for player 1
Added unit: U_BLADE_CHAMPION_A (Blade Champion)
Added unit: U_WITCHSEEKERS_C (Witchseekers)
Added unit: U_CALADIUS_GRAV-TANK_E (Caladius Grav-tank)
Set faction for player 1: Adeptus Custodes
Army applied successfully. Total units in game: 3
MultiplayerLobby: After applying P1 army, GameState has 3 units
MultiplayerLobby: Loading ORK_test for Player 2
Loading army list: ORK_test for player 2
Processed unit: U_WARBOSS_B for player 2
Processed unit: U_WARBOSS_IN_MEGA_ARMOUR_D for player 2
[2025-11-29 14:37:30] [DEBUG.0000000] Parsed transport capacity keywords | Context: {"description":"This model has a transport capacity of 22 ORKS INFANTRY models. Each MEGA ARMOUR model takes up the space of 2 models. This model cannot transport models that are JUMP PACK models.","keywords":["ORKS","INFANTRY"],"unit_id":"U_BATTLEWAGON_G"}
Processed unit: U_BATTLEWAGON_G for player 2
Successfully loaded army: ORK_test with 3 units
MultiplayerLobby: Player 2 army loaded, has 3 units
Applying army to game state for player: 2
Removing 0 existing units for player 2
Added unit: U_WARBOSS_B (Warboss)
Added unit: U_WARBOSS_IN_MEGA_ARMOUR_D (Warboss in Mega Armour)
Added unit: U_BATTLEWAGON_G (Battlewagon)
Set faction for player 2: Unknown
Army applied successfully. Total units in game: 6
MultiplayerLobby: After applying P2 army, GameState has 6 units
MultiplayerLobby: Armies loaded. Total units: 6
MultiplayerLobby: Syncing loaded armies to clients...
[GameState] MeasuringTapeManager not available
MultiplayerLobby: Snapshot has 6 units
MultiplayerLobby: Sent army snapshot to peer 452218089
NetworkManager: Receiving initial state from host
[GameState] No measuring_tape data in save
NetworkManager: State synchronized
MultiplayerLobby: Game started signal received
NetworkManager: Starting multiplayer game - transitioning to Main scene
NetworkManager: Units in GameState BEFORE scene change: 6
NetworkManager: Unit IDs: ["U_BLADE_CHAMPION_A", "U_WITCHSEEKERS_C", "U_CALADIUS_GRAV-TANK_E", "U_WARBOSS_B", "U_WARBOSS_IN_MEGA_ARMOUR_D", "U_BATTLEWAGON_G"]
NetworkManager: Starting multiplayer game - transitioning to Main scene
NetworkManager: Units in GameState BEFORE scene change: 6
NetworkManager: Unit IDs: ["U_BLADE_CHAMPION_A", "U_WITCHSEEKERS_C", "U_CALADIUS_GRAV-TANK_E", "U_WARBOSS_B", "U_WARBOSS_IN_MEGA_ARMOUR_D", "U_BATTLEWAGON_G"]
[TEST] Undo test completed

========================================
Cleaning up Multiplayer Test
========================================

[Test] Host performing action: get_game_state with params: {  }
[Test] Writing command file: host_87121_cmd_005.json
[Test] Waiting for result file...
[Test] Polling for result file: host_87121_cmd_005_result.json
MultiplayerLobby: Game started signal received
TestModeHandler: Processing command file host_87121_cmd_005.json
TestModeHandler: Executing command from file: host_87121_cmd_005.json
TestModeHandler: Executing action: get_game_state
TestModeHandler: Handling get_game_state action
TestModeHandler: get_game_state - Phase: Deployment, Turn: 0, Player: 0
TestModeHandler: Result written to: host_87121_cmd_005_result.json
TestModeHandler: Command executed and result written
MultiplayerLobby: Game started signal received
MultiplayerLobby: Game start RPC sent to all peers
[Test] Result file found!
[Test] Action completed: success=true, message=Game state retrieved
[Test Artifacts] Report saved: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_artifacts/reports/unknown_test_2025-11-29T14-37-31.json
[GameInstance] Terminating instance: Host
[LogMonitor] Stopped monitoring: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251129_143709.log
[GameInstance] Terminating instance: Client
[LogMonitor] Stopped monitoring: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251129_143720.log
Running tests in: res://tests/integration//test_assault_keyword_integration.gd
  Running: test_validate_shoot_allows_assault_weapon_after_advance
  Running: test_validate_shoot_blocks_non_assault_weapon_after_advance
  Running: test_validate_shoot_allows_all_weapons_without_advance
  Running: test_validate_shoot_blocks_fell_back_unit
  Running: test_is_assault_weapon_function
  Running: test_unit_has_assault_weapons_function
Running tests in: res://tests/integration//test_heavy_keyword_integration.gd
  Running: test_heavy_bonus_applied_when_unit_remained_stationary
SCRIPT ERROR: Invalid operands 'int' and 'bool' in operator '=='.
          at: assert_true (res://addons/gut/test.gd:37)
          GDScript backtrace (most recent call first):
              [0] assert_true (res://addons/gut/test.gd:37)
              [1] test_heavy_bonus_applied_when_unit_remained_stationary (res://tests/integration/test_heavy_keyword_integration.gd:280)
              [2] run_test_file (res://addons/gut/gut_cmdln.gd:154)
              [3] run_tests (res://addons/gut/gut_cmdln.gd:81)
              [4] _init (res://addons/gut/gut_cmdln.gd:15)
  Running: test_heavy_bonus_not_applied_when_unit_moved
  Running: test_heavy_bonus_not_applied_to_non_heavy_weapon
SCRIPT ERROR: Invalid operands 'int' and 'bool' in operator '=='.
          at: assert_false (res://addons/gut/test.gd:40)
          GDScript backtrace (most recent call first):
              [0] assert_false (res://addons/gut/test.gd:40)
              [1] test_heavy_bonus_not_applied_to_non_heavy_weapon (res://tests/integration/test_heavy_keyword_integration.gd:302)
              [2] run_test_file (res://addons/gut/gut_cmdln.gd:154)
              [3] run_tests (res://addons/gut/gut_cmdln.gd:81)
              [4] _init (res://addons/gut/gut_cmdln.gd:15)
  Running: test_heavy_bonus_not_applied_when_remained_stationary_flag_not_set
  Running: test_heavy_bonus_capped_at_plus_one
  Running: test_heavy_bonus_cancels_with_minus_one
  Running: test_heavy_bonus_with_additional_plus_one_still_capped
  Running: test_is_heavy_weapon_function
  Running: test_unit_has_heavy_weapons_function
  Running: test_remained_stationary_flag_lifecycle
  Running: test_moved_and_remained_stationary_mutually_exclusive

=== Test Results ===
Total: 60, Passed: 57, Failed: 3
TestModeHandler: Args -> ["-s", "addons/gut/gut_cmdln.gd", "-gdir", "res://tests/integration/", "-gprefix", "test_", "-gsuffix", ".gd", "-gexit"]
[2025-11-29 14:37:35] [INFO.0000000] DebugLogger initialized - Session: 20251129_143735
[2025-11-29 14:37:35] [INFO.0000000] Log file: user://logs/debug_20251129_143735.log
[2025-11-29 14:37:35] [INFO.0000000] Real path: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251129_143735.log
[MeasuringTapeManager] Save persistence: false
Found armies in res://: ["orks", "adeptus_custodes", "space_marines", "A_C_test", "ORK_test"]
ArmyListManager initialized with 5 armies: ["orks", "adeptus_custodes", "space_marines", "A_C_test", "ORK_test"]
[2025-11-29 14:37:35] [INFO.0000000] DebugManager initialized
GameState: Loading default armies...
GameState: ArmyListManager not available, falling back to placeholder armies
GameState: Initializing placeholder armies for both players
GameState: Initializing placeholder army for player 1
GameState: Initializing placeholder army for player 2
ActionLogger: Started session 20251129_143735
StateSerializer: Pretty print enabled: true
SaveLoadManager: Current res:// directory: res://
SaveLoadManager: Project directory path: /Users/robertocallaghan/Documents/claude/godotv2/40k/
SaveLoadManager: Initialized save directories in project folder
SaveLoadManager: Save files will be stored at: /Users/robertocallaghan/Documents/claude/godotv2/40k/saves/
[PhaseManager] Ready - awaiting explicit phase initialization
[TerrainManager] Initializing terrain system
[TerrainManager] Added walls to terrain pieces
[TerrainManager] Loaded 12 terrain pieces
[EnhancedLineOfSight] Initialized
MissionManager: Initializing mission system
MissionManager: Set up 5 objectives for Strike Force deployment
  - obj_center at position (880.0, 1200.0)
  - obj_tl at position (400.0, 560.0)
  - obj_tr at position (1360.0, 560.0)
  - obj_bl at position (400.0, 1840.0)
  - obj_br at position (1360.0, 1840.0)
MissionManager: Initialized Take and Hold mission
[MeasuringTapeManager] Initialized with save_persistence: false
[LineOfSightManager] Initialized - Hold 'V' to check what can see the cursor position
TransportManager initialized
NetworkManager: Initialized
[2025-11-29 14:37:35] [INFO.0000000] DebugLogger shutting down - Session: 20251129_143735
