Godot Engine v4.5.1.stable.official.f62fdbde1 - https://godotengine.org

DEBUG: System args: ["-s", "addons/gut/gut_cmdln.gd", "-gdir", "res://tests/integration/", "-gprefix", "test_", "-gsuffix", ".gd", "-gexit"]
DEBUG: User args: []
DEBUG: Combined args: ["-s", "addons/gut/gut_cmdln.gd", "-gdir", "res://tests/integration/", "-gprefix", "test_", "-gsuffix", ".gd", "-gexit"]
DEBUG: Processing arg[0]: '-s'
DEBUG: Processing arg[1]: 'addons/gut/gut_cmdln.gd'
DEBUG: Processing arg[2]: '-gdir'
DEBUG: Processing arg[3]: 'res://tests/integration/'
DEBUG: Processing arg[4]: '-gprefix'
DEBUG: Processing arg[5]: 'test_'
DEBUG: Processing arg[6]: '-gsuffix'
DEBUG: Processing arg[7]: '.gd'
DEBUG: Processing arg[8]: '-gexit'
=== GUT Test Runner ===
DEBUG: specific_test_file = ''
DEBUG: specific_test_method = ''
DEBUG: Found 3 test files
Running tests in: res://tests/integration//test_multiplayer_deployment.gd

========================================
Starting Multiplayer Integration Test
========================================

  Running: test_basic_multiplayer_connection

[TEST] test_basic_multiplayer_connection
[Test] Launching host and client instances...
[GameInstance] Launching Host instance on port 8000
[GameInstance] Using project path: /Users/robertocallaghan/Documents/claude/godotv2/40k/
Godot Engine v4.5.1.stable.official.f62fdbde1 - https://godotengine.org
OpenGL API 4.1 INTEL-18.8.6 - Compatibility - Using Device: Intel Inc. - Intel(R) Iris(TM) Graphics 6100

TestModeHandler: Args -> ["--test-mode", "--position=100,100", "--resolution=600x480", "--auto-host", "--port=8000", "--instance-name=Host"]
[LogMonitor] Started monitoring: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251127_200638.log
[GameInstance] Monitoring log file: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251127_200638.log
[GameInstance] Successfully launched Host (PID: 75092)
[Test] Host instance launched successfully on port 8000
========================================
   RUNNING IN TEST MODE
   Config: { "window_position": (100, 100), "window_size": (600, 480), "is_host": true, "port": 8000, "instance_name": "Host" }
========================================
TestModeHandler: Command directories ready
  Commands: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_commands/commands
  Results: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_commands/results
[2025-11-27 20:08:14] [INFO.0000000] DebugLogger initialized - Session: 20251127_200814
[2025-11-27 20:08:14] [INFO.0000000] Log file: user://logs/debug_20251127_200814.log
[2025-11-27 20:08:14] [INFO.0000000] Real path: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251127_200814.log
[MeasuringTapeManager] Save persistence: false
Found armies in res://: ["orks", "adeptus_custodes", "space_marines", "A_C_test", "ORK_test"]
ArmyListManager initialized with 5 armies: ["orks", "adeptus_custodes", "space_marines", "A_C_test", "ORK_test"]
[2025-11-27 20:08:14] [INFO.0000000] DebugManager initialized
GameState: Loading default armies...
GameState: ArmyListManager not available, falling back to placeholder armies
GameState: Initializing placeholder armies for both players
GameState: Initializing placeholder army for player 1
GameState: Initializing placeholder army for player 2
ActionLogger: Started session 20251127_200814
StateSerializer: Pretty print enabled: true
SaveLoadManager: Current res:// directory: res://
SaveLoadManager: Project directory path: /Users/robertocallaghan/Documents/claude/godotv2/40k/
SaveLoadManager: Initialized save directories in project folder
SaveLoadManager: Save files will be stored at: /Users/robertocallaghan/Documents/claude/godotv2/40k/saves/
[PhaseManager] Ready - awaiting explicit phase initialization
[TerrainManager] Initializing terrain system
[TerrainManager] Added walls to terrain pieces
[TerrainManager] Loaded 12 terrain pieces
[EnhancedLineOfSight] Initialized
MissionManager: Initializing mission system
MissionManager: Set up 5 objectives for Strike Force deployment
  - obj_center at position (880.0, 1200.0)
  - obj_tl at position (400.0, 560.0)
  - obj_tr at position (1360.0, 560.0)
  - obj_bl at position (400.0, 1840.0)
  - obj_br at position (1360.0, 1840.0)
MissionManager: Initialized Take and Hold mission
[MeasuringTapeManager] Initialized with save_persistence: false
[LineOfSightManager] Initialized - Hold 'V' to check what can see the cursor position
TransportManager initialized
NetworkManager: Initialized
MainMenu: Initializing main menu
MainMenu: Loaded 5 armies: ["A C Test", "Adeptus Custodes", "ORK Test", "Orks", "Space Marines"]
MainMenu: Dropdowns populated with 5 armies
MainMenu: Multiplayer button visible: true
MainMenu: Signals connected
MainMenu: Save/Load dialog setup complete
MainMenu: Default armies set - Player 1: A C Test, Player 2: ORK Test
MainMenu: Ready with default selections
TestModeHandler: Set window position to (100, 100)
TestModeHandler: Set window size to (600, 480)
TestModeHandler: Scheduling auto-host...
SaveLoadDialog: Checking node references...
  - save_button path: VBoxContainer/SaveSection/SaveInputContainer/SaveButton
  - save_name_input path: VBoxContainer/SaveSection/SaveInputContainer/SaveNameInput
  - saves_list path: VBoxContainer/LoadSection/SavesScrollContainer/SavesList
  - load_button path: VBoxContainer/LoadSection/LoadButtonContainer/LoadButton
SaveLoadDialog: Connected save button
SaveLoadDialog: Connected save input
SaveLoadDialog: Connected saves list
SaveLoadDialog: Connected load button
SaveLoadDialog: Connected delete button
SaveLoadDialog: Connected cancel button
SaveLoadDialog UI signals connected
SaveLoadDialog: Found 29 save files
SaveLoadDialog: Populated list with 29 save files
SaveLoadDialog initialized successfully
TestModeHandler: Current scene: MainMenu
TestModeHandler: Triggering multiplayer mode...
MainMenu: Multiplayer button pressed
MultiplayerLobby: Army selection initialized with 5 armies
MultiplayerLobby: Ready
[GameInstance] Launching Client instance on port 7778
[GameInstance] Using project path: /Users/robertocallaghan/Documents/claude/godotv2/40k/
Godot Engine v4.5.1.stable.official.f62fdbde1 - https://godotengine.org
TestModeHandler: Lobby scene: MultiplayerLobby
TestModeHandler: Creating host on port 8000
MultiplayerLobby: Host button pressed
========================================
   YOU ARE: PLAYER 1 (HOST)
   Hosting on port: 7777
========================================
MultiplayerLobby: Successfully hosting on port 7777
TestModeHandler: Waiting for client to connect...
TestModeHandler: Listening for peer connection...
OpenGL API 4.1 INTEL-18.8.6 - Compatibility - Using Device: Intel Inc. - Intel(R) Iris(TM) Graphics 6100

TestModeHandler: Args -> ["--test-mode", "--position=800,100", "--resolution=600x480", "--auto-join", "--host-ip=127.0.0.1", "--host-port=8000", "--instance-name=Client"]
[LogMonitor] Started monitoring: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251127_200814.log
[GameInstance] Monitoring log file: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251127_200814.log
[GameInstance] Successfully launched Client (PID: 75099)
[Test] Client instance launched successfully
[Test] Waiting for client to connect to host...
========================================
   RUNNING IN TEST MODE
   Config: { "window_position": (800, 100), "window_size": (600, 480), "is_host": false, "host_ip": "127.0.0.1", "host_port": 8000, "instance_name": "Client" }
========================================
TestModeHandler: Command directories ready
  Commands: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_commands/commands
  Results: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_commands/results
[2025-11-27 20:08:20] [INFO.0000000] DebugLogger initialized - Session: 20251127_200820
[2025-11-27 20:08:20] [INFO.0000000] Log file: user://logs/debug_20251127_200820.log
[2025-11-27 20:08:20] [INFO.0000000] Real path: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251127_200820.log
[MeasuringTapeManager] Save persistence: false
Found armies in res://: ["orks", "adeptus_custodes", "space_marines", "A_C_test", "ORK_test"]
ArmyListManager initialized with 5 armies: ["orks", "adeptus_custodes", "space_marines", "A_C_test", "ORK_test"]
[2025-11-27 20:08:20] [INFO.0000000] DebugManager initialized
GameState: Loading default armies...
GameState: ArmyListManager not available, falling back to placeholder armies
GameState: Initializing placeholder armies for both players
GameState: Initializing placeholder army for player 1
GameState: Initializing placeholder army for player 2
ActionLogger: Started session 20251127_200820
StateSerializer: Pretty print enabled: true
SaveLoadManager: Current res:// directory: res://
SaveLoadManager: Project directory path: /Users/robertocallaghan/Documents/claude/godotv2/40k/
SaveLoadManager: Initialized save directories in project folder
SaveLoadManager: Save files will be stored at: /Users/robertocallaghan/Documents/claude/godotv2/40k/saves/
[PhaseManager] Ready - awaiting explicit phase initialization
[TerrainManager] Initializing terrain system
[TerrainManager] Added walls to terrain pieces
[TerrainManager] Loaded 12 terrain pieces
[EnhancedLineOfSight] Initialized
MissionManager: Initializing mission system
MissionManager: Set up 5 objectives for Strike Force deployment
  - obj_center at position (880.0, 1200.0)
  - obj_tl at position (400.0, 560.0)
  - obj_tr at position (1360.0, 560.0)
  - obj_bl at position (400.0, 1840.0)
  - obj_br at position (1360.0, 1840.0)
MissionManager: Initialized Take and Hold mission
[MeasuringTapeManager] Initialized with save_persistence: false
[LineOfSightManager] Initialized - Hold 'V' to check what can see the cursor position
TransportManager initialized
NetworkManager: Initialized
MainMenu: Initializing main menu
MainMenu: Loaded 5 armies: ["A C Test", "Adeptus Custodes", "ORK Test", "Orks", "Space Marines"]
MainMenu: Dropdowns populated with 5 armies
MainMenu: Multiplayer button visible: true
MainMenu: Signals connected
[Test] Host performing action: get_game_state with params: {  }
[Test] Writing command file: host_75092_cmd_001.json
[Test] Waiting for result file...
[Test] Polling for result file: host_75092_cmd_001_result.json
MainMenu: Save/Load dialog setup complete
MainMenu: Default armies set - Player 1: A C Test, Player 2: ORK Test
MainMenu: Ready with default selections
TestModeHandler: Processing command file host_75092_cmd_001.json
TestModeHandler: Executing command from file: host_75092_cmd_001.json
TestModeHandler: Executing action: get_game_state
TestModeHandler: Handling get_game_state action
TestModeHandler: get_game_state - Phase: Deployment, Turn: 0, Player: 0
TestModeHandler: Result written to: host_75092_cmd_001_result.json
TestModeHandler: Command executed and result written
[Test] Result file found!
[Test] Action completed: success=true, message=Game state retrieved
[Test] Connection verified - action simulation working!
[TEST] PASSED: Basic connection established

========================================
Cleaning up Multiplayer Test
========================================

[Test] Host performing action: get_game_state with params: {  }
[Test] Writing command file: host_75092_cmd_002.json
[Test] Waiting for result file...
[Test] Polling for result file: host_75092_cmd_002_result.json
TestModeHandler: Set window position to (800, 100)
TestModeHandler: Set window size to (600, 480)
TestModeHandler: Scheduling auto-join...
SaveLoadDialog: Checking node references...
  - save_button path: VBoxContainer/SaveSection/SaveInputContainer/SaveButton
  - save_name_input path: VBoxContainer/SaveSection/SaveInputContainer/SaveNameInput
  - saves_list path: VBoxContainer/LoadSection/SavesScrollContainer/SavesList
  - load_button path: VBoxContainer/LoadSection/LoadButtonContainer/LoadButton
SaveLoadDialog: Connected save button
SaveLoadDialog: Connected save input
SaveLoadDialog: Connected saves list
SaveLoadDialog: Connected load button
SaveLoadDialog: Connected delete button
SaveLoadDialog: Connected cancel button
SaveLoadDialog UI signals connected
SaveLoadDialog: Found 29 save files
SaveLoadDialog: Populated list with 29 save files
SaveLoadDialog initialized successfully
TestModeHandler: Processing command file host_75092_cmd_002.json
TestModeHandler: Executing command from file: host_75092_cmd_002.json
TestModeHandler: Executing action: get_game_state
TestModeHandler: Handling get_game_state action
TestModeHandler: get_game_state - Phase: Deployment, Turn: 0, Player: 0
TestModeHandler: Result written to: host_75092_cmd_002_result.json
TestModeHandler: Command executed and result written
[Test] Result file found!
[Test] Action completed: success=true, message=Game state retrieved
[Test Artifacts] Report saved: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_artifacts/reports/unknown_test_2025-11-27T20-08-20.json
[GameInstance] Terminating instance: Host
[LogMonitor] Stopped monitoring: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251127_200638.log
[GameInstance] Terminating instance: Client
[LogMonitor] Stopped monitoring: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251127_200814.log

========================================
Starting Multiplayer Integration Test
========================================

  Running: test_deployment_save_load

[TEST] test_deployment_save_load
[Test] Launching host and client instances...
[GameInstance] Launching Host instance on port 8000
[GameInstance] Using project path: /Users/robertocallaghan/Documents/claude/godotv2/40k/
Godot Engine v4.5.1.stable.official.f62fdbde1 - https://godotengine.org
OpenGL API 4.1 INTEL-18.8.6 - Compatibility - Using Device: Intel Inc. - Intel(R) Iris(TM) Graphics 6100

TestModeHandler: Args -> ["--test-mode", "--position=100,100", "--resolution=600x480", "--auto-host", "--port=8000", "--instance-name=Host"]
[LogMonitor] Started monitoring: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251127_200820.log
[GameInstance] Monitoring log file: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251127_200820.log
[GameInstance] Successfully launched Host (PID: 75100)
[Test] Host instance launched successfully on port 8000
========================================
   RUNNING IN TEST MODE
   Config: { "window_position": (100, 100), "window_size": (600, 480), "is_host": true, "port": 8000, "instance_name": "Host" }
========================================
TestModeHandler: Command directories ready
  Commands: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_commands/commands
  Results: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_commands/results
[2025-11-27 20:08:24] [INFO.0000000] DebugLogger initialized - Session: 20251127_200824
[2025-11-27 20:08:24] [INFO.0000000] Log file: user://logs/debug_20251127_200824.log
[2025-11-27 20:08:24] [INFO.0000000] Real path: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251127_200824.log
[MeasuringTapeManager] Save persistence: false
Found armies in res://: ["orks", "adeptus_custodes", "space_marines", "A_C_test", "ORK_test"]
ArmyListManager initialized with 5 armies: ["orks", "adeptus_custodes", "space_marines", "A_C_test", "ORK_test"]
[2025-11-27 20:08:24] [INFO.0000000] DebugManager initialized
GameState: Loading default armies...
GameState: ArmyListManager not available, falling back to placeholder armies
GameState: Initializing placeholder armies for both players
GameState: Initializing placeholder army for player 1
GameState: Initializing placeholder army for player 2
ActionLogger: Started session 20251127_200824
StateSerializer: Pretty print enabled: true
SaveLoadManager: Current res:// directory: res://
SaveLoadManager: Project directory path: /Users/robertocallaghan/Documents/claude/godotv2/40k/
SaveLoadManager: Initialized save directories in project folder
SaveLoadManager: Save files will be stored at: /Users/robertocallaghan/Documents/claude/godotv2/40k/saves/
[PhaseManager] Ready - awaiting explicit phase initialization
[TerrainManager] Initializing terrain system
[TerrainManager] Added walls to terrain pieces
[TerrainManager] Loaded 12 terrain pieces
[EnhancedLineOfSight] Initialized
MissionManager: Initializing mission system
MissionManager: Set up 5 objectives for Strike Force deployment
  - obj_center at position (880.0, 1200.0)
  - obj_tl at position (400.0, 560.0)
  - obj_tr at position (1360.0, 560.0)
  - obj_bl at position (400.0, 1840.0)
  - obj_br at position (1360.0, 1840.0)
MissionManager: Initialized Take and Hold mission
[MeasuringTapeManager] Initialized with save_persistence: false
[LineOfSightManager] Initialized - Hold 'V' to check what can see the cursor position
TransportManager initialized
NetworkManager: Initialized
MainMenu: Initializing main menu
MainMenu: Loaded 5 armies: ["A C Test", "Adeptus Custodes", "ORK Test", "Orks", "Space Marines"]
MainMenu: Dropdowns populated with 5 armies
MainMenu: Multiplayer button visible: true
MainMenu: Signals connected
MainMenu: Save/Load dialog setup complete
MainMenu: Default armies set - Player 1: A C Test, Player 2: ORK Test
MainMenu: Ready with default selections
TestModeHandler: Set window position to (100, 100)
TestModeHandler: Set window size to (600, 480)
TestModeHandler: Scheduling auto-host...
SaveLoadDialog: Checking node references...
  - save_button path: VBoxContainer/SaveSection/SaveInputContainer/SaveButton
  - save_name_input path: VBoxContainer/SaveSection/SaveInputContainer/SaveNameInput
  - saves_list path: VBoxContainer/LoadSection/SavesScrollContainer/SavesList
  - load_button path: VBoxContainer/LoadSection/LoadButtonContainer/LoadButton
SaveLoadDialog: Connected save button
SaveLoadDialog: Connected save input
SaveLoadDialog: Connected saves list
SaveLoadDialog: Connected load button
SaveLoadDialog: Connected delete button
SaveLoadDialog: Connected cancel button
SaveLoadDialog UI signals connected
SaveLoadDialog: Found 29 save files
SaveLoadDialog: Populated list with 29 save files
SaveLoadDialog initialized successfully
[GameInstance] Launching Client instance on port 7778
[GameInstance] Using project path: /Users/robertocallaghan/Documents/claude/godotv2/40k/
TestModeHandler: Current scene: MainMenu
TestModeHandler: Triggering multiplayer mode...
MainMenu: Multiplayer button pressed
MultiplayerLobby: Army selection initialized with 5 armies
MultiplayerLobby: Ready
Godot Engine v4.5.1.stable.official.f62fdbde1 - https://godotengine.org
TestModeHandler: Lobby scene: MultiplayerLobby
TestModeHandler: Creating host on port 8000
MultiplayerLobby: Host button pressed
========================================
   YOU ARE: PLAYER 1 (HOST)
   Hosting on port: 7777
========================================
MultiplayerLobby: Successfully hosting on port 7777
TestModeHandler: Waiting for client to connect...
TestModeHandler: Listening for peer connection...
OpenGL API 4.1 INTEL-18.8.6 - Compatibility - Using Device: Intel Inc. - Intel(R) Iris(TM) Graphics 6100

TestModeHandler: Args -> ["--test-mode", "--position=800,100", "--resolution=600x480", "--auto-join", "--host-ip=127.0.0.1", "--host-port=8000", "--instance-name=Client"]
[LogMonitor] Started monitoring: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251127_200824.log
[GameInstance] Monitoring log file: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251127_200824.log
[GameInstance] Successfully launched Client (PID: 75111)
[Test] Client instance launched successfully
[Test] Waiting for client to connect to host...
[Test] Host performing action: get_game_state with params: {  }
[Test] Writing command file: host_75100_cmd_001.json
[Test] Waiting for result file...
[Test] Polling for result file: host_75100_cmd_001_result.json
TestModeHandler: Processing command file host_75100_cmd_001.json
TestModeHandler: Executing command from file: host_75100_cmd_001.json
TestModeHandler: Executing action: get_game_state
TestModeHandler: Handling get_game_state action
TestModeHandler: get_game_state - Phase: Deployment, Turn: 0, Player: 0
TestModeHandler: Result written to: host_75100_cmd_001_result.json
TestModeHandler: Command executed and result written
[Test] Result file found!
[Test] Action completed: success=true, message=Game state retrieved
[Test] Connection verified - action simulation working!
========================================
   RUNNING IN TEST MODE
   Config: { "window_position": (800, 100), "window_size": (600, 480), "is_host": false, "host_ip": "127.0.0.1", "host_port": 8000, "instance_name": "Client" }
========================================
TestModeHandler: Command directories ready
  Commands: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_commands/commands
  Results: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_commands/results
[2025-11-27 20:08:31] [INFO.0000000] DebugLogger initialized - Session: 20251127_200831
[2025-11-27 20:08:31] [INFO.0000000] Log file: user://logs/debug_20251127_200831.log
[2025-11-27 20:08:31] [INFO.0000000] Real path: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251127_200831.log
[MeasuringTapeManager] Save persistence: false
Found armies in res://: ["orks", "adeptus_custodes", "space_marines", "A_C_test", "ORK_test"]
ArmyListManager initialized with 5 armies: ["orks", "adeptus_custodes", "space_marines", "A_C_test", "ORK_test"]
[2025-11-27 20:08:31] [INFO.0000000] DebugManager initialized
GameState: Loading default armies...
GameState: ArmyListManager not available, falling back to placeholder armies
GameState: Initializing placeholder armies for both players
GameState: Initializing placeholder army for player 1
GameState: Initializing placeholder army for player 2
ActionLogger: Started session 20251127_200831
StateSerializer: Pretty print enabled: true
SaveLoadManager: Current res:// directory: res://
SaveLoadManager: Project directory path: /Users/robertocallaghan/Documents/claude/godotv2/40k/
SaveLoadManager: Initialized save directories in project folder
SaveLoadManager: Save files will be stored at: /Users/robertocallaghan/Documents/claude/godotv2/40k/saves/
[PhaseManager] Ready - awaiting explicit phase initialization
[TerrainManager] Initializing terrain system
[TerrainManager] Added walls to terrain pieces
[TerrainManager] Loaded 12 terrain pieces
[EnhancedLineOfSight] Initialized
MissionManager: Initializing mission system
MissionManager: Set up 5 objectives for Strike Force deployment
  - obj_center at position (880.0, 1200.0)
  - obj_tl at position (400.0, 560.0)
  - obj_tr at position (1360.0, 560.0)
  - obj_bl at position (400.0, 1840.0)
  - obj_br at position (1360.0, 1840.0)
MissionManager: Initialized Take and Hold mission
[MeasuringTapeManager] Initialized with save_persistence: false
[LineOfSightManager] Initialized - Hold 'V' to check what can see the cursor position
TransportManager initialized
NetworkManager: Initialized
MainMenu: Initializing main menu
MainMenu: Loaded 5 armies: ["A C Test", "Adeptus Custodes", "ORK Test", "Orks", "Space Marines"]
MainMenu: Dropdowns populated with 5 armies
MainMenu: Multiplayer button visible: true
MainMenu: Signals connected
MainMenu: Save/Load dialog setup complete
MainMenu: Default armies set - Player 1: A C Test, Player 2: ORK Test
MainMenu: Ready with default selections
TestModeHandler: Set window position to (800, 100)
TestModeHandler: Set window size to (600, 480)
TestModeHandler: Scheduling auto-join...
SaveLoadDialog: Checking node references...
  - save_button path: VBoxContainer/SaveSection/SaveInputContainer/SaveButton
  - save_name_input path: VBoxContainer/SaveSection/SaveInputContainer/SaveNameInput
  - saves_list path: VBoxContainer/LoadSection/SavesScrollContainer/SavesList
  - load_button path: VBoxContainer/LoadSection/LoadButtonContainer/LoadButton
SaveLoadDialog: Connected save button
SaveLoadDialog: Connected save input
SaveLoadDialog: Connected saves list
SaveLoadDialog: Connected load button
SaveLoadDialog: Connected delete button
SaveLoadDialog: Connected cancel button
SaveLoadDialog UI signals connected
SaveLoadDialog: Found 29 save files
SaveLoadDialog: Populated list with 29 save files
SaveLoadDialog initialized successfully
[Test] Host performing action: get_game_state with params: {  }
[Test] Writing command file: host_75100_cmd_002.json
[Test] Waiting for result file...
[Test] Polling for result file: host_75100_cmd_002_result.json
TestModeHandler: Processing command file host_75100_cmd_002.json
TestModeHandler: Processing command file host_75100_cmd_002.json
TestModeHandler: Executing command from file: host_75100_cmd_002.json
TestModeHandler: Executing action: get_game_state
TestModeHandler: Handling get_game_state action
TestModeHandler: Executing command from file: host_75100_cmd_002.json
TestModeHandler: Executing action: get_game_state
TestModeHandler: get_game_state - Phase: Deployment, Turn: 0, Player: 0
TestModeHandler: Handling get_game_state action
TestModeHandler: get_game_state - Phase: Deployment, Turn: 0, Player: 0
TestModeHandler: Result written to: host_75100_cmd_002_result.json
TestModeHandler: Command executed and result written
TestModeHandler: Result written to: host_75100_cmd_002_result.json
TestModeHandler: Command executed and result written
[Test] Result file found!
[Test] Action completed: success=true, message=Game state retrieved
[Test] Client performing action: get_game_state with params: {  }
[Test] Writing command file: client_75111_cmd_001.json
[Test] Waiting for result file...
[Test] Polling for result file: client_75111_cmd_001_result.json
TestModeHandler: Processing command file client_75111_cmd_001.json
TestModeHandler: Processing command file client_75111_cmd_001.json
TestModeHandler: Executing command from file: client_75111_cmd_001.json
TestModeHandler: Executing action: get_game_state
TestModeHandler: Handling get_game_state action
TestModeHandler: Executing command from file: client_75111_cmd_001.json
TestModeHandler: get_game_state - Phase: Deployment, Turn: 0, Player: 0
TestModeHandler: Executing action: get_game_state
TestModeHandler: Handling get_game_state action
TestModeHandler: get_game_state - Phase: Deployment, Turn: 0, Player: 0
TestModeHandler: Result written to: client_75111_cmd_001_result.json
TestModeHandler: Result written to: client_75111_cmd_001_result.json
TestModeHandler: Command executed and result written
TestModeHandler: Command executed and result written
[Test] Result file found!
[Test] Action completed: success=true, message=Game state retrieved
[TEST] PASSED: Deployment save loaded and synced

========================================
Cleaning up Multiplayer Test
========================================

[Test] Host performing action: get_game_state with params: {  }
[Test] Writing command file: host_75100_cmd_003.json
[Test] Waiting for result file...
[Test] Polling for result file: host_75100_cmd_003_result.json
TestModeHandler: Processing command file host_75100_cmd_003.json
TestModeHandler: Processing command file host_75100_cmd_003.json
TestModeHandler: Executing command from file: host_75100_cmd_003.json
TestModeHandler: Executing action: get_game_state
TestModeHandler: Handling get_game_state action
TestModeHandler: get_game_state - Phase: Deployment, Turn: 0, Player: 0
TestModeHandler: Executing command from file: host_75100_cmd_003.json
TestModeHandler: Executing action: get_game_state
TestModeHandler: Handling get_game_state action
TestModeHandler: get_game_state - Phase: Deployment, Turn: 0, Player: 0
TestModeHandler: Result written to: host_75100_cmd_003_result.json
TestModeHandler: Result written to: host_75100_cmd_003_result.json
TestModeHandler: Command executed and result written
TestModeHandler: Command executed and result written
[Test] Result file found!
[Test] Action completed: success=true, message=Game state retrieved
[Test Artifacts] Report saved: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_artifacts/reports/unknown_test_2025-11-27T20-08-32.json
[GameInstance] Terminating instance: Host
[LogMonitor] Stopped monitoring: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251127_200820.log
[GameInstance] Terminating instance: Client
[LogMonitor] Stopped monitoring: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251127_200824.log

========================================
Starting Multiplayer Integration Test
========================================

  Running: test_deployment_single_unit

[TEST] test_deployment_single_unit
[Test] Launching host and client instances...
[GameInstance] Launching Host instance on port 8000
[GameInstance] Using project path: /Users/robertocallaghan/Documents/claude/godotv2/40k/
Godot Engine v4.5.1.stable.official.f62fdbde1 - https://godotengine.org
OpenGL API 4.1 INTEL-18.8.6 - Compatibility - Using Device: Intel Inc. - Intel(R) Iris(TM) Graphics 6100

TestModeHandler: Args -> ["--test-mode", "--position=100,100", "--resolution=600x480", "--auto-host", "--port=8000", "--instance-name=Host"]
[LogMonitor] Started monitoring: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251127_200831.log
[GameInstance] Monitoring log file: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251127_200831.log
[GameInstance] Successfully launched Host (PID: 75118)
[Test] Host instance launched successfully on port 8000
========================================
   RUNNING IN TEST MODE
   Config: { "window_position": (100, 100), "window_size": (600, 480), "is_host": true, "port": 8000, "instance_name": "Host" }
========================================
TestModeHandler: Command directories ready
  Commands: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_commands/commands
  Results: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_commands/results
[2025-11-27 20:08:36] [INFO.0000000] DebugLogger initialized - Session: 20251127_200836
[2025-11-27 20:08:36] [INFO.0000000] Log file: user://logs/debug_20251127_200836.log
[2025-11-27 20:08:36] [INFO.0000000] Real path: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251127_200836.log
[MeasuringTapeManager] Save persistence: false
Found armies in res://: ["orks", "adeptus_custodes", "space_marines", "A_C_test", "ORK_test"]
ArmyListManager initialized with 5 armies: ["orks", "adeptus_custodes", "space_marines", "A_C_test", "ORK_test"]
[2025-11-27 20:08:36] [INFO.0000000] DebugManager initialized
GameState: Loading default armies...
GameState: ArmyListManager not available, falling back to placeholder armies
GameState: Initializing placeholder armies for both players
GameState: Initializing placeholder army for player 1
GameState: Initializing placeholder army for player 2
ActionLogger: Started session 20251127_200836
StateSerializer: Pretty print enabled: true
SaveLoadManager: Current res:// directory: res://
SaveLoadManager: Project directory path: /Users/robertocallaghan/Documents/claude/godotv2/40k/
SaveLoadManager: Initialized save directories in project folder
SaveLoadManager: Save files will be stored at: /Users/robertocallaghan/Documents/claude/godotv2/40k/saves/
[PhaseManager] Ready - awaiting explicit phase initialization
[TerrainManager] Initializing terrain system
[TerrainManager] Added walls to terrain pieces
[TerrainManager] Loaded 12 terrain pieces
[EnhancedLineOfSight] Initialized
MissionManager: Initializing mission system
MissionManager: Set up 5 objectives for Strike Force deployment
  - obj_center at position (880.0, 1200.0)
  - obj_tl at position (400.0, 560.0)
  - obj_tr at position (1360.0, 560.0)
  - obj_bl at position (400.0, 1840.0)
  - obj_br at position (1360.0, 1840.0)
MissionManager: Initialized Take and Hold mission
[MeasuringTapeManager] Initialized with save_persistence: false
[LineOfSightManager] Initialized - Hold 'V' to check what can see the cursor position
TransportManager initialized
NetworkManager: Initialized
MainMenu: Initializing main menu
MainMenu: Loaded 5 armies: ["A C Test", "Adeptus Custodes", "ORK Test", "Orks", "Space Marines"]
MainMenu: Dropdowns populated with 5 armies
MainMenu: Multiplayer button visible: true
MainMenu: Signals connected
MainMenu: Save/Load dialog setup complete
MainMenu: Default armies set - Player 1: A C Test, Player 2: ORK Test
MainMenu: Ready with default selections
TestModeHandler: Set window position to (100, 100)
TestModeHandler: Set window size to (600, 480)
TestModeHandler: Scheduling auto-host...
SaveLoadDialog: Checking node references...
  - save_button path: VBoxContainer/SaveSection/SaveInputContainer/SaveButton
  - save_name_input path: VBoxContainer/SaveSection/SaveInputContainer/SaveNameInput
  - saves_list path: VBoxContainer/LoadSection/SavesScrollContainer/SavesList
  - load_button path: VBoxContainer/LoadSection/LoadButtonContainer/LoadButton
SaveLoadDialog: Connected save button
SaveLoadDialog: Connected save input
SaveLoadDialog: Connected saves list
SaveLoadDialog: Connected load button
SaveLoadDialog: Connected delete button
SaveLoadDialog: Connected cancel button
SaveLoadDialog UI signals connected
SaveLoadDialog: Found 29 save files
SaveLoadDialog: Populated list with 29 save files
SaveLoadDialog initialized successfully
[GameInstance] Launching Client instance on port 7778
[GameInstance] Using project path: /Users/robertocallaghan/Documents/claude/godotv2/40k/
TestModeHandler: Current scene: MainMenu
TestModeHandler: Triggering multiplayer mode...
MainMenu: Multiplayer button pressed
MultiplayerLobby: Army selection initialized with 5 armies
MultiplayerLobby: Ready
Godot Engine v4.5.1.stable.official.f62fdbde1 - https://godotengine.org
OpenGL API 4.1 INTEL-18.8.6 - Compatibility - Using Device: Intel Inc. - Intel(R) Iris(TM) Graphics 6100

TestModeHandler: Args -> ["--test-mode", "--position=800,100", "--resolution=600x480", "--auto-join", "--host-ip=127.0.0.1", "--host-port=8000", "--instance-name=Client"]
TestModeHandler: Lobby scene: MultiplayerLobby
TestModeHandler: Creating host on port 8000
MultiplayerLobby: Host button pressed
========================================
   YOU ARE: PLAYER 1 (HOST)
   Hosting on port: 7777
========================================
MultiplayerLobby: Successfully hosting on port 7777
TestModeHandler: Waiting for client to connect...
TestModeHandler: Listening for peer connection...
[LogMonitor] Started monitoring: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251127_200836.log
[GameInstance] Monitoring log file: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251127_200836.log
[GameInstance] Successfully launched Client (PID: 75129)
[Test] Client instance launched successfully
[Test] Waiting for client to connect to host...
[Test] Host performing action: get_game_state with params: {  }
[Test] Writing command file: host_75118_cmd_001.json
[Test] Waiting for result file...
[Test] Polling for result file: host_75118_cmd_001_result.json
========================================
   RUNNING IN TEST MODE
   Config: { "window_position": (800, 100), "window_size": (600, 480), "is_host": false, "host_ip": "127.0.0.1", "host_port": 8000, "instance_name": "Client" }
========================================
TestModeHandler: Command directories ready
  Commands: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_commands/commands
  Results: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_commands/results
[2025-11-27 20:08:41] [INFO.0000000] DebugLogger initialized - Session: 20251127_200841
[2025-11-27 20:08:41] [INFO.0000000] Log file: user://logs/debug_20251127_200841.log
[2025-11-27 20:08:41] [INFO.0000000] Real path: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251127_200841.log
[MeasuringTapeManager] Save persistence: false
Found armies in res://: ["orks", "adeptus_custodes", "space_marines", "A_C_test", "ORK_test"]
ArmyListManager initialized with 5 armies: ["orks", "adeptus_custodes", "space_marines", "A_C_test", "ORK_test"]
[2025-11-27 20:08:41] [INFO.0000000] DebugManager initialized
GameState: Loading default armies...
GameState: ArmyListManager not available, falling back to placeholder armies
GameState: Initializing placeholder armies for both players
GameState: Initializing placeholder army for player 1
GameState: Initializing placeholder army for player 2
ActionLogger: Started session 20251127_200841
StateSerializer: Pretty print enabled: true
SaveLoadManager: Current res:// directory: res://
SaveLoadManager: Project directory path: /Users/robertocallaghan/Documents/claude/godotv2/40k/
SaveLoadManager: Initialized save directories in project folder
SaveLoadManager: Save files will be stored at: /Users/robertocallaghan/Documents/claude/godotv2/40k/saves/
[PhaseManager] Ready - awaiting explicit phase initialization
[TerrainManager] Initializing terrain system
[TerrainManager] Added walls to terrain pieces
[TerrainManager] Loaded 12 terrain pieces
[EnhancedLineOfSight] Initialized
MissionManager: Initializing mission system
MissionManager: Set up 5 objectives for Strike Force deployment
  - obj_center at position (880.0, 1200.0)
  - obj_tl at position (400.0, 560.0)
  - obj_tr at position (1360.0, 560.0)
  - obj_bl at position (400.0, 1840.0)
  - obj_br at position (1360.0, 1840.0)
MissionManager: Initialized Take and Hold mission
[MeasuringTapeManager] Initialized with save_persistence: false
[LineOfSightManager] Initialized - Hold 'V' to check what can see the cursor position
TransportManager initialized
NetworkManager: Initialized
MainMenu: Initializing main menu
MainMenu: Loaded 5 armies: ["A C Test", "Adeptus Custodes", "ORK Test", "Orks", "Space Marines"]
MainMenu: Dropdowns populated with 5 armies
MainMenu: Multiplayer button visible: true
MainMenu: Signals connected
MainMenu: Save/Load dialog setup complete
MainMenu: Default armies set - Player 1: A C Test, Player 2: ORK Test
MainMenu: Ready with default selections
TestModeHandler: Processing command file host_75118_cmd_001.json
TestModeHandler: Executing command from file: host_75118_cmd_001.json
TestModeHandler: Executing action: get_game_state
TestModeHandler: Handling get_game_state action
TestModeHandler: get_game_state - Phase: Deployment, Turn: 0, Player: 0
TestModeHandler: Result written to: host_75118_cmd_001_result.json
TestModeHandler: Command executed and result written
[Test] Result file found!
TestModeHandler: Set window position to (800, 100)
[Test] Action completed: success=true, message=Game state retrieved
[Test] Connection verified - action simulation working!
TestModeHandler: Set window size to (600, 480)
TestModeHandler: Scheduling auto-join...
SaveLoadDialog: Checking node references...
  - save_button path: VBoxContainer/SaveSection/SaveInputContainer/SaveButton
  - save_name_input path: VBoxContainer/SaveSection/SaveInputContainer/SaveNameInput
  - saves_list path: VBoxContainer/LoadSection/SavesScrollContainer/SavesList
  - load_button path: VBoxContainer/LoadSection/LoadButtonContainer/LoadButton
SaveLoadDialog: Connected save button
SaveLoadDialog: Connected save input
SaveLoadDialog: Connected saves list
SaveLoadDialog: Connected load button
SaveLoadDialog: Connected delete button
SaveLoadDialog: Connected cancel button
SaveLoadDialog UI signals connected
SaveLoadDialog: Found 29 save files
SaveLoadDialog: Populated list with 29 save files
SaveLoadDialog initialized successfully
TestModeHandler: Current scene: MainMenu
TestModeHandler: Triggering multiplayer mode...
MainMenu: Multiplayer button pressed
MultiplayerLobby: Army selection initialized with 5 armies
MultiplayerLobby: Ready
[TEST] Using auto-loaded save: deployment_start
TestModeHandler: Lobby scene: MultiplayerLobby
TestModeHandler: Joining host at 127.0.0.1
MultiplayerLobby: Join button pressed
NetworkManager: Connecting to 127.0.0.1:7777
MultiplayerLobby: Attempting to join 127.0.0.1:7777
NetworkManager: Peer connected - 1
NetworkManager: Successfully connected to host
NetworkManager: Client set peer_to_player_map[599067779] = 2
========================================
   YOU ARE: PLAYER 2 (CLIENT)
   Connected to host
========================================
MultiplayerLobby: Peer connected - 1
MultiplayerLobby: Game started signal received
NetworkManager: Peer connected - 599067779
[GameState] MeasuringTapeManager not available
MultiplayerLobby: Peer connected - 599067779
TestModeHandler: Client connected!
MultiplayerLobby: Game started signal received
NetworkManager: Receiving initial state from host
[GameState] No measuring_tape data in save
NetworkManager: State synchronized
MultiplayerLobby: Game started signal received
MultiplayerLobby: Syncing army selection - Player 1 -> A_C_test
MultiplayerLobby: Syncing army selection - Player 2 -> ORK_test
TestModeHandler: Starting game...
MultiplayerLobby: Start game button pressed
MultiplayerLobby: Loading armies...
MultiplayerLobby: Loading A_C_test for Player 1
Loading army list: A_C_test for player 1
Processed unit: U_BLADE_CHAMPION_A for player 1
Processed unit: U_WITCHSEEKERS_C for player 1
Processed unit: U_CALADIUS_GRAV-TANK_E for player 1
Successfully loaded army: A_C_test with 3 units
MultiplayerLobby: Player 1 army loaded, has 3 units
Applying army to game state for player: 1
Removing 0 existing units for player 1
Added unit: U_BLADE_CHAMPION_A (Blade Champion)
Added unit: U_WITCHSEEKERS_C (Witchseekers)
Added unit: U_CALADIUS_GRAV-TANK_E (Caladius Grav-tank)
Set faction for player 1: Adeptus Custodes
Army applied successfully. Total units in game: 3
MultiplayerLobby: After applying P1 army, GameState has 3 units
MultiplayerLobby: Loading ORK_test for Player 2
Loading army list: ORK_test for player 2
Processed unit: U_WARBOSS_B for player 2
Processed unit: U_WARBOSS_IN_MEGA_ARMOUR_D for player 2
[2025-11-27 20:08:46] [DEBUG.0000000] Parsed transport capacity keywords | Context: {"description":"This model has a transport capacity of 22 ORKS INFANTRY models. Each MEGA ARMOUR model takes up the space of 2 models. This model cannot transport models that are JUMP PACK models.","keywords":["ORKS","INFANTRY"],"unit_id":"U_BATTLEWAGON_G"}
Processed unit: U_BATTLEWAGON_G for player 2
Successfully loaded army: ORK_test with 3 units
MultiplayerLobby: Player 2 army loaded, has 3 units
Applying army to game state for player: 2
Removing 0 existing units for player 2
Added unit: U_WARBOSS_B (Warboss)
Added unit: U_WARBOSS_IN_MEGA_ARMOUR_D (Warboss in Mega Armour)
Added unit: U_BATTLEWAGON_G (Battlewagon)
Set faction for player 2: Unknown
Army applied successfully. Total units in game: 6
MultiplayerLobby: After applying P2 army, GameState has 6 units
MultiplayerLobby: Armies loaded. Total units: 6
MultiplayerLobby: Syncing loaded armies to clients...
[GameState] MeasuringTapeManager not available
MultiplayerLobby: Snapshot has 6 units
MultiplayerLobby: Sent army snapshot to peer 599067779
NetworkManager: Receiving initial state from host
[GameState] No measuring_tape data in save
NetworkManager: State synchronized
MultiplayerLobby: Game started signal received
NetworkManager: Starting multiplayer game - transitioning to Main scene
NetworkManager: Units in GameState BEFORE scene change: 6
NetworkManager: Unit IDs: ["U_BLADE_CHAMPION_A", "U_WITCHSEEKERS_C", "U_CALADIUS_GRAV-TANK_E", "U_WARBOSS_B", "U_WARBOSS_IN_MEGA_ARMOUR_D", "U_BATTLEWAGON_G"]
NetworkManager: Starting multiplayer game - transitioning to Main scene
NetworkManager: Units in GameState BEFORE scene change: 6
NetworkManager: Unit IDs: ["U_BLADE_CHAMPION_A", "U_WITCHSEEKERS_C", "U_CALADIUS_GRAV-TANK_E", "U_WARBOSS_B", "U_WARBOSS_IN_MEGA_ARMOUR_D", "U_BATTLEWAGON_G"]
[Test] Host performing action: get_game_state with params: {  }
[Test] Writing command file: host_75118_cmd_002.json
[Test] Waiting for result file...
[Test] Polling for result file: host_75118_cmd_002_result.json
MultiplayerLobby: Game started signal received
MultiplayerLobby: Game start RPC sent to all peers
TestModeHandler: Processing command file host_75118_cmd_002.json
TestModeHandler: Executing command from file: host_75118_cmd_002.json
TestModeHandler: Executing action: get_game_state
TestModeHandler: Handling get_game_state action
TestModeHandler: get_game_state - Phase: Deployment, Turn: 0, Player: 0
TestModeHandler: Result written to: host_75118_cmd_002_result.json
TestModeHandler: Command executed and result written
MultiplayerLobby: Game started signal received
[Test] Result file found!
[Test] Action completed: success=true, message=Game state retrieved
[Test] Host performing action: get_available_units with params: {  }
[Test] Writing command file: host_75118_cmd_003.json
[Test] Waiting for result file...
[Test] Polling for result file: host_75118_cmd_003_result.json
UnitStatsPanel: _ready() called with 4-section layout
UnitStatsPanel: Toggle button connected
UnitStatsPanel: Player units list connected
UnitStatsPanel: Enemy units list connected
UnitStatsPanel: Setting collapsed to true
UnitStatsPanel: Main content visible = false
UnitStatsPanel: Toggle button text = ▼ Unit Stats
UnitStatsPanel: Target height = 40, Target offset = -40
Main: _ready() called
Main: DebugLogger log file path: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251127_200836.log
[2025-11-27 20:08:48] [INFO.0000000] Main._ready() called
Main: Current units count BEFORE check: 6
Main: Unit IDs in GameState: ["U_BLADE_CHAMPION_A", "U_WITCHSEEKERS_C", "U_CALADIUS_GRAV-TANK_E", "U_WARBOSS_B", "U_WARBOSS_IN_MEGA_ARMOUR_D", "U_BATTLEWAGON_G"]
Main: Meta flags: ["game_id", "turn_number", "battle_round", "active_player", "phase", "created_at", "version", "from_multiplayer_lobby", "game_config"]
Main: Game config: { "player1_army": "A_C_test", "player2_army": "ORK_test" }
Main: from_menu=false from_save=false from_multiplayer=true
Main: ✓ Loading from multiplayer lobby with armies already loaded
Main: Units count AFTER multiplayer check: 6
Main: Initializing deployment phase with 6 units
[PhaseManager] transition_to_phase called for: DEPLOYMENT
[PhaseManager] Creating new phase instance for: DEPLOYMENT
[PhaseManager] Phase script: <GDScript#-9223372002159491695>
[PhaseManager] Created instance class: Node
[PhaseManager] Instance script: <GDScript#-9223372002159491695>
[PhaseManager] Instance has validate_action: true
[PhaseManager] Connected to phase_completed signal
[PhaseManager] Connected to action_taken signal
[GameState] MeasuringTapeManager not available
[PhaseManager] Creating snapshot for phase 0
[PhaseManager] Snapshot has 6 units
[PhaseManager] Unit IDs: ["U_BLADE_CHAMPION_A", "U_WITCHSEEKERS_C", "U_CALADIUS_GRAV-TANK_E", "U_WARBOSS_B", "U_WARBOSS_IN_MEGA_ARMOUR_D", "U_BATTLEWAGON_G"]
[0][INFO] Entering Deployment Phase
[0][INFO] Deployment phase initialized
UnitStatsPanel: _ready() called with 4-section layout
UnitStatsPanel: Toggle button connected
UnitStatsPanel: Player units list connected
UnitStatsPanel: Enemy units list connected
UnitStatsPanel: Setting collapsed to true
UnitStatsPanel: Main content visible = false
UnitStatsPanel: Toggle button text = ▼ Unit Stats
UnitStatsPanel: Target height = 40, Target offset = -40
Main: _ready() called
Main: DebugLogger log file path: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251127_200841.log
[2025-11-27 20:08:48] [INFO.0000000] Main._ready() called
Main: Current units count BEFORE check: 6
Main: Unit IDs in GameState: ["U_BLADE_CHAMPION_A", "U_WITCHSEEKERS_C", "U_CALADIUS_GRAV-TANK_E", "U_WARBOSS_B", "U_WARBOSS_IN_MEGA_ARMOUR_D", "U_BATTLEWAGON_G"]
Main: Meta flags: ["game_id", "turn_number", "battle_round", "active_player", "phase", "created_at", "version", "from_multiplayer_lobby", "game_config"]
Main: Game config: { "player1_army": "A_C_test", "player2_army": "ORK_test" }
Main: from_menu=false from_save=false from_multiplayer=true
Main: ✓ Loading from multiplayer lobby with armies already loaded
Main: Units count AFTER multiplayer check: 6
Main: Initializing deployment phase with 6 units
[PhaseManager] transition_to_phase called for: DEPLOYMENT
[PhaseManager] Creating new phase instance for: DEPLOYMENT
[PhaseManager] Phase script: <GDScript#-9223372002159491695>
[PhaseManager] Created instance class: Node
[PhaseManager] Instance script: <GDScript#-9223372002159491695>
[PhaseManager] Instance has validate_action: true
[PhaseManager] Connected to phase_completed signal
[PhaseManager] Connected to action_taken signal
[GameState] MeasuringTapeManager not available
[PhaseManager] Creating snapshot for phase 0
[PhaseManager] Snapshot has 6 units
[PhaseManager] Unit IDs: ["U_BLADE_CHAMPION_A", "U_WITCHSEEKERS_C", "U_CALADIUS_GRAV-TANK_E", "U_WARBOSS_B", "U_WARBOSS_IN_MEGA_ARMOUR_D", "U_BATTLEWAGON_G"]
[0][INFO] Entering Deployment Phase
[0][INFO] Deployment phase initialized
[PhaseManager] get_current_phase_instance returning: Node
[PhaseManager] Instance script path: res://phases/DeploymentPhase.gd
[PhaseManager] Instance has validate_action: true
[PhaseManager] ⚠️ Script path: res://phases/DeploymentPhase.gd
[PhaseManager] ⚠️ This SHOULD be a DeploymentPhase!
Main: Phase instance created - class: Node
Main: Phase instance script: <GDScript#-9223372002159491695>
Main: Phase has validate_action: true
Setting up objectives on board...
Main: Creating visuals for 5 objectives
MissionManager: Checking control for 5 objectives with 6 units

Checking objective: obj_center at position (880.0, 1200.0)
  Skipping U_BLADE_CHAMPION_A - not deployed (status: 0)
  Skipping U_WITCHSEEKERS_C - not deployed (status: 0)
  Skipping U_CALADIUS_GRAV-TANK_E - not deployed (status: 0)
  Skipping U_WARBOSS_B - not deployed (status: 0)
  Skipping U_WARBOSS_IN_MEGA_ARMOUR_D - not deployed (status: 0)
  Skipping U_BATTLEWAGON_G - not deployed (status: 0)

Checking objective: obj_tl at position (400.0, 560.0)
  Skipping U_BLADE_CHAMPION_A - not deployed (status: 0)
  Skipping U_WITCHSEEKERS_C - not deployed (status: 0)
  Skipping U_CALADIUS_GRAV-TANK_E - not deployed (status: 0)
  Skipping U_WARBOSS_B - not deployed (status: 0)
  Skipping U_WARBOSS_IN_MEGA_ARMOUR_D - not deployed (status: 0)
  Skipping U_BATTLEWAGON_G - not deployed (status: 0)

Checking objective: obj_tr at position (1360.0, 560.0)
  Skipping U_BLADE_CHAMPION_A - not deployed (status: 0)
  Skipping U_WITCHSEEKERS_C - not deployed (status: 0)
  Skipping U_CALADIUS_GRAV-TANK_E - not deployed (status: 0)
  Skipping U_WARBOSS_B - not deployed (status: 0)
  Skipping U_WARBOSS_IN_MEGA_ARMOUR_D - not deployed (status: 0)
  Skipping U_BATTLEWAGON_G - not deployed (status: 0)

Checking objective: obj_bl at position (400.0, 1840.0)
  Skipping U_BLADE_CHAMPION_A - not deployed (status: 0)
  Skipping U_WITCHSEEKERS_C - not deployed (status: 0)
  Skipping U_CALADIUS_GRAV-TANK_E - not deployed (status: 0)
  Skipping U_WARBOSS_B - not deployed (status: 0)
  Skipping U_WARBOSS_IN_MEGA_ARMOUR_D - not deployed (status: 0)
  Skipping U_BATTLEWAGON_G - not deployed (status: 0)

Checking objective: obj_br at position (1360.0, 1840.0)
  Skipping U_BLADE_CHAMPION_A - not deployed (status: 0)
  Skipping U_WITCHSEEKERS_C - not deployed (status: 0)
  Skipping U_CALADIUS_GRAV-TANK_E - not deployed (status: 0)
  Skipping U_WARBOSS_B - not deployed (status: 0)
  Skipping U_WARBOSS_IN_MEGA_ARMOUR_D - not deployed (status: 0)
  Skipping U_BATTLEWAGON_G - not deployed (status: 0)
Main: Objectives setup complete
Moved HUD_Bottom to top of screen
Looking for UnitStatsPanel in scene...
Found UnitStatsPanel in scene structure
Connected to unit_selected signal from UnitStatsPanel
UnitStatsPanel: Populating unit lists for phase: DEPLOYMENT
[PhaseManager] get_current_phase_instance returning: Node
[PhaseManager] Instance script path: res://phases/DeploymentPhase.gd
[PhaseManager] Instance has validate_action: true
[PhaseManager] ⚠️ Script path: res://phases/DeploymentPhase.gd
[PhaseManager] ⚠️ This SHOULD be a DeploymentPhase!
Main: Phase instance created - class: Node
Main: Phase instance script: <GDScript#-9223372002159491695>
Main: Phase has validate_action: true
Setting up objectives on board...
UnitStatsPanel: Populated 3 units for player (player 1)
Main: Creating visuals for 5 objectives
UnitStatsPanel: Populated 3 units for enemy (player 2)
Initialized UnitStatsPanel unit lists for phase: DEPLOYMENT
Fixed HUD layout: HUD_Left adjusted for new layout
Fixed HUD layout: HUD_Right adjusted for new layout
Adjusted unit list: fixed height to 150px
Setting up Mathhammer UI...
MathhhammerUI: Initializing...
MissionManager: Checking control for 5 objectives with 6 units

Checking objective: obj_center at position (880.0, 1200.0)
  Skipping U_BLADE_CHAMPION_A - not deployed (status: 0)
  Skipping U_WITCHSEEKERS_C - not deployed (status: 0)
  Skipping U_CALADIUS_GRAV-TANK_E - not deployed (status: 0)
  Skipping U_WARBOSS_B - not deployed (status: 0)
  Skipping U_WARBOSS_IN_MEGA_ARMOUR_D - not deployed (status: 0)
  Skipping U_BATTLEWAGON_G - not deployed (status: 0)

Checking objective: obj_tl at position (400.0, 560.0)
  Skipping U_BLADE_CHAMPION_A - not deployed (status: 0)
  Skipping U_WITCHSEEKERS_C - not deployed (status: 0)
  Skipping U_CALADIUS_GRAV-TANK_E - not deployed (status: 0)
  Skipping U_WARBOSS_B - not deployed (status: 0)
  Skipping U_WARBOSS_IN_MEGA_ARMOUR_D - not deployed (status: 0)
  Skipping U_BATTLEWAGON_G - not deployed (status: 0)

Checking objective: obj_tr at position (1360.0, 560.0)
  Skipping U_BLADE_CHAMPION_A - not deployed (status: 0)
  Skipping U_WITCHSEEKERS_C - not deployed (status: 0)
  Skipping U_CALADIUS_GRAV-TANK_E - not deployed (status: 0)
  Skipping U_WARBOSS_B - not deployed (status: 0)
  Skipping U_WARBOSS_IN_MEGA_ARMOUR_D - not deployed (status: 0)
  Skipping U_BATTLEWAGON_G - not deployed (status: 0)

Checking objective: obj_bl at position (400.0, 1840.0)
  Skipping U_BLADE_CHAMPION_A - not deployed (status: 0)
  Skipping U_WITCHSEEKERS_C - not deployed (status: 0)
  Skipping U_CALADIUS_GRAV-TANK_E - not deployed (status: 0)
  Skipping U_WARBOSS_B - not deployed (status: 0)
  Skipping U_WARBOSS_IN_MEGA_ARMOUR_D - not deployed (status: 0)
  Skipping U_BATTLEWAGON_G - not deployed (status: 0)

Checking objective: obj_br at position (1360.0, 1840.0)
  Skipping U_BLADE_CHAMPION_A - not deployed (status: 0)
  Skipping U_WITCHSEEKERS_C - not deployed (status: 0)
  Skipping U_CALADIUS_GRAV-TANK_E - not deployed (status: 0)
  Skipping U_WARBOSS_B - not deployed (status: 0)
  Skipping U_WARBOSS_IN_MEGA_ARMOUR_D - not deployed (status: 0)
  Skipping U_BATTLEWAGON_G - not deployed (status: 0)
Main: Objectives setup complete
Moved HUD_Bottom to top of screen
Looking for UnitStatsPanel in scene...
Found UnitStatsPanel in scene structure
Connected to unit_selected signal from UnitStatsPanel
UnitStatsPanel: Populating unit lists for phase: DEPLOYMENT
UnitStatsPanel: Populated 3 units for player (player 1)
UnitStatsPanel: Populated 3 units for enemy (player 2)
Initialized UnitStatsPanel unit lists for phase: DEPLOYMENT
Fixed HUD layout: HUD_Left adjusted for new layout
Fixed HUD layout: HUD_Right adjusted for new layout
Adjusted unit list: fixed height to 150px
Setting up Mathhammer UI...
MathhhammerUI: Initializing...
Mathhammer UI added to left HUD
Mathhammer UI successfully integrated into left side of main UI
Setting up Save/Load Dialog...
Mathhammer UI added to left HUD
Mathhammer UI successfully integrated into left side of main UI
Setting up Save/Load Dialog...
Save/Load Dialog setup completed
Setting up terrain system...
[TerrainVisual] Added wall line from (640.0, 80.0) to (800.0, 80.0) type: solid
[TerrainVisual] Added wall line from (640.0, 80.0) to (640.0, 200.0) type: window
[TerrainVisual] Added wall line from (1120.0, 200.0) to (1600.0, 200.0) type: solid
[TerrainVisual] Added wall line from (1120.0, 440.0) to (1600.0, 440.0) type: solid
[TerrainVisual] Added wall line from (1120.0, 280.0) to (1120.0, 360.0) type: door
[TerrainVisual] Added wall line from (1600.0, 250.0) to (1600.0, 390.0) type: window
[TerrainVisual] Added wall line from (640.0, 320.0) to (640.0, 560.0) type: solid
[TerrainVisual] Added wall line from (280.0, 440.0) to (520.0, 440.0) type: window
[TerrainVisual] Added wall line from (160.0, 1960.0) to (640.0, 1960.0) type: solid
[TerrainVisual] Added wall line from (160.0, 1960.0) to (160.0, 2200.0) type: solid
Save/Load Dialog setup completed
Setting up terrain system...
[TerrainVisual] Added wall line from (625.4415, 844.8528) to (964.8528, 505.4416) type: solid
[TerrainVisual] Added wall line from (640.0, 80.0) to (800.0, 80.0) type: solid
[TerrainVisual] Added wall line from (640.0, 80.0) to (640.0, 200.0) type: window
[TerrainVisual] Rendered 12 terrain pieces
[TerrainVisual] Initialized
Added TerrainVisual to BoardRoot
[LineOfSightVisual] Initialized - Will show models that can see cursor position
Added LineOfSightVisual to BoardRoot
Line of Sight: Hold 'V' to check what models can see the cursor position
Added terrain UI controls to HUD
Setting up measuring tape visual...
[MeasuringTapeVisual] Initialized with z_index 15
Added MeasuringTapeVisual to BoardRoot
Measuring Tape: Hold 't' and drag to measure, press 'y' to clear all measurements
[TerrainVisual] Added wall line from (1120.0, 200.0) to (1600.0, 200.0) type: solid
[TerrainVisual] Added wall line from (1120.0, 440.0) to (1600.0, 440.0) type: solid
[TerrainVisual] Added wall line from (1120.0, 280.0) to (1120.0, 360.0) type: door
[TerrainVisual] Added wall line from (1600.0, 250.0) to (1600.0, 390.0) type: window
Added measuring tape save toggle to HUD
Setting up transport panel...
[TerrainVisual] Added wall line from (640.0, 320.0) to (640.0, 560.0) type: solid
[TerrainVisual] Added wall line from (280.0, 440.0) to (520.0, 440.0) type: window
[TerrainVisual] Added wall line from (160.0, 1960.0) to (640.0, 1960.0) type: solid
[TerrainVisual] Added wall line from (160.0, 1960.0) to (160.0, 2200.0) type: solid
[TerrainVisual] Added wall line from (625.4415, 844.8528) to (964.8528, 505.4416) type: solid
Transport panel added to HUD_Right
Left panel toggle button added to top HUD
[TerrainVisual] Rendered 12 terrain pieces
[TerrainVisual] Initialized
Added TerrainVisual to BoardRoot
Left panel hidden by default
Main: setup_phase_controllers() STARTING (semaphore locked)
[LineOfSightVisual] Initialized - Will show models that can see cursor position
Added LineOfSightVisual to BoardRoot
Line of Sight: Hold 'V' to check what models can see the cursor position
Added terrain UI controls to HUD
Setting up measuring tape visual...
[MeasuringTapeVisual] Initialized with z_index 15
Added MeasuringTapeVisual to BoardRoot
Measuring Tape: Hold 't' and drag to measure, press 'y' to clear all measurements
Added measuring tape save toggle to HUD
Setting up transport panel...
Transport panel added to HUD_Right
Left panel toggle button added to top HUD
Left panel hidden by default
Main: setup_phase_controllers() STARTING (semaphore locked)
TestModeHandler: Processing command file host_75118_cmd_003.json
TestModeHandler: Executing command from file: host_75118_cmd_003.json
TestModeHandler: Executing action: get_available_units
TestModeHandler: Handling get_available_units action
TestModeHandler: Player 1 units: ["U_BLADE_CHAMPION_A", "U_WITCHSEEKERS_C", "U_CALADIUS_GRAV-TANK_E"] (undeployed: ["U_BLADE_CHAMPION_A", "U_WITCHSEEKERS_C", "U_CALADIUS_GRAV-TANK_E"])
TestModeHandler: Player 2 units: ["U_WARBOSS_B", "U_WARBOSS_IN_MEGA_ARMOUR_D", "U_BATTLEWAGON_G"] (undeployed: ["U_WARBOSS_B", "U_WARBOSS_IN_MEGA_ARMOUR_D", "U_BATTLEWAGON_G"])
TestModeHandler: Result written to: host_75118_cmd_003_result.json
TestModeHandler: Command executed and result written
SaveLoadDialog: Checking node references...
  - save_button path: VBoxContainer/SaveSection/SaveInputContainer/SaveButton
  - save_name_input path: VBoxContainer/SaveSection/SaveInputContainer/SaveNameInput
  - saves_list path: VBoxContainer/LoadSection/SavesScrollContainer/SavesList
  - load_button path: VBoxContainer/LoadSection/LoadButtonContainer/LoadButton
SaveLoadDialog: Connected save button
SaveLoadDialog: Connected save input
SaveLoadDialog: Connected saves list
SaveLoadDialog: Connected load button
SaveLoadDialog: Connected delete button
SaveLoadDialog: Connected cancel button
SaveLoadDialog UI signals connected
[Test] Result file found!
[Test] Action completed: success=true, message=Available units retrieved
[TEST] Player 1 undeployed units: ["U_BLADE_CHAMPION_A", "U_WITCHSEEKERS_C", "U_CALADIUS_GRAV-TANK_E"]
[TEST] Using unit: U_BLADE_CHAMPION_A
[Test] Host performing action: deploy_unit with params: { "unit_id": "U_BLADE_CHAMPION_A", "position": { "x": 100.0, "y": 100.0 } }
[Test] Writing command file: host_75118_cmd_004.json
[Test] Waiting for result file...
[Test] Polling for result file: host_75118_cmd_004_result.json
SaveLoadDialog: Checking node references...
  - save_button path: VBoxContainer/SaveSection/SaveInputContainer/SaveButton
  - save_name_input path: VBoxContainer/SaveSection/SaveInputContainer/SaveNameInput
  - saves_list path: VBoxContainer/LoadSection/SavesScrollContainer/SavesList
  - load_button path: VBoxContainer/LoadSection/LoadButtonContainer/LoadButton
SaveLoadDialog: Connected save button
SaveLoadDialog: Connected save input
SaveLoadDialog: Connected saves list
SaveLoadDialog: Connected load button
SaveLoadDialog: Connected delete button
SaveLoadDialog: Connected cancel button
SaveLoadDialog UI signals connected
SaveLoadDialog: Found 29 save files
SaveLoadDialog: Populated list with 29 save files
SaveLoadDialog initialized successfully
TestModeHandler: Processing command file host_75118_cmd_004.json
TestModeHandler: Executing command from file: host_75118_cmd_004.json
TestModeHandler: Executing action: deploy_unit
TestModeHandler: Handling deploy_unit action
GameManager: deploy_unit() called - unit_id: U_BLADE_CHAMPION_A, position: (100.0, 100.0)
GameManager: Total units in GameState: 6
GameManager: Unit IDs: ["U_BLADE_CHAMPION_A", "U_WITCHSEEKERS_C", "U_CALADIUS_GRAV-TANK_E", "U_WARBOSS_B", "U_WARBOSS_IN_MEGA_ARMOUR_D", "U_BATTLEWAGON_G"]
GameManager: Switching active player from 1 to 2
GameManager: Applying result with 4 changes/diffs
GameManager: Setting units.U_BLADE_CHAMPION_A.models.0.position = { "x": 100.0, "y": 100.0 }
GameManager: Setting units.U_BLADE_CHAMPION_A.models.0.rotation = 0.0
GameManager: Setting units.U_BLADE_CHAMPION_A.status = 2
GameManager: Setting meta.active_player = 2
GameManager: deploy_unit() result: success=true
TestModeHandler: Result written to: host_75118_cmd_004_result.json
TestModeHandler: Command executed and result written
SaveLoadDialog: Found 29 save files
Main: setup_phase_controllers() COMPLETE (semaphore unlocked)
ERROR: Signal 'unit_confirmed' is already connected to given callable 'CanvasLayer(Main.gd)::_on_unit_confirmed' in that object.
   at: connect (core/object/object.cpp:1538)
   GDScript backtrace (most recent call first):
       [0] connect_signals (res://scripts/Main.gd:1250)
       [1] _ready (res://scripts/Main.gd:137)
       [2] setup_phase_controllers (res://scripts/Main.gd:940)
SaveLoadDialog: Populated list with 29 save files
ERROR: Signal 'models_placed_changed' is already connected to given callable 'CanvasLayer(Main.gd)::_on_models_placed_changed' in that object.
   at: connect (core/object/object.cpp:1538)
   GDScript backtrace (most recent call first):
       [0] connect_signals (res://scripts/Main.gd:1251)
       [1] _ready (res://scripts/Main.gd:137)
       [2] setup_phase_controllers (res://scripts/Main.gd:940)
SaveLoadDialog initialized successfully
Main: Connected to GameManager.result_applied signal
UnitStatsPanel: Populating unit lists for phase: DEPLOYMENT
UnitStatsPanel: Populated 3 units for player (player 2)
UnitStatsPanel: Populated 3 units for enemy (player 1)
Refreshed bottom panel unit lists for phase: DEPLOYMENT
Refreshing right panel unit list for deployment - found 3 undeployed units
GameState: ⚠️ all_units_deployed check - Undeployed units: ["U_WITCHSEEKERS_C (player 1)", "U_CALADIUS_GRAV-TANK_E (player 1)", "U_WARBOSS_B (player 2)", "U_WARBOSS_IN_MEGA_ARMOUR_D (player 2)", "U_BATTLEWAGON_G (player 2)"]
Main: ⚠️ update_ui() - DEPLOYMENT phase - all_deployed: false
Main: ⚠️ Button state BEFORE change - disabled: true text: 'End Phase'
[2025-11-27 20:08:49] [INFO.0000000] update_ui deployment check | Context: {"all_deployed":false,"button_text":"End Phase","current_button_disabled":true}
Main: ⚠️ update_ui() - Setting button DISABLED (not all deployed)
Main: ⚠️ Button state AFTER disable - disabled: true
Main: ⚠️ Calling update_ui_for_phase() for initial phase setup
Main: ========== UPDATE UI FOR PHASE ==========
Main: Current phase: DEPLOYMENT
[2025-11-27 20:08:49] [INFO.0000000] update_ui_for_phase START | Context: {"button_exists":true,"button_path":"/root/Main/HUD_Bottom/HBoxContainer/PhaseActionButton","phase":"DEPLOYMENT"}
[2025-11-27 20:08:49] [INFO.0000000] Updating UI for phase | Context: {"phase":"DEPLOYMENT"}
GameState: ⚠️ all_units_deployed check - Undeployed units: ["U_WITCHSEEKERS_C (player 1)", "U_CALADIUS_GRAV-TANK_E (player 1)", "U_WARBOSS_B (player 2)", "U_WARBOSS_IN_MEGA_ARMOUR_D (player 2)", "U_BATTLEWAGON_G (player 2)"]
Main: Deployment phase - all_units_deployed: false button_disabled: true
[2025-11-27 20:08:49] [INFO.0000000] Deployment button state | Context: {"all_deployed":false,"button_disabled":true}
Main: Phase button configured - text: 'End Deployment' visible: true disabled: true
[2025-11-27 20:08:49] [INFO.0000000] Phase button configured | Context: {"disabled":true,"text":"End Deployment","visible":true}
Main: Connected phase action button to _on_phase_action_pressed
Main: ⚠️ VERIFICATION - Button connected: true
[2025-11-27 20:08:49] [INFO.0000000] Phase button signal connected | Context: {"connection_verified":true,"is_now_connected":true,"was_previously_connected":false}
WARNING: MovementActions container not found!
GameState: ⚠️ all_units_deployed check - Undeployed units: ["U_WITCHSEEKERS_C (player 1)", "U_CALADIUS_GRAV-TANK_E (player 1)", "U_WARBOSS_B (player 2)", "U_WARBOSS_IN_MEGA_ARMOUR_D (player 2)", "U_BATTLEWAGON_G (player 2)"]
UnitStatsPanel: Populating unit lists for phase: DEPLOYMENT
UnitStatsPanel: Populated 3 units for player (player 2)
UnitStatsPanel: Populated 3 units for enemy (player 1)
Refreshed bottom panel unit lists for phase: DEPLOYMENT
Refreshing right panel unit list for deployment - found 3 undeployed units
GameState: ⚠️ all_units_deployed check - Undeployed units: ["U_WITCHSEEKERS_C (player 1)", "U_CALADIUS_GRAV-TANK_E (player 1)", "U_WARBOSS_B (player 2)", "U_WARBOSS_IN_MEGA_ARMOUR_D (player 2)", "U_BATTLEWAGON_G (player 2)"]
Main: ⚠️ update_ui() - DEPLOYMENT phase - all_deployed: false
Main: ⚠️ Button state BEFORE change - disabled: true text: 'End Deployment'
[2025-11-27 20:08:49] [INFO.0000000] update_ui deployment check | Context: {"all_deployed":false,"button_text":"End Deployment","current_button_disabled":true}
Main: ⚠️ update_ui() - Setting button DISABLED (not all deployed)
Main: ⚠️ Button state AFTER disable - disabled: true
Main: ⚠️ Initial phase UI setup complete
Quick Save/Load enabled: [ key to save, ] key (or F9) to load
Main: setup_phase_controllers() COMPLETE (semaphore unlocked)
ERROR: Signal 'unit_confirmed' is already connected to given callable 'CanvasLayer(Main.gd)::_on_unit_confirmed' in that object.
   at: connect (core/object/object.cpp:1538)
   GDScript backtrace (most recent call first):
       [0] connect_signals (res://scripts/Main.gd:1250)
       [1] _ready (res://scripts/Main.gd:137)
       [2] setup_phase_controllers (res://scripts/Main.gd:940)
ERROR: Signal 'models_placed_changed' is already connected to given callable 'CanvasLayer(Main.gd)::_on_models_placed_changed' in that object.
   at: connect (core/object/object.cpp:1538)
   GDScript backtrace (most recent call first):
       [0] connect_signals (res://scripts/Main.gd:1251)
       [1] _ready (res://scripts/Main.gd:137)
       [2] setup_phase_controllers (res://scripts/Main.gd:940)
Main: Connected to GameManager.result_applied signal
UnitStatsPanel: Populating unit lists for phase: DEPLOYMENT
UnitStatsPanel: Populated 3 units for player (player 1)
UnitStatsPanel: Populated 3 units for enemy (player 2)
Refreshed bottom panel unit lists for phase: DEPLOYMENT
Refreshing right panel unit list for deployment - found 3 undeployed units
GameState: ⚠️ all_units_deployed check - Undeployed units: ["U_BLADE_CHAMPION_A (player 1)", "U_WITCHSEEKERS_C (player 1)", "U_CALADIUS_GRAV-TANK_E (player 1)", "U_WARBOSS_B (player 2)", "U_WARBOSS_IN_MEGA_ARMOUR_D (player 2)", "U_BATTLEWAGON_G (player 2)"]
Main: ⚠️ update_ui() - DEPLOYMENT phase - all_deployed: false
Main: ⚠️ Button state BEFORE change - disabled: true text: 'End Phase'
[2025-11-27 20:08:49] [INFO.0000000] update_ui deployment check | Context: {"all_deployed":false,"button_text":"End Phase","current_button_disabled":true}
Main: ⚠️ update_ui() - Setting button DISABLED (not all deployed)
Main: ⚠️ Button state AFTER disable - disabled: true
Main: ⚠️ Calling update_ui_for_phase() for initial phase setup
Main: ========== UPDATE UI FOR PHASE ==========
Main: Current phase: DEPLOYMENT
[2025-11-27 20:08:49] [INFO.0000000] update_ui_for_phase START | Context: {"button_exists":true,"button_path":"/root/Main/HUD_Bottom/HBoxContainer/PhaseActionButton","phase":"DEPLOYMENT"}
[2025-11-27 20:08:49] [INFO.0000000] Updating UI for phase | Context: {"phase":"DEPLOYMENT"}
GameState: ⚠️ all_units_deployed check - Undeployed units: ["U_BLADE_CHAMPION_A (player 1)", "U_WITCHSEEKERS_C (player 1)", "U_CALADIUS_GRAV-TANK_E (player 1)", "U_WARBOSS_B (player 2)", "U_WARBOSS_IN_MEGA_ARMOUR_D (player 2)", "U_BATTLEWAGON_G (player 2)"]
Main: Deployment phase - all_units_deployed: false button_disabled: true
[2025-11-27 20:08:49] [INFO.0000000] Deployment button state | Context: {"all_deployed":false,"button_disabled":true}
Main: Phase button configured - text: 'End Deployment' visible: true disabled: true
[2025-11-27 20:08:49] [INFO.0000000] Phase button configured | Context: {"disabled":true,"text":"End Deployment","visible":true}
Main: Connected phase action button to _on_phase_action_pressed
Main: ⚠️ VERIFICATION - Button connected: true
[2025-11-27 20:08:49] [INFO.0000000] Phase button signal connected | Context: {"connection_verified":true,"is_now_connected":true,"was_previously_connected":false}
WARNING: MovementActions container not found!
GameState: ⚠️ all_units_deployed check - Undeployed units: ["U_BLADE_CHAMPION_A (player 1)", "U_WITCHSEEKERS_C (player 1)", "U_CALADIUS_GRAV-TANK_E (player 1)", "U_WARBOSS_B (player 2)", "U_WARBOSS_IN_MEGA_ARMOUR_D (player 2)", "U_BATTLEWAGON_G (player 2)"]
UnitStatsPanel: Populating unit lists for phase: DEPLOYMENT
UnitStatsPanel: Populated 3 units for player (player 1)
UnitStatsPanel: Populated 3 units for enemy (player 2)
Refreshed bottom panel unit lists for phase: DEPLOYMENT
Refreshing right panel unit list for deployment - found 3 undeployed units
GameState: ⚠️ all_units_deployed check - Undeployed units: ["U_BLADE_CHAMPION_A (player 1)", "U_WITCHSEEKERS_C (player 1)", "U_CALADIUS_GRAV-TANK_E (player 1)", "U_WARBOSS_B (player 2)", "U_WARBOSS_IN_MEGA_ARMOUR_D (player 2)", "U_BATTLEWAGON_G (player 2)"]
Main: ⚠️ update_ui() - DEPLOYMENT phase - all_deployed: false
Main: ⚠️ Button state BEFORE change - disabled: true text: 'End Deployment'
[2025-11-27 20:08:49] [INFO.0000000] update_ui deployment check | Context: {"all_deployed":false,"button_text":"End Deployment","current_button_disabled":true}
Main: ⚠️ update_ui() - Setting button DISABLED (not all deployed)
Main: ⚠️ Button state AFTER disable - disabled: true
Main: ⚠️ Initial phase UI setup complete
Quick Save/Load enabled: [ key to save, ] key (or F9) to load
[Test] Result file found!
[Test] Action completed: success=true, message=Unit deployed successfully
TestModeHandler: PhaseManager already has phase instance
[Test] Host performing action: get_game_state with params: {  }
[Test] Writing command file: host_75118_cmd_005.json
[Test] Waiting for result file...
[Test] Polling for result file: host_75118_cmd_005_result.json
TestModeHandler: Processing command file host_75118_cmd_005.json
TestModeHandler: Executing command from file: host_75118_cmd_005.json
TestModeHandler: Executing action: get_game_state
TestModeHandler: Handling get_game_state action
TestModeHandler: get_game_state - Phase: Deployment, Turn: 0, Player: 0
TestModeHandler: Result written to: host_75118_cmd_005_result.json
TestModeHandler: Command executed and result written
[Test] Result file found!
[Test] Action completed: success=true, message=Game state retrieved
[Test] Client performing action: get_game_state with params: {  }
[Test] Writing command file: client_75129_cmd_001.json
[Test] Waiting for result file...
[Test] Polling for result file: client_75129_cmd_001_result.json
TestModeHandler: Processing command file client_75129_cmd_001.json
TestModeHandler: Executing command from file: client_75129_cmd_001.json
TestModeHandler: Executing action: get_game_state
TestModeHandler: Handling get_game_state action
TestModeHandler: get_game_state - Phase: Deployment, Turn: 0, Player: 0
TestModeHandler: Result written to: client_75129_cmd_001_result.json
TestModeHandler: Command executed and result written
[Test] Result file found!
[Test] Action completed: success=true, message=Game state retrieved
[TEST] Host units count: 6
[TEST] Client units count: 6
[TEST] PASSED: Unit deployment successful

========================================
Cleaning up Multiplayer Test
========================================

[Test] Host performing action: get_game_state with params: {  }
[Test] Writing command file: host_75118_cmd_006.json
[Test] Waiting for result file...
[Test] Polling for result file: host_75118_cmd_006_result.json
TestModeHandler: Processing command file host_75118_cmd_006.json
TestModeHandler: Executing command from file: host_75118_cmd_006.json
TestModeHandler: Executing action: get_game_state
TestModeHandler: Handling get_game_state action
TestModeHandler: get_game_state - Phase: Deployment, Turn: 0, Player: 0
TestModeHandler: Result written to: host_75118_cmd_006_result.json
TestModeHandler: Command executed and result written
[Test] Result file found!
[Test] Action completed: success=true, message=Game state retrieved
[Test Artifacts] Report saved: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_artifacts/reports/unknown_test_2025-11-27T20-08-50.json
[GameInstance] Terminating instance: Host
[LogMonitor] Stopped monitoring: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251127_200831.log
[GameInstance] Terminating instance: Client
[LogMonitor] Stopped monitoring: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251127_200836.log

========================================
Starting Multiplayer Integration Test
========================================

  Running: test_deployment_outside_zone

[TEST] test_deployment_outside_zone
[Test] Launching host and client instances...
[GameInstance] Launching Host instance on port 8000
[GameInstance] Using project path: /Users/robertocallaghan/Documents/claude/godotv2/40k/
Godot Engine v4.5.1.stable.official.f62fdbde1 - https://godotengine.org
OpenGL API 4.1 INTEL-18.8.6 - Compatibility - Using Device: Intel Inc. - Intel(R) Iris(TM) Graphics 6100

TestModeHandler: Args -> ["--test-mode", "--position=100,100", "--resolution=600x480", "--auto-host", "--port=8000", "--instance-name=Host"]
[LogMonitor] Started monitoring: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251127_200836.log
[GameInstance] Monitoring log file: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251127_200836.log
[GameInstance] Successfully launched Host (PID: 75135)
[Test] Host instance launched successfully on port 8000
========================================
   RUNNING IN TEST MODE
   Config: { "window_position": (100, 100), "window_size": (600, 480), "is_host": true, "port": 8000, "instance_name": "Host" }
========================================
TestModeHandler: Command directories ready
  Commands: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_commands/commands
  Results: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_commands/results
[2025-11-27 20:08:54] [INFO.0000000] DebugLogger initialized - Session: 20251127_200854
[2025-11-27 20:08:54] [INFO.0000000] Log file: user://logs/debug_20251127_200854.log
[2025-11-27 20:08:54] [INFO.0000000] Real path: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251127_200854.log
[MeasuringTapeManager] Save persistence: false
Found armies in res://: ["orks", "adeptus_custodes", "space_marines", "A_C_test", "ORK_test"]
ArmyListManager initialized with 5 armies: ["orks", "adeptus_custodes", "space_marines", "A_C_test", "ORK_test"]
[2025-11-27 20:08:54] [INFO.0000000] DebugManager initialized
GameState: Loading default armies...
GameState: ArmyListManager not available, falling back to placeholder armies
GameState: Initializing placeholder armies for both players
GameState: Initializing placeholder army for player 1
GameState: Initializing placeholder army for player 2
ActionLogger: Started session 20251127_200854
StateSerializer: Pretty print enabled: true
SaveLoadManager: Current res:// directory: res://
SaveLoadManager: Project directory path: /Users/robertocallaghan/Documents/claude/godotv2/40k/
SaveLoadManager: Initialized save directories in project folder
SaveLoadManager: Save files will be stored at: /Users/robertocallaghan/Documents/claude/godotv2/40k/saves/
[PhaseManager] Ready - awaiting explicit phase initialization
[TerrainManager] Initializing terrain system
[TerrainManager] Added walls to terrain pieces
[TerrainManager] Loaded 12 terrain pieces
[EnhancedLineOfSight] Initialized
MissionManager: Initializing mission system
MissionManager: Set up 5 objectives for Strike Force deployment
  - obj_center at position (880.0, 1200.0)
  - obj_tl at position (400.0, 560.0)
  - obj_tr at position (1360.0, 560.0)
  - obj_bl at position (400.0, 1840.0)
  - obj_br at position (1360.0, 1840.0)
MissionManager: Initialized Take and Hold mission
[MeasuringTapeManager] Initialized with save_persistence: false
[LineOfSightManager] Initialized - Hold 'V' to check what can see the cursor position
TransportManager initialized
NetworkManager: Initialized
MainMenu: Initializing main menu
MainMenu: Loaded 5 armies: ["A C Test", "Adeptus Custodes", "ORK Test", "Orks", "Space Marines"]
MainMenu: Dropdowns populated with 5 armies
MainMenu: Multiplayer button visible: true
MainMenu: Signals connected
MainMenu: Save/Load dialog setup complete
MainMenu: Default armies set - Player 1: A C Test, Player 2: ORK Test
MainMenu: Ready with default selections
TestModeHandler: Set window position to (100, 100)
TestModeHandler: Set window size to (600, 480)
TestModeHandler: Scheduling auto-host...
SaveLoadDialog: Checking node references...
  - save_button path: VBoxContainer/SaveSection/SaveInputContainer/SaveButton
  - save_name_input path: VBoxContainer/SaveSection/SaveInputContainer/SaveNameInput
  - saves_list path: VBoxContainer/LoadSection/SavesScrollContainer/SavesList
  - load_button path: VBoxContainer/LoadSection/LoadButtonContainer/LoadButton
SaveLoadDialog: Connected save button
SaveLoadDialog: Connected save input
SaveLoadDialog: Connected saves list
SaveLoadDialog: Connected load button
SaveLoadDialog: Connected delete button
SaveLoadDialog: Connected cancel button
SaveLoadDialog UI signals connected
SaveLoadDialog: Found 29 save files
SaveLoadDialog: Populated list with 29 save files
SaveLoadDialog initialized successfully
[GameInstance] Launching Client instance on port 7778
[GameInstance] Using project path: /Users/robertocallaghan/Documents/claude/godotv2/40k/
TestModeHandler: Current scene: MainMenu
TestModeHandler: Triggering multiplayer mode...
MainMenu: Multiplayer button pressed
MultiplayerLobby: Army selection initialized with 5 armies
MultiplayerLobby: Ready
Godot Engine v4.5.1.stable.official.f62fdbde1 - https://godotengine.org
OpenGL API 4.1 INTEL-18.8.6 - Compatibility - Using Device: Intel Inc. - Intel(R) Iris(TM) Graphics 6100

TestModeHandler: Lobby scene: MultiplayerLobby
TestModeHandler: Creating host on port 8000
MultiplayerLobby: Host button pressed
========================================
   YOU ARE: PLAYER 1 (HOST)
   Hosting on port: 7777
========================================
MultiplayerLobby: Successfully hosting on port 7777
TestModeHandler: Waiting for client to connect...
TestModeHandler: Listening for peer connection...
TestModeHandler: Args -> ["--test-mode", "--position=800,100", "--resolution=600x480", "--auto-join", "--host-ip=127.0.0.1", "--host-port=8000", "--instance-name=Client"]
[LogMonitor] Started monitoring: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251127_200854.log
[GameInstance] Monitoring log file: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251127_200854.log
[GameInstance] Successfully launched Client (PID: 75143)
[Test] Client instance launched successfully
[Test] Waiting for client to connect to host...
[Test] Host performing action: get_game_state with params: {  }
[Test] Writing command file: host_75135_cmd_001.json
[Test] Waiting for result file...
[Test] Polling for result file: host_75135_cmd_001_result.json
TestModeHandler: Processing command file host_75135_cmd_001.json
TestModeHandler: Executing command from file: host_75135_cmd_001.json
TestModeHandler: Executing action: get_game_state
TestModeHandler: Handling get_game_state action
TestModeHandler: get_game_state - Phase: Deployment, Turn: 0, Player: 0
TestModeHandler: Result written to: host_75135_cmd_001_result.json
[Test] Result file found!
TestModeHandler: Command executed and result written
[Test] Action completed: success=true, message=Game state retrieved
[Test] Connection verified - action simulation working!
========================================
   RUNNING IN TEST MODE
   Config: { "window_position": (800, 100), "window_size": (600, 480), "is_host": false, "host_ip": "127.0.0.1", "host_port": 8000, "instance_name": "Client" }
========================================
TestModeHandler: Command directories ready
  Commands: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_commands/commands
  Results: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_commands/results
[2025-11-27 20:08:59] [INFO.0000000] DebugLogger initialized - Session: 20251127_200859
[2025-11-27 20:08:59] [INFO.0000000] Log file: user://logs/debug_20251127_200859.log
[2025-11-27 20:08:59] [INFO.0000000] Real path: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251127_200859.log
[MeasuringTapeManager] Save persistence: false
Found armies in res://: ["orks", "adeptus_custodes", "space_marines", "A_C_test", "ORK_test"]
ArmyListManager initialized with 5 armies: ["orks", "adeptus_custodes", "space_marines", "A_C_test", "ORK_test"]
[2025-11-27 20:08:59] [INFO.0000000] DebugManager initialized
GameState: Loading default armies...
GameState: ArmyListManager not available, falling back to placeholder armies
GameState: Initializing placeholder armies for both players
GameState: Initializing placeholder army for player 1
GameState: Initializing placeholder army for player 2
ActionLogger: Started session 20251127_200859
StateSerializer: Pretty print enabled: true
SaveLoadManager: Current res:// directory: res://
SaveLoadManager: Project directory path: /Users/robertocallaghan/Documents/claude/godotv2/40k/
SaveLoadManager: Initialized save directories in project folder
SaveLoadManager: Save files will be stored at: /Users/robertocallaghan/Documents/claude/godotv2/40k/saves/
[PhaseManager] Ready - awaiting explicit phase initialization
[TerrainManager] Initializing terrain system
[TerrainManager] Added walls to terrain pieces
[TerrainManager] Loaded 12 terrain pieces
[EnhancedLineOfSight] Initialized
MissionManager: Initializing mission system
MissionManager: Set up 5 objectives for Strike Force deployment
  - obj_center at position (880.0, 1200.0)
  - obj_tl at position (400.0, 560.0)
  - obj_tr at position (1360.0, 560.0)
  - obj_bl at position (400.0, 1840.0)
  - obj_br at position (1360.0, 1840.0)
MissionManager: Initialized Take and Hold mission
[MeasuringTapeManager] Initialized with save_persistence: false
[LineOfSightManager] Initialized - Hold 'V' to check what can see the cursor position
TransportManager initialized
NetworkManager: Initialized
MainMenu: Initializing main menu
MainMenu: Loaded 5 armies: ["A C Test", "Adeptus Custodes", "ORK Test", "Orks", "Space Marines"]
MainMenu: Dropdowns populated with 5 armies
MainMenu: Multiplayer button visible: true
MainMenu: Signals connected
MainMenu: Save/Load dialog setup complete
MainMenu: Default armies set - Player 1: A C Test, Player 2: ORK Test
MainMenu: Ready with default selections
TestModeHandler: Set window position to (800, 100)
TestModeHandler: Set window size to (600, 480)
TestModeHandler: Scheduling auto-join...
SaveLoadDialog: Checking node references...
  - save_button path: VBoxContainer/SaveSection/SaveInputContainer/SaveButton
  - save_name_input path: VBoxContainer/SaveSection/SaveInputContainer/SaveNameInput
  - saves_list path: VBoxContainer/LoadSection/SavesScrollContainer/SavesList
  - load_button path: VBoxContainer/LoadSection/LoadButtonContainer/LoadButton
SaveLoadDialog: Connected save button
SaveLoadDialog: Connected save input
SaveLoadDialog: Connected saves list
SaveLoadDialog: Connected load button
SaveLoadDialog: Connected delete button
SaveLoadDialog: Connected cancel button
SaveLoadDialog UI signals connected
SaveLoadDialog: Found 29 save files
SaveLoadDialog: Populated list with 29 save files
SaveLoadDialog initialized successfully
TestModeHandler: Current scene: MainMenu
TestModeHandler: Triggering multiplayer mode...
MainMenu: Multiplayer button pressed
MultiplayerLobby: Army selection initialized with 5 armies
MultiplayerLobby: Ready
[Test] Host performing action: get_available_units with params: {  }
[Test] Writing command file: host_75135_cmd_002.json
[Test] Waiting for result file...
[Test] Polling for result file: host_75135_cmd_002_result.json
TestModeHandler: Processing command file host_75135_cmd_002.json
TestModeHandler: Executing command from file: host_75135_cmd_002.json
TestModeHandler: Executing action: get_available_units
TestModeHandler: Handling get_available_units action
TestModeHandler: Player 1 units: ["U_INTERCESSORS_A", "U_TACTICAL_A"] (undeployed: ["U_INTERCESSORS_A", "U_TACTICAL_A"])
TestModeHandler: Player 2 units: ["U_BOYZ_A", "U_GRETCHIN_A"] (undeployed: ["U_BOYZ_A", "U_GRETCHIN_A"])
TestModeHandler: Result written to: host_75135_cmd_002_result.json
TestModeHandler: Command executed and result written
[Test] Result file found!
[Test] Action completed: success=true, message=Available units retrieved
[Test] Host performing action: deploy_unit with params: { "unit_id": "U_INTERCESSORS_A", "position": { "x": 22.0, "y": 30.0 } }
[Test] Writing command file: host_75135_cmd_003.json
[Test] Waiting for result file...
[Test] Polling for result file: host_75135_cmd_003_result.json
TestModeHandler: Processing command file host_75135_cmd_003.json
TestModeHandler: Executing command from file: host_75135_cmd_003.json
TestModeHandler: Executing action: deploy_unit
TestModeHandler: Handling deploy_unit action
GameManager: deploy_unit() called - unit_id: U_INTERCESSORS_A, position: (22.0, 30.0)
GameManager: Total units in GameState: 4
GameManager: Unit IDs: ["U_INTERCESSORS_A", "U_TACTICAL_A", "U_BOYZ_A", "U_GRETCHIN_A"]
GameManager: Switching active player from 1 to 2
GameManager: Applying result with 12 changes/diffs
GameManager: Setting units.U_INTERCESSORS_A.models.0.position = { "x": 22.0, "y": 30.0 }
GameManager: Setting units.U_INTERCESSORS_A.models.0.rotation = 0.0
GameManager: Setting units.U_INTERCESSORS_A.models.1.position = { "x": 22.0, "y": 30.0 }
GameManager: Setting units.U_INTERCESSORS_A.models.1.rotation = 0.0
GameManager: Setting units.U_INTERCESSORS_A.models.2.position = { "x": 22.0, "y": 30.0 }
GameManager: Setting units.U_INTERCESSORS_A.models.2.rotation = 0.0
GameManager: Setting units.U_INTERCESSORS_A.models.3.position = { "x": 22.0, "y": 30.0 }
GameManager: Setting units.U_INTERCESSORS_A.models.3.rotation = 0.0
GameManager: Setting units.U_INTERCESSORS_A.models.4.position = { "x": 22.0, "y": 30.0 }
GameManager: Setting units.U_INTERCESSORS_A.models.4.rotation = 0.0
GameManager: Setting units.U_INTERCESSORS_A.status = 2
GameManager: Setting meta.active_player = 2
GameManager: deploy_unit() result: success=true
TestModeHandler: Result written to: host_75135_cmd_003_result.json
TestModeHandler: Command executed and result written
[Test] Result file found!
[Test] Action completed: success=true, message=Unit deployed successfully
ASSERTION FAILED: test_deployment_outside_zone - Deployment outside zone should be rejected
[TEST] Deployment correctly rejected: Unit deployed successfully

========================================
Cleaning up Multiplayer Test
========================================

[Test] Host performing action: get_game_state with params: {  }
[Test] Writing command file: host_75135_cmd_004.json
[Test] Waiting for result file...
[Test] Polling for result file: host_75135_cmd_004_result.json
TestModeHandler: Processing command file host_75135_cmd_004.json
TestModeHandler: Executing command from file: host_75135_cmd_004.json
TestModeHandler: Executing action: get_game_state
TestModeHandler: Handling get_game_state action
TestModeHandler: get_game_state - Phase: Deployment, Turn: 0, Player: 0
TestModeHandler: Result written to: host_75135_cmd_004_result.json
TestModeHandler: Command executed and result written
[Test] Result file found!
[Test] Action completed: success=true, message=Game state retrieved
[Test Artifacts] Report saved: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_artifacts/reports/unknown_test_2025-11-27T20-09-02.json
[GameInstance] Terminating instance: Host
[LogMonitor] Stopped monitoring: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251127_200836.log
[GameInstance] Terminating instance: Client
[LogMonitor] Stopped monitoring: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251127_200854.log

========================================
Starting Multiplayer Integration Test
========================================

  Running: test_deployment_alternating_turns

[TEST] test_deployment_alternating_turns
[Test] Launching host and client instances...
[GameInstance] Launching Host instance on port 8000
[GameInstance] Using project path: /Users/robertocallaghan/Documents/claude/godotv2/40k/
Godot Engine v4.5.1.stable.official.f62fdbde1 - https://godotengine.org
OpenGL API 4.1 INTEL-18.8.6 - Compatibility - Using Device: Intel Inc. - Intel(R) Iris(TM) Graphics 6100

TestModeHandler: Args -> ["--test-mode", "--position=100,100", "--resolution=600x480", "--auto-host", "--port=8000", "--instance-name=Host"]
[LogMonitor] Started monitoring: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251127_200854.log
[GameInstance] Monitoring log file: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251127_200854.log
[GameInstance] Successfully launched Host (PID: 75148)
[Test] Host instance launched successfully on port 8000
========================================
   RUNNING IN TEST MODE
   Config: { "window_position": (100, 100), "window_size": (600, 480), "is_host": true, "port": 8000, "instance_name": "Host" }
========================================
TestModeHandler: Command directories ready
  Commands: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_commands/commands
  Results: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_commands/results
[2025-11-27 20:09:06] [INFO.0000000] DebugLogger initialized - Session: 20251127_200906
[2025-11-27 20:09:06] [INFO.0000000] Log file: user://logs/debug_20251127_200906.log
[2025-11-27 20:09:06] [INFO.0000000] Real path: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251127_200906.log
[MeasuringTapeManager] Save persistence: false
Found armies in res://: ["orks", "adeptus_custodes", "space_marines", "A_C_test", "ORK_test"]
ArmyListManager initialized with 5 armies: ["orks", "adeptus_custodes", "space_marines", "A_C_test", "ORK_test"]
[2025-11-27 20:09:06] [INFO.0000000] DebugManager initialized
GameState: Loading default armies...
GameState: ArmyListManager not available, falling back to placeholder armies
GameState: Initializing placeholder armies for both players
GameState: Initializing placeholder army for player 1
GameState: Initializing placeholder army for player 2
ActionLogger: Started session 20251127_200906
StateSerializer: Pretty print enabled: true
SaveLoadManager: Current res:// directory: res://
SaveLoadManager: Project directory path: /Users/robertocallaghan/Documents/claude/godotv2/40k/
SaveLoadManager: Initialized save directories in project folder
SaveLoadManager: Save files will be stored at: /Users/robertocallaghan/Documents/claude/godotv2/40k/saves/
[PhaseManager] Ready - awaiting explicit phase initialization
[TerrainManager] Initializing terrain system
[TerrainManager] Added walls to terrain pieces
[TerrainManager] Loaded 12 terrain pieces
[EnhancedLineOfSight] Initialized
MissionManager: Initializing mission system
MissionManager: Set up 5 objectives for Strike Force deployment
  - obj_center at position (880.0, 1200.0)
  - obj_tl at position (400.0, 560.0)
  - obj_tr at position (1360.0, 560.0)
  - obj_bl at position (400.0, 1840.0)
  - obj_br at position (1360.0, 1840.0)
MissionManager: Initialized Take and Hold mission
[MeasuringTapeManager] Initialized with save_persistence: false
[LineOfSightManager] Initialized - Hold 'V' to check what can see the cursor position
TransportManager initialized
NetworkManager: Initialized
MainMenu: Initializing main menu
MainMenu: Loaded 5 armies: ["A C Test", "Adeptus Custodes", "ORK Test", "Orks", "Space Marines"]
MainMenu: Dropdowns populated with 5 armies
MainMenu: Multiplayer button visible: true
MainMenu: Signals connected
MainMenu: Save/Load dialog setup complete
MainMenu: Default armies set - Player 1: A C Test, Player 2: ORK Test
MainMenu: Ready with default selections
TestModeHandler: Set window position to (100, 100)
TestModeHandler: Set window size to (600, 480)
TestModeHandler: Scheduling auto-host...
SaveLoadDialog: Checking node references...
  - save_button path: VBoxContainer/SaveSection/SaveInputContainer/SaveButton
  - save_name_input path: VBoxContainer/SaveSection/SaveInputContainer/SaveNameInput
  - saves_list path: VBoxContainer/LoadSection/SavesScrollContainer/SavesList
  - load_button path: VBoxContainer/LoadSection/LoadButtonContainer/LoadButton
SaveLoadDialog: Connected save button
SaveLoadDialog: Connected save input
SaveLoadDialog: Connected saves list
SaveLoadDialog: Connected load button
SaveLoadDialog: Connected delete button
SaveLoadDialog: Connected cancel button
SaveLoadDialog UI signals connected
SaveLoadDialog: Found 29 save files
SaveLoadDialog: Populated list with 29 save files
SaveLoadDialog initialized successfully
[GameInstance] Launching Client instance on port 7778
[GameInstance] Using project path: /Users/robertocallaghan/Documents/claude/godotv2/40k/
TestModeHandler: Current scene: MainMenu
TestModeHandler: Triggering multiplayer mode...
MainMenu: Multiplayer button pressed
MultiplayerLobby: Army selection initialized with 5 armies
MultiplayerLobby: Ready
Godot Engine v4.5.1.stable.official.f62fdbde1 - https://godotengine.org
OpenGL API 4.1 INTEL-18.8.6 - Compatibility - Using Device: Intel Inc. - Intel(R) Iris(TM) Graphics 6100

TestModeHandler: Lobby scene: MultiplayerLobby
TestModeHandler: Creating host on port 8000
MultiplayerLobby: Host button pressed
========================================
   YOU ARE: PLAYER 1 (HOST)
   Hosting on port: 7777
========================================
MultiplayerLobby: Successfully hosting on port 7777
TestModeHandler: Waiting for client to connect...
TestModeHandler: Listening for peer connection...
TestModeHandler: Args -> ["--test-mode", "--position=800,100", "--resolution=600x480", "--auto-join", "--host-ip=127.0.0.1", "--host-port=8000", "--instance-name=Client"]
[LogMonitor] Started monitoring: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251127_200906.log
[GameInstance] Monitoring log file: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251127_200906.log
[GameInstance] Successfully launched Client (PID: 75159)
[Test] Client instance launched successfully
[Test] Waiting for client to connect to host...
[Test] Host performing action: get_game_state with params: {  }
[Test] Writing command file: host_75148_cmd_001.json
[Test] Waiting for result file...
[Test] Polling for result file: host_75148_cmd_001_result.json
========================================
   RUNNING IN TEST MODE
   Config: { "window_position": (800, 100), "window_size": (600, 480), "is_host": false, "host_ip": "127.0.0.1", "host_port": 8000, "instance_name": "Client" }
========================================
TestModeHandler: Command directories ready
  Commands: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_commands/commands
  Results: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_commands/results
[2025-11-27 20:09:12] [INFO.0000000] DebugLogger initialized - Session: 20251127_200912
[2025-11-27 20:09:12] [INFO.0000000] Log file: user://logs/debug_20251127_200912.log
[2025-11-27 20:09:12] [INFO.0000000] Real path: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251127_200912.log
[MeasuringTapeManager] Save persistence: false
Found armies in res://: ["orks", "adeptus_custodes", "space_marines", "A_C_test", "ORK_test"]
ArmyListManager initialized with 5 armies: ["orks", "adeptus_custodes", "space_marines", "A_C_test", "ORK_test"]
[2025-11-27 20:09:12] [INFO.0000000] DebugManager initialized
GameState: Loading default armies...
GameState: ArmyListManager not available, falling back to placeholder armies
GameState: Initializing placeholder armies for both players
GameState: Initializing placeholder army for player 1
GameState: Initializing placeholder army for player 2
ActionLogger: Started session 20251127_200912
StateSerializer: Pretty print enabled: true
SaveLoadManager: Current res:// directory: res://
SaveLoadManager: Project directory path: /Users/robertocallaghan/Documents/claude/godotv2/40k/
SaveLoadManager: Initialized save directories in project folder
SaveLoadManager: Save files will be stored at: /Users/robertocallaghan/Documents/claude/godotv2/40k/saves/
[PhaseManager] Ready - awaiting explicit phase initialization
[TerrainManager] Initializing terrain system
[TerrainManager] Added walls to terrain pieces
[TerrainManager] Loaded 12 terrain pieces
[EnhancedLineOfSight] Initialized
MissionManager: Initializing mission system
MissionManager: Set up 5 objectives for Strike Force deployment
  - obj_center at position (880.0, 1200.0)
  - obj_tl at position (400.0, 560.0)
  - obj_tr at position (1360.0, 560.0)
  - obj_bl at position (400.0, 1840.0)
  - obj_br at position (1360.0, 1840.0)
MissionManager: Initialized Take and Hold mission
[MeasuringTapeManager] Initialized with save_persistence: false
[LineOfSightManager] Initialized - Hold 'V' to check what can see the cursor position
TransportManager initialized
NetworkManager: Initialized
MainMenu: Initializing main menu
MainMenu: Loaded 5 armies: ["A C Test", "Adeptus Custodes", "ORK Test", "Orks", "Space Marines"]
MainMenu: Dropdowns populated with 5 armies
MainMenu: Multiplayer button visible: true
MainMenu: Signals connected
MainMenu: Save/Load dialog setup complete
MainMenu: Default armies set - Player 1: A C Test, Player 2: ORK Test
MainMenu: Ready with default selections
TestModeHandler: Processing command file host_75148_cmd_001.json
TestModeHandler: Executing command from file: host_75148_cmd_001.json
TestModeHandler: Executing action: get_game_state
TestModeHandler: Handling get_game_state action
TestModeHandler: get_game_state - Phase: Deployment, Turn: 0, Player: 0
TestModeHandler: Result written to: host_75148_cmd_001_result.json
TestModeHandler: Command executed and result written
TestModeHandler: Set window position to (800, 100)
TestModeHandler: Set window size to (600, 480)
TestModeHandler: Scheduling auto-join...
SaveLoadDialog: Checking node references...
  - save_button path: VBoxContainer/SaveSection/SaveInputContainer/SaveButton
  - save_name_input path: VBoxContainer/SaveSection/SaveInputContainer/SaveNameInput
  - saves_list path: VBoxContainer/LoadSection/SavesScrollContainer/SavesList
  - load_button path: VBoxContainer/LoadSection/LoadButtonContainer/LoadButton
SaveLoadDialog: Connected save button
SaveLoadDialog: Connected save input
SaveLoadDialog: Connected saves list
SaveLoadDialog: Connected load button
SaveLoadDialog: Connected delete button
SaveLoadDialog: Connected cancel button
SaveLoadDialog UI signals connected
[Test] Result file found!
[Test] Action completed: success=true, message=Game state retrieved
[Test] Connection verified - action simulation working!
SaveLoadDialog: Found 29 save files
SaveLoadDialog: Populated list with 29 save files
SaveLoadDialog initialized successfully
TestModeHandler: Current scene: MainMenu
TestModeHandler: Triggering multiplayer mode...
MainMenu: Multiplayer button pressed
MultiplayerLobby: Army selection initialized with 5 armies
MultiplayerLobby: Ready
[Test] Host performing action: get_available_units with params: {  }
[Test] Writing command file: host_75148_cmd_002.json
[Test] Waiting for result file...
[Test] Polling for result file: host_75148_cmd_002_result.json
TestModeHandler: Processing command file host_75148_cmd_002.json
TestModeHandler: Executing command from file: host_75148_cmd_002.json
TestModeHandler: Executing action: get_available_units
TestModeHandler: Handling get_available_units action
TestModeHandler: Player 1 units: ["U_INTERCESSORS_A", "U_TACTICAL_A"] (undeployed: ["U_INTERCESSORS_A", "U_TACTICAL_A"])
TestModeHandler: Player 2 units: ["U_BOYZ_A", "U_GRETCHIN_A"] (undeployed: ["U_BOYZ_A", "U_GRETCHIN_A"])
TestModeHandler: Result written to: host_75148_cmd_002_result.json
TestModeHandler: Command executed and result written
[Test] Result file found!
[Test] Action completed: success=true, message=Available units retrieved
[TEST] Using unit: U_INTERCESSORS_A
[Test] Host performing action: get_game_state with params: {  }
[Test] Writing command file: host_75148_cmd_003.json
[Test] Waiting for result file...
[Test] Polling for result file: host_75148_cmd_003_result.json
TestModeHandler: Processing command file host_75148_cmd_003.json
TestModeHandler: Executing command from file: host_75148_cmd_003.json
TestModeHandler: Executing action: get_game_state
TestModeHandler: Handling get_game_state action
TestModeHandler: get_game_state - Phase: Deployment, Turn: 0, Player: 0
TestModeHandler: Result written to: host_75148_cmd_003_result.json
TestModeHandler: Command executed and result written
[Test] Result file found!
[Test] Action completed: success=true, message=Game state retrieved
[TEST] Initial turn: Player 0.0
[Test] Host performing action: deploy_unit with params: { "unit_id": "U_INTERCESSORS_A", "position": { "x": 100.0, "y": 100.0 } }
[Test] Writing command file: host_75148_cmd_004.json
[Test] Waiting for result file...
[Test] Polling for result file: host_75148_cmd_004_result.json
TestModeHandler: Processing command file host_75148_cmd_004.json
TestModeHandler: Executing command from file: host_75148_cmd_004.json
TestModeHandler: Executing action: deploy_unit
TestModeHandler: Handling deploy_unit action
GameManager: deploy_unit() called - unit_id: U_INTERCESSORS_A, position: (100.0, 100.0)
GameManager: Total units in GameState: 4
GameManager: Unit IDs: ["U_INTERCESSORS_A", "U_TACTICAL_A", "U_BOYZ_A", "U_GRETCHIN_A"]
GameManager: Switching active player from 1 to 2
GameManager: Applying result with 12 changes/diffs
GameManager: Setting units.U_INTERCESSORS_A.models.0.position = { "x": 100.0, "y": 100.0 }
GameManager: Setting units.U_INTERCESSORS_A.models.0.rotation = 0.0
GameManager: Setting units.U_INTERCESSORS_A.models.1.position = { "x": 100.0, "y": 100.0 }
GameManager: Setting units.U_INTERCESSORS_A.models.1.rotation = 0.0
GameManager: Setting units.U_INTERCESSORS_A.models.2.position = { "x": 100.0, "y": 100.0 }
GameManager: Setting units.U_INTERCESSORS_A.models.2.rotation = 0.0
GameManager: Setting units.U_INTERCESSORS_A.models.3.position = { "x": 100.0, "y": 100.0 }
GameManager: Setting units.U_INTERCESSORS_A.models.3.rotation = 0.0
GameManager: Setting units.U_INTERCESSORS_A.models.4.position = { "x": 100.0, "y": 100.0 }
GameManager: Setting units.U_INTERCESSORS_A.models.4.rotation = 0.0
GameManager: Setting units.U_INTERCESSORS_A.status = 2
GameManager: Setting meta.active_player = 2
GameManager: deploy_unit() result: success=true
TestModeHandler: Result written to: host_75148_cmd_004_result.json
TestModeHandler: Command executed and result written
[Test] Result file found!
[Test] Action completed: success=true, message=Unit deployed successfully
TestModeHandler: Lobby scene: MultiplayerLobby
TestModeHandler: Joining host at 127.0.0.1
MultiplayerLobby: Join button pressed
NetworkManager: Connecting to 127.0.0.1:7777
MultiplayerLobby: Attempting to join 127.0.0.1:7777
NetworkManager: Peer connected - 1
NetworkManager: Successfully connected to host
NetworkManager: Client set peer_to_player_map[544071268] = 2
========================================
   YOU ARE: PLAYER 2 (CLIENT)
   Connected to host
========================================
MultiplayerLobby: Peer connected - 1
MultiplayerLobby: Game started signal received
NetworkManager: Peer connected - 544071268
[GameState] MeasuringTapeManager not available
MultiplayerLobby: Peer connected - 544071268
TestModeHandler: Client connected!
MultiplayerLobby: Game started signal received
NetworkManager: Receiving initial state from host
[GameState] No measuring_tape data in save
NetworkManager: State synchronized
MultiplayerLobby: Game started signal received
MultiplayerLobby: Syncing army selection - Player 1 -> A_C_test
MultiplayerLobby: Syncing army selection - Player 2 -> ORK_test
[Test] Host performing action: get_game_state with params: {  }
[Test] Writing command file: host_75148_cmd_005.json
[Test] Waiting for result file...
[Test] Polling for result file: host_75148_cmd_005_result.json
TestModeHandler: Processing command file host_75148_cmd_005.json
TestModeHandler: Executing command from file: host_75148_cmd_005.json
TestModeHandler: Executing action: get_game_state
TestModeHandler: Handling get_game_state action
TestModeHandler: get_game_state - Phase: Deployment, Turn: 0, Player: 0
TestModeHandler: Result written to: host_75148_cmd_005_result.json
TestModeHandler: Command executed and result written
[Test] Result file found!
[Test] Action completed: success=true, message=Game state retrieved
[TEST] Turn after deployment: Player 0.0
[TEST] Turn alternation test completed

========================================
Cleaning up Multiplayer Test
========================================

[Test] Host performing action: get_game_state with params: {  }
[Test] Writing command file: host_75148_cmd_006.json
[Test] Waiting for result file...
[Test] Polling for result file: host_75148_cmd_006_result.json
TestModeHandler: Starting game...
MultiplayerLobby: Start game button pressed
MultiplayerLobby: Loading armies...
MultiplayerLobby: Loading A_C_test for Player 1
Loading army list: A_C_test for player 1
Processed unit: U_BLADE_CHAMPION_A for player 1
Processed unit: U_WITCHSEEKERS_C for player 1
Processed unit: U_CALADIUS_GRAV-TANK_E for player 1
Successfully loaded army: A_C_test with 3 units
MultiplayerLobby: Player 1 army loaded, has 3 units
Applying army to game state for player: 1
Removing 0 existing units for player 1
Added unit: U_BLADE_CHAMPION_A (Blade Champion)
Added unit: U_WITCHSEEKERS_C (Witchseekers)
Added unit: U_CALADIUS_GRAV-TANK_E (Caladius Grav-tank)
Set faction for player 1: Adeptus Custodes
Army applied successfully. Total units in game: 3
MultiplayerLobby: After applying P1 army, GameState has 3 units
MultiplayerLobby: Loading ORK_test for Player 2
Loading army list: ORK_test for player 2
Processed unit: U_WARBOSS_B for player 2
Processed unit: U_WARBOSS_IN_MEGA_ARMOUR_D for player 2
[2025-11-27 20:09:16] [DEBUG.0000000] Parsed transport capacity keywords | Context: {"description":"This model has a transport capacity of 22 ORKS INFANTRY models. Each MEGA ARMOUR model takes up the space of 2 models. This model cannot transport models that are JUMP PACK models.","keywords":["ORKS","INFANTRY"],"unit_id":"U_BATTLEWAGON_G"}
Processed unit: U_BATTLEWAGON_G for player 2
Successfully loaded army: ORK_test with 3 units
MultiplayerLobby: Player 2 army loaded, has 3 units
Applying army to game state for player: 2
Removing 0 existing units for player 2
Added unit: U_WARBOSS_B (Warboss)
Added unit: U_WARBOSS_IN_MEGA_ARMOUR_D (Warboss in Mega Armour)
Added unit: U_BATTLEWAGON_G (Battlewagon)
Set faction for player 2: Unknown
Army applied successfully. Total units in game: 6
MultiplayerLobby: After applying P2 army, GameState has 6 units
MultiplayerLobby: Armies loaded. Total units: 6
MultiplayerLobby: Syncing loaded armies to clients...
[GameState] MeasuringTapeManager not available
MultiplayerLobby: Snapshot has 6 units
MultiplayerLobby: Sent army snapshot to peer 544071268
NetworkManager: Receiving initial state from host
[GameState] No measuring_tape data in save
NetworkManager: State synchronized
MultiplayerLobby: Game started signal received
TestModeHandler: Processing command file host_75148_cmd_006.json
TestModeHandler: Executing command from file: host_75148_cmd_006.json
TestModeHandler: Executing action: get_game_state
TestModeHandler: Handling get_game_state action
TestModeHandler: get_game_state - Phase: Deployment, Turn: 0, Player: 0
TestModeHandler: Result written to: host_75148_cmd_006_result.json
TestModeHandler: Command executed and result written
[Test] Result file found!
[Test] Action completed: success=true, message=Game state retrieved
[Test Artifacts] Report saved: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_artifacts/reports/unknown_test_2025-11-27T20-09-16.json
[GameInstance] Terminating instance: Host
[LogMonitor] Stopped monitoring: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251127_200854.log
[GameInstance] Terminating instance: Client
[LogMonitor] Stopped monitoring: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251127_200906.log

========================================
Starting Multiplayer Integration Test
========================================

  Running: test_deployment_wrong_turn

[TEST] test_deployment_wrong_turn
[Test] Launching host and client instances...
[GameInstance] Launching Host instance on port 8000
[GameInstance] Using project path: /Users/robertocallaghan/Documents/claude/godotv2/40k/
Godot Engine v4.5.1.stable.official.f62fdbde1 - https://godotengine.org
OpenGL API 4.1 INTEL-18.8.6 - Compatibility - Using Device: Intel Inc. - Intel(R) Iris(TM) Graphics 6100

TestModeHandler: Args -> ["--test-mode", "--position=100,100", "--resolution=600x480", "--auto-host", "--port=8000", "--instance-name=Host"]
[LogMonitor] Started monitoring: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251127_200906.log
[GameInstance] Monitoring log file: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251127_200906.log
[GameInstance] Successfully launched Host (PID: 75164)
[Test] Host instance launched successfully on port 8000
========================================
   RUNNING IN TEST MODE
   Config: { "window_position": (100, 100), "window_size": (600, 480), "is_host": true, "port": 8000, "instance_name": "Host" }
========================================
TestModeHandler: Command directories ready
  Commands: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_commands/commands
  Results: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_commands/results
[2025-11-27 20:09:20] [INFO.0000000] DebugLogger initialized - Session: 20251127_200920
[2025-11-27 20:09:20] [INFO.0000000] Log file: user://logs/debug_20251127_200920.log
[2025-11-27 20:09:20] [INFO.0000000] Real path: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251127_200920.log
[MeasuringTapeManager] Save persistence: false
Found armies in res://: ["orks", "adeptus_custodes", "space_marines", "A_C_test", "ORK_test"]
ArmyListManager initialized with 5 armies: ["orks", "adeptus_custodes", "space_marines", "A_C_test", "ORK_test"]
[2025-11-27 20:09:20] [INFO.0000000] DebugManager initialized
GameState: Loading default armies...
GameState: ArmyListManager not available, falling back to placeholder armies
GameState: Initializing placeholder armies for both players
GameState: Initializing placeholder army for player 1
GameState: Initializing placeholder army for player 2
ActionLogger: Started session 20251127_200920
StateSerializer: Pretty print enabled: true
SaveLoadManager: Current res:// directory: res://
SaveLoadManager: Project directory path: /Users/robertocallaghan/Documents/claude/godotv2/40k/
SaveLoadManager: Initialized save directories in project folder
SaveLoadManager: Save files will be stored at: /Users/robertocallaghan/Documents/claude/godotv2/40k/saves/
[PhaseManager] Ready - awaiting explicit phase initialization
[TerrainManager] Initializing terrain system
[TerrainManager] Added walls to terrain pieces
[TerrainManager] Loaded 12 terrain pieces
[EnhancedLineOfSight] Initialized
MissionManager: Initializing mission system
MissionManager: Set up 5 objectives for Strike Force deployment
  - obj_center at position (880.0, 1200.0)
  - obj_tl at position (400.0, 560.0)
  - obj_tr at position (1360.0, 560.0)
  - obj_bl at position (400.0, 1840.0)
  - obj_br at position (1360.0, 1840.0)
MissionManager: Initialized Take and Hold mission
[MeasuringTapeManager] Initialized with save_persistence: false
[LineOfSightManager] Initialized - Hold 'V' to check what can see the cursor position
TransportManager initialized
NetworkManager: Initialized
MainMenu: Initializing main menu
MainMenu: Loaded 5 armies: ["A C Test", "Adeptus Custodes", "ORK Test", "Orks", "Space Marines"]
MainMenu: Dropdowns populated with 5 armies
MainMenu: Multiplayer button visible: true
MainMenu: Signals connected
MainMenu: Save/Load dialog setup complete
MainMenu: Default armies set - Player 1: A C Test, Player 2: ORK Test
MainMenu: Ready with default selections
TestModeHandler: Set window position to (100, 100)
TestModeHandler: Set window size to (600, 480)
TestModeHandler: Scheduling auto-host...
SaveLoadDialog: Checking node references...
  - save_button path: VBoxContainer/SaveSection/SaveInputContainer/SaveButton
  - save_name_input path: VBoxContainer/SaveSection/SaveInputContainer/SaveNameInput
  - saves_list path: VBoxContainer/LoadSection/SavesScrollContainer/SavesList
  - load_button path: VBoxContainer/LoadSection/LoadButtonContainer/LoadButton
SaveLoadDialog: Connected save button
SaveLoadDialog: Connected save input
SaveLoadDialog: Connected saves list
SaveLoadDialog: Connected load button
SaveLoadDialog: Connected delete button
SaveLoadDialog: Connected cancel button
SaveLoadDialog UI signals connected
SaveLoadDialog: Found 29 save files
SaveLoadDialog: Populated list with 29 save files
SaveLoadDialog initialized successfully
[GameInstance] Launching Client instance on port 7778
[GameInstance] Using project path: /Users/robertocallaghan/Documents/claude/godotv2/40k/
TestModeHandler: Current scene: MainMenu
TestModeHandler: Triggering multiplayer mode...
MainMenu: Multiplayer button pressed
MultiplayerLobby: Army selection initialized with 5 armies
MultiplayerLobby: Ready
Godot Engine v4.5.1.stable.official.f62fdbde1 - https://godotengine.org
OpenGL API 4.1 INTEL-18.8.6 - Compatibility - Using Device: Intel Inc. - Intel(R) Iris(TM) Graphics 6100

TestModeHandler: Lobby scene: MultiplayerLobby
TestModeHandler: Creating host on port 8000
MultiplayerLobby: Host button pressed
========================================
   YOU ARE: PLAYER 1 (HOST)
   Hosting on port: 7777
========================================
MultiplayerLobby: Successfully hosting on port 7777
TestModeHandler: Waiting for client to connect...
TestModeHandler: Listening for peer connection...
TestModeHandler: Args -> ["--test-mode", "--position=800,100", "--resolution=600x480", "--auto-join", "--host-ip=127.0.0.1", "--host-port=8000", "--instance-name=Client"]
[LogMonitor] Started monitoring: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251127_200920.log
[GameInstance] Monitoring log file: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251127_200920.log
[GameInstance] Successfully launched Client (PID: 75171)
[Test] Client instance launched successfully
[Test] Waiting for client to connect to host...
[Test] Host performing action: get_game_state with params: {  }
[Test] Writing command file: host_75164_cmd_001.json
[Test] Waiting for result file...
[Test] Polling for result file: host_75164_cmd_001_result.json
TestModeHandler: Processing command file host_75164_cmd_001.json
TestModeHandler: Executing command from file: host_75164_cmd_001.json
TestModeHandler: Executing action: get_game_state
TestModeHandler: Handling get_game_state action
TestModeHandler: get_game_state - Phase: Deployment, Turn: 0, Player: 0
TestModeHandler: Result written to: host_75164_cmd_001_result.json
TestModeHandler: Command executed and result written
[Test] Result file found!
[Test] Action completed: success=true, message=Game state retrieved
[Test] Connection verified - action simulation working!
========================================
   RUNNING IN TEST MODE
   Config: { "window_position": (800, 100), "window_size": (600, 480), "is_host": false, "host_ip": "127.0.0.1", "host_port": 8000, "instance_name": "Client" }
========================================
TestModeHandler: Command directories ready
  Commands: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_commands/commands
  Results: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_commands/results
[2025-11-27 20:09:26] [INFO.0000000] DebugLogger initialized - Session: 20251127_200926
[2025-11-27 20:09:26] [INFO.0000000] Log file: user://logs/debug_20251127_200926.log
[2025-11-27 20:09:26] [INFO.0000000] Real path: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251127_200926.log
[MeasuringTapeManager] Save persistence: false
Found armies in res://: ["orks", "adeptus_custodes", "space_marines", "A_C_test", "ORK_test"]
ArmyListManager initialized with 5 armies: ["orks", "adeptus_custodes", "space_marines", "A_C_test", "ORK_test"]
[2025-11-27 20:09:26] [INFO.0000000] DebugManager initialized
GameState: Loading default armies...
GameState: ArmyListManager not available, falling back to placeholder armies
GameState: Initializing placeholder armies for both players
GameState: Initializing placeholder army for player 1
GameState: Initializing placeholder army for player 2
ActionLogger: Started session 20251127_200926
StateSerializer: Pretty print enabled: true
SaveLoadManager: Current res:// directory: res://
SaveLoadManager: Project directory path: /Users/robertocallaghan/Documents/claude/godotv2/40k/
SaveLoadManager: Initialized save directories in project folder
SaveLoadManager: Save files will be stored at: /Users/robertocallaghan/Documents/claude/godotv2/40k/saves/
[PhaseManager] Ready - awaiting explicit phase initialization
[TerrainManager] Initializing terrain system
[TerrainManager] Added walls to terrain pieces
[TerrainManager] Loaded 12 terrain pieces
[EnhancedLineOfSight] Initialized
MissionManager: Initializing mission system
MissionManager: Set up 5 objectives for Strike Force deployment
  - obj_center at position (880.0, 1200.0)
  - obj_tl at position (400.0, 560.0)
  - obj_tr at position (1360.0, 560.0)
  - obj_bl at position (400.0, 1840.0)
  - obj_br at position (1360.0, 1840.0)
MissionManager: Initialized Take and Hold mission
[MeasuringTapeManager] Initialized with save_persistence: false
[LineOfSightManager] Initialized - Hold 'V' to check what can see the cursor position
TransportManager initialized
NetworkManager: Initialized
MainMenu: Initializing main menu
MainMenu: Loaded 5 armies: ["A C Test", "Adeptus Custodes", "ORK Test", "Orks", "Space Marines"]
MainMenu: Dropdowns populated with 5 armies
MainMenu: Multiplayer button visible: true
MainMenu: Signals connected
MainMenu: Save/Load dialog setup complete
MainMenu: Default armies set - Player 1: A C Test, Player 2: ORK Test
MainMenu: Ready with default selections
TestModeHandler: Set window position to (800, 100)
TestModeHandler: Set window size to (600, 480)
TestModeHandler: Scheduling auto-join...
SaveLoadDialog: Checking node references...
  - save_button path: VBoxContainer/SaveSection/SaveInputContainer/SaveButton
  - save_name_input path: VBoxContainer/SaveSection/SaveInputContainer/SaveNameInput
  - saves_list path: VBoxContainer/LoadSection/SavesScrollContainer/SavesList
  - load_button path: VBoxContainer/LoadSection/LoadButtonContainer/LoadButton
SaveLoadDialog: Connected save button
SaveLoadDialog: Connected save input
SaveLoadDialog: Connected saves list
SaveLoadDialog: Connected load button
SaveLoadDialog: Connected delete button
SaveLoadDialog: Connected cancel button
SaveLoadDialog UI signals connected
SaveLoadDialog: Found 29 save files
SaveLoadDialog: Populated list with 29 save files
SaveLoadDialog initialized successfully
TestModeHandler: Current scene: MainMenu
TestModeHandler: Triggering multiplayer mode...
MainMenu: Multiplayer button pressed
MultiplayerLobby: Army selection initialized with 5 armies
MultiplayerLobby: Ready
[Test] Host performing action: get_available_units with params: {  }
[Test] Writing command file: host_75164_cmd_002.json
[Test] Waiting for result file...
[Test] Polling for result file: host_75164_cmd_002_result.json
TestModeHandler: Processing command file host_75164_cmd_002.json
TestModeHandler: Executing command from file: host_75164_cmd_002.json
TestModeHandler: Executing action: get_available_units
TestModeHandler: Handling get_available_units action
TestModeHandler: Player 1 units: ["U_INTERCESSORS_A", "U_TACTICAL_A"] (undeployed: ["U_INTERCESSORS_A", "U_TACTICAL_A"])
TestModeHandler: Player 2 units: ["U_BOYZ_A", "U_GRETCHIN_A"] (undeployed: ["U_BOYZ_A", "U_GRETCHIN_A"])
TestModeHandler: Result written to: host_75164_cmd_002_result.json
TestModeHandler: Command executed and result written
[Test] Result file found!
[Test] Action completed: success=true, message=Available units retrieved
[TEST] Using Player 2 unit: U_BOYZ_A
[Test] Host performing action: get_game_state with params: {  }
[Test] Writing command file: host_75164_cmd_003.json
[Test] Waiting for result file...
[Test] Polling for result file: host_75164_cmd_003_result.json
TestModeHandler: Processing command file host_75164_cmd_003.json
TestModeHandler: Executing command from file: host_75164_cmd_003.json
TestModeHandler: Executing action: get_game_state
TestModeHandler: Handling get_game_state action
TestModeHandler: get_game_state - Phase: Deployment, Turn: 0, Player: 0
TestModeHandler: Result written to: host_75164_cmd_003_result.json
TestModeHandler: Command executed and result written
[Test] Result file found!
[Test] Action completed: success=true, message=Game state retrieved
[TEST] Current turn: Player 0.0
[Test] Client performing action: deploy_unit with params: { "unit_id": "U_BOYZ_A", "position": { "x": 100.0, "y": 2100.0 } }
[Test] Writing command file: client_75171_cmd_001.json
[Test] Waiting for result file...
[Test] Polling for result file: client_75171_cmd_001_result.json
TestModeHandler: Processing command file client_75171_cmd_001.json
TestModeHandler: Executing command from file: client_75171_cmd_001.json
TestModeHandler: Executing action: deploy_unit
TestModeHandler: Handling deploy_unit action
GameManager: deploy_unit() called - unit_id: U_BOYZ_A, position: (100.0, 2100.0)
GameManager: Total units in GameState: 4
GameManager: Unit IDs: ["U_INTERCESSORS_A", "U_TACTICAL_A", "U_BOYZ_A", "U_GRETCHIN_A"]
GameManager: Switching active player from 1 to 2
GameManager: Applying result with 22 changes/diffs
GameManager: Setting units.U_BOYZ_A.models.0.position = { "x": 100.0, "y": 2100.0 }
GameManager: Setting units.U_BOYZ_A.models.0.rotation = 0.0
GameManager: Setting units.U_BOYZ_A.models.1.position = { "x": 100.0, "y": 2100.0 }
GameManager: Setting units.U_BOYZ_A.models.1.rotation = 0.0
GameManager: Setting units.U_BOYZ_A.models.2.position = { "x": 100.0, "y": 2100.0 }
GameManager: Setting units.U_BOYZ_A.models.2.rotation = 0.0
GameManager: Setting units.U_BOYZ_A.models.3.position = { "x": 100.0, "y": 2100.0 }
GameManager: Setting units.U_BOYZ_A.models.3.rotation = 0.0
GameManager: Setting units.U_BOYZ_A.models.4.position = { "x": 100.0, "y": 2100.0 }
GameManager: Setting units.U_BOYZ_A.models.4.rotation = 0.0
GameManager: Setting units.U_BOYZ_A.models.5.position = { "x": 100.0, "y": 2100.0 }
GameManager: Setting units.U_BOYZ_A.models.5.rotation = 0.0
GameManager: Setting units.U_BOYZ_A.models.6.position = { "x": 100.0, "y": 2100.0 }
GameManager: Setting units.U_BOYZ_A.models.6.rotation = 0.0
GameManager: Setting units.U_BOYZ_A.models.7.position = { "x": 100.0, "y": 2100.0 }
GameManager: Setting units.U_BOYZ_A.models.7.rotation = 0.0
GameManager: Setting units.U_BOYZ_A.models.8.position = { "x": 100.0, "y": 2100.0 }
GameManager: Setting units.U_BOYZ_A.models.8.rotation = 0.0
GameManager: Setting units.U_BOYZ_A.models.9.position = { "x": 100.0, "y": 2100.0 }
GameManager: Setting units.U_BOYZ_A.models.9.rotation = 0.0
GameManager: Setting units.U_BOYZ_A.status = 2
GameManager: Setting meta.active_player = 2
GameManager: deploy_unit() result: success=true
TestModeHandler: Result written to: client_75171_cmd_001_result.json
TestModeHandler: Command executed and result written
[Test] Result file found!
[Test] Action completed: success=true, message=Unit deployed successfully
[TEST] Wrong turn deployment result: success=true message=Unit deployed successfully
ASSERTION FAILED: test_deployment_wrong_turn - Player 2 should not be able to deploy when it's not their turn
[TEST] PASSED: Wrong turn deployment correctly rejected

========================================
Cleaning up Multiplayer Test
========================================

[Test] Host performing action: get_game_state with params: {  }
[Test] Writing command file: host_75164_cmd_004.json
[Test] Waiting for result file...
[Test] Polling for result file: host_75164_cmd_004_result.json
TestModeHandler: Processing command file host_75164_cmd_004.json
TestModeHandler: Executing command from file: host_75164_cmd_004.json
TestModeHandler: Executing action: get_game_state
TestModeHandler: Handling get_game_state action
TestModeHandler: get_game_state - Phase: Deployment, Turn: 0, Player: 0
TestModeHandler: Result written to: host_75164_cmd_004_result.json
TestModeHandler: Command executed and result written
[Test] Result file found!
[Test] Action completed: success=true, message=Game state retrieved
[Test Artifacts] Report saved: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_artifacts/reports/unknown_test_2025-11-27T20-09-29.json
[GameInstance] Terminating instance: Host
[LogMonitor] Stopped monitoring: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251127_200906.log
[GameInstance] Terminating instance: Client
[LogMonitor] Stopped monitoring: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251127_200920.log

========================================
Starting Multiplayer Integration Test
========================================

  Running: test_deployment_blocked_by_terrain

[TEST] test_deployment_blocked_by_terrain
[Test] Launching host and client instances...
[GameInstance] Launching Host instance on port 8000
[GameInstance] Using project path: /Users/robertocallaghan/Documents/claude/godotv2/40k/
Godot Engine v4.5.1.stable.official.f62fdbde1 - https://godotengine.org
OpenGL API 4.1 INTEL-18.8.6 - Compatibility - Using Device: Intel Inc. - Intel(R) Iris(TM) Graphics 6100

[LogMonitor] Started monitoring: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251127_200926.log
[GameInstance] Monitoring log file: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251127_200926.log
[GameInstance] Successfully launched Host (PID: 75179)
[Test] Host instance launched successfully on port 8000
TestModeHandler: Args -> ["--test-mode", "--position=100,100", "--resolution=600x480", "--auto-host", "--port=8000", "--instance-name=Host"]
========================================
   RUNNING IN TEST MODE
   Config: { "window_position": (100, 100), "window_size": (600, 480), "is_host": true, "port": 8000, "instance_name": "Host" }
========================================
TestModeHandler: Command directories ready
  Commands: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_commands/commands
  Results: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_commands/results
[2025-11-27 20:09:33] [INFO.0000000] DebugLogger initialized - Session: 20251127_200933
[2025-11-27 20:09:33] [INFO.0000000] Log file: user://logs/debug_20251127_200933.log
[2025-11-27 20:09:33] [INFO.0000000] Real path: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251127_200933.log
[MeasuringTapeManager] Save persistence: false
Found armies in res://: ["orks", "adeptus_custodes", "space_marines", "A_C_test", "ORK_test"]
ArmyListManager initialized with 5 armies: ["orks", "adeptus_custodes", "space_marines", "A_C_test", "ORK_test"]
[2025-11-27 20:09:33] [INFO.0000000] DebugManager initialized
GameState: Loading default armies...
GameState: ArmyListManager not available, falling back to placeholder armies
GameState: Initializing placeholder armies for both players
GameState: Initializing placeholder army for player 1
GameState: Initializing placeholder army for player 2
ActionLogger: Started session 20251127_200933
StateSerializer: Pretty print enabled: true
SaveLoadManager: Current res:// directory: res://
SaveLoadManager: Project directory path: /Users/robertocallaghan/Documents/claude/godotv2/40k/
SaveLoadManager: Initialized save directories in project folder
SaveLoadManager: Save files will be stored at: /Users/robertocallaghan/Documents/claude/godotv2/40k/saves/
[PhaseManager] Ready - awaiting explicit phase initialization
[TerrainManager] Initializing terrain system
[TerrainManager] Added walls to terrain pieces
[TerrainManager] Loaded 12 terrain pieces
[EnhancedLineOfSight] Initialized
MissionManager: Initializing mission system
MissionManager: Set up 5 objectives for Strike Force deployment
  - obj_center at position (880.0, 1200.0)
  - obj_tl at position (400.0, 560.0)
  - obj_tr at position (1360.0, 560.0)
  - obj_bl at position (400.0, 1840.0)
  - obj_br at position (1360.0, 1840.0)
MissionManager: Initialized Take and Hold mission
[MeasuringTapeManager] Initialized with save_persistence: false
[LineOfSightManager] Initialized - Hold 'V' to check what can see the cursor position
TransportManager initialized
NetworkManager: Initialized
MainMenu: Initializing main menu
MainMenu: Loaded 5 armies: ["A C Test", "Adeptus Custodes", "ORK Test", "Orks", "Space Marines"]
MainMenu: Dropdowns populated with 5 armies
MainMenu: Multiplayer button visible: true
MainMenu: Signals connected
MainMenu: Save/Load dialog setup complete
MainMenu: Default armies set - Player 1: A C Test, Player 2: ORK Test
MainMenu: Ready with default selections
TestModeHandler: Set window position to (100, 100)
TestModeHandler: Set window size to (600, 480)
TestModeHandler: Scheduling auto-host...
SaveLoadDialog: Checking node references...
  - save_button path: VBoxContainer/SaveSection/SaveInputContainer/SaveButton
  - save_name_input path: VBoxContainer/SaveSection/SaveInputContainer/SaveNameInput
  - saves_list path: VBoxContainer/LoadSection/SavesScrollContainer/SavesList
  - load_button path: VBoxContainer/LoadSection/LoadButtonContainer/LoadButton
SaveLoadDialog: Connected save button
SaveLoadDialog: Connected save input
SaveLoadDialog: Connected saves list
SaveLoadDialog: Connected load button
SaveLoadDialog: Connected delete button
SaveLoadDialog: Connected cancel button
SaveLoadDialog UI signals connected
SaveLoadDialog: Found 29 save files
SaveLoadDialog: Populated list with 29 save files
SaveLoadDialog initialized successfully
[GameInstance] Launching Client instance on port 7778
[GameInstance] Using project path: /Users/robertocallaghan/Documents/claude/godotv2/40k/
TestModeHandler: Current scene: MainMenu
TestModeHandler: Triggering multiplayer mode...
MainMenu: Multiplayer button pressed
MultiplayerLobby: Army selection initialized with 5 armies
MultiplayerLobby: Ready
Godot Engine v4.5.1.stable.official.f62fdbde1 - https://godotengine.org
OpenGL API 4.1 INTEL-18.8.6 - Compatibility - Using Device: Intel Inc. - Intel(R) Iris(TM) Graphics 6100

TestModeHandler: Args -> ["--test-mode", "--position=800,100", "--resolution=600x480", "--auto-join", "--host-ip=127.0.0.1", "--host-port=8000", "--instance-name=Client"]
TestModeHandler: Lobby scene: MultiplayerLobby
TestModeHandler: Creating host on port 8000
MultiplayerLobby: Host button pressed
========================================
   YOU ARE: PLAYER 1 (HOST)
   Hosting on port: 7777
========================================
MultiplayerLobby: Successfully hosting on port 7777
TestModeHandler: Waiting for client to connect...
TestModeHandler: Listening for peer connection...
[LogMonitor] Started monitoring: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251127_200933.log
[GameInstance] Monitoring log file: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251127_200933.log
[GameInstance] Successfully launched Client (PID: 75188)
[Test] Client instance launched successfully
[Test] Waiting for client to connect to host...
========================================
   RUNNING IN TEST MODE
   Config: { "window_position": (800, 100), "window_size": (600, 480), "is_host": false, "host_ip": "127.0.0.1", "host_port": 8000, "instance_name": "Client" }
========================================
TestModeHandler: Command directories ready
  Commands: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_commands/commands
  Results: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_commands/results
[2025-11-27 20:09:38] [INFO.0000000] DebugLogger initialized - Session: 20251127_200938
[2025-11-27 20:09:38] [INFO.0000000] Log file: user://logs/debug_20251127_200938.log
[2025-11-27 20:09:38] [INFO.0000000] Real path: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251127_200938.log
[MeasuringTapeManager] Save persistence: false
Found armies in res://: ["orks", "adeptus_custodes", "space_marines", "A_C_test", "ORK_test"]
ArmyListManager initialized with 5 armies: ["orks", "adeptus_custodes", "space_marines", "A_C_test", "ORK_test"]
[2025-11-27 20:09:38] [INFO.0000000] DebugManager initialized
GameState: Loading default armies...
GameState: ArmyListManager not available, falling back to placeholder armies
GameState: Initializing placeholder armies for both players
GameState: Initializing placeholder army for player 1
GameState: Initializing placeholder army for player 2
ActionLogger: Started session 20251127_200938
StateSerializer: Pretty print enabled: true
SaveLoadManager: Current res:// directory: res://
SaveLoadManager: Project directory path: /Users/robertocallaghan/Documents/claude/godotv2/40k/
SaveLoadManager: Initialized save directories in project folder
SaveLoadManager: Save files will be stored at: /Users/robertocallaghan/Documents/claude/godotv2/40k/saves/
[PhaseManager] Ready - awaiting explicit phase initialization
[TerrainManager] Initializing terrain system
[TerrainManager] Added walls to terrain pieces
[TerrainManager] Loaded 12 terrain pieces
[EnhancedLineOfSight] Initialized
MissionManager: Initializing mission system
MissionManager: Set up 5 objectives for Strike Force deployment
  - obj_center at position (880.0, 1200.0)
  - obj_tl at position (400.0, 560.0)
  - obj_tr at position (1360.0, 560.0)
  - obj_bl at position (400.0, 1840.0)
  - obj_br at position (1360.0, 1840.0)
MissionManager: Initialized Take and Hold mission
[MeasuringTapeManager] Initialized with save_persistence: false
[LineOfSightManager] Initialized - Hold 'V' to check what can see the cursor position
TransportManager initialized
NetworkManager: Initialized
MainMenu: Initializing main menu
MainMenu: Loaded 5 armies: ["A C Test", "Adeptus Custodes", "ORK Test", "Orks", "Space Marines"]
MainMenu: Dropdowns populated with 5 armies
MainMenu: Multiplayer button visible: true
MainMenu: Signals connected
MainMenu: Save/Load dialog setup complete
MainMenu: Default armies set - Player 1: A C Test, Player 2: ORK Test
MainMenu: Ready with default selections
[Test] Host performing action: get_game_state with params: {  }
[Test] Writing command file: host_75179_cmd_001.json
[Test] Waiting for result file...
[Test] Polling for result file: host_75179_cmd_001_result.json
TestModeHandler: Set window position to (800, 100)
TestModeHandler: Set window size to (600, 480)
TestModeHandler: Scheduling auto-join...
SaveLoadDialog: Checking node references...
  - save_button path: VBoxContainer/SaveSection/SaveInputContainer/SaveButton
  - save_name_input path: VBoxContainer/SaveSection/SaveInputContainer/SaveNameInput
  - saves_list path: VBoxContainer/LoadSection/SavesScrollContainer/SavesList
  - load_button path: VBoxContainer/LoadSection/LoadButtonContainer/LoadButton
SaveLoadDialog: Connected save button
SaveLoadDialog: Connected save input
SaveLoadDialog: Connected saves list
SaveLoadDialog: Connected load button
SaveLoadDialog: Connected delete button
SaveLoadDialog: Connected cancel button
SaveLoadDialog UI signals connected
TestModeHandler: Processing command file host_75179_cmd_001.json
TestModeHandler: Executing command from file: host_75179_cmd_001.json
TestModeHandler: Executing action: get_game_state
TestModeHandler: Handling get_game_state action
TestModeHandler: get_game_state - Phase: Deployment, Turn: 0, Player: 0
TestModeHandler: Result written to: host_75179_cmd_001_result.json
TestModeHandler: Command executed and result written
SaveLoadDialog: Found 29 save files
SaveLoadDialog: Populated list with 29 save files
SaveLoadDialog initialized successfully
[Test] Result file found!
[Test] Action completed: success=true, message=Game state retrieved
[Test] Connection verified - action simulation working!
TestModeHandler: Current scene: MainMenu
TestModeHandler: Triggering multiplayer mode...
MainMenu: Multiplayer button pressed
MultiplayerLobby: Army selection initialized with 5 armies
MultiplayerLobby: Ready
[Test] Host performing action: get_available_units with params: {  }
[Test] Writing command file: host_75179_cmd_002.json
[Test] Waiting for result file...
[Test] Polling for result file: host_75179_cmd_002_result.json
TestModeHandler: Processing command file host_75179_cmd_002.json
TestModeHandler: Processing command file host_75179_cmd_002.json
TestModeHandler: Executing command from file: host_75179_cmd_002.json
TestModeHandler: Executing action: get_available_units
TestModeHandler: Handling get_available_units action
TestModeHandler: Player 1 units: ["U_INTERCESSORS_A", "U_TACTICAL_A"] (undeployed: ["U_INTERCESSORS_A", "U_TACTICAL_A"])
TestModeHandler: Player 2 units: ["U_BOYZ_A", "U_GRETCHIN_A"] (undeployed: ["U_BOYZ_A", "U_GRETCHIN_A"])
TestModeHandler: Executing command from file: host_75179_cmd_002.json
TestModeHandler: Executing action: get_available_units
TestModeHandler: Handling get_available_units action
TestModeHandler: Player 1 units: ["U_INTERCESSORS_A", "U_TACTICAL_A"] (undeployed: ["U_INTERCESSORS_A", "U_TACTICAL_A"])
TestModeHandler: Player 2 units: ["U_BOYZ_A", "U_GRETCHIN_A"] (undeployed: ["U_BOYZ_A", "U_GRETCHIN_A"])
TestModeHandler: Result written to: host_75179_cmd_002_result.json
TestModeHandler: Result written to: host_75179_cmd_002_result.json
TestModeHandler: Command executed and result written
TestModeHandler: Command executed and result written
[Test] Result file found!
[Test] Action completed: success=true, message=Available units retrieved
[TEST] Using unit: U_INTERCESSORS_A
[Test] Host performing action: deploy_unit with params: { "unit_id": "U_INTERCESSORS_A", "position": { "x": 320.0, "y": 240.0 } }
[Test] Writing command file: host_75179_cmd_003.json
[Test] Waiting for result file...
[Test] Polling for result file: host_75179_cmd_003_result.json
TestModeHandler: Processing command file host_75179_cmd_003.json
TestModeHandler: Processing command file host_75179_cmd_003.json
TestModeHandler: Executing command from file: host_75179_cmd_003.json
TestModeHandler: Executing action: deploy_unit
TestModeHandler: Handling deploy_unit action
TestModeHandler: Executing command from file: host_75179_cmd_003.json
TestModeHandler: Executing action: deploy_unit
GameManager: deploy_unit() called - unit_id: U_INTERCESSORS_A, position: (320.0, 240.0)
TestModeHandler: Handling deploy_unit action
GameManager: Total units in GameState: 4
GameManager: Unit IDs: ["U_INTERCESSORS_A", "U_TACTICAL_A", "U_BOYZ_A", "U_GRETCHIN_A"]
GameManager: deploy_unit() called - unit_id: U_INTERCESSORS_A, position: (320.0, 240.0)
GameManager: Total units in GameState: 4
GameManager: Unit IDs: ["U_INTERCESSORS_A", "U_TACTICAL_A", "U_BOYZ_A", "U_GRETCHIN_A"]
GameManager: Switching active player from 1 to 2
GameManager: Switching active player from 1 to 2
GameManager: Applying result with 12 changes/diffs
GameManager: Applying result with 12 changes/diffs
GameManager: Setting units.U_INTERCESSORS_A.models.0.position = { "x": 320.0, "y": 240.0 }
GameManager: Setting units.U_INTERCESSORS_A.models.0.rotation = 0.0
GameManager: Setting units.U_INTERCESSORS_A.models.0.position = { "x": 320.0, "y": 240.0 }
GameManager: Setting units.U_INTERCESSORS_A.models.1.position = { "x": 320.0, "y": 240.0 }
GameManager: Setting units.U_INTERCESSORS_A.models.0.rotation = 0.0
GameManager: Setting units.U_INTERCESSORS_A.models.1.rotation = 0.0
GameManager: Setting units.U_INTERCESSORS_A.models.1.position = { "x": 320.0, "y": 240.0 }
GameManager: Setting units.U_INTERCESSORS_A.models.1.rotation = 0.0
GameManager: Setting units.U_INTERCESSORS_A.models.2.position = { "x": 320.0, "y": 240.0 }
GameManager: Setting units.U_INTERCESSORS_A.models.2.rotation = 0.0
GameManager: Setting units.U_INTERCESSORS_A.models.2.position = { "x": 320.0, "y": 240.0 }
GameManager: Setting units.U_INTERCESSORS_A.models.2.rotation = 0.0
GameManager: Setting units.U_INTERCESSORS_A.models.3.position = { "x": 320.0, "y": 240.0 }
GameManager: Setting units.U_INTERCESSORS_A.models.3.rotation = 0.0
GameManager: Setting units.U_INTERCESSORS_A.models.3.position = { "x": 320.0, "y": 240.0 }
GameManager: Setting units.U_INTERCESSORS_A.models.3.rotation = 0.0
GameManager: Setting units.U_INTERCESSORS_A.models.4.position = { "x": 320.0, "y": 240.0 }
GameManager: Setting units.U_INTERCESSORS_A.models.4.rotation = 0.0
GameManager: Setting units.U_INTERCESSORS_A.models.4.position = { "x": 320.0, "y": 240.0 }
GameManager: Setting units.U_INTERCESSORS_A.status = 2
GameManager: Setting units.U_INTERCESSORS_A.models.4.rotation = 0.0
GameManager: Setting meta.active_player = 2
GameManager: Setting units.U_INTERCESSORS_A.status = 2
GameManager: deploy_unit() result: success=true
GameManager: Setting meta.active_player = 2
GameManager: deploy_unit() result: success=true
TestModeHandler: Result written to: host_75179_cmd_003_result.json
TestModeHandler: Result written to: host_75179_cmd_003_result.json
TestModeHandler: Command executed and result written
TestModeHandler: Command executed and result written
[Test] Result file found!
[Test] Action completed: success=true, message=Unit deployed successfully
[TEST] Terrain blocking result: success=true message=Unit deployed successfully
ASSERTION FAILED: test_deployment_blocked_by_terrain - Deployment should be blocked by terrain: Unit deployed successfully

========================================
Cleaning up Multiplayer Test
========================================

[Test] Host performing action: get_game_state with params: {  }
[Test] Writing command file: host_75179_cmd_004.json
[Test] Waiting for result file...
[Test] Polling for result file: host_75179_cmd_004_result.json
TestModeHandler: Processing command file host_75179_cmd_004.json
TestModeHandler: Processing command file host_75179_cmd_004.json
TestModeHandler: Executing command from file: host_75179_cmd_004.json
TestModeHandler: Executing action: get_game_state
TestModeHandler: Executing command from file: host_75179_cmd_004.json
TestModeHandler: Handling get_game_state action
TestModeHandler: Executing action: get_game_state
TestModeHandler: Handling get_game_state action
TestModeHandler: get_game_state - Phase: Deployment, Turn: 0, Player: 0
TestModeHandler: get_game_state - Phase: Deployment, Turn: 0, Player: 0
TestModeHandler: Result written to: host_75179_cmd_004_result.json
TestModeHandler: Command executed and result written
TestModeHandler: Result written to: host_75179_cmd_004_result.json
TestModeHandler: Command executed and result written
TestModeHandler: Lobby scene: MultiplayerLobby
TestModeHandler: Joining host at 127.0.0.1
MultiplayerLobby: Join button pressed
NetworkManager: Connecting to 127.0.0.1:7777
MultiplayerLobby: Attempting to join 127.0.0.1:7777
[Test] Result file found!
[Test] Action completed: success=true, message=Game state retrieved
[Test Artifacts] Report saved: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_artifacts/reports/unknown_test_2025-11-27T20-09-41.json
[GameInstance] Terminating instance: Host
[LogMonitor] Stopped monitoring: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251127_200926.log
[GameInstance] Terminating instance: Client
[LogMonitor] Stopped monitoring: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251127_200933.log

========================================
Starting Multiplayer Integration Test
========================================

  Running: test_deployment_unit_coherency

[TEST] test_deployment_unit_coherency
[Test] Launching host and client instances...
[GameInstance] Launching Host instance on port 8000
[GameInstance] Using project path: /Users/robertocallaghan/Documents/claude/godotv2/40k/
Godot Engine v4.5.1.stable.official.f62fdbde1 - https://godotengine.org
OpenGL API 4.1 INTEL-18.8.6 - Compatibility - Using Device: Intel Inc. - Intel(R) Iris(TM) Graphics 6100

TestModeHandler: Args -> ["--test-mode", "--position=100,100", "--resolution=600x480", "--auto-host", "--port=8000", "--instance-name=Host"]
[LogMonitor] Started monitoring: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251127_200933.log
[GameInstance] Monitoring log file: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251127_200933.log
[GameInstance] Successfully launched Host (PID: 75192)
[Test] Host instance launched successfully on port 8000
========================================
   RUNNING IN TEST MODE
   Config: { "window_position": (100, 100), "window_size": (600, 480), "is_host": true, "port": 8000, "instance_name": "Host" }
========================================
TestModeHandler: Command directories ready
  Commands: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_commands/commands
  Results: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_commands/results
[2025-11-27 20:09:46] [INFO.0000000] DebugLogger initialized - Session: 20251127_200946
[2025-11-27 20:09:46] [INFO.0000000] Log file: user://logs/debug_20251127_200946.log
[2025-11-27 20:09:46] [INFO.0000000] Real path: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251127_200946.log
[MeasuringTapeManager] Save persistence: false
Found armies in res://: ["orks", "adeptus_custodes", "space_marines", "A_C_test", "ORK_test"]
ArmyListManager initialized with 5 armies: ["orks", "adeptus_custodes", "space_marines", "A_C_test", "ORK_test"]
[2025-11-27 20:09:46] [INFO.0000000] DebugManager initialized
GameState: Loading default armies...
GameState: ArmyListManager not available, falling back to placeholder armies
GameState: Initializing placeholder armies for both players
GameState: Initializing placeholder army for player 1
GameState: Initializing placeholder army for player 2
ActionLogger: Started session 20251127_200946
StateSerializer: Pretty print enabled: true
SaveLoadManager: Current res:// directory: res://
SaveLoadManager: Project directory path: /Users/robertocallaghan/Documents/claude/godotv2/40k/
SaveLoadManager: Initialized save directories in project folder
SaveLoadManager: Save files will be stored at: /Users/robertocallaghan/Documents/claude/godotv2/40k/saves/
[PhaseManager] Ready - awaiting explicit phase initialization
[TerrainManager] Initializing terrain system
[TerrainManager] Added walls to terrain pieces
[TerrainManager] Loaded 12 terrain pieces
[EnhancedLineOfSight] Initialized
MissionManager: Initializing mission system
MissionManager: Set up 5 objectives for Strike Force deployment
  - obj_center at position (880.0, 1200.0)
  - obj_tl at position (400.0, 560.0)
  - obj_tr at position (1360.0, 560.0)
  - obj_bl at position (400.0, 1840.0)
  - obj_br at position (1360.0, 1840.0)
MissionManager: Initialized Take and Hold mission
[MeasuringTapeManager] Initialized with save_persistence: false
[LineOfSightManager] Initialized - Hold 'V' to check what can see the cursor position
TransportManager initialized
NetworkManager: Initialized
MainMenu: Initializing main menu
MainMenu: Loaded 5 armies: ["A C Test", "Adeptus Custodes", "ORK Test", "Orks", "Space Marines"]
MainMenu: Dropdowns populated with 5 armies
MainMenu: Multiplayer button visible: true
MainMenu: Signals connected
MainMenu: Save/Load dialog setup complete
MainMenu: Default armies set - Player 1: A C Test, Player 2: ORK Test
MainMenu: Ready with default selections
TestModeHandler: Set window position to (100, 100)
TestModeHandler: Set window size to (600, 480)
TestModeHandler: Scheduling auto-host...
SaveLoadDialog: Checking node references...
  - save_button path: VBoxContainer/SaveSection/SaveInputContainer/SaveButton
  - save_name_input path: VBoxContainer/SaveSection/SaveInputContainer/SaveNameInput
  - saves_list path: VBoxContainer/LoadSection/SavesScrollContainer/SavesList
  - load_button path: VBoxContainer/LoadSection/LoadButtonContainer/LoadButton
SaveLoadDialog: Connected save button
SaveLoadDialog: Connected save input
SaveLoadDialog: Connected saves list
SaveLoadDialog: Connected load button
SaveLoadDialog: Connected delete button
SaveLoadDialog: Connected cancel button
SaveLoadDialog UI signals connected
SaveLoadDialog: Found 29 save files
SaveLoadDialog: Populated list with 29 save files
SaveLoadDialog initialized successfully
[GameInstance] Launching Client instance on port 7778
[GameInstance] Using project path: /Users/robertocallaghan/Documents/claude/godotv2/40k/
TestModeHandler: Current scene: MainMenu
TestModeHandler: Triggering multiplayer mode...
MainMenu: Multiplayer button pressed
MultiplayerLobby: Army selection initialized with 5 armies
MultiplayerLobby: Ready
Godot Engine v4.5.1.stable.official.f62fdbde1 - https://godotengine.org
OpenGL API 4.1 INTEL-18.8.6 - Compatibility - Using Device: Intel Inc. - Intel(R) Iris(TM) Graphics 6100

TestModeHandler: Args -> ["--test-mode", "--position=800,100", "--resolution=600x480", "--auto-join", "--host-ip=127.0.0.1", "--host-port=8000", "--instance-name=Client"]
TestModeHandler: Lobby scene: MultiplayerLobby
TestModeHandler: Creating host on port 8000
MultiplayerLobby: Host button pressed
========================================
   YOU ARE: PLAYER 1 (HOST)
   Hosting on port: 7777
========================================
MultiplayerLobby: Successfully hosting on port 7777
TestModeHandler: Waiting for client to connect...
TestModeHandler: Listening for peer connection...
[LogMonitor] Started monitoring: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251127_200946.log
[GameInstance] Monitoring log file: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251127_200946.log
[GameInstance] Successfully launched Client (PID: 75203)
[Test] Client instance launched successfully
[Test] Waiting for client to connect to host...
[Test] Host performing action: get_game_state with params: {  }
[Test] Writing command file: host_75192_cmd_001.json
[Test] Waiting for result file...
[Test] Polling for result file: host_75192_cmd_001_result.json
========================================
   RUNNING IN TEST MODE
   Config: { "window_position": (800, 100), "window_size": (600, 480), "is_host": false, "host_ip": "127.0.0.1", "host_port": 8000, "instance_name": "Client" }
========================================
TestModeHandler: Command directories ready
  Commands: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_commands/commands
  Results: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_commands/results
[2025-11-27 20:09:51] [INFO.0000000] DebugLogger initialized - Session: 20251127_200951
[2025-11-27 20:09:51] [INFO.0000000] Log file: user://logs/debug_20251127_200951.log
[2025-11-27 20:09:51] [INFO.0000000] Real path: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251127_200951.log
[MeasuringTapeManager] Save persistence: false
Found armies in res://: ["orks", "adeptus_custodes", "space_marines", "A_C_test", "ORK_test"]
ArmyListManager initialized with 5 armies: ["orks", "adeptus_custodes", "space_marines", "A_C_test", "ORK_test"]
[2025-11-27 20:09:51] [INFO.0000000] DebugManager initialized
GameState: Loading default armies...
GameState: ArmyListManager not available, falling back to placeholder armies
GameState: Initializing placeholder armies for both players
GameState: Initializing placeholder army for player 1
GameState: Initializing placeholder army for player 2
ActionLogger: Started session 20251127_200951
StateSerializer: Pretty print enabled: true
SaveLoadManager: Current res:// directory: res://
SaveLoadManager: Project directory path: /Users/robertocallaghan/Documents/claude/godotv2/40k/
SaveLoadManager: Initialized save directories in project folder
SaveLoadManager: Save files will be stored at: /Users/robertocallaghan/Documents/claude/godotv2/40k/saves/
[PhaseManager] Ready - awaiting explicit phase initialization
[TerrainManager] Initializing terrain system
[TerrainManager] Added walls to terrain pieces
[TerrainManager] Loaded 12 terrain pieces
[EnhancedLineOfSight] Initialized
MissionManager: Initializing mission system
MissionManager: Set up 5 objectives for Strike Force deployment
  - obj_center at position (880.0, 1200.0)
  - obj_tl at position (400.0, 560.0)
  - obj_tr at position (1360.0, 560.0)
  - obj_bl at position (400.0, 1840.0)
  - obj_br at position (1360.0, 1840.0)
MissionManager: Initialized Take and Hold mission
[MeasuringTapeManager] Initialized with save_persistence: false
[LineOfSightManager] Initialized - Hold 'V' to check what can see the cursor position
TransportManager initialized
NetworkManager: Initialized
MainMenu: Initializing main menu
MainMenu: Loaded 5 armies: ["A C Test", "Adeptus Custodes", "ORK Test", "Orks", "Space Marines"]
MainMenu: Dropdowns populated with 5 armies
MainMenu: Multiplayer button visible: true
MainMenu: Signals connected
MainMenu: Save/Load dialog setup complete
MainMenu: Default armies set - Player 1: A C Test, Player 2: ORK Test
MainMenu: Ready with default selections
TestModeHandler: Processing command file host_75192_cmd_001.json
TestModeHandler: Executing command from file: host_75192_cmd_001.json
TestModeHandler: Executing action: get_game_state
TestModeHandler: Handling get_game_state action
TestModeHandler: get_game_state - Phase: Deployment, Turn: 0, Player: 0
TestModeHandler: Result written to: host_75192_cmd_001_result.json
TestModeHandler: Command executed and result written
TestModeHandler: Set window position to (800, 100)
TestModeHandler: Set window size to (600, 480)
TestModeHandler: Scheduling auto-join...
SaveLoadDialog: Checking node references...
  - save_button path: VBoxContainer/SaveSection/SaveInputContainer/SaveButton
  - save_name_input path: VBoxContainer/SaveSection/SaveInputContainer/SaveNameInput
  - saves_list path: VBoxContainer/LoadSection/SavesScrollContainer/SavesList
  - load_button path: VBoxContainer/LoadSection/LoadButtonContainer/LoadButton
SaveLoadDialog: Connected save button
SaveLoadDialog: Connected save input
SaveLoadDialog: Connected saves list
SaveLoadDialog: Connected load button
SaveLoadDialog: Connected delete button
SaveLoadDialog: Connected cancel button
SaveLoadDialog UI signals connected
SaveLoadDialog: Found 29 save files
SaveLoadDialog: Populated list with 29 save files
SaveLoadDialog initialized successfully
[Test] Result file found!
[Test] Action completed: success=true, message=Game state retrieved
[Test] Connection verified - action simulation working!
TestModeHandler: Current scene: MainMenu
TestModeHandler: Triggering multiplayer mode...
MainMenu: Multiplayer button pressed
MultiplayerLobby: Army selection initialized with 5 armies
MultiplayerLobby: Ready
[Test] Host performing action: get_available_units with params: {  }
[Test] Writing command file: host_75192_cmd_002.json
[Test] Waiting for result file...
[Test] Polling for result file: host_75192_cmd_002_result.json
TestModeHandler: Processing command file host_75192_cmd_002.json
TestModeHandler: Executing command from file: host_75192_cmd_002.json
TestModeHandler: Executing action: get_available_units
TestModeHandler: Handling get_available_units action
TestModeHandler: Player 1 units: ["U_INTERCESSORS_A", "U_TACTICAL_A"] (undeployed: ["U_INTERCESSORS_A", "U_TACTICAL_A"])
TestModeHandler: Player 2 units: ["U_BOYZ_A", "U_GRETCHIN_A"] (undeployed: ["U_BOYZ_A", "U_GRETCHIN_A"])
TestModeHandler: Result written to: host_75192_cmd_002_result.json
TestModeHandler: Command executed and result written
[Test] Result file found!
[Test] Action completed: success=true, message=Available units retrieved
[TEST] Using unit: U_INTERCESSORS_A
[Test] Host performing action: deploy_unit with params: { "unit_id": "U_INTERCESSORS_A", "position": { "x": 200.0, "y": 200.0 } }
[Test] Writing command file: host_75192_cmd_003.json
[Test] Waiting for result file...
[Test] Polling for result file: host_75192_cmd_003_result.json
TestModeHandler: Processing command file host_75192_cmd_003.json
TestModeHandler: Executing command from file: host_75192_cmd_003.json
TestModeHandler: Executing action: deploy_unit
TestModeHandler: Handling deploy_unit action
GameManager: deploy_unit() called - unit_id: U_INTERCESSORS_A, position: (200.0, 200.0)
GameManager: Total units in GameState: 4
GameManager: Unit IDs: ["U_INTERCESSORS_A", "U_TACTICAL_A", "U_BOYZ_A", "U_GRETCHIN_A"]
GameManager: Switching active player from 1 to 2
GameManager: Applying result with 12 changes/diffs
GameManager: Setting units.U_INTERCESSORS_A.models.0.position = { "x": 200.0, "y": 200.0 }
GameManager: Setting units.U_INTERCESSORS_A.models.0.rotation = 0.0
GameManager: Setting units.U_INTERCESSORS_A.models.1.position = { "x": 200.0, "y": 200.0 }
GameManager: Setting units.U_INTERCESSORS_A.models.1.rotation = 0.0
GameManager: Setting units.U_INTERCESSORS_A.models.2.position = { "x": 200.0, "y": 200.0 }
GameManager: Setting units.U_INTERCESSORS_A.models.2.rotation = 0.0
GameManager: Setting units.U_INTERCESSORS_A.models.3.position = { "x": 200.0, "y": 200.0 }
GameManager: Setting units.U_INTERCESSORS_A.models.3.rotation = 0.0
GameManager: Setting units.U_INTERCESSORS_A.models.4.position = { "x": 200.0, "y": 200.0 }
GameManager: Setting units.U_INTERCESSORS_A.models.4.rotation = 0.0
GameManager: Setting units.U_INTERCESSORS_A.status = 2
GameManager: Setting meta.active_player = 2
GameManager: deploy_unit() result: success=true
TestModeHandler: Result written to: host_75192_cmd_003_result.json
TestModeHandler: Command executed and result written
[Test] Result file found!
[Test] Action completed: success=true, message=Unit deployed successfully
[TEST] Multi-model deployment result: success=true message=Unit deployed successfully
TestModeHandler: Lobby scene: MultiplayerLobby
TestModeHandler: Joining host at 127.0.0.1
MultiplayerLobby: Join button pressed
NetworkManager: Connecting to 127.0.0.1:7777
MultiplayerLobby: Attempting to join 127.0.0.1:7777
NetworkManager: Peer connected - 1
NetworkManager: Successfully connected to host
NetworkManager: Client set peer_to_player_map[1869635091] = 2
========================================
   YOU ARE: PLAYER 2 (CLIENT)
   Connected to host
========================================
MultiplayerLobby: Peer connected - 1
MultiplayerLobby: Game started signal received
NetworkManager: Peer connected - 1869635091
[GameState] MeasuringTapeManager not available
MultiplayerLobby: Peer connected - 1869635091
TestModeHandler: Client connected!
MultiplayerLobby: Game started signal received
NetworkManager: Receiving initial state from host
[GameState] No measuring_tape data in save
NetworkManager: State synchronized
MultiplayerLobby: Game started signal received
MultiplayerLobby: Syncing army selection - Player 1 -> A_C_test
MultiplayerLobby: Syncing army selection - Player 2 -> ORK_test
[Test] Host performing action: get_game_state with params: {  }
[Test] Writing command file: host_75192_cmd_004.json
[Test] Waiting for result file...
[Test] Polling for result file: host_75192_cmd_004_result.json
TestModeHandler: Processing command file host_75192_cmd_004.json
TestModeHandler: Processing command file host_75192_cmd_004.json
TestModeHandler: Executing command from file: host_75192_cmd_004.json
TestModeHandler: Executing action: get_game_state
TestModeHandler: Handling get_game_state action
TestModeHandler: Executing command from file: host_75192_cmd_004.json
TestModeHandler: get_game_state - Phase: Deployment, Turn: 0, Player: 0
TestModeHandler: Executing action: get_game_state
TestModeHandler: Handling get_game_state action
TestModeHandler: get_game_state - Phase: Deployment, Turn: 0, Player: 0
TestModeHandler: Result written to: host_75192_cmd_004_result.json
TestModeHandler: Result written to: host_75192_cmd_004_result.json
TestModeHandler: Command executed and result written
TestModeHandler: Command executed and result written
[Test] Result file found!
[Test] Action completed: success=true, message=Game state retrieved
[TEST] Unit U_INTERCESSORS_A has 5 models, all positioned correctly
[TEST] Unit coherency test completed with assertions

========================================
Cleaning up Multiplayer Test
========================================

[Test] Host performing action: get_game_state with params: {  }
[Test] Writing command file: host_75192_cmd_005.json
[Test] Waiting for result file...
[Test] Polling for result file: host_75192_cmd_005_result.json
TestModeHandler: Processing command file host_75192_cmd_005.json
TestModeHandler: Processing command file host_75192_cmd_005.json
TestModeHandler: Executing command from file: host_75192_cmd_005.json
TestModeHandler: Executing action: get_game_state
TestModeHandler: Handling get_game_state action
TestModeHandler: get_game_state - Phase: Deployment, Turn: 0, Player: 0
TestModeHandler: Executing command from file: host_75192_cmd_005.json
TestModeHandler: Executing action: get_game_state
TestModeHandler: Handling get_game_state action
TestModeHandler: get_game_state - Phase: Deployment, Turn: 0, Player: 0
TestModeHandler: Result written to: host_75192_cmd_005_result.json
TestModeHandler: Result written to: host_75192_cmd_005_result.json
TestModeHandler: Command executed and result written
TestModeHandler: Starting game...
TestModeHandler: Command executed and result written
MultiplayerLobby: Start game button pressed
MultiplayerLobby: Loading armies...
MultiplayerLobby: Loading A_C_test for Player 1
Loading army list: A_C_test for player 1
Processed unit: U_BLADE_CHAMPION_A for player 1
Processed unit: U_WITCHSEEKERS_C for player 1
Processed unit: U_CALADIUS_GRAV-TANK_E for player 1
Successfully loaded army: A_C_test with 3 units
MultiplayerLobby: Player 1 army loaded, has 3 units
Applying army to game state for player: 1
Removing 0 existing units for player 1
Added unit: U_BLADE_CHAMPION_A (Blade Champion)
Added unit: U_WITCHSEEKERS_C (Witchseekers)
Added unit: U_CALADIUS_GRAV-TANK_E (Caladius Grav-tank)
Set faction for player 1: Adeptus Custodes
Army applied successfully. Total units in game: 3
MultiplayerLobby: After applying P1 army, GameState has 3 units
MultiplayerLobby: Loading ORK_test for Player 2
Loading army list: ORK_test for player 2
Processed unit: U_WARBOSS_B for player 2
Processed unit: U_WARBOSS_IN_MEGA_ARMOUR_D for player 2
[2025-11-27 20:09:55] [DEBUG.0000000] Parsed transport capacity keywords | Context: {"description":"This model has a transport capacity of 22 ORKS INFANTRY models. Each MEGA ARMOUR model takes up the space of 2 models. This model cannot transport models that are JUMP PACK models.","keywords":["ORKS","INFANTRY"],"unit_id":"U_BATTLEWAGON_G"}
Processed unit: U_BATTLEWAGON_G for player 2
Successfully loaded army: ORK_test with 3 units
MultiplayerLobby: Player 2 army loaded, has 3 units
Applying army to game state for player: 2
Removing 0 existing units for player 2
Added unit: U_WARBOSS_B (Warboss)
Added unit: U_WARBOSS_IN_MEGA_ARMOUR_D (Warboss in Mega Armour)
Added unit: U_BATTLEWAGON_G (Battlewagon)
Set faction for player 2: Unknown
Army applied successfully. Total units in game: 6
MultiplayerLobby: After applying P2 army, GameState has 6 units
MultiplayerLobby: Armies loaded. Total units: 6
MultiplayerLobby: Syncing loaded armies to clients...
[GameState] MeasuringTapeManager not available
MultiplayerLobby: Snapshot has 6 units
MultiplayerLobby: Sent army snapshot to peer 1869635091
NetworkManager: Receiving initial state from host
[GameState] No measuring_tape data in save
NetworkManager: State synchronized
MultiplayerLobby: Game started signal received
[Test] Result file found!
[Test] JSON parse error on attempt 1/3: {
	"execution_time_ms": 3,
	"result": {
		"data": {
			"current_phase": "Deployment",
			"current_turn": 0,
			"player_turn": 0,
			"units": {
				"U_BOYZ_A": {
					"id": "U_BOYZ_A",
					"meta": {
						"keywords": [
							"INFANTRY",
							"MOB",
							"ORKS"
						],
						"name": "Boyz",
						"stats": {
							"move": 6,
							"save": 6,
							"toughness": 5
						}
					},
					"models": [
						{
							"alive": true,
							"base_mm": 32,
							"current_wounds": 1,
							"id": "m1",
							"position": null,
							"status_effects": [],
							"wounds": 1
						},
						{
							"alive": true,
							"base_mm": 32,
							"current_wounds": 1,
							"id": "m2",
							"position": null,
							"status_effects": [],
							"wounds": 1
						},
						{
							"alive": true,
							"base_mm": 32,
							"current_wounds": 1,
							"id": "m3",
							"position": null,
							"status_effects": [],
							"wounds": 1
						},
						{
							"alive": true,
							"base_mm": 32,
							"current_wounds": 1,
							"id": "m4",
							"position": null,
							"status_effects": [],
							"wounds": 1
						},
						{
							"alive": true,
							"base_mm": 32,
							"current_wounds": 1,
							"id": "m5",
							"position": null,
							"status_effects": [],
							"wounds": 1
						},
						{
							"alive": true,
							"base_mm": 32,
							"current_wounds": 1,
							"id": "m6",
							"position": null,
							"status_effects": [],
							"wounds": 1
						},
						{
							"alive": true,
							"base_mm": 32,
							"current_wounds": 1,
							"id": "m7",
							"position": null,
							"status_effects": [],
							"wounds": 1
						},
						{
							"alive": true,
							"base_mm": 32,
							"current_wounds": 1,
							"id": "m8",
							"position": null,
							"status_effects": [],
							"wounds": 1
						},
						{
							"alive": true,
							"base_mm": 32,
							"current_wounds": 1,
							"id": "m9",
							"position": null,
							"status_effects": [],
							"wounds": 1
						},
						{
							"alive": true,
							"base_mm": 32,
							"current_wounds": 1,
							"id": "m10",
							"position": null,
							"status_effects": [],
							"wounds": 1
						}
					],
					"owner": 2,
					"squad_id": "U_BOYZ_A",
					"status": 0
				},
				"U_GRETCHIN_A": {
					"id": "U_GRETCHIN_A",
					"meta": {
						"keywords": [
							"INFANTRY",
							"GROTS",
							"ORKS"
						],
						"name": "Gretchin",
						"stats": {
							"move": 5,
							"save": 7,
							"toughness": 3
						}
					},
					"models": [
						{
							"alive": true,
							"base_mm": 25,
							"current_wounds": 1,
							"id": "m1",
							"position": null,
							"status_effects": [],
							"wounds": 1
						},
						{
							"alive": true,
							"base_mm": 25,
							"current_wounds": 1,
							"id": "m2",
							"position": null,
							"status_effects": [],
							"wounds": 1
						},
						{
							"alive": true,
							"base_mm": 25,
							"current_wounds": 1,
							"id": "m3",
							"position": null,
							"status_effects": [],
							"wounds": 1
						},
						{
							"alive": true,
							"base_mm": 25,
							"current_wounds": 1,
							"id": "m4",
							"position": null,
							"status_effects": [],
							"wounds": 1
						},
						{
							"alive": true,
							"base_mm": 25,
							"current_wounds": 1,
							"id": "m5",
							"position": null,
							"status_effects": [],
							"wounds": 1
						}
					],
					"owner": 2,
					"squad_id": "U_GRETCHIN_A",
					"status": 0
				},
				"U_INTERCESSORS_A": {
					"id": "U_INTERCESSORS_A",
					"meta": {
						"keywords": [
							"INFANTRY",
							"PRIMARIS",
							"IMPERIUM",
							"ADEPTUS ASTARTES"
						],
						"name": "Intercessor Squad",
						"stats": {
							"move": 6,
							"save": 3,
							"toughness": 4
						}
					},
					"models": [
						{
							"alive": true,
							"base_mm": 32,
							"current_wounds": 2,
							"id": "m1",
							"position": {
								"x": 200.0,
								"y": 200.0
							},
							"rotation": 0.0,
							"status_effects": [],
							"wounds": 2
						},
						{
							"alive": true,
							"base_mm": 32,
							"current_wounds": 2,
							"id": "m2",
							"position": {
								"x": 200.0,
								"y": 200.0
							},
							"rotation": 0.0,
							"status_effects": [],
							"wounds": 2
						},
						{
							"alive": true,
							"base_mm": 32,
							"current_wounds": 2,
							"id": "m3",
							"position": {
								"x": 200.0,
								"y": 200.0
							},
							"rotation": 0.0,
							"status_effects": [],
							"wounds": 2
						},
						{
							"alive": true,
							"base_mm": 32,
							"current_wounds": 2,
							"id": "m4",
							"position": {
								"x": 200.0,
								"y": 200.0
							},
							"rotation": 0.0,
							"status_effects": [],
							"wounds": 2
						},
						{
							"alive": true,
							"base_mm": 32,
							"current_wounds": 2,
							"id": "m5",
							"position": {
								"x": 200.0,
								"y": 200.0
							},
							"rotation": 0.0,
							"status_effects": [],
							"wounds": 2
						}
					],
					"owner": 1,
					"squad_id": "U_INTERCESSORS_A",
					"status": 2
				},
				"U_TACTICAL_A": {
					"id": "U_TACTICAL_A",
					"meta": {
						"keywords": [
							"INFANTRY",
							"IMPERIUM",
							"ADEPTUS ASTARTES"
						],
						"name": "Tactical Squad",
						"stats": {
							"move": 6,
							"save": 3,
							"toughness": 4
						}
					},
					"models": [
						{
							"alive": true,
							"base_mm": 32,
							"current_wounds": 2,
							"id": "m1",
							"position": null,
							"status_effects": [],
							"wounds": 2
						},
						{
							"alive": true,
							"base_mm": 32,
							"current_wounds": 2,
							"id": "m2",
							"position": null,
							"status_effects": [],
							"wounds": 2
						},
						{
							"alive": true,
							"base_mm": 32,
							"current_wounds": 2,
							"id": "m3",
							"position": null,
							"status_effects": [],
							"wounds": 2
						},
						{
							"alive": true,
							"base_mm": 32,
							"current_wounds": 2,
							"id": "m4",
							"position": null,
							"status_effects": [],
							"wounds": 2
						},
						{
							"alive": true,
							"base_mm": 32,
							"current_wounds": 2,
							"id": "m5",
							"position": null,
							"status_effects": [],
							"wounds": 2
						}
					],
					"owner": 1,
					"squad_id": "U_TACTICAL_A",
					"status": 0
				}
			}
		},
		"message": "Game state retrieved",
		"success": true
	},
	"sequence": 5,
	"timestamp": 7234,
	"version": "1.0"
}}
[Test] JSON parse error on attempt 2/3: {
	"execution_time_ms": 3,
	"result": {
		"data": {
			"current_phase": "Deployment",
			"current_turn": 0,
			"player_turn": 0,
			"units": {
				"U_BOYZ_A": {
					"id": "U_BOYZ_A",
					"meta": {
						"keywords": [
							"INFANTRY",
							"MOB",
							"ORKS"
						],
						"name": "Boyz",
						"stats": {
							"move": 6,
							"save": 6,
							"toughness": 5
						}
					},
					"models": [
						{
							"alive": true,
							"base_mm": 32,
							"current_wounds": 1,
							"id": "m1",
							"position": null,
							"status_effects": [],
							"wounds": 1
						},
						{
							"alive": true,
							"base_mm": 32,
							"current_wounds": 1,
							"id": "m2",
							"position": null,
							"status_effects": [],
							"wounds": 1
						},
						{
							"alive": true,
							"base_mm": 32,
							"current_wounds": 1,
							"id": "m3",
							"position": null,
							"status_effects": [],
							"wounds": 1
						},
						{
							"alive": true,
							"base_mm": 32,
							"current_wounds": 1,
							"id": "m4",
							"position": null,
							"status_effects": [],
							"wounds": 1
						},
						{
							"alive": true,
							"base_mm": 32,
							"current_wounds": 1,
							"id": "m5",
							"position": null,
							"status_effects": [],
							"wounds": 1
						},
						{
							"alive": true,
							"base_mm": 32,
							"current_wounds": 1,
							"id": "m6",
							"position": null,
							"status_effects": [],
							"wounds": 1
						},
						{
							"alive": true,
							"base_mm": 32,
							"current_wounds": 1,
							"id": "m7",
							"position": null,
							"status_effects": [],
							"wounds": 1
						},
						{
							"alive": true,
							"base_mm": 32,
							"current_wounds": 1,
							"id": "m8",
							"position": null,
							"status_effects": [],
							"wounds": 1
						},
						{
							"alive": true,
							"base_mm": 32,
							"current_wounds": 1,
							"id": "m9",
							"position": null,
							"status_effects": [],
							"wounds": 1
						},
						{
							"alive": true,
							"base_mm": 32,
							"current_wounds": 1,
							"id": "m10",
							"position": null,
							"status_effects": [],
							"wounds": 1
						}
					],
					"owner": 2,
					"squad_id": "U_BOYZ_A",
					"status": 0
				},
				"U_GRETCHIN_A": {
					"id": "U_GRETCHIN_A",
					"meta": {
						"keywords": [
							"INFANTRY",
							"GROTS",
							"ORKS"
						],
						"name": "Gretchin",
						"stats": {
							"move": 5,
							"save": 7,
							"toughness": 3
						}
					},
					"models": [
						{
							"alive": true,
							"base_mm": 25,
							"current_wounds": 1,
							"id": "m1",
							"position": null,
							"status_effects": [],
							"wounds": 1
						},
						{
							"alive": true,
							"base_mm": 25,
							"current_wounds": 1,
							"id": "m2",
							"position": null,
							"status_effects": [],
							"wounds": 1
						},
						{
							"alive": true,
							"base_mm": 25,
							"current_wounds": 1,
							"id": "m3",
							"position": null,
							"status_effects": [],
							"wounds": 1
						},
						{
							"alive": true,
							"base_mm": 25,
							"current_wounds": 1,
							"id": "m4",
							"position": null,
							"status_effects": [],
							"wounds": 1
						},
						{
							"alive": true,
							"base_mm": 25,
							"current_wounds": 1,
							"id": "m5",
							"position": null,
							"status_effects": [],
							"wounds": 1
						}
					],
					"owner": 2,
					"squad_id": "U_GRETCHIN_A",
					"status": 0
				},
				"U_INTERCESSORS_A": {
					"id": "U_INTERCESSORS_A",
					"meta": {
						"keywords": [
							"INFANTRY",
							"PRIMARIS",
							"IMPERIUM",
							"ADEPTUS ASTARTES"
						],
						"name": "Intercessor Squad",
						"stats": {
							"move": 6,
							"save": 3,
							"toughness": 4
						}
					},
					"models": [
						{
							"alive": true,
							"base_mm": 32,
							"current_wounds": 2,
							"id": "m1",
							"position": {
								"x": 200.0,
								"y": 200.0
							},
							"rotation": 0.0,
							"status_effects": [],
							"wounds": 2
						},
						{
							"alive": true,
							"base_mm": 32,
							"current_wounds": 2,
							"id": "m2",
							"position": {
								"x": 200.0,
								"y": 200.0
							},
							"rotation": 0.0,
							"status_effects": [],
							"wounds": 2
						},
						{
							"alive": true,
							"base_mm": 32,
							"current_wounds": 2,
							"id": "m3",
							"position": {
								"x": 200.0,
								"y": 200.0
							},
							"rotation": 0.0,
							"status_effects": [],
							"wounds": 2
						},
						{
							"alive": true,
							"base_mm": 32,
							"current_wounds": 2,
							"id": "m4",
							"position": {
								"x": 200.0,
								"y": 200.0
							},
							"rotation": 0.0,
							"status_effects": [],
							"wounds": 2
						},
						{
							"alive": true,
							"base_mm": 32,
							"current_wounds": 2,
							"id": "m5",
							"position": {
								"x": 200.0,
								"y": 200.0
							},
							"rotation": 0.0,
							"status_effects": [],
							"wounds": 2
						}
					],
					"owner": 1,
					"squad_id": "U_INTERCESSORS_A",
					"status": 2
				},
				"U_TACTICAL_A": {
					"id": "U_TACTICAL_A",
					"meta": {
						"keywords": [
							"INFANTRY",
							"IMPERIUM",
							"ADEPTUS ASTARTES"
						],
						"name": "Tactical Squad",
						"stats": {
							"move": 6,
							"save": 3,
							"toughness": 4
						}
					},
					"models": [
						{
							"alive": true,
							"base_mm": 32,
							"current_wounds": 2,
							"id": "m1",
							"position": null,
							"status_effects": [],
							"wounds": 2
						},
						{
							"alive": true,
							"base_mm": 32,
							"current_wounds": 2,
							"id": "m2",
							"position": null,
							"status_effects": [],
							"wounds": 2
						},
						{
							"alive": true,
							"base_mm": 32,
							"current_wounds": 2,
							"id": "m3",
							"position": null,
							"status_effects": [],
							"wounds": 2
						},
						{
							"alive": true,
							"base_mm": 32,
							"current_wounds": 2,
							"id": "m4",
							"position": null,
							"status_effects": [],
							"wounds": 2
						},
						{
							"alive": true,
							"base_mm": 32,
							"current_wounds": 2,
							"id": "m5",
							"position": null,
							"status_effects": [],
							"wounds": 2
						}
					],
					"owner": 1,
					"squad_id": "U_TACTICAL_A",
					"status": 0
				}
			}
		},
		"message": "Game state retrieved",
		"success": true
	},
	"sequence": 5,
	"timestamp": 7234,
	"version": "1.0"
}}
[Test] JSON parse error on attempt 3/3: {
	"execution_time_ms": 3,
	"result": {
		"data": {
			"current_phase": "Deployment",
			"current_turn": 0,
			"player_turn": 0,
			"units": {
				"U_BOYZ_A": {
					"id": "U_BOYZ_A",
					"meta": {
						"keywords": [
							"INFANTRY",
							"MOB",
							"ORKS"
						],
						"name": "Boyz",
						"stats": {
							"move": 6,
							"save": 6,
							"toughness": 5
						}
					},
					"models": [
						{
							"alive": true,
							"base_mm": 32,
							"current_wounds": 1,
							"id": "m1",
							"position": null,
							"status_effects": [],
							"wounds": 1
						},
						{
							"alive": true,
							"base_mm": 32,
							"current_wounds": 1,
							"id": "m2",
							"position": null,
							"status_effects": [],
							"wounds": 1
						},
						{
							"alive": true,
							"base_mm": 32,
							"current_wounds": 1,
							"id": "m3",
							"position": null,
							"status_effects": [],
							"wounds": 1
						},
						{
							"alive": true,
							"base_mm": 32,
							"current_wounds": 1,
							"id": "m4",
							"position": null,
							"status_effects": [],
							"wounds": 1
						},
						{
							"alive": true,
							"base_mm": 32,
							"current_wounds": 1,
							"id": "m5",
							"position": null,
							"status_effects": [],
							"wounds": 1
						},
						{
							"alive": true,
							"base_mm": 32,
							"current_wounds": 1,
							"id": "m6",
							"position": null,
							"status_effects": [],
							"wounds": 1
						},
						{
							"alive": true,
							"base_mm": 32,
							"current_wounds": 1,
							"id": "m7",
							"position": null,
							"status_effects": [],
							"wounds": 1
						},
						{
							"alive": true,
							"base_mm": 32,
							"current_wounds": 1,
							"id": "m8",
							"position": null,
							"status_effects": [],
							"wounds": 1
						},
						{
							"alive": true,
							"base_mm": 32,
							"current_wounds": 1,
							"id": "m9",
							"position": null,
							"status_effects": [],
							"wounds": 1
						},
						{
							"alive": true,
							"base_mm": 32,
							"current_wounds": 1,
							"id": "m10",
							"position": null,
							"status_effects": [],
							"wounds": 1
						}
					],
					"owner": 2,
					"squad_id": "U_BOYZ_A",
					"status": 0
				},
				"U_GRETCHIN_A": {
					"id": "U_GRETCHIN_A",
					"meta": {
						"keywords": [
							"INFANTRY",
							"GROTS",
							"ORKS"
						],
						"name": "Gretchin",
						"stats": {
							"move": 5,
							"save": 7,
							"toughness": 3
						}
					},
					"models": [
						{
							"alive": true,
							"base_mm": 25,
							"current_wounds": 1,
							"id": "m1",
							"position": null,
							"status_effects": [],
							"wounds": 1
						},
						{
							"alive": true,
							"base_mm": 25,
							"current_wounds": 1,
							"id": "m2",
							"position": null,
							"status_effects": [],
							"wounds": 1
						},
						{
							"alive": true,
							"base_mm": 25,
							"current_wounds": 1,
							"id": "m3",
							"position": null,
							"status_effects": [],
							"wounds": 1
						},
						{
							"alive": true,
							"base_mm": 25,
							"current_wounds": 1,
							"id": "m4",
							"position": null,
							"status_effects": [],
							"wounds": 1
						},
						{
							"alive": true,
							"base_mm": 25,
							"current_wounds": 1,
							"id": "m5",
							"position": null,
							"status_effects": [],
							"wounds": 1
						}
					],
					"owner": 2,
					"squad_id": "U_GRETCHIN_A",
					"status": 0
				},
				"U_INTERCESSORS_A": {
					"id": "U_INTERCESSORS_A",
					"meta": {
						"keywords": [
							"INFANTRY",
							"PRIMARIS",
							"IMPERIUM",
							"ADEPTUS ASTARTES"
						],
						"name": "Intercessor Squad",
						"stats": {
							"move": 6,
							"save": 3,
							"toughness": 4
						}
					},
					"models": [
						{
							"alive": true,
							"base_mm": 32,
							"current_wounds": 2,
							"id": "m1",
							"position": {
								"x": 200.0,
								"y": 200.0
							},
							"rotation": 0.0,
							"status_effects": [],
							"wounds": 2
						},
						{
							"alive": true,
							"base_mm": 32,
							"current_wounds": 2,
							"id": "m2",
							"position": {
								"x": 200.0,
								"y": 200.0
							},
							"rotation": 0.0,
							"status_effects": [],
							"wounds": 2
						},
						{
							"alive": true,
							"base_mm": 32,
							"current_wounds": 2,
							"id": "m3",
							"position": {
								"x": 200.0,
								"y": 200.0
							},
							"rotation": 0.0,
							"status_effects": [],
							"wounds": 2
						},
						{
							"alive": true,
							"base_mm": 32,
							"current_wounds": 2,
							"id": "m4",
							"position": {
								"x": 200.0,
								"y": 200.0
							},
							"rotation": 0.0,
							"status_effects": [],
							"wounds": 2
						},
						{
							"alive": true,
							"base_mm": 32,
							"current_wounds": 2,
							"id": "m5",
							"position": {
								"x": 200.0,
								"y": 200.0
							},
							"rotation": 0.0,
							"status_effects": [],
							"wounds": 2
						}
					],
					"owner": 1,
					"squad_id": "U_INTERCESSORS_A",
					"status": 2
				},
				"U_TACTICAL_A": {
					"id": "U_TACTICAL_A",
					"meta": {
						"keywords": [
							"INFANTRY",
							"IMPERIUM",
							"ADEPTUS ASTARTES"
						],
						"name": "Tactical Squad",
						"stats": {
							"move": 6,
							"save": 3,
							"toughness": 4
						}
					},
					"models": [
						{
							"alive": true,
							"base_mm": 32,
							"current_wounds": 2,
							"id": "m1",
							"position": null,
							"status_effects": [],
							"wounds": 2
						},
						{
							"alive": true,
							"base_mm": 32,
							"current_wounds": 2,
							"id": "m2",
							"position": null,
							"status_effects": [],
							"wounds": 2
						},
						{
							"alive": true,
							"base_mm": 32,
							"current_wounds": 2,
							"id": "m3",
							"position": null,
							"status_effects": [],
							"wounds": 2
						},
						{
							"alive": true,
							"base_mm": 32,
							"current_wounds": 2,
							"id": "m4",
							"position": null,
							"status_effects": [],
							"wounds": 2
						},
						{
							"alive": true,
							"base_mm": 32,
							"current_wounds": 2,
							"id": "m5",
							"position": null,
							"status_effects": [],
							"wounds": 2
						}
					],
					"owner": 1,
					"squad_id": "U_TACTICAL_A",
					"status": 0
				}
			}
		},
		"message": "Game state retrieved",
		"success": true
	},
	"sequence": 5,
	"timestamp": 7234,
	"version": "1.0"
}}
ERROR: [Test] Failed to parse result JSON after 3 attempts
   at: push_error (core/variant/variant_utility.cpp:1024)
   GDScript backtrace (most recent call first):
       [0] _wait_for_result (res://tests/helpers/MultiplayerIntegrationTest.gd:374)
       [1] _simulate_action (res://tests/helpers/MultiplayerIntegrationTest.gd:292)
       [2] simulate_host_action (res://tests/helpers/MultiplayerIntegrationTest.gd:233)
       [3] _generate_test_report (res://tests/helpers/MultiplayerIntegrationTest.gd:516)
       [4] after_each (res://tests/helpers/MultiplayerIntegrationTest.gd:53)
       [5] run_test_file (res://addons/gut/gut_cmdln.gd:160)
       [6] run_tests (res://addons/gut/gut_cmdln.gd:81)
       [7] _init (res://addons/gut/gut_cmdln.gd:15)
[Test Artifacts] Report saved: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_artifacts/reports/unknown_test_2025-11-27T20-09-55.json
[GameInstance] Terminating instance: Host
[LogMonitor] Stopped monitoring: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251127_200933.log
[GameInstance] Terminating instance: Client
[LogMonitor] Stopped monitoring: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251127_200946.log

========================================
Starting Multiplayer Integration Test
========================================

  Running: test_deployment_completion_both_players

[TEST] test_deployment_completion_both_players
[Test] Launching host and client instances...
[GameInstance] Launching Host instance on port 8000
[GameInstance] Using project path: /Users/robertocallaghan/Documents/claude/godotv2/40k/
Godot Engine v4.5.1.stable.official.f62fdbde1 - https://godotengine.org
OpenGL API 4.1 INTEL-18.8.6 - Compatibility - Using Device: Intel Inc. - Intel(R) Iris(TM) Graphics 6100

TestModeHandler: Args -> ["--test-mode", "--position=100,100", "--resolution=600x480", "--auto-host", "--port=8000", "--instance-name=Host"]
[LogMonitor] Started monitoring: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251127_200951.log
[GameInstance] Monitoring log file: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251127_200951.log
[GameInstance] Successfully launched Host (PID: 75206)
[Test] Host instance launched successfully on port 8000
========================================
   RUNNING IN TEST MODE
   Config: { "window_position": (100, 100), "window_size": (600, 480), "is_host": true, "port": 8000, "instance_name": "Host" }
========================================
TestModeHandler: Command directories ready
  Commands: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_commands/commands
  Results: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_commands/results
[2025-11-27 20:09:59] [INFO.0000000] DebugLogger initialized - Session: 20251127_200959
[2025-11-27 20:09:59] [INFO.0000000] Log file: user://logs/debug_20251127_200959.log
[2025-11-27 20:09:59] [INFO.0000000] Real path: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251127_200959.log
[MeasuringTapeManager] Save persistence: false
Found armies in res://: ["orks", "adeptus_custodes", "space_marines", "A_C_test", "ORK_test"]
ArmyListManager initialized with 5 armies: ["orks", "adeptus_custodes", "space_marines", "A_C_test", "ORK_test"]
[2025-11-27 20:09:59] [INFO.0000000] DebugManager initialized
GameState: Loading default armies...
GameState: ArmyListManager not available, falling back to placeholder armies
GameState: Initializing placeholder armies for both players
GameState: Initializing placeholder army for player 1
GameState: Initializing placeholder army for player 2
ActionLogger: Started session 20251127_200959
StateSerializer: Pretty print enabled: true
SaveLoadManager: Current res:// directory: res://
SaveLoadManager: Project directory path: /Users/robertocallaghan/Documents/claude/godotv2/40k/
SaveLoadManager: Initialized save directories in project folder
SaveLoadManager: Save files will be stored at: /Users/robertocallaghan/Documents/claude/godotv2/40k/saves/
[PhaseManager] Ready - awaiting explicit phase initialization
[TerrainManager] Initializing terrain system
[TerrainManager] Added walls to terrain pieces
[TerrainManager] Loaded 12 terrain pieces
[EnhancedLineOfSight] Initialized
MissionManager: Initializing mission system
MissionManager: Set up 5 objectives for Strike Force deployment
  - obj_center at position (880.0, 1200.0)
  - obj_tl at position (400.0, 560.0)
  - obj_tr at position (1360.0, 560.0)
  - obj_bl at position (400.0, 1840.0)
  - obj_br at position (1360.0, 1840.0)
MissionManager: Initialized Take and Hold mission
[MeasuringTapeManager] Initialized with save_persistence: false
[LineOfSightManager] Initialized - Hold 'V' to check what can see the cursor position
TransportManager initialized
NetworkManager: Initialized
MainMenu: Initializing main menu
MainMenu: Loaded 5 armies: ["A C Test", "Adeptus Custodes", "ORK Test", "Orks", "Space Marines"]
MainMenu: Dropdowns populated with 5 armies
MainMenu: Multiplayer button visible: true
MainMenu: Signals connected
MainMenu: Save/Load dialog setup complete
MainMenu: Default armies set - Player 1: A C Test, Player 2: ORK Test
MainMenu: Ready with default selections
TestModeHandler: Set window position to (100, 100)
TestModeHandler: Set window size to (600, 480)
TestModeHandler: Scheduling auto-host...
SaveLoadDialog: Checking node references...
  - save_button path: VBoxContainer/SaveSection/SaveInputContainer/SaveButton
  - save_name_input path: VBoxContainer/SaveSection/SaveInputContainer/SaveNameInput
  - saves_list path: VBoxContainer/LoadSection/SavesScrollContainer/SavesList
  - load_button path: VBoxContainer/LoadSection/LoadButtonContainer/LoadButton
SaveLoadDialog: Connected save button
SaveLoadDialog: Connected save input
SaveLoadDialog: Connected saves list
SaveLoadDialog: Connected load button
SaveLoadDialog: Connected delete button
SaveLoadDialog: Connected cancel button
SaveLoadDialog UI signals connected
SaveLoadDialog: Found 29 save files
SaveLoadDialog: Populated list with 29 save files
SaveLoadDialog initialized successfully
[GameInstance] Launching Client instance on port 7778
[GameInstance] Using project path: /Users/robertocallaghan/Documents/claude/godotv2/40k/
TestModeHandler: Current scene: MainMenu
TestModeHandler: Triggering multiplayer mode...
MainMenu: Multiplayer button pressed
MultiplayerLobby: Army selection initialized with 5 armies
MultiplayerLobby: Ready
Godot Engine v4.5.1.stable.official.f62fdbde1 - https://godotengine.org
OpenGL API 4.1 INTEL-18.8.6 - Compatibility - Using Device: Intel Inc. - Intel(R) Iris(TM) Graphics 6100

TestModeHandler: Lobby scene: MultiplayerLobby
TestModeHandler: Creating host on port 8000
MultiplayerLobby: Host button pressed
========================================
   YOU ARE: PLAYER 1 (HOST)
   Hosting on port: 7777
========================================
MultiplayerLobby: Successfully hosting on port 7777
TestModeHandler: Waiting for client to connect...
TestModeHandler: Listening for peer connection...
TestModeHandler: Args -> ["--test-mode", "--position=800,100", "--resolution=600x480", "--auto-join", "--host-ip=127.0.0.1", "--host-port=8000", "--instance-name=Client"]
[LogMonitor] Started monitoring: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251127_200959.log
[GameInstance] Monitoring log file: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251127_200959.log
[GameInstance] Successfully launched Client (PID: 75216)
[Test] Client instance launched successfully
[Test] Waiting for client to connect to host...
[Test] Host performing action: get_game_state with params: {  }
[Test] Writing command file: host_75206_cmd_001.json
[Test] Waiting for result file...
[Test] Polling for result file: host_75206_cmd_001_result.json
TestModeHandler: Processing command file host_75206_cmd_001.json
TestModeHandler: Executing command from file: host_75206_cmd_001.json
TestModeHandler: Executing action: get_game_state
TestModeHandler: Handling get_game_state action
TestModeHandler: get_game_state - Phase: Deployment, Turn: 0, Player: 0
TestModeHandler: Result written to: host_75206_cmd_001_result.json
TestModeHandler: Command executed and result written
[Test] Result file found!
[Test] Action completed: success=true, message=Game state retrieved
[Test] Connection verified - action simulation working!
========================================
   RUNNING IN TEST MODE
   Config: { "window_position": (800, 100), "window_size": (600, 480), "is_host": false, "host_ip": "127.0.0.1", "host_port": 8000, "instance_name": "Client" }
========================================
TestModeHandler: Command directories ready
  Commands: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_commands/commands
  Results: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_commands/results
[2025-11-27 20:10:05] [INFO.0000000] DebugLogger initialized - Session: 20251127_201005
[2025-11-27 20:10:05] [INFO.0000000] Log file: user://logs/debug_20251127_201005.log
[2025-11-27 20:10:05] [INFO.0000000] Real path: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251127_201005.log
[MeasuringTapeManager] Save persistence: false
Found armies in res://: ["orks", "adeptus_custodes", "space_marines", "A_C_test", "ORK_test"]
ArmyListManager initialized with 5 armies: ["orks", "adeptus_custodes", "space_marines", "A_C_test", "ORK_test"]
[2025-11-27 20:10:05] [INFO.0000000] DebugManager initialized
GameState: Loading default armies...
GameState: ArmyListManager not available, falling back to placeholder armies
GameState: Initializing placeholder armies for both players
GameState: Initializing placeholder army for player 1
GameState: Initializing placeholder army for player 2
ActionLogger: Started session 20251127_201005
StateSerializer: Pretty print enabled: true
SaveLoadManager: Current res:// directory: res://
SaveLoadManager: Project directory path: /Users/robertocallaghan/Documents/claude/godotv2/40k/
SaveLoadManager: Initialized save directories in project folder
SaveLoadManager: Save files will be stored at: /Users/robertocallaghan/Documents/claude/godotv2/40k/saves/
[PhaseManager] Ready - awaiting explicit phase initialization
[TerrainManager] Initializing terrain system
[TerrainManager] Added walls to terrain pieces
[TerrainManager] Loaded 12 terrain pieces
[EnhancedLineOfSight] Initialized
MissionManager: Initializing mission system
MissionManager: Set up 5 objectives for Strike Force deployment
  - obj_center at position (880.0, 1200.0)
  - obj_tl at position (400.0, 560.0)
  - obj_tr at position (1360.0, 560.0)
  - obj_bl at position (400.0, 1840.0)
  - obj_br at position (1360.0, 1840.0)
MissionManager: Initialized Take and Hold mission
[MeasuringTapeManager] Initialized with save_persistence: false
[LineOfSightManager] Initialized - Hold 'V' to check what can see the cursor position
TransportManager initialized
NetworkManager: Initialized
MainMenu: Initializing main menu
MainMenu: Loaded 5 armies: ["A C Test", "Adeptus Custodes", "ORK Test", "Orks", "Space Marines"]
MainMenu: Dropdowns populated with 5 armies
MainMenu: Multiplayer button visible: true
MainMenu: Signals connected
MainMenu: Save/Load dialog setup complete
MainMenu: Default armies set - Player 1: A C Test, Player 2: ORK Test
MainMenu: Ready with default selections
TestModeHandler: Set window position to (800, 100)
TestModeHandler: Set window size to (600, 480)
TestModeHandler: Scheduling auto-join...
SaveLoadDialog: Checking node references...
  - save_button path: VBoxContainer/SaveSection/SaveInputContainer/SaveButton
  - save_name_input path: VBoxContainer/SaveSection/SaveInputContainer/SaveNameInput
  - saves_list path: VBoxContainer/LoadSection/SavesScrollContainer/SavesList
  - load_button path: VBoxContainer/LoadSection/LoadButtonContainer/LoadButton
SaveLoadDialog: Connected save button
SaveLoadDialog: Connected save input
SaveLoadDialog: Connected saves list
SaveLoadDialog: Connected load button
SaveLoadDialog: Connected delete button
SaveLoadDialog: Connected cancel button
SaveLoadDialog UI signals connected
SaveLoadDialog: Found 29 save files
SaveLoadDialog: Populated list with 29 save files
SaveLoadDialog initialized successfully
TestModeHandler: Current scene: MainMenu
TestModeHandler: Triggering multiplayer mode...
MainMenu: Multiplayer button pressed
MultiplayerLobby: Army selection initialized with 5 armies
MultiplayerLobby: Ready
[Test] Host performing action: complete_deployment with params: { "player_id": 1 }
[Test] Writing command file: host_75206_cmd_002.json
[Test] Waiting for result file...
[Test] Polling for result file: host_75206_cmd_002_result.json
TestModeHandler: Processing command file host_75206_cmd_002.json
TestModeHandler: Executing command from file: host_75206_cmd_002.json
TestModeHandler: Executing action: complete_deployment
TestModeHandler: Handling complete_deployment action
GameManager: complete_deployment() called for player 1
GameManager: Processing END_DEPLOYMENT action
[PhaseManager] get_current_phase_instance returning: null
WARNING: GameManager: Could not emit phase_completed - no phase instance
     at: push_warning (core/variant/variant_utility.cpp:1034)
     GDScript backtrace (most recent call first):
         [0] _trigger_phase_completion (res://autoloads/GameManager.gd:664)
         [1] process_end_deployment (res://autoloads/GameManager.gd:270)
         [2] process_action (res://autoloads/GameManager.gd:45)
         [3] apply_action (res://autoloads/GameManager.gd:10)
         [4] complete_deployment (res://autoloads/GameManager.gd:867)
         [5] _handle_complete_deployment (res://autoloads/TestModeHandler.gd:686)
         [6] _execute_command (res://autoloads/TestModeHandler.gd:440)
         [7] _execute_command_file (res://autoloads/TestModeHandler.gd:415)
         [8] _check_for_commands (res://autoloads/TestModeHandler.gd:386)
         [9] _process (res://autoloads/TestModeHandler.gd:372)
GameManager: Applying result with 1 changes/diffs
GameManager: Setting meta.phase = 1
GameManager: complete_deployment() result: success=true
TestModeHandler: Result written to: host_75206_cmd_002_result.json
TestModeHandler: Command executed and result written
[Test] Result file found!
[Test] Action completed: success=true, message=Player 1 deployment complete
[TEST] Player 1 complete: success=true
TestModeHandler: Lobby scene: MultiplayerLobby
TestModeHandler: Joining host at 127.0.0.1
MultiplayerLobby: Join button pressed
NetworkManager: Connecting to 127.0.0.1:7777
MultiplayerLobby: Attempting to join 127.0.0.1:7777
NetworkManager: Peer connected - 1
NetworkManager: Successfully connected to host
NetworkManager: Client set peer_to_player_map[667672170] = 2
========================================
   YOU ARE: PLAYER 2 (CLIENT)
   Connected to host
========================================
MultiplayerLobby: Peer connected - 1
MultiplayerLobby: Game started signal received
NetworkManager: Peer connected - 667672170
[GameState] MeasuringTapeManager not available
MultiplayerLobby: Peer connected - 667672170
TestModeHandler: Client connected!
MultiplayerLobby: Game started signal received
NetworkManager: Receiving initial state from host
[GameState] No measuring_tape data in save
NetworkManager: State synchronized
MultiplayerLobby: Game started signal received
MultiplayerLobby: Syncing army selection - Player 1 -> A_C_test
MultiplayerLobby: Syncing army selection - Player 2 -> ORK_test
[Test] Host performing action: get_game_state with params: {  }
[Test] Writing command file: host_75206_cmd_003.json
[Test] Waiting for result file...
[Test] Polling for result file: host_75206_cmd_003_result.json
TestModeHandler: Processing command file host_75206_cmd_003.json
TestModeHandler: Executing command from file: host_75206_cmd_003.json
TestModeHandler: Executing action: get_game_state
TestModeHandler: Handling get_game_state action
TestModeHandler: get_game_state - Phase: Command, Turn: 0, Player: 0
TestModeHandler: Result written to: host_75206_cmd_003_result.json
TestModeHandler: Command executed and result written
[Test] Result file found!
[Test] Action completed: success=true, message=Game state retrieved
[TEST] Phase after P1 complete: Command
[Test] Client performing action: complete_deployment with params: { "player_id": 2 }
[Test] Writing command file: client_75216_cmd_001.json
[Test] Waiting for result file...
[Test] Polling for result file: client_75216_cmd_001_result.json
TestModeHandler: Processing command file client_75216_cmd_001.json
TestModeHandler: Executing command from file: client_75216_cmd_001.json
TestModeHandler: Executing action: complete_deployment
TestModeHandler: Handling complete_deployment action
GameManager: complete_deployment() called for player 2
GameManager: Processing END_DEPLOYMENT action
[PhaseManager] get_current_phase_instance returning: null
WARNING: GameManager: Could not emit phase_completed - no phase instance
     at: push_warning (core/variant/variant_utility.cpp:1034)
     GDScript backtrace (most recent call first):
         [0] _trigger_phase_completion (res://autoloads/GameManager.gd:664)
         [1] process_end_deployment (res://autoloads/GameManager.gd:270)
         [2] process_action (res://autoloads/GameManager.gd:45)
         [3] apply_action (res://autoloads/GameManager.gd:10)
         [4] complete_deployment (res://autoloads/GameManager.gd:867)
         [5] _handle_complete_deployment (res://autoloads/TestModeHandler.gd:686)
         [6] _execute_command (res://autoloads/TestModeHandler.gd:440)
         [7] _execute_command_file (res://autoloads/TestModeHandler.gd:415)
         [8] _check_for_commands (res://autoloads/TestModeHandler.gd:386)
         [9] _process (res://autoloads/TestModeHandler.gd:372)
GameManager: Applying result with 1 changes/diffs
GameManager: Setting meta.phase = 1
GameManager: complete_deployment() result: success=true
TestModeHandler: Result written to: client_75216_cmd_001_result.json
TestModeHandler: Command executed and result written
[Test] Result file found!
[Test] Action completed: success=true, message=Player 2 deployment complete
[TEST] Player 2 complete: success=true
TestModeHandler: Starting game...
MultiplayerLobby: Start game button pressed
MultiplayerLobby: Loading armies...
MultiplayerLobby: Loading A_C_test for Player 1
Loading army list: A_C_test for player 1
Processed unit: U_BLADE_CHAMPION_A for player 1
Processed unit: U_WITCHSEEKERS_C for player 1
Processed unit: U_CALADIUS_GRAV-TANK_E for player 1
Successfully loaded army: A_C_test with 3 units
MultiplayerLobby: Player 1 army loaded, has 3 units
Applying army to game state for player: 1
Removing 0 existing units for player 1
Added unit: U_BLADE_CHAMPION_A (Blade Champion)
Added unit: U_WITCHSEEKERS_C (Witchseekers)
Added unit: U_CALADIUS_GRAV-TANK_E (Caladius Grav-tank)
Set faction for player 1: Adeptus Custodes
Army applied successfully. Total units in game: 3
MultiplayerLobby: After applying P1 army, GameState has 3 units
MultiplayerLobby: Loading ORK_test for Player 2
Loading army list: ORK_test for player 2
Processed unit: U_WARBOSS_B for player 2
Processed unit: U_WARBOSS_IN_MEGA_ARMOUR_D for player 2
[2025-11-27 20:10:10] [DEBUG.0000000] Parsed transport capacity keywords | Context: {"description":"This model has a transport capacity of 22 ORKS INFANTRY models. Each MEGA ARMOUR model takes up the space of 2 models. This model cannot transport models that are JUMP PACK models.","keywords":["ORKS","INFANTRY"],"unit_id":"U_BATTLEWAGON_G"}
Processed unit: U_BATTLEWAGON_G for player 2
Successfully loaded army: ORK_test with 3 units
MultiplayerLobby: Player 2 army loaded, has 3 units
Applying army to game state for player: 2
Removing 0 existing units for player 2
Added unit: U_WARBOSS_B (Warboss)
Added unit: U_WARBOSS_IN_MEGA_ARMOUR_D (Warboss in Mega Armour)
Added unit: U_BATTLEWAGON_G (Battlewagon)
Set faction for player 2: Unknown
Army applied successfully. Total units in game: 6
MultiplayerLobby: After applying P2 army, GameState has 6 units
MultiplayerLobby: Armies loaded. Total units: 6
MultiplayerLobby: Syncing loaded armies to clients...
[GameState] MeasuringTapeManager not available
MultiplayerLobby: Snapshot has 6 units
MultiplayerLobby: Sent army snapshot to peer 667672170
NetworkManager: Receiving initial state from host
[GameState] No measuring_tape data in save
NetworkManager: State synchronized
MultiplayerLobby: Game started signal received
NetworkManager: Starting multiplayer game - transitioning to Main scene
NetworkManager: Units in GameState BEFORE scene change: 6
NetworkManager: Unit IDs: ["U_BLADE_CHAMPION_A", "U_WITCHSEEKERS_C", "U_CALADIUS_GRAV-TANK_E", "U_WARBOSS_B", "U_WARBOSS_IN_MEGA_ARMOUR_D", "U_BATTLEWAGON_G"]
NetworkManager: Starting multiplayer game - transitioning to Main scene
NetworkManager: Units in GameState BEFORE scene change: 6
NetworkManager: Unit IDs: ["U_BLADE_CHAMPION_A", "U_WITCHSEEKERS_C", "U_CALADIUS_GRAV-TANK_E", "U_WARBOSS_B", "U_WARBOSS_IN_MEGA_ARMOUR_D", "U_BATTLEWAGON_G"]
[Test] Host performing action: get_game_state with params: {  }
[Test] Writing command file: host_75206_cmd_004.json
[Test] Waiting for result file...
[Test] Polling for result file: host_75206_cmd_004_result.json
MultiplayerLobby: Game started signal received
MultiplayerLobby: Game started signal received
MultiplayerLobby: Game start RPC sent to all peers
TestModeHandler: Processing command file host_75206_cmd_004.json
TestModeHandler: Executing command from file: host_75206_cmd_004.json
TestModeHandler: Executing action: get_game_state
TestModeHandler: Handling get_game_state action
TestModeHandler: get_game_state - Phase: Command, Turn: 0, Player: 0
TestModeHandler: Result written to: host_75206_cmd_004_result.json
TestModeHandler: Command executed and result written
[Test] Result file found!
[Test] Action completed: success=true, message=Game state retrieved
[TEST] Phase after both complete: Command
[TEST] Deployment completion test finished

========================================
Cleaning up Multiplayer Test
========================================

[Test] Host performing action: get_game_state with params: {  }
[Test] Writing command file: host_75206_cmd_005.json
[Test] Waiting for result file...
[Test] Polling for result file: host_75206_cmd_005_result.json
UnitStatsPanel: _ready() called with 4-section layout
UnitStatsPanel: Toggle button connected
UnitStatsPanel: Player units list connected
UnitStatsPanel: Enemy units list connected
UnitStatsPanel: Setting collapsed to true
UnitStatsPanel: Main content visible = false
UnitStatsPanel: Toggle button text = ▼ Unit Stats
UnitStatsPanel: Target height = 40, Target offset = -40
Main: _ready() called
Main: DebugLogger log file path: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251127_201005.log
[2025-11-27 20:10:12] [INFO.0000000] Main._ready() called
Main: Current units count BEFORE check: 6
Main: Unit IDs in GameState: ["U_BLADE_CHAMPION_A", "U_WITCHSEEKERS_C", "U_CALADIUS_GRAV-TANK_E", "U_WARBOSS_B", "U_WARBOSS_IN_MEGA_ARMOUR_D", "U_BATTLEWAGON_G"]
Main: Meta flags: ["game_id", "turn_number", "battle_round", "active_player", "phase", "created_at", "version", "from_multiplayer_lobby", "game_config"]
Main: Game config: { "player1_army": "A_C_test", "player2_army": "ORK_test" }
Main: from_menu=false from_save=false from_multiplayer=true
Main: ✓ Loading from multiplayer lobby with armies already loaded
Main: Units count AFTER multiplayer check: 6
Main: Initializing deployment phase with 6 units
[PhaseManager] transition_to_phase called for: DEPLOYMENT
[PhaseManager] Creating new phase instance for: DEPLOYMENT
[PhaseManager] Phase script: <GDScript#-9223372002159491695>
[PhaseManager] Created instance class: Node
[PhaseManager] Instance script: <GDScript#-9223372002159491695>
[PhaseManager] Instance has validate_action: true
[PhaseManager] Connected to phase_completed signal
[PhaseManager] Connected to action_taken signal
[GameState] MeasuringTapeManager not available
[PhaseManager] Creating snapshot for phase 0
[PhaseManager] Snapshot has 6 units
[PhaseManager] Unit IDs: ["U_BLADE_CHAMPION_A", "U_WITCHSEEKERS_C", "U_CALADIUS_GRAV-TANK_E", "U_WARBOSS_B", "U_WARBOSS_IN_MEGA_ARMOUR_D", "U_BATTLEWAGON_G"]
[0][INFO] Entering Deployment Phase
[0][INFO] Deployment phase initialized
UnitStatsPanel: _ready() called with 4-section layout
UnitStatsPanel: Toggle button connected
UnitStatsPanel: Player units list connected
UnitStatsPanel: Enemy units list connected
UnitStatsPanel: Setting collapsed to true
UnitStatsPanel: Main content visible = false
UnitStatsPanel: Toggle button text = ▼ Unit Stats
UnitStatsPanel: Target height = 40, Target offset = -40
Main: _ready() called
Main: DebugLogger log file path: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251127_200959.log
[2025-11-27 20:10:12] [INFO.0000000] Main._ready() called
Main: Current units count BEFORE check: 6
Main: Unit IDs in GameState: ["U_BLADE_CHAMPION_A", "U_WITCHSEEKERS_C", "U_CALADIUS_GRAV-TANK_E", "U_WARBOSS_B", "U_WARBOSS_IN_MEGA_ARMOUR_D", "U_BATTLEWAGON_G"]
Main: Meta flags: ["game_id", "turn_number", "battle_round", "active_player", "phase", "created_at", "version", "from_multiplayer_lobby", "game_config"]
Main: Game config: { "player1_army": "A_C_test", "player2_army": "ORK_test" }
Main: from_menu=false from_save=false from_multiplayer=true
Main: ✓ Loading from multiplayer lobby with armies already loaded
Main: Units count AFTER multiplayer check: 6
Main: Initializing deployment phase with 6 units
[PhaseManager] transition_to_phase called for: DEPLOYMENT
[PhaseManager] Creating new phase instance for: DEPLOYMENT
[PhaseManager] Phase script: <GDScript#-9223372002159491695>
[PhaseManager] Created instance class: Node
[PhaseManager] Instance script: <GDScript#-9223372002159491695>
[PhaseManager] Instance has validate_action: true
[PhaseManager] Connected to phase_completed signal
[PhaseManager] Connected to action_taken signal
[GameState] MeasuringTapeManager not available
[PhaseManager] Creating snapshot for phase 0
[PhaseManager] Snapshot has 6 units
[PhaseManager] Unit IDs: ["U_BLADE_CHAMPION_A", "U_WITCHSEEKERS_C", "U_CALADIUS_GRAV-TANK_E", "U_WARBOSS_B", "U_WARBOSS_IN_MEGA_ARMOUR_D", "U_BATTLEWAGON_G"]
[0][INFO] Entering Deployment Phase
[0][INFO] Deployment phase initialized
[PhaseManager] get_current_phase_instance returning: Node
[PhaseManager] Instance script path: res://phases/DeploymentPhase.gd
[PhaseManager] Instance has validate_action: true
[PhaseManager] ⚠️ Script path: res://phases/DeploymentPhase.gd
[PhaseManager] ⚠️ This SHOULD be a DeploymentPhase!
Main: Phase instance created - class: Node
Main: Phase instance script: <GDScript#-9223372002159491695>
Main: Phase has validate_action: true
Setting up objectives on board...
Main: Creating visuals for 5 objectives
MissionManager: Checking control for 5 objectives with 6 units

Checking objective: obj_center at position (880.0, 1200.0)
  Skipping U_BLADE_CHAMPION_A - not deployed (status: 0)
  Skipping U_WITCHSEEKERS_C - not deployed (status: 0)
  Skipping U_CALADIUS_GRAV-TANK_E - not deployed (status: 0)
  Skipping U_WARBOSS_B - not deployed (status: 0)
  Skipping U_WARBOSS_IN_MEGA_ARMOUR_D - not deployed (status: 0)
  Skipping U_BATTLEWAGON_G - not deployed (status: 0)

Checking objective: obj_tl at position (400.0, 560.0)
  Skipping U_BLADE_CHAMPION_A - not deployed (status: 0)
  Skipping U_WITCHSEEKERS_C - not deployed (status: 0)
  Skipping U_CALADIUS_GRAV-TANK_E - not deployed (status: 0)
  Skipping U_WARBOSS_B - not deployed (status: 0)
  Skipping U_WARBOSS_IN_MEGA_ARMOUR_D - not deployed (status: 0)
  Skipping U_BATTLEWAGON_G - not deployed (status: 0)

Checking objective: obj_tr at position (1360.0, 560.0)
  Skipping U_BLADE_CHAMPION_A - not deployed (status: 0)
  Skipping U_WITCHSEEKERS_C - not deployed (status: 0)
  Skipping U_CALADIUS_GRAV-TANK_E - not deployed (status: 0)
  Skipping U_WARBOSS_B - not deployed (status: 0)
  Skipping U_WARBOSS_IN_MEGA_ARMOUR_D - not deployed (status: 0)
  Skipping U_BATTLEWAGON_G - not deployed (status: 0)

Checking objective: obj_bl at position (400.0, 1840.0)
  Skipping U_BLADE_CHAMPION_A - not deployed (status: 0)
  Skipping U_WITCHSEEKERS_C - not deployed (status: 0)
  Skipping U_CALADIUS_GRAV-TANK_E - not deployed (status: 0)
  Skipping U_WARBOSS_B - not deployed (status: 0)
  Skipping U_WARBOSS_IN_MEGA_ARMOUR_D - not deployed (status: 0)
  Skipping U_BATTLEWAGON_G - not deployed (status: 0)

Checking objective: obj_br at position (1360.0, 1840.0)
  Skipping U_BLADE_CHAMPION_A - not deployed (status: 0)
  Skipping U_WITCHSEEKERS_C - not deployed (status: 0)
  Skipping U_CALADIUS_GRAV-TANK_E - not deployed (status: 0)
  Skipping U_WARBOSS_B - not deployed (status: 0)
  Skipping U_WARBOSS_IN_MEGA_ARMOUR_D - not deployed (status: 0)
  Skipping U_BATTLEWAGON_G - not deployed (status: 0)
Main: Objectives setup complete
Moved HUD_Bottom to top of screen
Looking for UnitStatsPanel in scene...
Found UnitStatsPanel in scene structure
Connected to unit_selected signal from UnitStatsPanel
UnitStatsPanel: Populating unit lists for phase: DEPLOYMENT
UnitStatsPanel: Populated 3 units for player (player 1)
UnitStatsPanel: Populated 3 units for enemy (player 2)
Initialized UnitStatsPanel unit lists for phase: DEPLOYMENT
Fixed HUD layout: HUD_Left adjusted for new layout
Fixed HUD layout: HUD_Right adjusted for new layout
Adjusted unit list: fixed height to 150px
Setting up Mathhammer UI...
MathhhammerUI: Initializing...
[PhaseManager] get_current_phase_instance returning: Node
[PhaseManager] Instance script path: res://phases/DeploymentPhase.gd
[PhaseManager] Instance has validate_action: true
[PhaseManager] ⚠️ Script path: res://phases/DeploymentPhase.gd
[PhaseManager] ⚠️ This SHOULD be a DeploymentPhase!
Main: Phase instance created - class: Node
Main: Phase instance script: <GDScript#-9223372002159491695>
Main: Phase has validate_action: true
Setting up objectives on board...
Main: Creating visuals for 5 objectives
MissionManager: Checking control for 5 objectives with 6 units

Checking objective: obj_center at position (880.0, 1200.0)
  Skipping U_BLADE_CHAMPION_A - not deployed (status: 0)
  Skipping U_WITCHSEEKERS_C - not deployed (status: 0)
  Skipping U_CALADIUS_GRAV-TANK_E - not deployed (status: 0)
  Skipping U_WARBOSS_B - not deployed (status: 0)
  Skipping U_WARBOSS_IN_MEGA_ARMOUR_D - not deployed (status: 0)
  Skipping U_BATTLEWAGON_G - not deployed (status: 0)

Checking objective: obj_tl at position (400.0, 560.0)
  Skipping U_BLADE_CHAMPION_A - not deployed (status: 0)
  Skipping U_WITCHSEEKERS_C - not deployed (status: 0)
  Skipping U_CALADIUS_GRAV-TANK_E - not deployed (status: 0)
  Skipping U_WARBOSS_B - not deployed (status: 0)
  Skipping U_WARBOSS_IN_MEGA_ARMOUR_D - not deployed (status: 0)
  Skipping U_BATTLEWAGON_G - not deployed (status: 0)

Checking objective: obj_tr at position (1360.0, 560.0)
  Skipping U_BLADE_CHAMPION_A - not deployed (status: 0)
  Skipping U_WITCHSEEKERS_C - not deployed (status: 0)
  Skipping U_CALADIUS_GRAV-TANK_E - not deployed (status: 0)
  Skipping U_WARBOSS_B - not deployed (status: 0)
  Skipping U_WARBOSS_IN_MEGA_ARMOUR_D - not deployed (status: 0)
  Skipping U_BATTLEWAGON_G - not deployed (status: 0)

Checking objective: obj_bl at position (400.0, 1840.0)
  Skipping U_BLADE_CHAMPION_A - not deployed (status: 0)
  Skipping U_WITCHSEEKERS_C - not deployed (status: 0)
  Skipping U_CALADIUS_GRAV-TANK_E - not deployed (status: 0)
  Skipping U_WARBOSS_B - not deployed (status: 0)
  Skipping U_WARBOSS_IN_MEGA_ARMOUR_D - not deployed (status: 0)
  Skipping U_BATTLEWAGON_G - not deployed (status: 0)

Checking objective: obj_br at position (1360.0, 1840.0)
  Skipping U_BLADE_CHAMPION_A - not deployed (status: 0)
  Skipping U_WITCHSEEKERS_C - not deployed (status: 0)
  Skipping U_CALADIUS_GRAV-TANK_E - not deployed (status: 0)
  Skipping U_WARBOSS_B - not deployed (status: 0)
  Skipping U_WARBOSS_IN_MEGA_ARMOUR_D - not deployed (status: 0)
  Skipping U_BATTLEWAGON_G - not deployed (status: 0)
Main: Objectives setup complete
Moved HUD_Bottom to top of screen
Looking for UnitStatsPanel in scene...
Found UnitStatsPanel in scene structure
Connected to unit_selected signal from UnitStatsPanel
UnitStatsPanel: Populating unit lists for phase: DEPLOYMENT
UnitStatsPanel: Populated 3 units for player (player 1)
UnitStatsPanel: Populated 3 units for enemy (player 2)
Initialized UnitStatsPanel unit lists for phase: DEPLOYMENT
Fixed HUD layout: HUD_Left adjusted for new layout
Fixed HUD layout: HUD_Right adjusted for new layout
Adjusted unit list: fixed height to 150px
Setting up Mathhammer UI...
MathhhammerUI: Initializing...
Mathhammer UI added to left HUD
Mathhammer UI successfully integrated into left side of main UI
Setting up Save/Load Dialog...
Save/Load Dialog setup completed
Setting up terrain system...
[TerrainVisual] Added wall line from (640.0, 80.0) to (800.0, 80.0) type: solid
[TerrainVisual] Added wall line from (640.0, 80.0) to (640.0, 200.0) type: window
[TerrainVisual] Added wall line from (1120.0, 200.0) to (1600.0, 200.0) type: solid
[TerrainVisual] Added wall line from (1120.0, 440.0) to (1600.0, 440.0) type: solid
[TerrainVisual] Added wall line from (1120.0, 280.0) to (1120.0, 360.0) type: door
[TerrainVisual] Added wall line from (1600.0, 250.0) to (1600.0, 390.0) type: window
[TerrainVisual] Added wall line from (640.0, 320.0) to (640.0, 560.0) type: solid
[TerrainVisual] Added wall line from (280.0, 440.0) to (520.0, 440.0) type: window
[TerrainVisual] Added wall line from (160.0, 1960.0) to (640.0, 1960.0) type: solid
[TerrainVisual] Added wall line from (160.0, 1960.0) to (160.0, 2200.0) type: solid
[TerrainVisual] Added wall line from (625.4415, 844.8528) to (964.8528, 505.4416) type: solid
[TerrainVisual] Rendered 12 terrain pieces
[TerrainVisual] Initialized
Added TerrainVisual to BoardRoot
[LineOfSightVisual] Initialized - Will show models that can see cursor position
Added LineOfSightVisual to BoardRoot
Line of Sight: Hold 'V' to check what models can see the cursor position
Added terrain UI controls to HUD
Setting up measuring tape visual...
[MeasuringTapeVisual] Initialized with z_index 15
Added MeasuringTapeVisual to BoardRoot
Measuring Tape: Hold 't' and drag to measure, press 'y' to clear all measurements
Added measuring tape save toggle to HUD
Setting up transport panel...
Transport panel added to HUD_Right
Left panel toggle button added to top HUD
Left panel hidden by default
Main: setup_phase_controllers() STARTING (semaphore locked)
TestModeHandler: Processing command file host_75206_cmd_005.json
TestModeHandler: Executing command from file: host_75206_cmd_005.json
TestModeHandler: Executing action: get_game_state
TestModeHandler: Handling get_game_state action
TestModeHandler: get_game_state - Phase: Deployment, Turn: 0, Player: 0
TestModeHandler: Result written to: host_75206_cmd_005_result.json
TestModeHandler: Command executed and result written
SaveLoadDialog: Checking node references...
  - save_button path: VBoxContainer/SaveSection/SaveInputContainer/SaveButton
  - save_name_input path: VBoxContainer/SaveSection/SaveInputContainer/SaveNameInput
  - saves_list path: VBoxContainer/LoadSection/SavesScrollContainer/SavesList
  - load_button path: VBoxContainer/LoadSection/LoadButtonContainer/LoadButton
SaveLoadDialog: Connected save button
SaveLoadDialog: Connected save input
SaveLoadDialog: Connected saves list
SaveLoadDialog: Connected load button
SaveLoadDialog: Connected delete button
SaveLoadDialog: Connected cancel button
SaveLoadDialog UI signals connected
Mathhammer UI added to left HUD
Mathhammer UI successfully integrated into left side of main UI
Setting up Save/Load Dialog...
Save/Load Dialog setup completed
Setting up terrain system...
[TerrainVisual] Added wall line from (640.0, 80.0) to (800.0, 80.0) type: solid
[TerrainVisual] Added wall line from (640.0, 80.0) to (640.0, 200.0) type: window
SaveLoadDialog: Found 29 save files
[TerrainVisual] Added wall line from (1120.0, 200.0) to (1600.0, 200.0) type: solid
[TerrainVisual] Added wall line from (1120.0, 440.0) to (1600.0, 440.0) type: solid
[TerrainVisual] Added wall line from (1120.0, 280.0) to (1120.0, 360.0) type: door
[TerrainVisual] Added wall line from (1600.0, 250.0) to (1600.0, 390.0) type: window
SaveLoadDialog: Populated list with 29 save files
SaveLoadDialog initialized successfully
[TerrainVisual] Added wall line from (640.0, 320.0) to (640.0, 560.0) type: solid
[TerrainVisual] Added wall line from (280.0, 440.0) to (520.0, 440.0) type: window
[TerrainVisual] Added wall line from (160.0, 1960.0) to (640.0, 1960.0) type: solid
[TerrainVisual] Added wall line from (160.0, 1960.0) to (160.0, 2200.0) type: solid
[TerrainVisual] Added wall line from (625.4415, 844.8528) to (964.8528, 505.4416) type: solid
[TerrainVisual] Rendered 12 terrain pieces
[TerrainVisual] Initialized
Added TerrainVisual to BoardRoot
[LineOfSightVisual] Initialized - Will show models that can see cursor position
Added LineOfSightVisual to BoardRoot
Line of Sight: Hold 'V' to check what models can see the cursor position
Added terrain UI controls to HUD
Setting up measuring tape visual...
[MeasuringTapeVisual] Initialized with z_index 15
Added MeasuringTapeVisual to BoardRoot
Measuring Tape: Hold 't' and drag to measure, press 'y' to clear all measurements
Added measuring tape save toggle to HUD
Setting up transport panel...
Main: setup_phase_controllers() COMPLETE (semaphore unlocked)
Transport panel added to HUD_Right
ERROR: Signal 'unit_confirmed' is already connected to given callable 'CanvasLayer(Main.gd)::_on_unit_confirmed' in that object.
   at: connect (core/object/object.cpp:1538)
   GDScript backtrace (most recent call first):
       [0] connect_signals (res://scripts/Main.gd:1250)
       [1] _ready (res://scripts/Main.gd:137)
       [2] setup_phase_controllers (res://scripts/Main.gd:940)
ERROR: Signal 'models_placed_changed' is already connected to given callable 'CanvasLayer(Main.gd)::_on_models_placed_changed' in that object.
   at: connect (core/object/object.cpp:1538)
   GDScript backtrace (most recent call first):
       [0] connect_signals (res://scripts/Main.gd:1251)
       [1] _ready (res://scripts/Main.gd:137)
       [2] setup_phase_controllers (res://scripts/Main.gd:940)
Main: Connected to GameManager.result_applied signal
Left panel toggle button added to top HUD
UnitStatsPanel: Populating unit lists for phase: DEPLOYMENT
Left panel hidden by default
Main: setup_phase_controllers() STARTING (semaphore locked)
UnitStatsPanel: Populated 3 units for player (player 1)
UnitStatsPanel: Populated 3 units for enemy (player 2)
Refreshed bottom panel unit lists for phase: DEPLOYMENT
Refreshing right panel unit list for deployment - found 3 undeployed units
GameState: ⚠️ all_units_deployed check - Undeployed units: ["U_BLADE_CHAMPION_A (player 1)", "U_WITCHSEEKERS_C (player 1)", "U_CALADIUS_GRAV-TANK_E (player 1)", "U_WARBOSS_B (player 2)", "U_WARBOSS_IN_MEGA_ARMOUR_D (player 2)", "U_BATTLEWAGON_G (player 2)"]
Main: ⚠️ update_ui() - DEPLOYMENT phase - all_deployed: false
Main: ⚠️ Button state BEFORE change - disabled: true text: 'End Phase'
[2025-11-27 20:10:12] [INFO.0000000] update_ui deployment check | Context: {"all_deployed":false,"button_text":"End Phase","current_button_disabled":true}
Main: ⚠️ update_ui() - Setting button DISABLED (not all deployed)
Main: ⚠️ Button state AFTER disable - disabled: true
Main: ⚠️ Calling update_ui_for_phase() for initial phase setup
Main: ========== UPDATE UI FOR PHASE ==========
Main: Current phase: DEPLOYMENT
[2025-11-27 20:10:12] [INFO.0000000] update_ui_for_phase START | Context: {"button_exists":true,"button_path":"/root/Main/HUD_Bottom/HBoxContainer/PhaseActionButton","phase":"DEPLOYMENT"}
[2025-11-27 20:10:12] [INFO.0000000] Updating UI for phase | Context: {"phase":"DEPLOYMENT"}
GameState: ⚠️ all_units_deployed check - Undeployed units: ["U_BLADE_CHAMPION_A (player 1)", "U_WITCHSEEKERS_C (player 1)", "U_CALADIUS_GRAV-TANK_E (player 1)", "U_WARBOSS_B (player 2)", "U_WARBOSS_IN_MEGA_ARMOUR_D (player 2)", "U_BATTLEWAGON_G (player 2)"]
Main: Deployment phase - all_units_deployed: false button_disabled: true
[2025-11-27 20:10:12] [INFO.0000000] Deployment button state | Context: {"all_deployed":false,"button_disabled":true}
Main: Phase button configured - text: 'End Deployment' visible: true disabled: true
[2025-11-27 20:10:12] [INFO.0000000] Phase button configured | Context: {"disabled":true,"text":"End Deployment","visible":true}
Main: Connected phase action button to _on_phase_action_pressed
Main: ⚠️ VERIFICATION - Button connected: true
[2025-11-27 20:10:12] [INFO.0000000] Phase button signal connected | Context: {"connection_verified":true,"is_now_connected":true,"was_previously_connected":false}
WARNING: MovementActions container not found!
GameState: ⚠️ all_units_deployed check - Undeployed units: ["U_BLADE_CHAMPION_A (player 1)", "U_WITCHSEEKERS_C (player 1)", "U_CALADIUS_GRAV-TANK_E (player 1)", "U_WARBOSS_B (player 2)", "U_WARBOSS_IN_MEGA_ARMOUR_D (player 2)", "U_BATTLEWAGON_G (player 2)"]
UnitStatsPanel: Populating unit lists for phase: DEPLOYMENT
UnitStatsPanel: Populated 3 units for player (player 1)
UnitStatsPanel: Populated 3 units for enemy (player 2)
Refreshed bottom panel unit lists for phase: DEPLOYMENT
Refreshing right panel unit list for deployment - found 3 undeployed units
GameState: ⚠️ all_units_deployed check - Undeployed units: ["U_BLADE_CHAMPION_A (player 1)", "U_WITCHSEEKERS_C (player 1)", "U_CALADIUS_GRAV-TANK_E (player 1)", "U_WARBOSS_B (player 2)", "U_WARBOSS_IN_MEGA_ARMOUR_D (player 2)", "U_BATTLEWAGON_G (player 2)"]
Main: ⚠️ update_ui() - DEPLOYMENT phase - all_deployed: false
Main: ⚠️ Button state BEFORE change - disabled: true text: 'End Deployment'
[2025-11-27 20:10:12] [INFO.0000000] update_ui deployment check | Context: {"all_deployed":false,"button_text":"End Deployment","current_button_disabled":true}
Main: ⚠️ update_ui() - Setting button DISABLED (not all deployed)
Main: ⚠️ Button state AFTER disable - disabled: true
Main: ⚠️ Initial phase UI setup complete
Quick Save/Load enabled: [ key to save, ] key (or F9) to load
SaveLoadDialog: Checking node references...
  - save_button path: VBoxContainer/SaveSection/SaveInputContainer/SaveButton
  - save_name_input path: VBoxContainer/SaveSection/SaveInputContainer/SaveNameInput
  - saves_list path: VBoxContainer/LoadSection/SavesScrollContainer/SavesList
  - load_button path: VBoxContainer/LoadSection/LoadButtonContainer/LoadButton
SaveLoadDialog: Connected save button
SaveLoadDialog: Connected save input
SaveLoadDialog: Connected saves list
SaveLoadDialog: Connected load button
SaveLoadDialog: Connected delete button
SaveLoadDialog: Connected cancel button
SaveLoadDialog UI signals connected
SaveLoadDialog: Found 29 save files
SaveLoadDialog: Populated list with 29 save files
SaveLoadDialog initialized successfully
Main: setup_phase_controllers() COMPLETE (semaphore unlocked)
ERROR: Signal 'unit_confirmed' is already connected to given callable 'CanvasLayer(Main.gd)::_on_unit_confirmed' in that object.
   at: connect (core/object/object.cpp:1538)
   GDScript backtrace (most recent call first):
       [0] connect_signals (res://scripts/Main.gd:1250)
       [1] _ready (res://scripts/Main.gd:137)
       [2] setup_phase_controllers (res://scripts/Main.gd:940)
ERROR: Signal 'models_placed_changed' is already connected to given callable 'CanvasLayer(Main.gd)::_on_models_placed_changed' in that object.
   at: connect (core/object/object.cpp:1538)
   GDScript backtrace (most recent call first):
       [0] connect_signals (res://scripts/Main.gd:1251)
       [1] _ready (res://scripts/Main.gd:137)
       [2] setup_phase_controllers (res://scripts/Main.gd:940)
Main: Connected to GameManager.result_applied signal
UnitStatsPanel: Populating unit lists for phase: DEPLOYMENT
UnitStatsPanel: Populated 3 units for player (player 1)
UnitStatsPanel: Populated 3 units for enemy (player 2)
Refreshed bottom panel unit lists for phase: DEPLOYMENT
Refreshing right panel unit list for deployment - found 3 undeployed units
GameState: ⚠️ all_units_deployed check - Undeployed units: ["U_BLADE_CHAMPION_A (player 1)", "U_WITCHSEEKERS_C (player 1)", "U_CALADIUS_GRAV-TANK_E (player 1)", "U_WARBOSS_B (player 2)", "U_WARBOSS_IN_MEGA_ARMOUR_D (player 2)", "U_BATTLEWAGON_G (player 2)"]
Main: ⚠️ update_ui() - DEPLOYMENT phase - all_deployed: false
Main: ⚠️ Button state BEFORE change - disabled: true text: 'End Phase'
[2025-11-27 20:10:12] [INFO.0000000] update_ui deployment check | Context: {"all_deployed":false,"button_text":"End Phase","current_button_disabled":true}
Main: ⚠️ update_ui() - Setting button DISABLED (not all deployed)
Main: ⚠️ Button state AFTER disable - disabled: true
Main: ⚠️ Calling update_ui_for_phase() for initial phase setup
Main: ========== UPDATE UI FOR PHASE ==========
Main: Current phase: DEPLOYMENT
[2025-11-27 20:10:12] [INFO.0000000] update_ui_for_phase START | Context: {"button_exists":true,"button_path":"/root/Main/HUD_Bottom/HBoxContainer/PhaseActionButton","phase":"DEPLOYMENT"}
[2025-11-27 20:10:12] [INFO.0000000] Updating UI for phase | Context: {"phase":"DEPLOYMENT"}
GameState: ⚠️ all_units_deployed check - Undeployed units: ["U_BLADE_CHAMPION_A (player 1)", "U_WITCHSEEKERS_C (player 1)", "U_CALADIUS_GRAV-TANK_E (player 1)", "U_WARBOSS_B (player 2)", "U_WARBOSS_IN_MEGA_ARMOUR_D (player 2)", "U_BATTLEWAGON_G (player 2)"]
Main: Deployment phase - all_units_deployed: false button_disabled: true
[2025-11-27 20:10:12] [INFO.0000000] Deployment button state | Context: {"all_deployed":false,"button_disabled":true}
Main: Phase button configured - text: 'End Deployment' visible: true disabled: true
[2025-11-27 20:10:12] [INFO.0000000] Phase button configured | Context: {"disabled":true,"text":"End Deployment","visible":true}
Main: Connected phase action button to _on_phase_action_pressed
Main: ⚠️ VERIFICATION - Button connected: true
[2025-11-27 20:10:12] [INFO.0000000] Phase button signal connected | Context: {"connection_verified":true,"is_now_connected":true,"was_previously_connected":false}
WARNING: MovementActions container not found!
GameState: ⚠️ all_units_deployed check - Undeployed units: ["U_BLADE_CHAMPION_A (player 1)", "U_WITCHSEEKERS_C (player 1)", "U_CALADIUS_GRAV-TANK_E (player 1)", "U_WARBOSS_B (player 2)", "U_WARBOSS_IN_MEGA_ARMOUR_D (player 2)", "U_BATTLEWAGON_G (player 2)"]
UnitStatsPanel: Populating unit lists for phase: DEPLOYMENT
UnitStatsPanel: Populated 3 units for player (player 1)
UnitStatsPanel: Populated 3 units for enemy (player 2)
Refreshed bottom panel unit lists for phase: DEPLOYMENT
Refreshing right panel unit list for deployment - found 3 undeployed units
GameState: ⚠️ all_units_deployed check - Undeployed units: ["U_BLADE_CHAMPION_A (player 1)", "U_WITCHSEEKERS_C (player 1)", "U_CALADIUS_GRAV-TANK_E (player 1)", "U_WARBOSS_B (player 2)", "U_WARBOSS_IN_MEGA_ARMOUR_D (player 2)", "U_BATTLEWAGON_G (player 2)"]
Main: ⚠️ update_ui() - DEPLOYMENT phase - all_deployed: false
Main: ⚠️ Button state BEFORE change - disabled: true text: 'End Deployment'
[2025-11-27 20:10:12] [INFO.0000000] update_ui deployment check | Context: {"all_deployed":false,"button_text":"End Deployment","current_button_disabled":true}
Main: ⚠️ update_ui() - Setting button DISABLED (not all deployed)
Main: ⚠️ Button state AFTER disable - disabled: true
Main: ⚠️ Initial phase UI setup complete
Quick Save/Load enabled: [ key to save, ] key (or F9) to load
[Test] Result file found!
[Test] Action completed: success=true, message=Game state retrieved
[Test Artifacts] Report saved: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_artifacts/reports/unknown_test_2025-11-27T20-10-12.json
[GameInstance] Terminating instance: Host
[LogMonitor] Stopped monitoring: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251127_200951.log
[GameInstance] Terminating instance: Client
[LogMonitor] Stopped monitoring: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251127_200959.log

========================================
Starting Multiplayer Integration Test
========================================

  Running: test_deployment_undo_action

[TEST] test_deployment_undo_action
[Test] Launching host and client instances...
[GameInstance] Launching Host instance on port 8000
[GameInstance] Using project path: /Users/robertocallaghan/Documents/claude/godotv2/40k/
Godot Engine v4.5.1.stable.official.f62fdbde1 - https://godotengine.org
OpenGL API 4.1 INTEL-18.8.6 - Compatibility - Using Device: Intel Inc. - Intel(R) Iris(TM) Graphics 6100

TestModeHandler: Args -> ["--test-mode", "--position=100,100", "--resolution=600x480", "--auto-host", "--port=8000", "--instance-name=Host"]
[LogMonitor] Started monitoring: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251127_201005.log
[GameInstance] Monitoring log file: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251127_201005.log
[GameInstance] Successfully launched Host (PID: 75223)
[Test] Host instance launched successfully on port 8000
========================================
   RUNNING IN TEST MODE
   Config: { "window_position": (100, 100), "window_size": (600, 480), "is_host": true, "port": 8000, "instance_name": "Host" }
========================================
TestModeHandler: Command directories ready
  Commands: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_commands/commands
  Results: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_commands/results
[2025-11-27 20:10:17] [INFO.0000000] DebugLogger initialized - Session: 20251127_201017
[2025-11-27 20:10:17] [INFO.0000000] Log file: user://logs/debug_20251127_201017.log
[2025-11-27 20:10:17] [INFO.0000000] Real path: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251127_201017.log
[MeasuringTapeManager] Save persistence: false
Found armies in res://: ["orks", "adeptus_custodes", "space_marines", "A_C_test", "ORK_test"]
ArmyListManager initialized with 5 armies: ["orks", "adeptus_custodes", "space_marines", "A_C_test", "ORK_test"]
[2025-11-27 20:10:17] [INFO.0000000] DebugManager initialized
GameState: Loading default armies...
GameState: ArmyListManager not available, falling back to placeholder armies
GameState: Initializing placeholder armies for both players
GameState: Initializing placeholder army for player 1
GameState: Initializing placeholder army for player 2
ActionLogger: Started session 20251127_201017
StateSerializer: Pretty print enabled: true
SaveLoadManager: Current res:// directory: res://
SaveLoadManager: Project directory path: /Users/robertocallaghan/Documents/claude/godotv2/40k/
SaveLoadManager: Initialized save directories in project folder
SaveLoadManager: Save files will be stored at: /Users/robertocallaghan/Documents/claude/godotv2/40k/saves/
[PhaseManager] Ready - awaiting explicit phase initialization
[TerrainManager] Initializing terrain system
[TerrainManager] Added walls to terrain pieces
[TerrainManager] Loaded 12 terrain pieces
[EnhancedLineOfSight] Initialized
MissionManager: Initializing mission system
MissionManager: Set up 5 objectives for Strike Force deployment
  - obj_center at position (880.0, 1200.0)
  - obj_tl at position (400.0, 560.0)
  - obj_tr at position (1360.0, 560.0)
  - obj_bl at position (400.0, 1840.0)
  - obj_br at position (1360.0, 1840.0)
MissionManager: Initialized Take and Hold mission
[MeasuringTapeManager] Initialized with save_persistence: false
[LineOfSightManager] Initialized - Hold 'V' to check what can see the cursor position
TransportManager initialized
NetworkManager: Initialized
MainMenu: Initializing main menu
MainMenu: Loaded 5 armies: ["A C Test", "Adeptus Custodes", "ORK Test", "Orks", "Space Marines"]
MainMenu: Dropdowns populated with 5 armies
MainMenu: Multiplayer button visible: true
MainMenu: Signals connected
MainMenu: Save/Load dialog setup complete
MainMenu: Default armies set - Player 1: A C Test, Player 2: ORK Test
MainMenu: Ready with default selections
TestModeHandler: Set window position to (100, 100)
TestModeHandler: Set window size to (600, 480)
TestModeHandler: Scheduling auto-host...
SaveLoadDialog: Checking node references...
  - save_button path: VBoxContainer/SaveSection/SaveInputContainer/SaveButton
  - save_name_input path: VBoxContainer/SaveSection/SaveInputContainer/SaveNameInput
  - saves_list path: VBoxContainer/LoadSection/SavesScrollContainer/SavesList
  - load_button path: VBoxContainer/LoadSection/LoadButtonContainer/LoadButton
SaveLoadDialog: Connected save button
SaveLoadDialog: Connected save input
SaveLoadDialog: Connected saves list
SaveLoadDialog: Connected load button
SaveLoadDialog: Connected delete button
SaveLoadDialog: Connected cancel button
SaveLoadDialog UI signals connected
SaveLoadDialog: Found 29 save files
SaveLoadDialog: Populated list with 29 save files
SaveLoadDialog initialized successfully
[GameInstance] Launching Client instance on port 7778
[GameInstance] Using project path: /Users/robertocallaghan/Documents/claude/godotv2/40k/
TestModeHandler: Current scene: MainMenu
TestModeHandler: Triggering multiplayer mode...
MainMenu: Multiplayer button pressed
MultiplayerLobby: Army selection initialized with 5 armies
MultiplayerLobby: Ready
Godot Engine v4.5.1.stable.official.f62fdbde1 - https://godotengine.org
OpenGL API 4.1 INTEL-18.8.6 - Compatibility - Using Device: Intel Inc. - Intel(R) Iris(TM) Graphics 6100

TestModeHandler: Args -> ["--test-mode", "--position=800,100", "--resolution=600x480", "--auto-join", "--host-ip=127.0.0.1", "--host-port=8000", "--instance-name=Client"]
TestModeHandler: Lobby scene: MultiplayerLobby
TestModeHandler: Creating host on port 8000
MultiplayerLobby: Host button pressed
========================================
   YOU ARE: PLAYER 1 (HOST)
   Hosting on port: 7777
========================================
MultiplayerLobby: Successfully hosting on port 7777
TestModeHandler: Waiting for client to connect...
TestModeHandler: Listening for peer connection...
[LogMonitor] Started monitoring: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251127_201017.log
[GameInstance] Monitoring log file: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251127_201017.log
[GameInstance] Successfully launched Client (PID: 75234)
[Test] Client instance launched successfully
[Test] Waiting for client to connect to host...
[Test] Host performing action: get_game_state with params: {  }
[Test] Writing command file: host_75223_cmd_001.json
[Test] Waiting for result file...
[Test] Polling for result file: host_75223_cmd_001_result.json
TestModeHandler: Processing command file host_75223_cmd_001.json
TestModeHandler: Executing command from file: host_75223_cmd_001.json
TestModeHandler: Executing action: get_game_state
TestModeHandler: Handling get_game_state action
TestModeHandler: get_game_state - Phase: Deployment, Turn: 0, Player: 0
TestModeHandler: Result written to: host_75223_cmd_001_result.json
TestModeHandler: Command executed and result written
========================================
   RUNNING IN TEST MODE
   Config: { "window_position": (800, 100), "window_size": (600, 480), "is_host": false, "host_ip": "127.0.0.1", "host_port": 8000, "instance_name": "Client" }
========================================
TestModeHandler: Command directories ready
  Commands: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_commands/commands
  Results: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_commands/results
[2025-11-27 20:10:22] [INFO.0000000] DebugLogger initialized - Session: 20251127_201022
[2025-11-27 20:10:22] [INFO.0000000] Log file: user://logs/debug_20251127_201022.log
[2025-11-27 20:10:22] [INFO.0000000] Real path: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251127_201022.log
[MeasuringTapeManager] Save persistence: false
Found armies in res://: ["orks", "adeptus_custodes", "space_marines", "A_C_test", "ORK_test"]
ArmyListManager initialized with 5 armies: ["orks", "adeptus_custodes", "space_marines", "A_C_test", "ORK_test"]
[2025-11-27 20:10:22] [INFO.0000000] DebugManager initialized
GameState: Loading default armies...
GameState: ArmyListManager not available, falling back to placeholder armies
GameState: Initializing placeholder armies for both players
GameState: Initializing placeholder army for player 1
GameState: Initializing placeholder army for player 2
ActionLogger: Started session 20251127_201022
StateSerializer: Pretty print enabled: true
[Test] Result file found!
SaveLoadManager: Current res:// directory: res://
SaveLoadManager: Project directory path: /Users/robertocallaghan/Documents/claude/godotv2/40k/
SaveLoadManager: Initialized save directories in project folder
SaveLoadManager: Save files will be stored at: /Users/robertocallaghan/Documents/claude/godotv2/40k/saves/
[PhaseManager] Ready - awaiting explicit phase initialization
[TerrainManager] Initializing terrain system
[TerrainManager] Added walls to terrain pieces
[TerrainManager] Loaded 12 terrain pieces
[EnhancedLineOfSight] Initialized
MissionManager: Initializing mission system
MissionManager: Set up 5 objectives for Strike Force deployment
  - obj_center at position (880.0, 1200.0)
  - obj_tl at position (400.0, 560.0)
  - obj_tr at position (1360.0, 560.0)
  - obj_bl at position (400.0, 1840.0)
  - obj_br at position (1360.0, 1840.0)
MissionManager: Initialized Take and Hold mission
[MeasuringTapeManager] Initialized with save_persistence: false
[LineOfSightManager] Initialized - Hold 'V' to check what can see the cursor position
TransportManager initialized
NetworkManager: Initialized
[Test] Action completed: success=true, message=Game state retrieved
[Test] Connection verified - action simulation working!
MainMenu: Initializing main menu
MainMenu: Loaded 5 armies: ["A C Test", "Adeptus Custodes", "ORK Test", "Orks", "Space Marines"]
MainMenu: Dropdowns populated with 5 armies
MainMenu: Multiplayer button visible: true
MainMenu: Signals connected
MainMenu: Save/Load dialog setup complete
MainMenu: Default armies set - Player 1: A C Test, Player 2: ORK Test
MainMenu: Ready with default selections
TestModeHandler: Set window position to (800, 100)
TestModeHandler: Set window size to (600, 480)
TestModeHandler: Scheduling auto-join...
SaveLoadDialog: Checking node references...
  - save_button path: VBoxContainer/SaveSection/SaveInputContainer/SaveButton
  - save_name_input path: VBoxContainer/SaveSection/SaveInputContainer/SaveNameInput
  - saves_list path: VBoxContainer/LoadSection/SavesScrollContainer/SavesList
  - load_button path: VBoxContainer/LoadSection/LoadButtonContainer/LoadButton
SaveLoadDialog: Connected save button
SaveLoadDialog: Connected save input
SaveLoadDialog: Connected saves list
SaveLoadDialog: Connected load button
SaveLoadDialog: Connected delete button
SaveLoadDialog: Connected cancel button
SaveLoadDialog UI signals connected
SaveLoadDialog: Found 29 save files
SaveLoadDialog: Populated list with 29 save files
SaveLoadDialog initialized successfully
TestModeHandler: Current scene: MainMenu
TestModeHandler: Triggering multiplayer mode...
MainMenu: Multiplayer button pressed
MultiplayerLobby: Army selection initialized with 5 armies
MultiplayerLobby: Ready
[Test] Host performing action: get_available_units with params: {  }
[Test] Writing command file: host_75223_cmd_002.json
[Test] Waiting for result file...
[Test] Polling for result file: host_75223_cmd_002_result.json
TestModeHandler: Processing command file host_75223_cmd_002.json
TestModeHandler: Executing command from file: host_75223_cmd_002.json
TestModeHandler: Executing action: get_available_units
TestModeHandler: Handling get_available_units action
TestModeHandler: Player 1 units: ["U_INTERCESSORS_A", "U_TACTICAL_A"] (undeployed: ["U_INTERCESSORS_A", "U_TACTICAL_A"])
TestModeHandler: Player 2 units: ["U_BOYZ_A", "U_GRETCHIN_A"] (undeployed: ["U_BOYZ_A", "U_GRETCHIN_A"])
TestModeHandler: Result written to: host_75223_cmd_002_result.json
TestModeHandler: Command executed and result written
[Test] Result file found!
[Test] Action completed: success=true, message=Available units retrieved
[Test] Host performing action: deploy_unit with params: { "unit_id": "U_INTERCESSORS_A", "position": { "x": 100.0, "y": 100.0 } }
[Test] Writing command file: host_75223_cmd_003.json
[Test] Waiting for result file...
[Test] Polling for result file: host_75223_cmd_003_result.json
TestModeHandler: Processing command file host_75223_cmd_003.json
TestModeHandler: Executing command from file: host_75223_cmd_003.json
TestModeHandler: Executing action: deploy_unit
TestModeHandler: Handling deploy_unit action
GameManager: deploy_unit() called - unit_id: U_INTERCESSORS_A, position: (100.0, 100.0)
GameManager: Total units in GameState: 4
GameManager: Unit IDs: ["U_INTERCESSORS_A", "U_TACTICAL_A", "U_BOYZ_A", "U_GRETCHIN_A"]
GameManager: Switching active player from 1 to 2
GameManager: Applying result with 12 changes/diffs
GameManager: Setting units.U_INTERCESSORS_A.models.0.position = { "x": 100.0, "y": 100.0 }
GameManager: Setting units.U_INTERCESSORS_A.models.0.rotation = 0.0
GameManager: Setting units.U_INTERCESSORS_A.models.1.position = { "x": 100.0, "y": 100.0 }
GameManager: Setting units.U_INTERCESSORS_A.models.1.rotation = 0.0
GameManager: Setting units.U_INTERCESSORS_A.models.2.position = { "x": 100.0, "y": 100.0 }
GameManager: Setting units.U_INTERCESSORS_A.models.2.rotation = 0.0
GameManager: Setting units.U_INTERCESSORS_A.models.3.position = { "x": 100.0, "y": 100.0 }
GameManager: Setting units.U_INTERCESSORS_A.models.3.rotation = 0.0
GameManager: Setting units.U_INTERCESSORS_A.models.4.position = { "x": 100.0, "y": 100.0 }
GameManager: Setting units.U_INTERCESSORS_A.models.4.rotation = 0.0
GameManager: Setting units.U_INTERCESSORS_A.status = 2
GameManager: Setting meta.active_player = 2
GameManager: deploy_unit() result: success=true
TestModeHandler: Result written to: host_75223_cmd_003_result.json
TestModeHandler: Command executed and result written
[Test] Result file found!
[Test] Action completed: success=true, message=Unit deployed successfully
TestModeHandler: Lobby scene: MultiplayerLobby
TestModeHandler: Joining host at 127.0.0.1
MultiplayerLobby: Join button pressed
NetworkManager: Connecting to 127.0.0.1:7777
MultiplayerLobby: Attempting to join 127.0.0.1:7777
NetworkManager: Peer connected - 1
NetworkManager: Successfully connected to host
NetworkManager: Client set peer_to_player_map[879902943] = 2
========================================
   YOU ARE: PLAYER 2 (CLIENT)
   Connected to host
========================================
MultiplayerLobby: Peer connected - 1
MultiplayerLobby: Game started signal received
NetworkManager: Peer connected - 879902943
[GameState] MeasuringTapeManager not available
MultiplayerLobby: Peer connected - 879902943
TestModeHandler: Client connected!
MultiplayerLobby: Game started signal received
NetworkManager: Receiving initial state from host
[GameState] No measuring_tape data in save
NetworkManager: State synchronized
MultiplayerLobby: Game started signal received
MultiplayerLobby: Syncing army selection - Player 1 -> A_C_test
MultiplayerLobby: Syncing army selection - Player 2 -> ORK_test
[Test] Host performing action: undo_deployment with params: {  }
[Test] Writing command file: host_75223_cmd_004.json
[Test] Waiting for result file...
[Test] Polling for result file: host_75223_cmd_004_result.json
TestModeHandler: Processing command file host_75223_cmd_004.json
TestModeHandler: Executing command from file: host_75223_cmd_004.json
TestModeHandler: Executing action: undo_deployment
TestModeHandler: Handling undo_deployment action
GameManager: undo_last_action() called
WARNING: GameManager: No actions to undo
     at: push_warning (core/variant/variant_utility.cpp:1034)
     GDScript backtrace (most recent call first):
         [0] undo_last_action (res://autoloads/GameManager.gd:753)
         [1] _handle_undo_deployment (res://autoloads/TestModeHandler.gd:656)
         [2] _execute_command (res://autoloads/TestModeHandler.gd:438)
         [3] _execute_command_file (res://autoloads/TestModeHandler.gd:415)
         [4] _check_for_commands (res://autoloads/TestModeHandler.gd:386)
         [5] _process (res://autoloads/TestModeHandler.gd:372)
TestModeHandler: Result written to: host_75223_cmd_004_result.json
TestModeHandler: Command executed and result written
[Test] Result file found!
[Test] Action completed: success=false, message=No action to undo
[TEST] Undo result: success=false message=No action to undo
TestModeHandler: Starting game...
MultiplayerLobby: Start game button pressed
MultiplayerLobby: Loading armies...
MultiplayerLobby: Loading A_C_test for Player 1
Loading army list: A_C_test for player 1
Processed unit: U_BLADE_CHAMPION_A for player 1
Processed unit: U_WITCHSEEKERS_C for player 1
Processed unit: U_CALADIUS_GRAV-TANK_E for player 1
Successfully loaded army: A_C_test with 3 units
MultiplayerLobby: Player 1 army loaded, has 3 units
Applying army to game state for player: 1
Removing 0 existing units for player 1
Added unit: U_BLADE_CHAMPION_A (Blade Champion)
Added unit: U_WITCHSEEKERS_C (Witchseekers)
Added unit: U_CALADIUS_GRAV-TANK_E (Caladius Grav-tank)
Set faction for player 1: Adeptus Custodes
Army applied successfully. Total units in game: 3
MultiplayerLobby: After applying P1 army, GameState has 3 units
MultiplayerLobby: Loading ORK_test for Player 2
Loading army list: ORK_test for player 2
Processed unit: U_WARBOSS_B for player 2
Processed unit: U_WARBOSS_IN_MEGA_ARMOUR_D for player 2
[2025-11-27 20:10:26] [DEBUG.0000000] Parsed transport capacity keywords | Context: {"description":"This model has a transport capacity of 22 ORKS INFANTRY models. Each MEGA ARMOUR model takes up the space of 2 models. This model cannot transport models that are JUMP PACK models.","keywords":["ORKS","INFANTRY"],"unit_id":"U_BATTLEWAGON_G"}
Processed unit: U_BATTLEWAGON_G for player 2
Successfully loaded army: ORK_test with 3 units
MultiplayerLobby: Player 2 army loaded, has 3 units
Applying army to game state for player: 2
Removing 0 existing units for player 2
Added unit: U_WARBOSS_B (Warboss)
Added unit: U_WARBOSS_IN_MEGA_ARMOUR_D (Warboss in Mega Armour)
Added unit: U_BATTLEWAGON_G (Battlewagon)
Set faction for player 2: Unknown
Army applied successfully. Total units in game: 6
MultiplayerLobby: After applying P2 army, GameState has 6 units
MultiplayerLobby: Armies loaded. Total units: 6
MultiplayerLobby: Syncing loaded armies to clients...
[GameState] MeasuringTapeManager not available
MultiplayerLobby: Snapshot has 6 units
MultiplayerLobby: Sent army snapshot to peer 879902943
NetworkManager: Receiving initial state from host
[GameState] No measuring_tape data in save
NetworkManager: State synchronized
MultiplayerLobby: Game started signal received
NetworkManager: Starting multiplayer game - transitioning to Main scene
NetworkManager: Units in GameState BEFORE scene change: 6
NetworkManager: Unit IDs: ["U_BLADE_CHAMPION_A", "U_WITCHSEEKERS_C", "U_CALADIUS_GRAV-TANK_E", "U_WARBOSS_B", "U_WARBOSS_IN_MEGA_ARMOUR_D", "U_BATTLEWAGON_G"]
NetworkManager: Starting multiplayer game - transitioning to Main scene
NetworkManager: Units in GameState BEFORE scene change: 6
NetworkManager: Unit IDs: ["U_BLADE_CHAMPION_A", "U_WITCHSEEKERS_C", "U_CALADIUS_GRAV-TANK_E", "U_WARBOSS_B", "U_WARBOSS_IN_MEGA_ARMOUR_D", "U_BATTLEWAGON_G"]
[TEST] Undo test completed

========================================
Cleaning up Multiplayer Test
========================================

[Test] Host performing action: get_game_state with params: {  }
[Test] Writing command file: host_75223_cmd_005.json
[Test] Waiting for result file...
[Test] Polling for result file: host_75223_cmd_005_result.json
MultiplayerLobby: Game started signal received
MultiplayerLobby: Game started signal received
MultiplayerLobby: Game start RPC sent to all peers
TestModeHandler: Processing command file host_75223_cmd_005.json
TestModeHandler: Executing command from file: host_75223_cmd_005.json
TestModeHandler: Executing action: get_game_state
TestModeHandler: Handling get_game_state action
TestModeHandler: get_game_state - Phase: Deployment, Turn: 0, Player: 0
TestModeHandler: Result written to: host_75223_cmd_005_result.json
TestModeHandler: Command executed and result written
[Test] Result file found!
[Test] Action completed: success=true, message=Game state retrieved
[Test Artifacts] Report saved: /Users/robertocallaghan/Documents/claude/godotv2/40k/test_results/test_artifacts/reports/unknown_test_2025-11-27T20-10-27.json
[GameInstance] Terminating instance: Host
[LogMonitor] Stopped monitoring: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251127_201005.log
[GameInstance] Terminating instance: Client
[LogMonitor] Stopped monitoring: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251127_201017.log
Running tests in: res://tests/integration//test_assault_keyword_integration.gd
  Running: test_validate_shoot_allows_assault_weapon_after_advance
  Running: test_validate_shoot_blocks_non_assault_weapon_after_advance
  Running: test_validate_shoot_allows_all_weapons_without_advance
  Running: test_validate_shoot_blocks_fell_back_unit
  Running: test_is_assault_weapon_function
  Running: test_unit_has_assault_weapons_function
Running tests in: res://tests/integration//test_heavy_keyword_integration.gd
  Running: test_heavy_bonus_applied_when_unit_remained_stationary
SCRIPT ERROR: Invalid operands 'int' and 'bool' in operator '=='.
          at: assert_true (res://addons/gut/test.gd:37)
          GDScript backtrace (most recent call first):
              [0] assert_true (res://addons/gut/test.gd:37)
              [1] test_heavy_bonus_applied_when_unit_remained_stationary (res://tests/integration/test_heavy_keyword_integration.gd:280)
              [2] run_test_file (res://addons/gut/gut_cmdln.gd:154)
              [3] run_tests (res://addons/gut/gut_cmdln.gd:81)
              [4] _init (res://addons/gut/gut_cmdln.gd:15)
  Running: test_heavy_bonus_not_applied_when_unit_moved
  Running: test_heavy_bonus_not_applied_to_non_heavy_weapon
SCRIPT ERROR: Invalid operands 'int' and 'bool' in operator '=='.
          at: assert_false (res://addons/gut/test.gd:40)
          GDScript backtrace (most recent call first):
              [0] assert_false (res://addons/gut/test.gd:40)
              [1] test_heavy_bonus_not_applied_to_non_heavy_weapon (res://tests/integration/test_heavy_keyword_integration.gd:302)
              [2] run_test_file (res://addons/gut/gut_cmdln.gd:154)
              [3] run_tests (res://addons/gut/gut_cmdln.gd:81)
              [4] _init (res://addons/gut/gut_cmdln.gd:15)
  Running: test_heavy_bonus_not_applied_when_remained_stationary_flag_not_set
  Running: test_heavy_bonus_capped_at_plus_one
  Running: test_heavy_bonus_cancels_with_minus_one
  Running: test_heavy_bonus_with_additional_plus_one_still_capped
  Running: test_is_heavy_weapon_function
  Running: test_unit_has_heavy_weapons_function
  Running: test_remained_stationary_flag_lifecycle
  Running: test_moved_and_remained_stationary_mutually_exclusive

=== Test Results ===
Total: 60, Passed: 57, Failed: 3
TestModeHandler: Args -> ["-s", "addons/gut/gut_cmdln.gd", "-gdir", "res://tests/integration/", "-gprefix", "test_", "-gsuffix", ".gd", "-gexit"]
[2025-11-27 20:10:31] [INFO.0000000] DebugLogger initialized - Session: 20251127_201031
[2025-11-27 20:10:31] [INFO.0000000] Log file: user://logs/debug_20251127_201031.log
[2025-11-27 20:10:31] [INFO.0000000] Real path: /Users/robertocallaghan/Library/Application Support/Godot/app_userdata/40k/logs/debug_20251127_201031.log
[MeasuringTapeManager] Save persistence: false
Found armies in res://: ["orks", "adeptus_custodes", "space_marines", "A_C_test", "ORK_test"]
ArmyListManager initialized with 5 armies: ["orks", "adeptus_custodes", "space_marines", "A_C_test", "ORK_test"]
[2025-11-27 20:10:31] [INFO.0000000] DebugManager initialized
GameState: Loading default armies...
GameState: ArmyListManager not available, falling back to placeholder armies
GameState: Initializing placeholder armies for both players
GameState: Initializing placeholder army for player 1
GameState: Initializing placeholder army for player 2
ActionLogger: Started session 20251127_201031
StateSerializer: Pretty print enabled: true
SaveLoadManager: Current res:// directory: res://
SaveLoadManager: Project directory path: /Users/robertocallaghan/Documents/claude/godotv2/40k/
SaveLoadManager: Initialized save directories in project folder
SaveLoadManager: Save files will be stored at: /Users/robertocallaghan/Documents/claude/godotv2/40k/saves/
[PhaseManager] Ready - awaiting explicit phase initialization
[TerrainManager] Initializing terrain system
[TerrainManager] Added walls to terrain pieces
[TerrainManager] Loaded 12 terrain pieces
[EnhancedLineOfSight] Initialized
MissionManager: Initializing mission system
MissionManager: Set up 5 objectives for Strike Force deployment
  - obj_center at position (880.0, 1200.0)
  - obj_tl at position (400.0, 560.0)
  - obj_tr at position (1360.0, 560.0)
  - obj_bl at position (400.0, 1840.0)
  - obj_br at position (1360.0, 1840.0)
MissionManager: Initialized Take and Hold mission
[MeasuringTapeManager] Initialized with save_persistence: false
[LineOfSightManager] Initialized - Hold 'V' to check what can see the cursor position
TransportManager initialized
NetworkManager: Initialized
[2025-11-27 20:10:31] [INFO.0000000] DebugLogger shutting down - Session: 20251127_201031
